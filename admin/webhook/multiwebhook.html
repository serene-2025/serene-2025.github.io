<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>üöÄ Webhook Manager</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen p-8">
  <div class="max-w-3xl mx-auto bg-white p-6 rounded-2xl shadow">
    <h1 class="text-2xl font-bold text-blue-700 mb-6">Webhook Manager</h1>

    <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏° Webhook -->
    <div class="mb-6 flex gap-2">
      <input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠ Webhook" class="border p-2 rounded flex-1" />
      <input id="url" placeholder="Webhook URL" class="border p-2 rounded flex-1" />
      <button id="add" class="bg-blue-600 text-white px-4 py-2 rounded">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
    </div>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
    <table class="w-full border rounded-lg">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-2 text-left">‡∏ä‡∏∑‡πà‡∏≠</th>
          <th class="p-2 text-left">URL</th>
          <th class="p-2 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        </tr>
      </thead>
      <tbody id="list"></tbody>
    </table>
  </div>

  <script>
    const supabaseUrl = "https://kiumelolsilduqnvrekf.supabase.co"; // üî∏ ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtpdW1lbG9sc2lsZHVxbnZyZWtmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwODUyNzYsImV4cCI6MjA3MjY2MTI3Nn0.3hCFJiDrkgNJQEggS8MkRnxlhvqIMAax_a73NJq14gU"; // üî∏ ‡πÉ‡∏™‡πà API Key
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    async function loadWebhooks() {
      const { data } = await supabase.from("webhooks").select("*").order("id", { ascending: false });
      const list = document.getElementById("list");
      list.innerHTML = data.map(w => `
        <tr>
          <td class="border p-2">${w.name}</td>
          <td class="border p-2 text-blue-600">${w.url}</td>
          <td class="border p-2 text-center">
            ${w.active ? '<span class="text-green-600">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>' : '<span class="text-gray-400">‡∏õ‡∏¥‡∏î</span>'}
          </td>
        </tr>
      `).join('');
    }

    document.getElementById("add").onclick = async () => {
      const name = document.getElementById("name").value.trim();
      const url = document.getElementById("url").value.trim();
      if (!name || !url) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞ URL ‡∏Å‡πà‡∏≠‡∏ô");

      await supabase.from("webhooks").insert([{ name, url, active: true }]);
      await loadWebhooks();

      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Log ‡πÑ‡∏õ Google Sheet (Apps Script)
      fetch("https://script.google.com/macros/s/AKfycbwfAN_0AHxoE33K_neWaNaY3EO_0dt1PjQFAH6sKDrmqg2oLHyhN4tH--uSWrW2sbJ43A/exec", {
        method: "POST",
        body: JSON.stringify({ name, url, status: "Added" })
      });

      document.getElementById("name").value = "";
      document.getElementById("url").value = "";
    };

    loadWebhooks();
  </script>
</body>
</html>
