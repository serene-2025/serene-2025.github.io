<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ - ‡∏ô‡∏¥‡∏ï‡∏¥‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { 
            font-family: 'Sarabun', sans-serif; 
            -webkit-tap-highlight-color: transparent;
        }
        .loading { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        /* Modern animations */
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        .slide-up { animation: slideUp 0.6s ease-out; }
        .bounce-in { animation: bounceIn 0.8s ease-out; }
        .pulse-success { animation: pulseSuccess 0.6s ease-in-out; }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes pulseSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); box-shadow: 0 0 20px rgba(34, 197, 94, 0.4); }
            100% { transform: scale(1); }
        }
        
        /* Glass morphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        /* Gradient backgrounds */
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
        }
        
        .gradient-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
        }
        
        /* Hover effects */
        .hover-lift {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        @media (hover: hover) {
            .hover-lift:hover {
                transform: translateY(-3px);
                box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            }
        }
        .active-scale:active {
            transform: scale(0.96);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 10px; }
        
        /* Search highlight */
        .highlight {
            background-color: #fef08a;
            padding: 0px 2px;
            border-radius: 2px;
            font-weight: 600;
        }

        /* Table row animations */
        .table-row-enter {
            animation: tableRowEnter 0.3s ease-out both;
        }

        @keyframes tableRowEnter {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Safe area for mobile bottom nav */
        @supports (padding-bottom: env(safe-area-inset-bottom)) {
            .pb-safe { padding-bottom: calc(env(safe-area-inset-bottom) + 5rem); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex flex-col pb-24 md:pb-0">
    
    <!-- Top Navigation (Desktop) / Header (Mobile) -->
    <nav class="glass shadow-lg mb-4 md:mb-8 sticky top-0 z-40 transition-all">
        <div class="container mx-auto px-4 md:px-6">
            <!-- Desktop Navigation -->
            <div class="hidden md:flex justify-between items-center py-5">
                <h1 class="text-3xl font-bold text-white drop-shadow-md">üèòÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ</h1>
                <div class="flex space-x-3">
                    <button id="registerTab" class="px-6 py-2.5 bg-white bg-opacity-20 text-white rounded-xl font-medium hover-lift backdrop-blur-sm border border-white border-opacity-30 transition-all duration-300 shadow-sm flex items-center">
                        <span class="mr-2">üìù</span> ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
                    </button>
                    <button id="dashboardTab" class="px-6 py-2.5 bg-white bg-opacity-10 text-white rounded-xl font-medium hover-lift backdrop-blur-sm border border-white border-opacity-20 transition-all duration-300 flex items-center">
                        <span class="mr-2">üìã</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
                    </button>
                </div>
            </div>
            
            <!-- Mobile Header -->
            <div class="md:hidden py-4 flex justify-center items-center">
                <h1 id="mobilePageTitle" class="text-xl font-bold text-white drop-shadow-md">üìù ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ‡πÉ‡∏´‡∏°‡πà</h1>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <div class="container mx-auto px-4 flex-1">
        
        <!-- ==============================
             Registration Form Section 
             ============================== -->
        <div id="registerSection" class="max-w-3xl mx-auto slide-up">
            <div class="bg-white/95 backdrop-blur-xl rounded-[2rem] shadow-2xl p-6 md:p-10 mb-8 border border-white/40">
                <div class="text-center mb-6 hidden md:block">
                    <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full mb-3 shadow-lg">
                        <span class="text-3xl text-white">üöó</span>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-800 bg-gradient-to-r from-purple-600 to-indigo-600 bg-clip-text text-transparent">
                        ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
                    </h2>
                </div>
                
                <form id="vehicleForm" class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    
                    <!-- ‡∏ä‡∏∑‡πà‡∏≠ ‡∏™‡∏Å‡∏∏‡∏• -->
                    <div class="md:col-span-2 group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2 ml-1">
                            üë§ ‡∏ä‡∏∑‡πà‡∏≠ ‡∏™‡∏Å‡∏∏‡∏• <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <input type="text" id="fullName" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡∏≠‡∏ô‡∏∏‡∏ä‡∏≤" class="w-full px-4 py-3.5 pl-11 bg-gray-50/50 border-2 border-gray-200 rounded-2xl focus:bg-white focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 transition-all duration-300 text-gray-800">
                            <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">‚úçÔ∏è</span>
                        </div>
                    </div>
                    
                    <!-- ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà -->
                    <div class="group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2 ml-1">
                            üè† ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <input type="text" id="houseNumber" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 998/5" class="w-full px-4 py-3.5 pl-11 bg-gray-50/50 border-2 border-gray-200 rounded-2xl focus:bg-white focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 transition-all duration-300 text-gray-800">
                            <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">üèòÔ∏è</span>
                        </div>
                    </div>
                    
                    <!-- ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ -->
                    <div class="group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2 ml-1">
                            üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <input type="tel" id="phoneNumber" required pattern="0[0-9]{8,9}" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0812345678" class="w-full px-4 py-3.5 pl-11 bg-gray-50/50 border-2 border-gray-200 rounded-2xl focus:bg-white focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 transition-all duration-300 text-gray-800">
                            <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">‚òéÔ∏è</span>
                        </div>
                    </div>
                    
                    <!-- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ -->
                    <div class="group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2 ml-1">
                            üöô ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <select id="vehicleType" required class="w-full px-4 py-3.5 pl-11 bg-gray-50/50 border-2 border-gray-200 rounded-2xl focus:bg-white focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 transition-all duration-300 appearance-none text-gray-800">
                                <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ</option>
                                <option value="‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå">üöó ‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</option>
                                <option value="‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå">üèçÔ∏è ‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå</option>
                                <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üöõ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                            </select>
                            <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">üöò</span>
                            <span class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none">‚ñº</span>
                        </div>
                    </div>
                    
                    <!-- ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ -->
                    <div class="group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2 ml-1">
                            üî¢ ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ <span class="text-red-500">*</span>
                        </label>
                        <div class="relative flex gap-2">
                            <!-- ‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô -->
                            <div class="relative flex-1">
                                <input type="text" id="licensePlate" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏Ç1234" class="w-full px-4 py-3.5 pl-11 bg-gray-50/50 border-2 border-gray-200 rounded-2xl focus:bg-white focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 transition-all duration-300 font-mono text-gray-800 uppercase">
                                <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">üè∑Ô∏è</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î -->
                    <div class="md:col-span-2 group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2 ml-1">
                            üìç ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <input type="text" id="province" required list="provinceList" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î" class="w-full px-4 py-3.5 pl-11 bg-gray-50/50 border-2 border-gray-200 rounded-2xl focus:bg-white focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 transition-all duration-300 text-gray-800">
                            <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">üó∫Ô∏è</span>
                            <datalist id="provinceList">
                                <option value="‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£"><option value="‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà"><option value="‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ"><option value="‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå"><option value="‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£"><option value="‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô"><option value="‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ"><option value="‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤"><option value="‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ"><option value="‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó"><option value="‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥"><option value="‡∏ä‡∏∏‡∏°‡∏û‡∏£"><option value="‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢"><option value="‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà"><option value="‡∏ï‡∏£‡∏±‡∏á"><option value="‡∏ï‡∏£‡∏≤‡∏î"><option value="‡∏ï‡∏≤‡∏Å"><option value="‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å"><option value="‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°"><option value="‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏°"><option value="‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤"><option value="‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä"><option value="‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå"><option value="‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ"><option value="‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™"><option value="‡∏ô‡πà‡∏≤‡∏ô"><option value="‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨"><option value="‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå"><option value="‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ"><option value="‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå"><option value="‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ"><option value="‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ"><option value="‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤"><option value="‡∏û‡∏∞‡πÄ‡∏¢‡∏≤"><option value="‡∏û‡∏±‡∏á‡∏á‡∏≤"><option value="‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á"><option value="‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£"><option value="‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å"><option value="‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ"><option value="‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå"><option value="‡πÅ‡∏û‡∏£‡πà"><option value="‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï"><option value="‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°"><option value="‡∏°‡∏∏‡∏Å‡∏î‡∏≤‡∏´‡∏≤‡∏£"><option value="‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô"><option value="‡∏¢‡πÇ‡∏™‡∏ò‡∏£"><option value="‡∏¢‡∏∞‡∏•‡∏≤"><option value="‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î"><option value="‡∏£‡∏∞‡∏ô‡∏≠‡∏á"><option value="‡∏£‡∏∞‡∏¢‡∏≠‡∏á"><option value="‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ"><option value="‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ"><option value="‡∏•‡∏≥‡∏õ‡∏≤‡∏á"><option value="‡∏•‡∏≥‡∏û‡∏π‡∏ô"><option value="‡πÄ‡∏•‡∏¢"><option value="‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©"><option value="‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£"><option value="‡∏™‡∏á‡∏Ç‡∏•‡∏≤"><option value="‡∏™‡∏ï‡∏π‡∏•"><option value="‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£"><option value="‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°"><option value="‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£"><option value="‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß"><option value="‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ"><option value="‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ"><option value="‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢"><option value="‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏ö‡∏∏‡∏£‡∏µ"><option value="‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ"><option value="‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå"><option value="‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢"><option value="‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π"><option value="‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á"><option value="‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏à‡∏£‡∏¥‡∏ç"><option value="‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ"><option value="‡∏≠‡∏∏‡∏ï‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡πå"><option value="‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ò‡∏≤‡∏ô‡∏µ"><option value="‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ">
                            </datalist>
                        </div>
                    </div>
                    
                    <!-- ‡∏†‡∏≤‡∏û‡∏£‡∏ñ -->
                    <div class="md:col-span-2 group mt-2">
                        <label class="block text-sm font-semibold text-gray-700 mb-2 ml-1">
                            üì∏ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ñ <span class="text-red-500">*</span>
                        </label>
                        <div class="border-2 border-dashed border-purple-300 rounded-[1.5rem] p-6 text-center hover:border-purple-500 transition-all duration-300 bg-gray-50/50 hover-lift active-scale">
                            <input type="file" id="vehicleImage" accept="image/*" required class="hidden">
                            
                            <div id="imageUploadArea" class="cursor-pointer flex flex-col items-center justify-center" onclick="document.getElementById('vehicleImage').click()">
                                <div class="w-14 h-14 bg-white rounded-full flex items-center justify-center shadow-md mb-3 text-2xl text-purple-600">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                                </div>
                                <span class="text-purple-700 font-semibold text-base mb-1">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û</span>
                                <span class="text-xs text-gray-500">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå JPG, PNG ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB</span>
                            </div>
                            
                            <div id="imagePreview" class="hidden relative inline-block mx-auto">
                                <img id="previewImg" class="max-h-48 rounded-xl shadow-md border-2 border-white object-contain">
                                <button type="button" id="removeImageBtn" class="absolute -top-3 -right-3 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-red-600 active-scale">
                                    ‚úï
                                </button>
                                <p id="fileNameText" class="text-xs text-gray-600 mt-2 truncate max-w-[200px]"></p>
                            </div>
                        </div>
                    </div>

                    <input type="hidden" id="status" value="‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö">

                    <!-- Submit Button -->
                    <div class="md:col-span-2 mt-4">
                        <button type="submit" id="submitBtn" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-bold py-4 px-6 rounded-2xl transition-all duration-300 shadow-xl active-scale disabled:opacity-70 disabled:cursor-not-allowed">
                            <span id="submitText" class="flex items-center justify-center text-lg">
                                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
                            </span>
                            <div id="submitLoading" class="hidden flex items-center justify-center text-lg">
                                <div class="loading w-5 h-5 border-2 border-white border-t-transparent rounded-full mr-2"></div>
                                ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
                            </div>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ==============================
             Dashboard / List Section 
             ============================== -->
        <div id="dashboardSection" class="hidden">
            
            <!-- Summary Cards -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-5 mb-6 bounce-in">
                <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-sm border border-gray-100 p-4 flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 text-xl shrink-0">üöó</div>
                    <div>
                        <p class="text-xs text-gray-500 font-medium">‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</p>
                        <p id="carCount" class="text-xl font-bold text-gray-800">0</p>
                    </div>
                </div>
                <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-sm border border-gray-100 p-4 flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600 text-xl shrink-0">üèçÔ∏è</div>
                    <div>
                        <p class="text-xs text-gray-500 font-medium">‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÑ‡∏ã‡∏Ñ‡πå</p>
                        <p id="motorcycleCount" class="text-xl font-bold text-gray-800">0</p>
                    </div>
                </div>
                <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-sm border border-gray-100 p-4 flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 text-xl shrink-0">üöõ</div>
                    <div>
                        <p class="text-xs text-gray-500 font-medium">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</p>
                        <p id="otherCount" class="text-xl font-bold text-gray-800">0</p>
                    </div>
                </div>
                <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-sm border border-gray-100 p-4 flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 text-xl shrink-0">üìã</div>
                    <div>
                        <p class="text-xs text-gray-500 font-medium">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                        <p id="totalCount" class="text-xl font-bold text-gray-800">0</p>
                    </div>
                </div>
            </div>

            <!-- List Container -->
            <div class="bg-white/95 backdrop-blur-xl rounded-[2rem] shadow-xl p-4 md:p-8 mb-4 border border-white/40 slide-up">
                
                <!-- Toolbar: Search & Filter -->
                <div class="flex flex-col md:flex-row gap-3 mb-5">
                    <div class="flex flex-col sm:flex-row gap-2 flex-1">
                        <select id="searchTypeFilter" class="w-full sm:w-auto px-3 py-3 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500/30 text-gray-700 font-medium transition-all">
                            <option value="all">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            <option value="house">üè† ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà (‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô 100%)</option>
                            <option value="plate">üè∑Ô∏è ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ</option>
                        </select>
                        <div class="relative flex-1">
                            <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ, ‡∏ä‡∏∑‡πà‡∏≠..." class="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500/30 focus:border-indigo-500 text-sm transition-all">
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">üîç</span>
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                        <select id="vehicleTypeFilter" class="flex-1 md:flex-none px-3 py-3 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500/30 text-gray-700">
                            <option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                            <option value="‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå">üöó ‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</option>
                            <option value="‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå">üèçÔ∏è ‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå</option>
                            <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üöõ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                        </select>
                        <button id="refreshDataBtn" class="px-4 py-3 bg-indigo-50 text-indigo-600 rounded-xl border border-indigo-100 active-scale shadow-sm">
                            üîÑ
                        </button>
                    </div>
                </div>

                <div class="flex justify-between items-center mb-3 px-1">
                    <div id="searchResults" class="text-sm font-medium text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
                </div>

                <!-- Desktop Table View (Hidden on mobile) -->
                <div id="desktopTableView" class="hidden md:block overflow-x-auto rounded-xl border border-gray-200">
                    <table class="w-full border-collapse bg-white">
                        <thead>
                            <tr class="bg-gray-50 border-b border-gray-200 text-gray-600 text-sm">
                                <th class="px-4 py-3 text-center font-semibold">‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th>
                                <th class="px-4 py-3 text-center font-semibold">‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ</th>
                                <th class="px-4 py-3 text-center font-semibold">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                                <th class="px-4 py-3 text-center font-semibold">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th class="px-4 py-3 text-center font-semibold">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                            </tr>
                        </thead>
                        <tbody id="dataTableBody" class="divide-y divide-gray-100">
                            <tr><td colspan="5" class="px-4 py-8 text-center text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- Mobile Card View (Optimized UI) -->
                <div id="mobileCardView" class="block md:hidden space-y-3 min-h-[300px]">
                    <!-- Cards injected by JS -->
                </div>

                <!-- Pagination -->
                <div id="paginationContainer" class="mt-6 flex justify-between items-center hidden">
                    <div class="text-xs text-gray-500 hidden sm:block">
                        ‡πÅ‡∏™‡∏î‡∏á <span id="showingFrom">1</span> - <span id="showingTo">10</span> ‡∏à‡∏≤‡∏Å <span id="totalItems">0</span>
                    </div>
                    <div class="flex gap-1 overflow-x-auto w-full sm:w-auto justify-center" id="pageNumbersContainer">
                        <!-- Pagination buttons -->
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>

    <!-- ==============================
         Mobile Bottom Navigation 
         ============================== -->
    <div class="md:hidden fixed bottom-0 w-full bg-white/95 backdrop-blur-lg border-t border-gray-200 z-50 flex justify-around px-2 py-1 pb-safe shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
        <button id="navTabRegister" class="flex-1 flex flex-col items-center py-2 px-1 text-indigo-600 rounded-xl transition-colors active-scale">
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
            <span class="text-[10px] font-bold">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</span>
        </button>
        <button id="navTabDashboard" class="flex-1 flex flex-col items-center py-2 px-1 text-gray-400 hover:text-gray-600 rounded-xl transition-colors active-scale">
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
            <span class="text-[10px] font-bold">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏•‡∏á</span>
        </button>
    </div>

    <!-- Modals -->
    <!-- Image Modal -->
    <div id="imageModal" class="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-[100] hidden opacity-0 transition-opacity duration-300">
        <div class="relative w-full max-w-lg mx-4 flex flex-col items-center">
            <button id="closeImageModal" class="absolute -top-12 right-0 text-white p-2 text-3xl opacity-80 hover:opacity-100 active-scale">‚úï</button>
            <img id="modalImage" src="" class="max-w-full max-h-[70vh] object-contain rounded-xl shadow-2xl mb-4 bg-white/10">
            
            <!-- Details Card under Image -->
            <div class="bg-white w-full rounded-2xl p-4 shadow-xl text-left">
                <div class="flex items-center justify-between mb-2">
                    <h3 id="modalImageTitle" class="text-xl font-bold font-mono text-gray-800"></h3>
                    <span id="modalStatusBadge" class="text-xs px-2 py-1 rounded-md font-bold"></span>
                </div>
                <p id="modalProvince" class="text-sm text-gray-500 mb-3"></p>
                <div class="grid grid-cols-2 gap-2 text-sm text-gray-700 bg-gray-50 p-3 rounded-xl">
                    <div><span class="mr-1 opacity-70">üè†</span> <span id="modalHouseNumber" class="font-medium"></span></div>
                    <div><span class="mr-1 opacity-70">üì±</span> <span id="modalPhoneNumber"></span></div>
                    <div class="col-span-2"><span class="mr-1 opacity-70">üë§</span> <span id="modalOwnerName"></span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100] hidden">
        <div class="bg-white rounded-3xl p-8 max-w-sm mx-4 w-full text-center bounce-in shadow-2xl">
            <svg class="success-checkmark" viewBox="0 0 52 52">
                <circle class="success-checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                <path class="success-checkmark__check" fill="none" d="m14.1 27.2l7.1 7.2 16.7-16.8"/>
            </svg>
            <h3 class="text-2xl font-bold text-gray-800 mb-2 mt-4">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
            <p class="text-gray-500 mb-6">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
            <button id="closeSuccessModal" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3.5 rounded-xl transition-all active-scale">
                ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
            </button>
        </div>
    </div>

    <!-- Toast Message -->
    <div id="toastMessage" class="fixed top-5 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-5 py-3 rounded-full shadow-2xl transform -translate-y-20 opacity-0 transition-all duration-300 z-[110] flex items-center gap-2 font-medium text-sm w-max">
        <span id="toastIcon">‚ÑπÔ∏è</span>
        <span id="toastText">Message</span>
    </div>

    <script>
        // Configuration - Direct Google Sheets access
        const SPREADSHEET_ID = '1kwFxoXRb6JsvkcglUpuXkYYRqZiOuAWWAWG-4kot3XM';
        const SHEET_NAME = '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ';
        
        // Fallback API URL for form submissions
        const API_URL = 'https://script.google.com/macros/s/AKfycbz608VbnbGi89kV01UgPMtZuYdRHNfCXTrnHPIRHdjBRzTkhbwr0DWrB5oElXnyMvGIew/exec';
        
        // Global variables
        let vehicleData = [];
        let filteredData = [];
        let currentPage = 1;
        let itemsPerPage = 15; // Set to 15 for better mobile scrolling
        let autoRefreshInterval;
        
        // --- Navigation Logic ---
        const sections = {
            register: document.getElementById('registerSection'),
            dashboard: document.getElementById('dashboardSection')
        };
        
        // Desktop Tabs
        document.getElementById('registerTab').addEventListener('click', () => switchTab('register'));
        document.getElementById('dashboardTab').addEventListener('click', () => switchTab('dashboard'));
        
        // Mobile Bottom Nav Tabs
        document.getElementById('navTabRegister').addEventListener('click', () => switchTab('register'));
        document.getElementById('navTabDashboard').addEventListener('click', () => switchTab('dashboard'));

        function switchTab(tab) {
            // Content toggle
            if (tab === 'register') {
                sections.register.classList.remove('hidden');
                sections.dashboard.classList.add('hidden');
                document.getElementById('mobilePageTitle').innerHTML = 'üìù ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ‡πÉ‡∏´‡∏°‡πà';
                window.scrollTo({ top: 0, behavior: 'smooth' });
                stopAutoRefresh();
            } else {
                sections.register.classList.add('hidden');
                sections.dashboard.classList.remove('hidden');
                document.getElementById('mobilePageTitle').innerHTML = 'üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô';
                if (vehicleData.length === 0) loadDashboardData();
                startAutoRefresh();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            // Desktop Tab UI Update
            const dtReg = document.getElementById('registerTab');
            const dtDash = document.getElementById('dashboardTab');
            if (tab === 'register') {
                dtReg.classList.replace('bg-opacity-10', 'bg-opacity-20');
                dtReg.classList.add('border-opacity-30');
                dtDash.classList.replace('bg-opacity-20', 'bg-opacity-10');
                dtDash.classList.remove('border-opacity-30');
            } else {
                dtDash.classList.replace('bg-opacity-10', 'bg-opacity-20');
                dtDash.classList.add('border-opacity-30');
                dtReg.classList.replace('bg-opacity-20', 'bg-opacity-10');
                dtReg.classList.remove('border-opacity-30');
            }

            // Mobile Nav UI Update
            const mbReg = document.getElementById('navTabRegister');
            const mbDash = document.getElementById('navTabDashboard');
            if (tab === 'register') {
                mbReg.classList.replace('text-gray-400', 'text-indigo-600');
                mbDash.classList.replace('text-indigo-600', 'text-gray-400');
            } else {
                mbDash.classList.replace('text-gray-400', 'text-indigo-600');
                mbReg.classList.replace('text-indigo-600', 'text-gray-400');
            }
        }
        
        // --- Form Handling & File Upload ---
        const imageUploadArea = document.getElementById('imageUploadArea');
        const imagePreview = document.getElementById('imagePreview');
        const vehicleImageInput = document.getElementById('vehicleImage');
        const removeImageBtn = document.getElementById('removeImageBtn');
        let imageBase64Data = "";

        vehicleImageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    showToast('error', '‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5MB)');
                    this.value = ''; return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('fileNameText').textContent = file.name;
                    imageUploadArea.classList.add('hidden');
                    imagePreview.classList.remove('hidden');
                    imageBase64Data = e.target.result; // Store base64 ready for upload
                };
                reader.readAsDataURL(file);
            }
        });

        removeImageBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            vehicleImageInput.value = '';
            imageBase64Data = '';
            imagePreview.classList.add('hidden');
            imageUploadArea.classList.remove('hidden');
        });

        document.getElementById('vehicleForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const submitLoading = document.getElementById('submitLoading');
            
            submitBtn.disabled = true;
            submitText.classList.add('hidden');
            submitLoading.classList.remove('hidden');
            
            try {
                const formData = new FormData();
                formData.append('action', 'register');
                formData.append('fullName', document.getElementById('fullName').value);
                formData.append('houseNumber', document.getElementById('houseNumber').value);
                formData.append('phoneNumber', document.getElementById('phoneNumber').value);
                formData.append('vehicleType', document.getElementById('vehicleType').value);
                formData.append('licensePlate', document.getElementById('licensePlate').value);
                formData.append('province', document.getElementById('province').value);
                formData.append('vehicleImage', imageBase64Data);
                formData.append('status', document.getElementById('status').value);
                
                const response = await fetch(API_URL, { method: 'POST', body: formData });
                const result = await response.json();
                
                if (result.success) {
                    showSuccessModal();
                    this.reset();
                    removeImageBtn.click(); // clear image preview
                    
                    // Force refresh background data
                    loadDashboardData();
                } else {
                    throw new Error(result.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
                }
            } catch (error) {
                showToast('error', `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`);
            } finally {
                submitBtn.disabled = false;
                submitText.classList.remove('hidden');
                submitLoading.classList.add('hidden');
            }
        });

        // --- Data Fetching & Parsing ---
        async function loadDashboardData() {
            document.getElementById('searchResults').innerHTML = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î...';
            try {
                const csvUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}`;
                const response = await fetch(csvUrl);
                const csvText = await response.text();
                
                if (csvText && csvText.trim()) {
                    vehicleData = parseCSVData(csvText);
                    filteredData = [...vehicleData];
                    
                    updateDashboardCards();
                    renderData();
                    showToast('success', `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß (${vehicleData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`);
                } else {
                    document.getElementById('searchResults').innerHTML = '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö';
                }
            } catch (error) {
                console.error('CSV Failed, falling back to API:', error);
                try {
                    const fd = new FormData(); fd.append('action', 'getData');
                    const res = await fetch(API_URL, { method: 'POST', body: fd });
                    const result = await res.json();
                    if (result && result.success) {
                        vehicleData = result.data;
                        filteredData = [...vehicleData];
                        updateDashboardCards();
                        renderData();
                    }
                } catch (fallbackError) {
                    showToast('error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
                }
            }
        }
        
        function parseCSVData(csvText) {
            try {
                const lines = csvText.split('\n').filter(line => line.trim());
                if (lines.length <= 1) return [];
                
                const data = [];
                for (let i = 1; i < lines.length; i++) {
                    const row = parseCSVRow(lines[i]);
                    if (row.length === 0 || row.every(cell => !cell.trim())) continue;
                    
                    // Col match: [0]ID, [1]Name, [2]House, [3]Phone, [4]Type, [5]Plate, [6]Province, [7]Image, [8]Date, [9]Status
                    const vehicle = {
                        fullName: row[1] || '',
                        houseNumber: row[2] || '',
                        phoneNumber: row[3] || '',
                        vehicleType: row[4] || '',
                        licensePlate: row[5] || '',
                        province: row[6] || '',
                        imageUrl: row[7] || '',
                        dateTime: row[8] || '',
                        status: row[9] || '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö',
                        originalIndex: i
                    };
                    if (vehicle.fullName || vehicle.licensePlate) data.push(vehicle);
                }
                return data.sort((a, b) => b.originalIndex - a.originalIndex); // Newest first
            } catch (error) { return []; }
        }

        function parseCSVRow(row) {
            const result = [];
            let current = '', inQuotes = false;
            for (let i = 0; i < row.length; i++) {
                const char = row[i];
                if (char === '"') {
                    if (inQuotes && row[i + 1] === '"') { current += '"'; i++; } 
                    else { inQuotes = !inQuotes; }
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim()); current = '';
                } else { current += char; }
            }
            result.push(current.trim());
            return result;
        }

        // --- Search, Filter & Render ---
        const searchInput = document.getElementById('searchInput');
        const typeFilter = document.getElementById('vehicleTypeFilter');
        const searchTypeFilter = document.getElementById('searchTypeFilter');
        
        searchInput.addEventListener('input', () => { currentPage = 1; renderData(); });
        typeFilter.addEventListener('change', () => { currentPage = 1; renderData(); });
        searchTypeFilter.addEventListener('change', () => { 
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            if(searchTypeFilter.value === 'house') {
                searchInput.placeholder = "‡∏£‡∏∞‡∏ö‡∏∏‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡πä‡∏∞‡πÜ (‡πÄ‡∏ä‡πà‡∏ô 998/5)";
            } else if(searchTypeFilter.value === 'plate') {
                searchInput.placeholder = "‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏Ç 1234)";
            } else {
                searchInput.placeholder = "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ, ‡∏ä‡∏∑‡πà‡∏≠...";
            }
            currentPage = 1; 
            renderData(); 
        });
        document.getElementById('refreshDataBtn').addEventListener('click', loadDashboardData);

        function filterData() {
            const term = searchInput.value.toLowerCase().trim();
            const vType = typeFilter.value;
            const sType = searchTypeFilter.value;
            
            filteredData = vehicleData.filter(v => {
                const vHouse = (v.houseNumber || '').toLowerCase();
                const vPlate = (v.licensePlate || '').toLowerCase();
                const vName = (v.fullName || '').toLowerCase();
                const vProv = (v.province || '').toLowerCase();

                let matchTerm = false;

                if (!term) {
                    matchTerm = true;
                } else if (sType === 'house') {
                    // ‡∏´‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô 100%
                    matchTerm = (vHouse === term);
                } else if (sType === 'plate') {
                    // ‡∏´‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ
                    matchTerm = vPlate.includes(term);
                } else {
                    // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á (‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥)
                    matchTerm = vHouse.includes(term) || 
                                vPlate.includes(term) || 
                                vName.includes(term) || 
                                vProv.includes(term);
                }

                const matchType = !vType || v.vehicleType === vType;
                return matchTerm && matchType;
            });
        }

        function renderData() {
            filterData();
            
            const total = filteredData.length;
            document.getElementById('searchResults').innerHTML = total > 0 
                ? `‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <b>${total}</b> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£` 
                : '<span class="text-red-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</span>';
                
            const totalPages = Math.ceil(total / itemsPerPage);
            if (currentPage > totalPages && totalPages > 0) currentPage = totalPages;
            
            const start = (currentPage - 1) * itemsPerPage;
            const paginated = filteredData.slice(start, start + itemsPerPage);
            
            renderDesktopTable(paginated, start);
            renderMobileCards(paginated);
            renderPagination(total, totalPages);
        }

        function updateDashboardCards() {
            const source = vehicleData; // Count from all data
            document.getElementById('carCount').textContent = source.filter(v => v.vehicleType === '‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå').length;
            document.getElementById('motorcycleCount').textContent = source.filter(v => v.vehicleType === '‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå').length;
            document.getElementById('otherCount').textContent = source.filter(v => v.vehicleType === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ').length;
            document.getElementById('totalCount').textContent = source.length;
        }

        // --- Desktop Table View ---
        function renderDesktopTable(data, startIndex) {
            const tbody = document.getElementById('dataTableBody');
            const term = searchInput.value.trim();
            
            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="px-4 py-12 text-center text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</td></tr>`;
                return;
            }

            tbody.innerHTML = data.map((v, i) => `
                <tr class="hover:bg-gray-50/50 transition-colors table-row-enter" style="animation-delay: ${i*0.03}s">
                    <td class="px-4 py-3 align-middle text-center">
                        <span class="font-medium text-gray-800">${hi(v.houseNumber, term)}</span>
                    </td>
                    <td class="px-4 py-3 align-middle text-center">
                        <div class="font-mono font-bold text-gray-900 text-lg">${hi(v.licensePlate, term)}</div>
                        <div class="text-xs text-gray-500">${v.province ? hi(v.province, term) : ''}</div>
                    </td>
                    <td class="px-4 py-3 align-middle">
                        <div class="flex flex-col text-sm">
                            <span class="text-gray-800 font-medium">${hi(v.fullName, term)}</span>
                            <span class="text-gray-500 font-mono text-xs">üìû ${v.phoneNumber}</span>
                        </div>
                    </td>
                    <td class="px-4 py-3 align-middle text-center">
                        <span class="inline-flex px-2 py-1 rounded-md text-xs font-semibold ${getStatusColor(v)}">${getStatusText(v)}</span>
                    </td>
                    <td class="px-4 py-3 align-middle text-center">
                        <button onclick="openImageModal('${v.imageUrl||''}', '${v.licensePlate}', '${v.houseNumber}', '${v.fullName}', '${v.phoneNumber}', '${v.province}', '${v.vehicleType}', '${getStatusColor(v)}')" 
                                class="w-12 h-10 rounded-lg overflow-hidden border border-gray-200 mx-auto shadow-sm hover:opacity-80 active-scale transition-all">
                            ${v.imageUrl ? `<img src="${v.imageUrl}" class="w-full h-full object-cover">` : `<div class="w-full h-full bg-gray-100 flex items-center justify-center text-lg">${getVehicleIcon(v.vehicleType)}</div>`}
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // --- Mobile Cards View (Optimized UI) ---
        function renderMobileCards(data) {
            const container = document.getElementById('mobileCardView');
            const term = searchInput.value.trim();
            
            if (data.length === 0) {
                container.innerHTML = `<div class="py-12 text-center text-gray-400 border-2 border-dashed border-gray-200 rounded-2xl">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</div>`;
                return;
            }

            container.innerHTML = data.map((v, i) => {
                const hasImg = v.imageUrl && v.imageUrl.trim() !== '';
                const imgThumb = hasImg ? `<img src="${v.imageUrl}" class="w-full h-full object-cover">` : `<div class="w-full h-full bg-gradient-to-br ${getVehicleImageGradient(v.vehicleType)} flex items-center justify-center text-3xl opacity-80">${getVehicleIcon(v.vehicleType)}</div>`;
                const sColor = getStatusColor(v);
                
                return `
                <div class="bg-white rounded-[1.25rem] shadow-[0_2px_10px_rgba(0,0,0,0.04)] border border-gray-100 p-3.5 mb-3 hover-lift active-scale transition-transform table-row-enter" 
                     style="animation-delay: ${i*0.03}s"
                     onclick="openImageModal('${v.imageUrl||''}', '${v.licensePlate}', '${v.houseNumber}', '${v.fullName}', '${v.phoneNumber}', '${v.province}', '${v.vehicleType}', '${sColor}')">
                    
                    <div class="flex gap-3.5 items-start">
                        <!-- Left: Thumbnail -->
                        <div class="w-[84px] h-[84px] shrink-0 rounded-[1rem] overflow-hidden shadow-sm border border-gray-100 relative bg-gray-50">
                            ${imgThumb}
                            <!-- Tiny status indicator -->
                            <div class="absolute top-1 right-1 w-3 h-3 rounded-full border-2 border-white ${getStatusBadgeColorOnly(v)} shadow-sm"></div>
                        </div>
                        
                        <!-- Right: Details -->
                        <div class="flex-1 min-w-0 pt-0.5">
                            <div class="flex justify-between items-start mb-0.5">
                                <h4 class="font-bold text-gray-900 text-lg leading-tight truncate pr-2 font-mono">${hi(v.licensePlate, term)}</h4>
                                <span class="text-[10px] font-bold px-2 py-0.5 rounded border ${sColor} shrink-0 mt-0.5">${getStatusText(v)}</span>
                            </div>
                            
                            <div class="text-xs text-gray-500 mb-2 truncate bg-gray-50 inline-block px-1.5 py-0.5 rounded">
                                ${v.province ? hi(v.province, term) : v.vehicleType}
                            </div>
                            
                            <div class="grid grid-cols-1 gap-1 w-full">
                                <div class="flex items-center text-xs">
                                    <span class="w-4 opacity-50">üè†</span> 
                                    <span class="truncate text-gray-800 font-medium">${hi(v.houseNumber, term)}</span>
                                </div>
                                <div class="flex items-center text-xs">
                                    <span class="w-4 opacity-50">üë§</span> 
                                    <span class="truncate text-gray-600">${hi(v.fullName, term)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        // --- Pagination UI ---
        function renderPagination(totalItems, totalPages) {
            const container = document.getElementById('paginationContainer');
            const pageContainer = document.getElementById('pageNumbersContainer');
            
            if (totalPages <= 1) {
                container.classList.add('hidden');
                return;
            }
            container.classList.remove('hidden');
            
            // Text info
            const from = totalItems === 0 ? 0 : (currentPage - 1) * itemsPerPage + 1;
            const to = Math.min(currentPage * itemsPerPage, totalItems);
            document.getElementById('showingFrom').textContent = from;
            document.getElementById('showingTo').textContent = to;
            document.getElementById('totalItems').textContent = totalItems;

            // Generate Buttons
            let btns = '';
            
            // Prev
            btns += `<button onclick="goToPage(${currentPage-1})" ${currentPage===1?'disabled':''} class="px-3 py-1.5 rounded-lg border border-gray-200 text-gray-600 disabled:opacity-30 disabled:bg-gray-50 text-sm active-scale">‚óÄ</button>`;
            
            // Minimal page numbers for mobile (Current / Total)
            btns += `<div class="px-4 py-1.5 font-medium text-sm text-gray-700 bg-gray-50 rounded-lg border border-gray-100 flex items-center">
                        <span class="text-indigo-600">${currentPage}</span> <span class="mx-1 opacity-50">/</span> ${totalPages}
                     </div>`;
                     
            // Next
            btns += `<button onclick="goToPage(${currentPage+1})" ${currentPage===totalPages?'disabled':''} class="px-3 py-1.5 rounded-lg border border-gray-200 text-gray-600 disabled:opacity-30 disabled:bg-gray-50 text-sm active-scale">‚ñ∂</button>`;
            
            pageContainer.innerHTML = btns;
        }

        function goToPage(p) {
            const totalP = Math.ceil(filteredData.length / itemsPerPage);
            if(p >= 1 && p <= totalP) {
                currentPage = p;
                renderData();
                window.scrollTo({ top: document.getElementById('dashboardSection').offsetTop - 20, behavior: 'smooth' });
            }
        }

        // --- Helpers ---
        function hi(text, term) { // Highlight helper
            if (!term || !text) return text || '';
            const regex = new RegExp(`(${term})`, 'gi');
            return text.toString().replace(regex, '<span class="highlight">$1</span>');
        }

        function getStatusColor(v) {
            const st = (v.status || '').toLowerCase();
            if(st.includes('‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå')||st.includes('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥')) return 'bg-green-50 text-green-700 border-green-200';
            if(st.includes('‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥')||st.includes('‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå')) return 'bg-red-50 text-red-700 border-red-200';
            if(st.includes('‡∏£‡∏≠')||st.includes('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏û')) return 'bg-orange-50 text-orange-700 border-orange-200';
            return 'bg-blue-50 text-blue-700 border-blue-200';
        }
        
        function getStatusBadgeColorOnly(v) {
            const st = (v.status || '').toLowerCase();
            if(st.includes('‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå')||st.includes('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥')) return 'bg-green-500';
            if(st.includes('‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥')||st.includes('‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå')) return 'bg-red-500';
            if(st.includes('‡∏£‡∏≠')||st.includes('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏û')) return 'bg-orange-500';
            return 'bg-blue-500';
        }

        function getStatusText(v) {
            const hasImg = v.imageUrl && v.imageUrl.trim() !== '';
            const isFull = v.fullName && v.houseNumber && v.licensePlate;
            if(v.status && v.status.trim() !== '') return v.status;
            if(isFull && hasImg) return '‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô';
            if(isFull) return '‡∏Ç‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û';
            return '‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå';
        }

        function getVehicleIcon(type) {
            if(type === '‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå') return 'üöó';
            if(type === '‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå') return 'üèçÔ∏è';
            if(type === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') return 'üöõ';
            return 'üöô';
        }

        function getVehicleImageGradient(type) {
            if(type === '‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå') return 'from-blue-200 to-blue-300';
            if(type === '‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå') return 'from-green-200 to-green-300';
            if(type === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') return 'from-purple-200 to-purple-300';
            return 'from-gray-200 to-gray-300';
        }

        // Generate SVG Placeholder on the fly
        function getPlaceholderImage(vType) {
            const icon = getVehicleIcon(vType);
            const svg = `<svg width="400" height="300" xmlns="http://www.w3.org/2000/svg"><rect width="100%" height="100%" fill="#f1f5f9"/><text x="50%" y="50%" font-family="sans-serif" font-size="80" text-anchor="middle" dominant-baseline="middle">${icon}</text><text x="50%" y="70%" font-family="sans-serif" font-size="20" fill="#94a3b8" text-anchor="middle">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</text></svg>`;
            return 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svg)));
        }

        // --- Modals & Toasts ---
        const imgModal = document.getElementById('imageModal');
        
        function openImageModal(imgUrl, plate, house, owner, phone, prov, vType, colorClass) {
            document.getElementById('modalImage').src = imgUrl || getPlaceholderImage(vType);
            document.getElementById('modalImageTitle').textContent = plate;
            document.getElementById('modalProvince').textContent = prov ? `‡∏à.${prov}` : '';
            document.getElementById('modalHouseNumber').textContent = house;
            document.getElementById('modalOwnerName').textContent = owner;
            document.getElementById('modalPhoneNumber').textContent = phone;
            
            const badge = document.getElementById('modalStatusBadge');
            badge.className = `text-xs px-2 py-1 rounded-md border ${colorClass}`;
            badge.textContent = getStatusText({status: '', imageUrl: imgUrl, fullName: owner, houseNumber: house, licensePlate: plate});
            
            imgModal.classList.remove('hidden');
            setTimeout(() => imgModal.classList.remove('opacity-0'), 10);
            document.body.style.overflow = 'hidden';
        }

        function closeImageModal() {
            imgModal.classList.add('opacity-0');
            setTimeout(() => {
                imgModal.classList.add('hidden');
                document.body.style.overflow = '';
            }, 300);
        }

        document.getElementById('closeImageModal').addEventListener('click', closeImageModal);
        imgModal.addEventListener('click', (e) => { if(e.target === imgModal) closeImageModal(); });

        function showSuccessModal() {
            const m = document.getElementById('successModal');
            m.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        function closeSuccessModal() {
            document.getElementById('successModal').classList.add('hidden');
            document.body.style.overflow = '';
            switchTab('dashboard'); // Auto switch to list on success
        }
        document.getElementById('closeSuccessModal').addEventListener('click', closeSuccessModal);

        let toastTimeout;
        function showToast(type, msg) {
            const t = document.getElementById('toastMessage');
            document.getElementById('toastIcon').textContent = type === 'success' ? '‚úÖ' : '‚ùå';
            document.getElementById('toastText').textContent = msg;
            
            if(type === 'success') t.classList.replace('bg-gray-800', 'bg-emerald-600');
            else t.classList.replace('bg-emerald-600', 'bg-red-600');
            
            t.classList.remove('-translate-y-20', 'opacity-0');
            t.classList.add('translate-y-0', 'opacity-100');
            
            clearTimeout(toastTimeout);
            toastTimeout = setTimeout(() => {
                t.classList.remove('translate-y-0', 'opacity-100');
                t.classList.add('-translate-y-20', 'opacity-0');
            }, 3000);
        }

        // Auto Refresh
        function startAutoRefresh() {
            stopAutoRefresh();
            autoRefreshInterval = setInterval(() => {
                if(!document.getElementById('dashboardSection').classList.contains('hidden')) {
                    loadDashboardData();
                }
            }, 180000); // 3 mins
        }
        function stopAutoRefresh() { clearInterval(autoRefreshInterval); }

    </script>
</body>
</html>
