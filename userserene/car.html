<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ Serene</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2554/2554936.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .loading { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        /* Modern animations */
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        .slide-up { animation: slideUp 0.6s ease-out; }
        .bounce-in { animation: bounceIn 0.8s ease-out; }
        .pulse-success { animation: pulseSuccess 0.6s ease-in-out; }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes pulseSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); box-shadow: 0 0 20px rgba(34, 197, 94, 0.4); }
            100% { transform: scale(1); }
        }
        
        /* Glass morphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        /* Gradient backgrounds */
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
        }
        
        /* Hover effects */
        .hover-lift {
            transition: all 0.3s ease;
        }
        .hover-lift:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
        }
        
        /* Success animation */
        .success-checkmark {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: block;
            stroke-width: 2;
            stroke: #22c55e;
            stroke-miterlimit: 10;
            margin: 10px auto;
            box-shadow: inset 0px 0px 0px #22c55e;
            animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
        }
        
        .success-checkmark__circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 2;
            stroke-miterlimit: 10;
            stroke: #22c55e;
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }
        
        .success-checkmark__check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }
        
        @keyframes stroke {
            100% {
                stroke-dashoffset: 0;
            }
        }
        
        @keyframes scale {
            0%, 100% {
                transform: none;
            }
            50% {
                transform: scale3d(1.1, 1.1, 1);
            }
        }
        
        @keyframes fill {
            100% {
                box-shadow: inset 0px 0px 0px 30px #22c55e;
            }
        }

        /* Search highlight */
        .highlight {
            background-color: #fef08a;
            padding: 1px 2px;
            border-radius: 2px;
            font-weight: 600;
        }

        /* Table row animations */
        .table-row-enter {
            animation: tableRowEnter 0.3s ease-out;
        }

        @keyframes tableRowEnter {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* No results animation */
        .no-results {
            animation: noResultsBounce 0.6s ease-out;
        }

        @keyframes noResultsBounce {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Navigation -->
    <nav class="glass shadow-2xl mb-8 fade-in">
        <div class="container mx-auto px-6">
            <div class="flex justify-between items-center py-6">
                <h1 class="text-3xl font-bold text-white drop-shadow-lg">üèòÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ</h1>
                <div class="flex space-x-4">
                    <button id="registerTab" class="px-6 py-3 bg-white bg-opacity-20 text-white rounded-xl font-medium hover-lift backdrop-blur-sm border border-white border-opacity-30 transition-all duration-300">üìù ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
                    <button id="dashboardTab" class="px-6 py-3 bg-white bg-opacity-10 text-white rounded-xl font-medium hover-lift backdrop-blur-sm border border-white border-opacity-20 transition-all duration-300">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4">
        <!-- Registration Form Section -->
        <div id="registerSection" class="max-w-4xl mx-auto slide-up">
            <div class="gradient-card rounded-3xl shadow-2xl p-10 mb-8 hover-lift border border-white border-opacity-20">
                <h2 class="text-3xl font-bold text-gray-800 mb-8 flex items-center">
                    üöó ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ‡πÉ‡∏´‡∏°‡πà
                </h2>
                
                <form id="vehicleForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="md:col-span-2">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">‡∏ä‡∏∑‡πà‡∏≠ ‡∏™‡∏Å‡∏∏‡∏• *</label>
                        <input type="text" id="fullName" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡∏≠‡∏ô‡∏∏‡∏ä‡∏≤" class="w-full px-5 py-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-300 bg-white bg-opacity-80 backdrop-blur-sm">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà *</label>
                        <input type="text" id="houseNumber" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 998/5" class="w-full px-5 py-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-300 bg-white bg-opacity-80 backdrop-blur-sm">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ *</label>
                        <input type="tel" id="phoneNumber" required pattern="0[0-9]{8,9}" placeholder="‡πÄ‡∏ä‡πà‡∏ô 081-234-5678" class="w-full px-5 py-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-300 bg-white bg-opacity-80 backdrop-blur-sm">
                        <p class="text-xs text-gray-600 mt-2 font-medium">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ 0</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ *</label>
                        <select id="vehicleType" required class="w-full px-5 py-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-300 bg-white bg-opacity-80 backdrop-blur-sm">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ</option>
                            <option value="‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå">üöó ‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</option>
                            <option value="‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå">üèçÔ∏è ‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå</option>
                            <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üöõ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ *</label>
                        <input type="text" id="licensePlate" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏Ç 1234" class="w-full px-5 py-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-300 bg-white bg-opacity-80 backdrop-blur-sm">
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">‡∏†‡∏≤‡∏û‡∏£‡∏ñ *</label>
                        <div class="border-2 border-dashed border-purple-300 rounded-2xl p-8 text-center hover:border-purple-500 transition-all duration-300 bg-gradient-to-br from-purple-50 to-indigo-50 hover-lift">
                            <input type="file" id="vehicleImage" accept="image/*" required class="hidden">
                            <div id="imageUploadArea" class="cursor-pointer" onclick="document.getElementById('vehicleImage').click()">
                                <div class="text-purple-600 mb-3 text-lg font-semibold">
                                    üì∑ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û‡∏£‡∏ñ
                                </div>
                                <p class="text-sm text-purple-500 font-medium">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå JPG, PNG (‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB)</p>
                            </div>
                            <div id="imagePreview" class="hidden mt-6">
                                <img id="previewImg" class="max-w-sm mx-auto rounded-2xl shadow-lg">
                                <p id="fileName" class="text-sm text-gray-700 mt-3 font-medium"></p>
                            </div>
                        </div>
                    </div>

                    <div class="md:col-span-2 mt-8">
                        <button type="submit" id="submitBtn" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-bold py-5 px-8 rounded-2xl transition-all duration-300 transform hover:scale-105 shadow-2xl disabled:opacity-50 disabled:cursor-not-allowed hover-lift">
                            <span id="submitText" class="text-lg">üìù ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ</span>
                            <div id="submitLoading" class="hidden flex items-center justify-center">
                                <div class="loading w-6 h-6 border-2 border-white border-t-transparent rounded-full mr-3"></div>
                                <span class="text-lg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
                            </div>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboardSection" class="hidden">
            <!-- Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8 bounce-in">
                <div class="gradient-card rounded-2xl shadow-2xl p-6 hover-lift border border-white border-opacity-20">
                    <div class="flex items-center">
                        <div class="p-4 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl shadow-lg">
                            <span class="text-3xl">üöó</span>
                        </div>
                        <div class="ml-5">
                            <p class="text-sm text-gray-600 font-semibold">‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</p>
                            <p id="carCount" class="text-3xl font-bold text-blue-600">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="gradient-card rounded-2xl shadow-2xl p-6 hover-lift border border-white border-opacity-20">
                    <div class="flex items-center">
                        <div class="p-4 bg-gradient-to-br from-green-400 to-green-600 rounded-2xl shadow-lg">
                            <span class="text-3xl">üèçÔ∏è</span>
                        </div>
                        <div class="ml-5">
                            <p class="text-sm text-gray-600 font-semibold">‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå</p>
                            <p id="motorcycleCount" class="text-3xl font-bold text-green-600">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="gradient-card rounded-2xl shadow-2xl p-6 hover-lift border border-white border-opacity-20">
                    <div class="flex items-center">
                        <div class="p-4 bg-gradient-to-br from-purple-400 to-purple-600 rounded-2xl shadow-lg">
                            <span class="text-3xl">üöõ</span>
                        </div>
                        <div class="ml-5">
                            <p class="text-sm text-gray-600 font-semibold">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</p>
                            <p id="otherCount" class="text-3xl font-bold text-purple-600">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="gradient-card rounded-2xl shadow-2xl p-6 hover-lift border border-white border-opacity-20">
                    <div class="flex items-center">
                        <div class="p-4 bg-gradient-to-br from-orange-400 to-orange-600 rounded-2xl shadow-lg">
                            <span class="text-3xl">üìä</span>
                        </div>
                        <div class="ml-5">
                            <p class="text-sm text-gray-600 font-semibold">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                            <p id="totalCount" class="text-3xl font-bold text-orange-600">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Table -->
            <div class="gradient-card rounded-3xl shadow-2xl p-10 slide-up border border-white border-opacity-20">
                <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-8 gap-4">
                    <h2 class="text-3xl font-bold text-gray-800">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h2>
                    <div class="flex flex-col sm:flex-row gap-3 w-full lg:w-auto">
                        <button id="refreshData" class="bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 hover-lift shadow-lg">
                            üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                        <button id="clearSearch" class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 hover-lift shadow-lg">
                            üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                        </button>
                    </div>
                </div>

                <!-- Search and Filter Section -->
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 mb-8 border border-blue-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <!-- Search Input -->
                        <div class="lg:col-span-2">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</label>
                            <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ, ‡∏ä‡∏∑‡πà‡∏≠..." class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300 bg-white">
                        </div>
                        
                        <!-- Vehicle Type Filter -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ</label>
                            <select id="vehicleTypeFilter" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300 bg-white">
                                <option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                                <option value="‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå">üöó ‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</option>
                                <option value="‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå">üèçÔ∏è ‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå</option>
                                <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üöõ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                            </select>
                        </div>
                        
                        <!-- Search Button -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</label>
                            <button id="searchButton" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold py-3 px-4 rounded-xl transition-all duration-300 hover-lift shadow-lg flex items-center justify-center">
                                üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                            </button>
                        </div>
                    </div>
                    
                    <!-- Search Results Info and Pagination Controls -->
                    <div class="mt-4 flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                        <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4">
                            <div id="searchResults" class="text-sm text-gray-600 font-medium">
                                ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <span id="totalResults">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                            </div>
                            <div class="flex items-center gap-2">
                                <label class="text-sm text-gray-600 font-medium">‡πÅ‡∏™‡∏î‡∏á:</label>
                                <select id="itemsPerPage" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
                                    <option value="10">10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</option>
                                    <option value="25">25 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</option>
                                    <option value="50">50 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</option>
                                    <option value="all" selected>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                                </select>
                            </div>
                        </div>
                        <div class="text-sm text-gray-500">
                            üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
                        </div>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-indigo-50">
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">ID</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠ ‡∏™‡∏Å‡∏∏‡∏•</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">‡∏†‡∏≤‡∏û‡∏£‡∏ñ</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡∏•‡∏≤</th>
                            </tr>
                        </thead>
                        <tbody id="dataTableBody">
                            <tr>
                                <td colspan="8" class="border border-gray-300 px-4 py-8 text-center text-gray-500">
                                    <div class="loading w-8 h-8 border-2 border-indigo-500 border-t-transparent rounded-full mx-auto mb-2"></div>
                                    ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination Navigation -->
                <div id="paginationContainer" class="mt-6 flex flex-col sm:flex-row justify-between items-center gap-4 hidden">
                    <div class="text-sm text-gray-600">
                        ‡πÅ‡∏™‡∏î‡∏á <span id="showingFrom">1</span> ‡∏ñ‡∏∂‡∏á <span id="showingTo">10</span> ‡∏à‡∏≤‡∏Å <span id="totalItems">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                    </div>
                    
                    <div class="flex items-center gap-2">
                        <button id="firstPage" class="px-3 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200">
                            ‚èÆÔ∏è ‡πÅ‡∏£‡∏Å
                        </button>
                        <button id="prevPage" class="px-3 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200">
                            ‚¨ÖÔ∏è ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                        </button>
                        
                        <div id="pageNumbers" class="flex items-center gap-1">
                            <!-- Page numbers will be inserted here -->
                        </div>
                        
                        <button id="nextPage" class="px-3 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200">
                            ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚û°Ô∏è
                        </button>
                        <button id="lastPage" class="px-3 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200">
                            ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ‚è≠Ô∏è
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success Modal -->
        <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-3xl p-8 max-w-md mx-4 text-center bounce-in">
                <svg class="success-checkmark" viewBox="0 0 52 52">
                    <circle class="success-checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                    <path class="success-checkmark__check" fill="none" d="m14.1 27.2l7.1 7.2 16.7-16.8"/>
                </svg>
                <h3 class="text-2xl font-bold text-gray-800 mb-2">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
                <p class="text-gray-600 mb-6">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
                <button id="closeSuccessModal" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-3 px-8 rounded-xl transition-all duration-300 hover-lift">
                    ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢
                </button>
            </div>
        </div>

        <!-- Success/Error Messages -->
        <div id="successMessage" class="fixed top-4 right-4 bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-4 rounded-2xl shadow-2xl transform translate-x-full transition-transform duration-300 z-50">
            ‚úÖ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!
        </div>
        
        <div id="errorMessage" class="fixed top-4 right-4 bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-4 rounded-2xl shadow-2xl transform translate-x-full transition-transform duration-300 z-50">
            ‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
        </div>
    </div>

    <script>
        // Configuration - Direct Google Sheets access
        const SPREADSHEET_ID = '1kwFxoXRb6JsvkcglUpuXkYYRqZiOuAWWAWG-4kot3XM';
        const SHEET_NAME = '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ';
        const API_KEY = 'AIzaSyDummy'; // This will use public access
        
        // Fallback API URL for form submissions
        const API_URL = 'https://script.google.com/macros/s/AKfycbz608VbnbGi89kV01UgPMtZuYdRHNfCXTrnHPIRHdjBRzTkhbwr0DWrB5oElXnyMvGIew/exec';
        
        // Global variables
        let vehicleData = [];
        let filteredData = [];
        let currentPage = 1;
        let itemsPerPage = 999999; // Show all data by default
        
        // Tab switching
        document.getElementById('registerTab').addEventListener('click', () => switchTab('register'));
        document.getElementById('dashboardTab').addEventListener('click', () => switchTab('dashboard'));
        
        function switchTab(tab) {
            const registerSection = document.getElementById('registerSection');
            const dashboardSection = document.getElementById('dashboardSection');
            const registerTab = document.getElementById('registerTab');
            const dashboardTab = document.getElementById('dashboardTab');
            
            if (tab === 'register') {
                registerSection.classList.remove('hidden');
                dashboardSection.classList.add('hidden');
                registerTab.classList.add('bg-white', 'bg-opacity-20', 'text-white', 'border-white', 'border-opacity-30');
                registerTab.classList.remove('bg-white', 'bg-opacity-10', 'border-opacity-20');
                dashboardTab.classList.add('bg-white', 'bg-opacity-10', 'border-opacity-20');
                dashboardTab.classList.remove('bg-white', 'bg-opacity-20', 'border-white', 'border-opacity-30');
            } else {
                registerSection.classList.add('hidden');
                dashboardSection.classList.remove('hidden');
                dashboardTab.classList.add('bg-white', 'bg-opacity-20', 'text-white', 'border-white', 'border-opacity-30');
                dashboardTab.classList.remove('bg-white', 'bg-opacity-10', 'border-opacity-20');
                registerTab.classList.add('bg-white', 'bg-opacity-10', 'border-opacity-20');
                registerTab.classList.remove('bg-white', 'bg-opacity-20', 'border-white', 'border-opacity-30');
                loadDashboardData();
            }
        }
        
        // Search and Filter Functions
        function initializeSearchAndFilter() {
            const searchInput = document.getElementById('searchInput');
            const vehicleTypeFilter = document.getElementById('vehicleTypeFilter');
            const searchButton = document.getElementById('searchButton');
            const clearSearchBtn = document.getElementById('clearSearch');
            const itemsPerPageSelect = document.getElementById('itemsPerPage');
            
            // Add event listeners for real-time search
            searchInput.addEventListener('input', debounce(performSearch, 300));
            vehicleTypeFilter.addEventListener('change', performSearch);
            searchButton.addEventListener('click', performSearch);
            clearSearchBtn.addEventListener('click', clearAllFilters);
            itemsPerPageSelect.addEventListener('change', handleItemsPerPageChange);
            
            // Initialize pagination controls
            initializePaginationControls();
        }
        
        function initializePaginationControls() {
            document.getElementById('firstPage').addEventListener('click', () => goToPage(1));
            document.getElementById('prevPage').addEventListener('click', () => goToPage(currentPage - 1));
            document.getElementById('nextPage').addEventListener('click', () => goToPage(currentPage + 1));
            document.getElementById('lastPage').addEventListener('click', () => {
                const totalPages = Math.ceil(filteredData.length / itemsPerPage);
                goToPage(totalPages);
            });
        }
        
        function handleItemsPerPageChange() {
            const select = document.getElementById('itemsPerPage');
            if (select.value === 'all') {
                itemsPerPage = Math.max(filteredData.length, 999999);
            } else {
                itemsPerPage = parseInt(select.value);
            }
            currentPage = 1; // Reset to first page
            updateDataTable();
            updatePagination();
        }
        
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            const vehicleTypeFilter = document.getElementById('vehicleTypeFilter').value;
            
            console.log('Performing search with term:', searchTerm);
            console.log('Vehicle type filter:', vehicleTypeFilter);
            console.log('Total vehicle data:', vehicleData.length);
            
            filteredData = vehicleData.filter(vehicle => {
                // Enhanced text search with better matching - focus on house number and license plate
                const houseNumber = (vehicle.houseNumber || '').toString().toLowerCase();
                const licensePlate = (vehicle.licensePlate || '').toString().toLowerCase();
                const fullName = (vehicle.fullName || vehicle.firstName + ' ' + vehicle.lastName || '').toLowerCase();
                const phoneNumber = (vehicle.phoneNumber || '').toString().toLowerCase();
                
                // Check if search term matches any field (using includes for partial matching)
                const matchesSearch = !searchTerm || 
                    houseNumber.includes(searchTerm) ||
                    licensePlate.includes(searchTerm) ||
                    fullName.includes(searchTerm) ||
                    phoneNumber.includes(searchTerm);
                
                // Vehicle type filter
                const matchesVehicleType = !vehicleTypeFilter || vehicle.vehicleType === vehicleTypeFilter;
                
                const matches = matchesSearch && matchesVehicleType;
                
                if (searchTerm && matches) {
                    console.log('Match found:', {
                        houseNumber: vehicle.houseNumber,
                        licensePlate: vehicle.licensePlate,
                        fullName: vehicle.fullName || vehicle.firstName + ' ' + vehicle.lastName
                    });
                }
                
                return matches;
            });
            
            console.log('Filtered results:', filteredData.length);
            
            // Reset to first page when searching
            currentPage = 1;
            
            // Update items per page if "all" is selected
            const itemsPerPageSelect = document.getElementById('itemsPerPage');
            if (itemsPerPageSelect.value === 'all') {
                itemsPerPage = Math.max(filteredData.length, 999999);
            }
            
            updateSearchResults();
            updateDataTable();
            updatePagination();
            updateDashboard(); // Update dashboard with filtered data
        }
        
        function updateSearchResults() {
            const totalResults = document.getElementById('totalResults');
            const searchResults = document.getElementById('searchResults');
            
            // Check if elements exist before updating
            if (totalResults) {
                totalResults.textContent = filteredData.length;
            }
            
            if (searchResults) {
                if (filteredData.length !== vehicleData.length) {
                    searchResults.innerHTML = `‡∏û‡∏ö <span class="text-blue-600 font-bold">${filteredData.length}</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${vehicleData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                } else {
                    searchResults.innerHTML = `‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <span class="text-blue-600 font-bold">${filteredData.length}</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                }
            }
        }
        
        function clearAllFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('vehicleTypeFilter').value = '';
            document.getElementById('itemsPerPage').value = 'all';
            
            filteredData = [...vehicleData];
            currentPage = 1;
            itemsPerPage = Math.max(vehicleData.length, 999999);
            
            updateSearchResults();
            updateDataTable();
            updatePagination();
            updateDashboard();
            
            // Show success message
            showMessage('success', '‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }
        
        // Pagination Functions
        function goToPage(page) {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            updateDataTable();
            updatePagination();
        }
        
        function updatePagination() {
            const totalItems = filteredData.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const paginationContainer = document.getElementById('paginationContainer');
            
            // Show/hide pagination based on whether we need it
            if (totalPages <= 1 && document.getElementById('itemsPerPage').value !== 'all') {
                paginationContainer.classList.add('hidden');
                return;
            } else {
                paginationContainer.classList.remove('hidden');
            }
            
            // Update showing info
            const showingFrom = totalItems === 0 ? 0 : (currentPage - 1) * itemsPerPage + 1;
            const showingTo = Math.min(currentPage * itemsPerPage, totalItems);
            
            document.getElementById('showingFrom').textContent = showingFrom;
            document.getElementById('showingTo').textContent = showingTo;
            document.getElementById('totalItems').textContent = totalItems;
            
            // Update button states
            document.getElementById('firstPage').disabled = currentPage === 1;
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages;
            document.getElementById('lastPage').disabled = currentPage === totalPages;
            
            // Update page numbers
            updatePageNumbers(totalPages);
        }
        
        function updatePageNumbers(totalPages) {
            const pageNumbersContainer = document.getElementById('pageNumbers');
            pageNumbersContainer.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // Calculate which page numbers to show
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);
            
            // Adjust if we're near the beginning or end
            if (currentPage <= 3) {
                endPage = Math.min(5, totalPages);
            }
            if (currentPage >= totalPages - 2) {
                startPage = Math.max(1, totalPages - 4);
            }
            
            // Add first page and ellipsis if needed
            if (startPage > 1) {
                addPageButton(1);
                if (startPage > 2) {
                    pageNumbersContainer.appendChild(createEllipsis());
                }
            }
            
            // Add page numbers
            for (let i = startPage; i <= endPage; i++) {
                addPageButton(i);
            }
            
            // Add ellipsis and last page if needed
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    pageNumbersContainer.appendChild(createEllipsis());
                }
                addPageButton(totalPages);
            }
        }
        
        function addPageButton(pageNum) {
            const button = document.createElement('button');
            button.textContent = pageNum;
            button.className = `px-3 py-2 border rounded-lg text-sm transition-all duration-200 ${
                pageNum === currentPage 
                    ? 'bg-blue-500 text-white border-blue-500' 
                    : 'border-gray-300 hover:bg-gray-50'
            }`;
            button.addEventListener('click', () => goToPage(pageNum));
            document.getElementById('pageNumbers').appendChild(button);
        }
        
        function createEllipsis() {
            const span = document.createElement('span');
            span.textContent = '...';
            span.className = 'px-2 py-2 text-gray-500';
            return span;
        }
        
        function highlightSearchTerm(text, searchTerm) {
            if (!searchTerm || !text) return text;
            
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }
        
        // Image preview
        document.getElementById('vehicleImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                // Validate file size (5MB limit)
                if (file.size > 5 * 1024 * 1024) {
                    showMessage('error', '‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB)');
                    this.value = '';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').classList.remove('hidden');
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('fileName').textContent = file.name;
                    document.getElementById('imageUploadArea').classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Form submission
        document.getElementById('vehicleForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const submitLoading = document.getElementById('submitLoading');
            
            // Show loading state
            submitBtn.disabled = true;
            submitText.classList.add('hidden');
            submitLoading.classList.remove('hidden');
            
            try {
                // Convert image to Base64 first
                const imageFile = document.getElementById('vehicleImage').files[0];
                let imageBase64 = "";
                
                if (imageFile) {
                    imageBase64 = await convertFileToBase64(imageFile);
                    console.log('Image converted to Base64');
                }
                
                // Prepare form data using FormData
                const formData = new FormData();
                formData.append('action', 'register');
                formData.append('fullName', document.getElementById('fullName').value);
                formData.append('houseNumber', document.getElementById('houseNumber').value);
                formData.append('phoneNumber', document.getElementById('phoneNumber').value);
                formData.append('vehicleType', document.getElementById('vehicleType').value);
                formData.append('licensePlate', document.getElementById('licensePlate').value);
                formData.append('vehicleImage', imageBase64); // Send Base64 instead of file
                
                console.log('Sending registration data...');
                
                // Send to Google Apps Script
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });
                
                console.log('Response received:', response.status);
                
                const result = await response.json();
                console.log('Result:', result);
                
                if (result.success) {
                    // Show success modal with animation
                    showSuccessModal();
                    this.reset();
                    document.getElementById('imagePreview').classList.add('hidden');
                    document.getElementById('imageUploadArea').classList.remove('hidden');
                    
                    // Add success animation to submit button
                    submitBtn.classList.add('pulse-success');
                    setTimeout(() => {
                        submitBtn.classList.remove('pulse-success');
                    }, 600);
                    
                    console.log('Registration successful:', result);
                } else {
                    throw new Error(result.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
                }
                
            } catch (error) {
                console.error('Error details:', error);
                showMessage('error', `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`);
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                submitText.classList.remove('hidden');
                submitLoading.classList.add('hidden');
            }
        });
        
        // Convert file to base64
        function convertFileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }
        
        // Load dashboard data directly from Google Sheets
        async function loadDashboardData() {
            console.log('Loading dashboard data from Google Sheets...');
            
            // Initialize empty data
            vehicleData = [];
            filteredData = [];
            
            // Show loading state
            updateDashboard();
            updateDataTable();
            updateSearchResults();
            updatePagination();
            
            try {
                // Try to load from Google Sheets directly using CSV export
                const csvUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}`;
                
                console.log('Fetching from CSV URL:', csvUrl);
                
                const response = await fetch(csvUrl);
                const csvText = await response.text();
                
                console.log('CSV Response received, length:', csvText.length);
                
                if (csvText && csvText.trim()) {
                    // Parse CSV data
                    const parsedData = parseCSVData(csvText);
                    
                    if (parsedData.length > 0) {
                        vehicleData = parsedData;
                        filteredData = [...vehicleData];
                        
                        console.log('Data loaded from Google Sheets:', vehicleData.length, 'records');
                        
                        // Update UI with real data
                        updateDashboard();
                        updateDataTable();
                        updateSearchResults();
                        updatePagination();
                        
                        showMessage('success', `‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (${vehicleData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`);
                    } else {
                        console.log('No data found in spreadsheet');
                        showMessage('info', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Google Sheets');
                    }
                } else {
                    throw new Error('Empty response from Google Sheets');
                }
                
            } catch (error) {
                console.error('Error loading from Google Sheets:', error);
                
                // Fallback to original API method
                try {
                    console.log('Falling back to API method...');
                    const formData = new FormData();
                    formData.append('action', 'getData');
                    
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    console.log('Fallback API Response:', result);
                    
                    if (result && result.success && result.data) {
                        vehicleData = result.data;
                        filteredData = [...vehicleData];
                        
                        // Update UI with real data
                        updateDashboard();
                        updateDataTable();
                        updateSearchResults();
                        updatePagination();
                        
                        console.log('Fallback data loaded:', vehicleData.length, 'records');
                        showMessage('success', `‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (${vehicleData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`);
                    } else {
                        console.log('No data received from fallback API');
                        showMessage('error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                    }
                } catch (fallbackError) {
                    console.error('Fallback API also failed:', fallbackError);
                    showMessage('error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡πÅ‡∏´‡∏•‡πà‡∏á‡πÑ‡∏î‡πâ');
                }
            }
        }
        
        // Parse CSV data from Google Sheets
        function parseCSVData(csvText) {
            try {
                const lines = csvText.split('\n').filter(line => line.trim());
                if (lines.length <= 1) return []; // No data rows
                
                // Parse header row to understand column structure
                const headers = parseCSVRow(lines[0]);
                console.log('CSV Headers:', headers);
                
                const data = [];
                
                // Parse data rows (skip header)
                for (let i = 1; i < lines.length; i++) {
                    const row = parseCSVRow(lines[i]);
                    if (row.length === 0 || row.every(cell => !cell.trim())) continue; // Skip empty rows
                    
                    // Map CSV columns to our data structure
                    // Assuming columns: Timestamp, ‡∏ä‡∏∑‡πà‡∏≠ ‡∏™‡∏Å‡∏∏‡∏•, ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠, ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ, ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ, ‡∏†‡∏≤‡∏û‡∏£‡∏ñ
                    const vehicle = {
                        sequenceNumber: i, // Use row number as sequence
                        registrationDate: row[0] || '', // Timestamp
                        fullName: row[1] || '',
                        houseNumber: row[2] || '',
                        phoneNumber: row[3] || '',
                        vehicleType: row[4] || '',
                        licensePlate: row[5] || '',
                        imageUrl: row[6] || '', // Image URL if available
                        // Legacy support
                        firstName: (row[1] || '').split(' ')[0] || '',
                        lastName: (row[1] || '').split(' ').slice(1).join(' ') || ''
                    };
                    
                    // Only add if we have essential data
                    if (vehicle.fullName || vehicle.houseNumber || vehicle.licensePlate) {
                        data.push(vehicle);
                    }
                }
                
                console.log('Parsed CSV data:', data.length, 'records');
                return data;
                
            } catch (error) {
                console.error('Error parsing CSV:', error);
                return [];
            }
        }
        
        // Parse a single CSV row, handling quoted fields
        function parseCSVRow(row) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < row.length; i++) {
                const char = row[i];
                
                if (char === '"') {
                    if (inQuotes && row[i + 1] === '"') {
                        // Escaped quote
                        current += '"';
                        i++; // Skip next quote
                    } else {
                        // Toggle quote state
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    // End of field
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            // Add the last field
            result.push(current.trim());
            
            return result;
        }
        
        // Update dashboard summary (now uses filtered data)
        function updateDashboard() {
            const dataToUse = filteredData.length > 0 ? filteredData : vehicleData;
            
            const carCount = dataToUse.filter(v => v.vehicleType === '‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå').length;
            const motorcycleCount = dataToUse.filter(v => v.vehicleType === '‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå').length;
            const otherCount = dataToUse.filter(v => v.vehicleType === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ').length;
            const totalCount = dataToUse.length;
            
            document.getElementById('carCount').textContent = carCount;
            document.getElementById('motorcycleCount').textContent = motorcycleCount;
            document.getElementById('otherCount').textContent = otherCount;
            document.getElementById('totalCount').textContent = totalCount;
        }
        
        // Update data table (now uses filtered data with highlighting and pagination)
        function updateDataTable() {
            const tbody = document.getElementById('dataTableBody');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (filteredData.length === 0) {
                if (vehicleData.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" class="border border-gray-300 px-4 py-8 text-center text-gray-500">
                                <div class="no-results">
                                    <div class="text-6xl mb-4">üìã</div>
                                    <div class="text-lg font-semibold mb-2">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</div>
                                    <div class="text-sm">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡πÅ‡∏£‡∏Å</div>
                                </div>
                            </td>
                        </tr>
                    `;
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" class="border border-gray-300 px-4 py-8 text-center text-gray-500">
                                <div class="no-results">
                                    <div class="text-6xl mb-4">üîç</div>
                                    <div class="text-lg font-semibold mb-2">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
                                    <div class="text-sm">‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</div>
                                </div>
                            </td>
                        </tr>
                    `;
                }
                return;
            }
            
            // Calculate pagination
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = document.getElementById('itemsPerPage').value === 'all' 
                ? filteredData.length 
                : startIndex + itemsPerPage;
            const paginatedData = filteredData.slice(startIndex, endIndex);
            
            tbody.innerHTML = paginatedData.map((vehicle, index) => `
                <tr class="hover:bg-gray-50 table-row-enter" style="animation-delay: ${index * 0.05}s">
                    <td class="border border-gray-300 px-4 py-3">${vehicle.sequenceNumber || (startIndex + index + 1)}</td>
                    <td class="border border-gray-300 px-4 py-3">${highlightSearchTerm(vehicle.fullName || (vehicle.firstName + ' ' + vehicle.lastName), searchTerm)}</td>
                    <td class="border border-gray-300 px-4 py-3">${highlightSearchTerm(vehicle.houseNumber, searchTerm)}</td>
                    <td class="border border-gray-300 px-4 py-3">${highlightSearchTerm(vehicle.phoneNumber, searchTerm)}</td>
                    <td class="border border-gray-300 px-4 py-3">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${getVehicleTypeColor(vehicle.vehicleType)}">
                            ${vehicle.vehicleType}
                        </span>
                    </td>
                    <td class="border border-gray-300 px-4 py-3 font-mono">${highlightSearchTerm(vehicle.licensePlate, searchTerm)}</td>
                    <td class="border border-gray-300 px-4 py-3">
                        ${vehicle.imageUrl ? 
                            `<a href="${vehicle.imageUrl}" target="_blank" class="text-blue-600 hover:text-blue-800">
                                <img src="${vehicle.imageUrl}" alt="‡∏£‡∏ñ" class="w-16 h-12 object-cover rounded cursor-pointer hover:scale-110 transition-transform duration-200">
                            </a>` : 
                            '<span class="text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏û</span>'
                        }
                    </td>
                    <td class="border border-gray-300 px-4 py-3 text-sm">${vehicle.registrationDate}</td>
                </tr>
            `).join('');
        }
        
        // Get vehicle type color
        function getVehicleTypeColor(type) {
            switch(type) {
                case '‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå': return 'bg-blue-100 text-blue-800';
                case '‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå': return 'bg-green-100 text-green-800';
                case '‡∏≠‡∏∑‡πà‡∏ô‡πÜ': return 'bg-purple-100 text-purple-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }
        
        // Refresh data button
        document.getElementById('refreshData').addEventListener('click', loadDashboardData);
        
        // Show success modal
        function showSuccessModal() {
            const modal = document.getElementById('successModal');
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        // Close success modal
        function closeSuccessModal() {
            const modal = document.getElementById('successModal');
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
        
        // Show message function
        function showMessage(type, message) {
            let messageEl;
            let icon;
            
            if (type === 'success') {
                messageEl = document.getElementById('successMessage');
                icon = '‚úÖ ';
            } else if (type === 'info') {
                // Use success message element for info messages with different icon
                messageEl = document.getElementById('successMessage');
                icon = '‚ÑπÔ∏è ';
            } else {
                messageEl = document.getElementById('errorMessage');
                icon = '‚ùå ';
            }
            
            if (messageEl) {
                messageEl.textContent = icon + message;
                messageEl.classList.remove('translate-x-full');
                setTimeout(() => {
                    messageEl.classList.add('translate-x-full');
                }, 3000);
            }
        }
        
        // Auto-refresh functionality
        let autoRefreshInterval;
        
        function startAutoRefresh() {
            // Refresh data every 30 seconds when on dashboard
            autoRefreshInterval = setInterval(() => {
                if (!document.getElementById('dashboardSection').classList.contains('hidden')) {
                    loadDashboardData();
                }
            }, 30000);
        }
        
        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize search and filter functionality
            initializeSearchAndFilter();
            
            // Load dashboard data on page load
            loadDashboardData();
            // Start auto-refresh
            startAutoRefresh();
            
            // Success modal event listeners
            document.getElementById('closeSuccessModal').addEventListener('click', closeSuccessModal);
            document.getElementById('successModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeSuccessModal();
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97ffa89e26df7b58',t:'MTc1ODAxODMxNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
