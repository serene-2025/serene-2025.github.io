        <!DOCTYPE html>
        <html lang="th">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Modern Registration</title>
            <meta name="description" content="Modern Registration for LIFF App" />
            <meta name="author" content="iton5" />
            <meta property="og:title" content="Modern Registration-iton5-thailand" />
            <meta property="og:description" content="Modern Registration for LIFF App" />
            <meta property="og:type" content="website" />
            <meta property="og:image" content="https://lh3.googleusercontent.com/d/1Ck_OCfEW4dEp3A1k9yfQplYmW7qmwzFF" />
            <script src="https://cdn.tailwindcss.com"></script>
            <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
            <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
            <link rel="stylesheet" href="https://bit.ly/fontiton5" type="text/css" charset="utf-8" />
            <style>
                @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap');

                body {
                    font-family: 'line_seed_sans_th';
                    background: linear-gradient(135deg, #f0f4f8, #d9e2ec);
                    display: flex;
                    justify-content: center;
                    align-items: flex-start;
                    min-height: 100vh;
                    padding: 20px;
                    box-sizing: border-box;
                }


                @keyframes fadeIn {
                    from { opacity: 0; transform: scale(0.95); }
                    to { opacity: 1; transform: scale(1); }
                }

                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }

                .card {
                    background: #ffffff;
                    border-radius: 20px;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
                    width: 100%;
                    max-width: 500px;
                    padding: 30px 40px;
                    box-sizing: border-box;
                    animation: fadeIn 0.6s ease-out forwards;
                }


                .screen {
                    display: none;
                }
                .screen.active {
                    display: block;
                }

                h1 {
                    text-align: center;
                    font-size: 2rem;
                    font-weight: 700;
                    margin-bottom: 2rem;
                    background: linear-gradient(45deg, #00b09b, #96c93d);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                }

                .form-group {
                    margin-bottom: 1.25rem;
                }

                label {
                    display: block;
                    margin-bottom: 0.5rem;
                    color: #4a5568;
                    font-weight: 600;
                    font-size: 0.9rem;
                }

                .form-input, .form-select {
                    width: 100%;
                    padding: 12px 15px;
                    border: 1px solid #e2e8f0;
                    border-radius: 10px;
                    box-sizing: border-box;
                    font-size: 1rem;
                    color: #2d3748;
                    background-color: #f7fafc;
                    transition: all 0.3s ease;
                }

                .form-input:focus, .form-select:focus {
                    outline: none;
                    border-color: #00b09b;
                    box-shadow: 0 0 0 3px rgba(0, 176, 155, 0.2);
                    background-color: #ffffff;
                }

                .form-grid {
                    display: grid;
                    grid-template-columns: 1fr 2fr;
                    gap: 1rem;
                }

                .btn {
                    width: 100%;
                    padding: 15px;
                    border: none;
                    border-radius: 10px;
                    font-size: 1.1rem;
                    font-weight: 700;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    position: relative;
                    overflow: hidden;
                }

                .btn-primary {
                    background: linear-gradient(45deg, #00b09b, #96c93d);
                    color: white;
                    box-shadow: 0 4px 15px rgba(0, 176, 155, 0.3);
                }

                .btn:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 6px 20px rgba(0, 176, 155, 0.4);
                }

                .btn:active {
                    transform: translateY(0);
                    box-shadow: 0 4px 15px rgba(0, 176, 155, 0.3);
                }

                .btn-secondary {
                    background-color: #e2e8f0;
                    color: #4a5568;
                }
                .btn-secondary:hover {
                    background-color: #cbd5e0;
                    box-shadow: none;
                }

                .pdpa-box {
                    background-color: #f7fafc;
                    border: 1px solid #e2e8f0;
                    padding: 15px;
                    border-radius: 10px;
                    height: 500px;
                    overflow-y: auto;
                    color: #718096;
                    font-size: 0.9rem;
                    margin-bottom: 1.5rem;
                }
                .pdpa-actions {
                    display: flex;
                    gap: 1rem;
                }

                .file-input-wrapper {
                    border: 2px dashed #e2e8f0;
                    padding: 20px;
                    border-radius: 10px;
                    text-align: center;
                    cursor: pointer;
                    transition: background-color 0.3s, border-color 0.3s;
                }
                .file-input-wrapper:hover {
                    background-color: #f7fafc;
                    border-color: #00b09b;
                }
                #imageUpload { display: none; }
                .image-preview-container { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
                .image-preview-item { width: 70px; height: 70px; border-radius: 10px; overflow: hidden; }
                .image-preview-item img { width: 100%; height: 100%; object-fit: cover; }

                #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.8); backdrop-filter: blur(5px); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; }
                .spinner { border: 5px solid #e2e8f0; border-top: 5px solid #00b09b; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
                #loading-text { color: #4a5568; font-weight: 600; margin-top: 20px; }
                .hidden { display: none !important; }
                #status { text-align: center; margin-top: 1.5rem; font-weight: 600; min-height: 24px; }
                .profile-header {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    margin-bottom: 1.5rem;
                }

                .profile-image {
                    width: 80px;
                    height: 80px;
                    border-radius: 50%;
                    border: 4px solid #ffffff;
                    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
                    object-fit: cover;
                }

                .profile-name {
                    margin-top: 0.75rem;
                    font-size: 1.1rem;
                    font-weight: 600;
                    color: #2d3748;
                }
            </style>
            </head>
        <body>

            <div class="card">
                <div id="screen-loading" class="screen active">
                     <h1>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</h1>
                </div>

                <div id="screen-pdpa" class="screen">
                    <h1>‡∏Ç‡πâ‡∏≠‡∏ï‡∏Å‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h1>
                    <div class="pdpa-box">
                        <p><strong>‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (Privacy Policy)</strong></p>
                        <p class="mt-2">‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ø ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡πà‡∏≤‡∏ô‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≤‡∏ô‡∏°‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î</p>

                        <p class="mt-3"><strong>1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°:</strong></p>
                        <p>‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô‡∏ã‡∏∂‡πà‡∏á‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏û‡∏µ‡∏¢‡∏á: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å LINE (User ID, ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á, ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå), ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•, ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏∑‡πà‡∏≠, ‡∏≠‡∏µ‡πÄ‡∏°‡∏•, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå ‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≤‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ô‡∏µ‡πâ</p>

                        <p class="mt-3"><strong>2. ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</strong></p>
                        <p>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô, ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°, ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ø ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏≠‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏Å‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á‡πÑ‡∏ß‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡∏à‡∏≤‡∏Å‡∏ó‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô</p>

                        <p class="mt-3"><strong>3. ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢:</strong></p>
                        <p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ö‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÑ‡∏ß‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏°‡∏≤‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô</p>

                        <p class="mt-3"><strong>4. ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Ç‡∏≠‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</strong></p>
                        <p>‡∏ó‡πà‡∏≤‡∏ô‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á, ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç, ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÑ‡∏ß‡πâ</p>

                        <p class="mt-4">‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°" ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ç‡πâ‡∏≠‡∏ï‡∏Å‡∏•‡∏á‡πÅ‡∏•‡∏∞‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡πâ‡∏ß</p>
                    </div>
                    <div class="pdpa-actions">
                        <button id="btn-pdpa-disagree" class="btn btn-secondary">‡πÑ‡∏°‡πà‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°</button>
                        <button id="btn-pdpa-agree" class="btn btn-primary">‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°</button>
                    </div>
                </div>

                <div id="screen-form" class="screen">
                        <h1
                            class="text-2xl font-extrabold tracking-tight text-gray-900 dark:text-slate-200 sm:text-3xl md:text-4xl">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h1>
                    <div class="profile-header mt-4">
                        <img id="profileImage" src="" alt="Profile Picture" class="profile-image">
                        <p class="profile-name">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, <span id="displayName"></span>!</p>
                    </div>
                    <form id="registrationForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="title">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label>
                                <select id="title" class="form-select" required>
                                    <option value="‡∏ô‡∏≤‡∏¢">‡∏ô‡∏≤‡∏¢</option>
                                    <option value="‡∏ô‡∏≤‡∏á">‡∏ô‡∏≤‡∏á</option>
                                    <option value="‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß">‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="first_name">‡∏ä‡∏∑‡πà‡∏≠</label>
                                <input type="text" id="first_name" class="form-input" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="last_name">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                            <input type="text" id="last_name" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label for="email">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                            <input type="email" id="email" class="form-input" placeholder="example@email.com" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                            <input type="tel" id="phone" class="form-input" maxlength="10" pattern="[0-9]{10}" inputmode="numeric" placeholder="0812345678" required>
                        </div>
                        <div class="form-group">
                            <label for="imageUpload">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡∏£‡∏π‡∏õ)</label>
                            <label for="imageUpload" class="file-input-wrapper">
                                <span id="file-input-text">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</span>
                            </label>
                            <input type="file" id="imageUpload" accept="image/*" multiple>
                            <div id="image-preview" class="image-preview-container"></div>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
                        </div>
                    </form>
                </div>

                <p id="status"></p>
            </div>

            <div id="loading-overlay" class="hidden">
                <div class="spinner"></div>
                <p id="loading-text">‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</p>
            </div>

            <script>

                const LIFF_ID = "2000143615-81jg2jz0";
                const SUPABASE_URL = "https://kjuuaeeayxumihaxdtns.supabase.co";
                const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtqdXVhZWVheXh1bWloYXhkdG5zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwNTA0MTcsImV4cCI6MjA2OTYyNjQxN30.0Z9_1jXOcrf7bOwwQIWNI0E6qO74Gpt28ZmK0OFlrgo";
                const BUCKET_NAME = "user-uploads";
                const TELEGRAM_BOT_TOKEN = "7708637309:AAHU2swP8U67XVWITdjsxjQoqiXIL9KbBJs"; 
                const TELEGRAM_CHAT_ID = "7585120244"; 

                const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                let liffProfile = null;

                const screens = {
                    loading: document.getElementById('screen-loading'),
                    pdpa: document.getElementById('screen-pdpa'),
                    form: document.getElementById('screen-form')
                };
                const loadingOverlay = document.getElementById('loading-overlay');
                const loadingText = document.getElementById('loading-text');
                const statusElement = document.getElementById('status');

                function showScreen(screenName) {
                    Object.values(screens).forEach(screen => screen.classList.remove('active'));
                    screens[screenName]?.classList.add('active');
                }


                function initializeForm() {
                    if (!liffProfile) return;
                    document.getElementById('profileImage').src = liffProfile.pictureUrl || '';
                    document.getElementById('displayName').innerText = liffProfile.displayName;
                }

                async function main() {
                    try {
                        await liff.init({ liffId: LIFF_ID, withLoginOnExternalBrowser: true  });
                        if (!liff.isLoggedIn()) { liff.login({ redirectUri: window.location.href }); return; }
                        liffProfile = await liff.getProfile();
                        document.getElementById('email').value = liff.getDecodedIDToken().email || '';
                        const { data } = await supabaseClient
                            .from('registrations')
                            .select('pdpa_consent')
                            .eq('user_id', liffProfile.userId)
                            .single();

                        if (data && data.pdpa_consent) {
                            initializeForm(); 
                            showScreen('form');
                        } else {
                            showScreen('pdpa');
                        }
                    } catch (error) {
                        if (error.code === 'PGRST116') {
                            showScreen('pdpa');
                        } else {
                            console.error("Init Error:", error);
                            statusElement.textContent = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
                        }
                    } finally {
                        screens.loading.classList.remove('active');
                    }
                }

                document.addEventListener('DOMContentLoaded', main);

                document.getElementById('btn-pdpa-agree').addEventListener('click', async () => {
                    loadingOverlay.classList.remove('hidden');
                    loadingText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°...';
                    try {
                        const { error } = await supabaseClient
                            .from('registrations')
                            .upsert({ user_id: liffProfile.userId, pdpa_consent: true, display_name: liffProfile.displayName, picture_url: liffProfile.pictureUrl }, { onConflict: 'user_id' });
                        if (error) throw error;

                        initializeForm(); 
                        showScreen('form');
                    } catch (error) {
                        console.error("PDPA Consent Error:", error);
                        statusElement.textContent = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°";
                    } finally {
                        loadingOverlay.classList.add('hidden');
                    }
                });

                       document.getElementById('btn-pdpa-disagree').addEventListener('click', () => {
                           if (liff.isInClient()) liff.closeWindow();
                       });

                       document.getElementById('imageUpload').addEventListener('change', (event) => {
                           const previewContainer = document.getElementById('image-preview');
                           const textLabel = document.getElementById('file-input-text');
                           previewContainer.innerHTML = '';
                           const files = event.target.files;

                           if (files.length > 5) {
                               alert("‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û");
                               event.target.value = '';
                               textLabel.textContent = '‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå';
                               return;
                           }

                           if(files.length > 0) {
                               textLabel.textContent = `${files.length} ‡πÑ‡∏ü‡∏•‡πå‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å`;
                           } else {
                               textLabel.textContent = '‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå';
                           }

                           Array.from(files).forEach(file => {
                               const reader = new FileReader();
                               reader.onload = (e) => {
                                   const div = document.createElement('div');
                                   div.className = 'image-preview-item';
                                   div.innerHTML = `<img src="${e.target.result}" alt="${file.name}">`;
                                   previewContainer.appendChild(div);
                               };
                               reader.readAsDataURL(file);
                           });
                       });


                function processAndCompressImage(file, maxDimension = 1280, quality = 0.8) {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.readAsDataURL(file);
                        reader.onerror = (error) => reject(error);
                        reader.onload = (event) => {
                            const img = new Image();
                            img.src = event.target.result;
                            img.onerror = (error) => reject(error);
                            img.onload = () => {
                                const canvas = document.createElement('canvas');

                                let newWidth = img.width;
                                let newHeight = img.height;

                                if (newWidth > maxDimension || newHeight > maxDimension) {
                                    if (newWidth > newHeight) {
                                        newHeight *= maxDimension / newWidth;
                                        newWidth = maxDimension;
                                    } else {
                                        newWidth *= maxDimension / newHeight;
                                        newHeight = maxDimension;
                                    }
                                }

                                canvas.width = newWidth;
                                canvas.height = newHeight;

                                const ctx = canvas.getContext('2d');
                                ctx.drawImage(img, 0, 0, newWidth, newHeight);

                                const webpDataUrl = canvas.toDataURL('image/webp', quality);

                                const blob = (() => {
                                    const parts = webpDataUrl.split(',');
                                    const mimeType = parts[0].match(/:(.*?);/)[1];
                                    const decodedData = atob(parts[1]);
                                    let n = decodedData.length;
                                    const u8arr = new Uint8Array(n);
                                    while (n--) {
                                        u8arr[n] = decodedData.charCodeAt(n);
                                    }
                                    return new Blob([u8arr], { type: mimeType });
                                })();

                                const newFileName = file.name.substring(0, file.name.lastIndexOf('.')) + '.webp';
                                const webpFile = new File([blob], newFileName, { type: 'image/webp' });

                                console.log(`Processed ${file.name}: Original size ${(file.size / 1024).toFixed(1)} KB -> New size ${(webpFile.size / 1024).toFixed(1)} KB`);
                                resolve(webpFile);
                            };
                        };
                    });
                }

        async function sendTelegramNotification_ClientSide(formData, imageUrls) {
            if (!TELEGRAM_BOT_TOKEN || !TELEGRAM_CHAT_ID) {
                console.warn("Telegram credentials are not set.");
                return;
            }

            const message = `
        üîî <b>‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà!</b>

        <b>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•:</b> ${formData.title} ${formData.first_name} ${formData.last_name}
        <b>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</b> ${formData.email || "‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏£‡∏≠‡∏Å"}
        <b>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</b> ${formData.phone || "‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏£‡∏≠‡∏Å"}
        <b>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ:</b> ${imageUrls.length} ‡∏£‡∏π‡∏õ

        <a href="${imageUrls[0] || ' '}">‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</a>
        `;

            const encodedMessage = encodeURIComponent(message);
            const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage?chat_id=${TELEGRAM_CHAT_ID}&text=${encodedMessage}&parse_mode=HTML`;

            try {

                fetch(url);
                console.log("Telegram notification request sent.");
            } catch (error) {
                console.error("Failed to send Telegram notification:", error);
            }
        }
                    document.getElementById('registrationForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    loadingOverlay.classList.remove('hidden');
                    const submitButton = e.target.querySelector('button[type="submit"]');
                    submitButton.disabled = true;

                    try {
                        const imageFiles = document.getElementById('imageUpload').files;
                        if (imageFiles.length === 0) {
                            throw new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏π‡∏õ");
                        }

                        loadingText.textContent = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• ${imageFiles.length} ‡∏£‡∏π‡∏õ...`;
                        const processingPromises = Array.from(imageFiles).map(file => processAndCompressImage(file, 1280, 0.8));
                        const processedFiles = await Promise.all(processingPromises);

                        loadingText.textContent = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î ${processedFiles.length} ‡∏£‡∏π‡∏õ...`;
                        const uploadPromises = processedFiles.map(file => {
                            const filePath = `${liffProfile.userId}/${Date.now()}-${file.name.replace(/\s/g, '_')}`;
                            return supabaseClient.storage.from(BUCKET_NAME).upload(filePath, file);
                        });

                        const uploadResults = await Promise.all(uploadPromises);
                        const imageUrls = [];
                        for (const result of uploadResults) {
                            if (result.error) throw new Error(`Upload failed: ${result.error.message}`);
                            const { data: urlData } = supabaseClient.storage.from(BUCKET_NAME).getPublicUrl(result.data.path);
                            imageUrls.push(urlData.publicUrl);
                        }

                        loadingText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
                        const formData = {
                            title: document.getElementById('title').value,
                            first_name: document.getElementById('first_name').value,
                            last_name: document.getElementById('last_name').value,
                            email: document.getElementById('email').value,
                            phone: document.getElementById('phone').value,
                            uploaded_image_urls: imageUrls
                        };

         const { error: insertError } = await supabaseClient
    .from('registrations')
    .insert({
        user_id: liffProfile.userId,
        display_name: liffProfile.displayName,
        picture_url: liffProfile.pictureUrl,
        ...formData
    });
                            
                        if (updateError) throw updateError;
                         await sendTelegramNotification_ClientSide(formData, imageUrls);

                        loadingText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô...';

                        const messagesToSend = [
                         {
                                "type": "flex",
                                "altText": "‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå",
                                "contents": {
                              "type": "bubble",
                              "header": {
                                "type": "box",
                                "layout": "vertical",
                                "contents": [
                                  {
                                    "type": "text",
                                    "text": "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢",
                                    "wrap": true,
                                    "weight": "bold",
                                    "size": "xl",
                                    "color": "#06C755",
                                    "margin": "none",
                                    "align": "center"
                                  }
                                ]
                              },
                              "hero": {
                                "type": "image",
                                "url": imageUrls[0],
                                "aspectMode": "fit",
                                "aspectRatio": "1:1",
                                "size": "full"
                              },
                              "body": {
                                "type": "box",
                                "layout": "vertical",
                                "contents": [
                                  {
                                    "type": "text",
                                    "text": "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤",
                                    "color": "#aaaaaa",
                                    "adjustMode": "shrink-to-fit"
                                  },
                                  {
                                    "type": "box",
                                    "layout": "horizontal",
                                    "contents": [
                                      {
                                        "type": "text",
                                        "text": "‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•:",
                                        "wrap": true,
                                        "flex": 3,
                                        "size": "xs",
                                        "color": "#989898"
                                      },
                                      {
                                        "type": "text",
                                        "text": `${formData.title} ${formData.first_name} ${formData.last_name}`,
                                        "wrap": true,
                                        "size": "xs",
                                        "margin": "md",
                                        "flex": 7,
                                        "color": "#222222",
                                        "align": "start"
                                      }
                                    ],
                                    "margin": "xxl"
                                  },
                                  {
                                    "type": "box",
                                    "layout": "baseline",
                                    "contents": [
                                      {
                                        "type": "text",
                                        "text": "‡∏≠‡∏µ‡πÄ‡∏°‡∏•:",
                                        "wrap": true,
                                        "flex": 3,
                                        "size": "xs",
                                        "color": "#989898"
                                      },
                                      {
                                        "type": "text",
                                        "text": `${formData.email}`,
                                        "wrap": true,
                                        "size": "xs",
                                        "margin": "md",
                                        "flex": 7,
                                        "color": "#222222"
                                      }
                                    ],
                                    "margin": "md"
                                  },
                                  {
                                    "type": "box",
                                    "layout": "baseline",
                                    "contents": [
                                      {
                                        "type": "text",
                                        "text": "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:",
                                        "wrap": true,
                                        "flex": 3,
                                        "size": "xs",
                                        "color": "#989898"
                                      },
                                      {
                                        "type": "text",
                                        "wrap": true,
                                        "size": "xs",
                                        "margin": "md",
                                        "flex": 7,
                                        "text": `${formData.phone}`,
                                        "color": "#222222"
                                      }
                                    ],
                                    "margin": "md"
                                  }
                                ],
                                "spacing": "sm"
                              },
                              "footer": {
                                "type": "box",
                                "layout": "vertical",
                                "contents": [
                                  {
                                    "type": "button",
                                    "style": "primary",
                                    "action": {
                                      "type": "uri",
                                      "label": "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡∏°‡πà",
                                      "uri": "https://liff.line.me/"+ LIFF_ID
                                    },
                                    "color": "#06C755",
                                    "height": "sm"
                                  }
                                ]
                              }
                            }
                            }
                        ];


                        if (liff.isInClient()) {
                            await liff.sendMessages(messagesToSend);
                            statusElement.textContent = "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß!";
                            Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß!", 'success');
                            setTimeout(() => liff.closeWindow(), 2000);
                        } else {

                            statusElement.textContent = "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (Flex Message ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)";

                        }


                    } catch (error) {
                        console.error('Submission Error:', error);
                        statusElement.textContent = `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`;
                    } finally {
                        loadingOverlay.classList.add('hidden');
                        submitButton.disabled = false;
                    }
                });
              const message = "‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö";

                document.addEventListener("contextmenu", function (e) {
                    Swal.fire('Oh!', message, 'error');

                    e.preventDefault();
                });

                document.addEventListener("mousedown", function (e) {
                    if (e.button === 2 || e.button === 1) {
                        Swal.fire('Oh!', message, 'error');

                        e.preventDefault();
                    }
                });
                   </script>
               </body>
               </html>
