<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á - ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£ (Online)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts: Sarabun -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // ==========================================
        // ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Supabase
        // ==========================================
        const SUPABASE_URL = 'https://dueckgfsbageeomiybav.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR1ZWNrZ2ZzYmFnZWVvbWl5YmF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3MzU4MjEsImV4cCI6MjA4NDMxMTgyMX0.69yySB2muOFaG51Wu1l2ZxDjbYgpNOiBxR2Wjy0Y10s';
        
        // ==========================================
        // ü§ñ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Telegram Bot
        // ==========================================
        const TELEGRAM_TOKEN = '8279169798:AAG-JnddhWhscK_Zr5vRCx9naaRDVMBZ9XQ';
        const TELEGRAM_CHAT_ID = '-1003502117297'; 

        // Initialize Client
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#10b981', // Emerald 500
                        secondary: '#4f46e5', // Indigo 600
                        accent: '#f59e0b', // Amber 500
                    },
                    fontFamily: {
                        sans: ['Sarabun', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f0f4f8;
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .glass-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }
        .image-preview {
            width: 100%;
            height: 220px;
            object-fit: cover;
            border-radius: 1rem;
            display: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Loading Overlay */
        #loadingOverlay {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(4px);
        }
        .nav-active {
            color: #10b981;
            background-color: #ecfdf5;
        }
        /* Admin Button Pulse */
        .admin-active {
            background-color: #fee2e2;
            color: #ef4444;
            border: 1px solid #fca5a5;
        }
        /* Modal Transition */
        #imageModal {
            transition: opacity 0.3s ease;
        }
        #modalImage {
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body class="text-slate-800 antialiased selection:bg-primary selection:text-white pb-20 lg:pb-0">

    <!-- Navbar -->
    <nav class="glass-nav sticky top-0 z-50 shadow-sm transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between mb-2 md:mb-0">
                <!-- Logo -->
                <div class="flex items-center gap-3 cursor-pointer" onclick="switchView('register')">
                    <div class="bg-gradient-to-tr from-primary to-emerald-300 w-10 h-10 rounded-xl flex items-center justify-center text-white shadow-lg shadow-emerald-200">
                        <i class="fa-solid fa-cloud text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold leading-tight text-slate-800">PetRegister <span class="text-primary text-xs bg-emerald-100 px-2 py-0.5 rounded-full">Online</span></h1>
                        <p class="text-xs text-slate-500">‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô</p>
                    </div>
                </div>

                <!-- Desktop Menu -->
                <div class="hidden md:flex items-center gap-2 bg-slate-100/50 p-1 rounded-xl border border-slate-200/50">
                    <button onclick="switchView('register')" id="btn-nav-register" class="px-5 py-2 rounded-lg text-sm font-semibold transition-all duration-200 flex items-center gap-2 text-slate-600 hover:bg-white hover:shadow-sm">
                        <i class="fa-solid fa-plus-circle"></i> ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
                    </button>
                    <button onclick="switchView('list')" id="btn-nav-list" class="px-5 py-2 rounded-lg text-sm font-semibold transition-all duration-200 flex items-center gap-2 text-slate-600 hover:bg-white hover:shadow-sm">
                        <i class="fa-solid fa-list"></i> ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
                    </button>
                    <!-- Admin Toggle -->
                    <button onclick="toggleAdmin()" id="btn-admin" class="ml-2 w-9 h-9 rounded-full flex items-center justify-center text-slate-400 hover:text-red-500 hover:bg-red-50 transition-colors" title="‡πÇ‡∏´‡∏°‡∏î‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö">
                        <i class="fa-solid fa-lock"></i>
                    </button>
                </div>

                <!-- Mobile Header Buttons -->
                <div class="flex items-center gap-2 md:hidden">
                    <button onclick="toggleAdmin()" id="mob-btn-admin" class="w-9 h-9 bg-slate-100 rounded-full flex items-center justify-center text-slate-400">
                        <i class="fa-solid fa-lock text-sm"></i>
                    </button>
                    <button onclick="switchView('register')" class="w-9 h-9 bg-primary text-white rounded-full flex items-center justify-center shadow-lg shadow-emerald-200">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </div>
            </div>

            <!-- Mobile Menu Tabs -->
            <div class="flex md:hidden border-t border-slate-100 pt-2 gap-2">
                <button onclick="switchView('register')" id="mob-nav-register" class="flex-1 py-2 text-center text-sm font-semibold rounded-lg transition-colors">
                    ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
                </button>
                <button onclick="switchView('list')" id="mob-nav-list" class="flex-1 py-2 text-center text-sm font-semibold rounded-lg transition-colors">
                    ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
                </button>
            </div>
        </div>
        
        <!-- Admin Banner -->
        <div id="adminBanner" class="hidden bg-red-500 text-white text-center text-xs py-1 font-bold tracking-wider">
            <i class="fa-solid fa-shield-halved mr-1"></i> ADMIN MODE ACTIVE
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 py-6 min-h-[80vh]">

        <!-- View: Register (Default Visible) -->
        <div id="view-register" class="fade-in">
            <div class="max-w-2xl mx-auto">
                <div class="bg-white rounded-3xl shadow-xl shadow-slate-200/50 p-6 md:p-8 border border-slate-100">
                    <div class="mb-8 text-center relative">
                        <span id="formBadge" class="bg-emerald-100 text-emerald-700 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">New Registration</span>
                        <h2 id="formTitle" class="text-2xl md:text-3xl font-bold text-slate-800 mt-3">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</h2>
                        <p class="text-slate-500 mt-1">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                        
                        <!-- Cancel Edit Button -->
                        <button id="cancelEditBtn" onclick="cancelEdit()" class="hidden absolute top-0 right-0 text-gray-400 hover:text-red-500 text-sm font-medium">
                            <i class="fa-solid fa-times mr-1"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                        </button>
                    </div>

                    <form id="petForm" onsubmit="handleRegister(event)" class="space-y-6">
                        
                        <!-- Owner Section -->
                        <div class="bg-slate-50 p-5 rounded-2xl border border-slate-100 space-y-4">
                            <div class="flex items-center gap-2 text-secondary font-bold text-lg">
                                <i class="fa-regular fa-id-card"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1.5 ml-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                <input type="text" id="ownerName" required 
                                    class="w-full px-4 py-3 bg-white border-0 rounded-xl focus:ring-2 focus:ring-primary/50 transition-all outline-none placeholder:text-slate-400 shadow-sm" 
                                    placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏£‡∏±‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå">
                            </div>

                            <div class="grid grid-cols-5 gap-3">
                                <div class="col-span-3">
                                    <label class="block text-sm font-medium text-slate-700 mb-1.5 ml-1">‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</label>
                                    <input type="text" id="houseNo" required 
                                        class="w-full px-4 py-3 bg-white border-0 rounded-xl focus:ring-2 focus:ring-primary/50 transition-all outline-none placeholder:text-slate-400 shadow-sm" 
                                        placeholder="99/99">
                                </div>
                                <div class="col-span-2">
                                    <label class="block text-sm font-medium text-slate-700 mb-1.5 ml-1">‡∏ã‡∏≠‡∏¢</label>
                                    <div class="relative">
                                        <select id="soi" class="w-full px-4 py-3 bg-white border-0 rounded-xl focus:ring-2 focus:ring-primary/50 transition-all outline-none appearance-none shadow-sm text-center">
                                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                                            <script>
                                                // Generate 20 Soi options
                                                for(let i=1; i<=20; i++) {
                                                    document.write(`<option value="${i}">‡∏ã‡∏≠‡∏¢ ${i}</option>`);
                                                }
                                            </script>
                                            <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                                        </select>
                                        <i class="fa-solid fa-chevron-down absolute right-3 top-4 text-slate-400 text-xs pointer-events-none"></i>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1.5 ml-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                                <div class="relative">
                                    <i class="fa-solid fa-phone absolute left-4 top-3.5 text-slate-400"></i>
                                    <input type="tel" id="phone" required inputmode="numeric"
                                        class="w-full pl-10 pr-4 py-3 bg-white border-0 rounded-xl focus:ring-2 focus:ring-primary/50 transition-all outline-none placeholder:text-slate-400 shadow-sm" 
                                        placeholder="08x-xxx-xxxx">
                                </div>
                            </div>
                        </div>

                        <!-- Pet Section -->
                        <div class="bg-slate-50 p-5 rounded-2xl border border-slate-100 space-y-4">
                            <div class="flex items-center gap-2 text-accent font-bold text-lg">
                                <i class="fa-solid fa-cat"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1.5 ml-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                                    <div class="relative">
                                        <select id="petType" class="w-full px-4 py-3 bg-white border-0 rounded-xl focus:ring-2 focus:ring-accent/50 transition-all outline-none appearance-none shadow-sm">
                                            <option value="‡∏™‡∏∏‡∏ô‡∏±‡∏Ç">üêï ‡∏™‡∏∏‡∏ô‡∏±‡∏Ç</option>
                                            <option value="‡πÅ‡∏°‡∏ß">üêà ‡πÅ‡∏°‡∏ß</option>
                                            <option value="‡∏ô‡∏Å">ü¶ú ‡∏ô‡∏Å</option>
                                            <option value="‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢">üêá ‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢</option>
                                            <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üêæ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                                        </select>
                                        <i class="fa-solid fa-chevron-down absolute right-4 top-4 text-slate-400 text-xs pointer-events-none"></i>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1.5 ml-1">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å</label>
                                    <input type="text" id="petName" required 
                                        class="w-full px-4 py-3 bg-white border-0 rounded-xl focus:ring-2 focus:ring-accent/50 transition-all outline-none placeholder:text-slate-400 shadow-sm" 
                                        placeholder="‡∏ô‡πâ‡∏≠‡∏á‡∏ñ‡∏∏‡∏á‡∏ó‡∏≠‡∏á">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2 ml-1">‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</label>
                                <div class="group relative w-full h-64 border-2 border-dashed border-slate-300 rounded-2xl hover:bg-white hover:border-primary transition-all cursor-pointer flex flex-col items-center justify-center overflow-hidden bg-white/50" 
                                    onclick="document.getElementById('petImage').click()">
                                    
                                    <div class="space-y-2 text-center z-10 p-4 transition-all duration-300" id="uploadPlaceholder">
                                        <div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto text-slate-400 group-hover:text-primary group-hover:scale-110 transition-all shadow-sm">
                                            <i class="fa-solid fa-camera text-3xl"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium text-slate-600">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ</p>
                                            <p class="text-xs text-slate-400 mt-1">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JPG, PNG (Max 10MB)</p>
                                        </div>
                                    </div>

                                    <img id="preview" class="image-preview absolute inset-0 z-20 h-full">
                                    <input id="petImage" type="file" class="sr-only" accept="image/*" onchange="previewImage(this)">
                                    
                                    <button type="button" id="removeImgBtn" onclick="removeImage(event)" 
                                        class="hidden absolute top-2 right-2 z-30 bg-white/90 text-red-500 w-9 h-9 rounded-full shadow-md hover:scale-110 transition flex items-center justify-center">
                                        <i class="fa-solid fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="pt-2 flex gap-3">
                            <button type="submit" id="submitBtn" class="flex-1 bg-gradient-to-r from-primary to-emerald-600 text-white font-bold py-4 rounded-2xl shadow-lg shadow-emerald-200 hover:shadow-emerald-300 hover:-translate-y-1 active:translate-y-0 transition-all text-lg flex items-center justify-center gap-2 group">
                                <span id="submitBtnText">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                                <i id="submitBtnIcon" class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- View: List (Hidden by default) -->
        <div id="view-list" class="hidden fade-in">
            <!-- Search & Filters -->
            <div class="bg-white rounded-3xl p-3 shadow-sm mb-8 flex items-center gap-3 border border-slate-100 sticky top-[130px] md:top-24 z-40">
                <div class="flex-1 relative">
                    <i class="fa-solid fa-search absolute left-5 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    <input type="text" id="searchInput" onkeyup="filterPets()" 
                        placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠, ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà..." 
                        class="w-full pl-12 pr-4 py-3.5 bg-transparent border-none focus:ring-0 text-slate-700 placeholder:text-slate-400 rounded-2xl outline-none">
                </div>
                <div class="bg-slate-50 px-4 py-2 rounded-2xl text-sm font-semibold text-slate-500 whitespace-nowrap hidden sm:flex items-center gap-2">
                    <i class="fa-solid fa-layer-group text-primary"></i>
                    <span id="count">...</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                </div>
            </div>

            <!-- Grid Content -->
            <div id="petGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 pb-20">
                <!-- Javascript will populate this -->
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="hidden flex flex-col items-center justify-center py-20 text-center">
                <div class="w-40 h-40 bg-slate-100 rounded-full flex items-center justify-center mb-6">
                    <i class="fa-solid fa-paw text-6xl text-slate-300"></i>
                </div>
                <h3 class="text-xl font-bold text-slate-700">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h3>
                <p class="text-slate-500 mt-2 max-w-xs mx-auto">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
            </div>
        </div>
    </div>

    <!-- Image Modal (Full Screen) -->
    <div id="imageModal" class="fixed inset-0 z-[100] hidden bg-black/95 backdrop-blur-md flex items-center justify-center p-4 cursor-zoom-out opacity-0" onclick="closeImageModal()">
        <img id="modalImage" src="" class="max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl transform scale-95 transition-transform duration-300">
        <button class="absolute top-5 right-5 text-white/70 hover:text-white text-4xl focus:outline-none w-12 h-12 flex items-center justify-center bg-white/10 rounded-full hover:bg-white/20 transition-all">
            <i class="fa-solid fa-xmark"></i>
        </button>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 z-[100] hidden flex flex-col items-center justify-center">
        <i class="fa-solid fa-circle-notch fa-spin text-4xl text-primary mb-3"></i>
        <p class="text-slate-600 font-medium">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 transform translate-y-32 opacity-0 transition-all duration-500 z-[60] w-max max-w-[90vw]">
        <div class="glass-effect bg-slate-800/90 text-white px-6 py-3.5 rounded-full shadow-2xl flex items-center gap-3 backdrop-blur-md">
            <!-- Added ID for safer selection -->
            <div id="toastIcon" class="bg-emerald-500 rounded-full p-1"><i class="fa-solid fa-check text-xs"></i></div>
            <span id="toastMessage" class="font-medium text-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</span>
        </div>
    </div>

    <script>
        // State management
        let pets = [];
        let currentImageBase64 = null;
        let currentView = 'register'; 
        let isAdmin = false; 
        let editingPetId = null; 
        let existingImageUrl = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            fetchPets();
            updateViewUI();
            
            // Try to load chat id from storage if previously saved (Optional convenience)
            const savedChatId = localStorage.getItem('tg_chat_id');
            if(savedChatId) TELEGRAM_CHAT_ID = savedChatId;
        });

        // ==========================================
        // üîê Admin & Navigation Logic
        // ==========================================
        function toggleAdmin() {
            if (isAdmin) {
                // Logout Admin
                isAdmin = false;
                showToast('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏°‡∏î Admin ‡πÅ‡∏•‡πâ‡∏ß');
            } else {
                // Login Admin
                const pass = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö (Demo: 1234)");
                if (pass === '1234') {
                    isAdmin = true;
                    showToast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î Admin ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
                    
                    // (Removed prompt for Chat ID since it is now hardcoded)
                } else if (pass !== null) {
                    showToast('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', true);
                }
            }
            updateAdminUI();
            renderPets(pets); 
        }

        function updateAdminUI() {
            const btn = document.getElementById('btn-admin');
            const mobBtn = document.getElementById('mob-btn-admin');
            const banner = document.getElementById('adminBanner');
            
            if (isAdmin) {
                btn?.classList.add('admin-active', 'text-red-500');
                btn.innerHTML = '<i class="fa-solid fa-unlock"></i>';
                mobBtn?.classList.add('admin-active', 'text-red-500');
                mobBtn.innerHTML = '<i class="fa-solid fa-unlock text-sm"></i>';
                banner.classList.remove('hidden');
            } else {
                btn?.classList.remove('admin-active', 'text-red-500');
                btn.innerHTML = '<i class="fa-solid fa-lock"></i>';
                mobBtn?.classList.remove('admin-active', 'text-red-500');
                mobBtn.innerHTML = '<i class="fa-solid fa-lock text-sm"></i>';
                banner.classList.add('hidden');
            }
        }

        function switchView(viewName) {
            currentView = viewName;
            updateViewUI();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateViewUI() {
            const listSection = document.getElementById('view-list');
            const registerSection = document.getElementById('view-register');
            const btnList = document.getElementById('btn-nav-list');
            const btnReg = document.getElementById('btn-nav-register');
            const mobList = document.getElementById('mob-nav-list');
            const mobReg = document.getElementById('mob-nav-register');

            if (currentView === 'list') {
                listSection.classList.remove('hidden');
                registerSection.classList.add('hidden');
                btnList?.classList.add('nav-active', 'bg-emerald-50', 'shadow-sm');
                btnReg?.classList.remove('nav-active', 'bg-emerald-50', 'shadow-sm');
                mobList?.classList.add('nav-active');
                mobReg?.classList.remove('nav-active');
            } else {
                listSection.classList.add('hidden');
                registerSection.classList.remove('hidden');
                btnList?.classList.remove('nav-active', 'bg-emerald-50', 'shadow-sm');
                btnReg?.classList.add('nav-active', 'bg-emerald-50', 'shadow-sm');
                mobList?.classList.remove('nav-active');
                mobReg?.classList.add('nav-active');
            }
        }

        // ==========================================
        // üì∑ Image Modal Logic
        // ==========================================
        function openImageModal(src) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            
            modalImg.src = src;
            modal.classList.remove('hidden');
            // Allow display:flex to apply first, then add opacity for transition
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modalImg.classList.remove('scale-95');
                modalImg.classList.add('scale-100');
            }, 10);
        }

        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');

            modal.classList.add('opacity-0');
            modalImg.classList.remove('scale-100');
            modalImg.classList.add('scale-95');
            
            setTimeout(() => {
                modal.classList.add('hidden');
                modalImg.src = '';
            }, 300); // Match transition duration
        }

        // ==========================================
        // üì¢ Telegram Notification
        // ==========================================
        async function notifyTelegram(pet) {
            if (!TELEGRAM_CHAT_ID) {
                 console.log('Telegram Notification skipped: No Chat ID');
                 return;
            }

            const message = `üì¢ *‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà*
            
üë§ *‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á:* ${pet.ownername}
üè† *‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:* ${pet.houseno} (‡∏ã‡∏≠‡∏¢ ${pet.soi})
üê∂ *‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á:* ${pet.petname} (${pet.pettype})
üìû *‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:* ${pet.phone}
üïí *‡πÄ‡∏ß‡∏•‡∏≤:* ${new Date().toLocaleString('th-TH')}`;

            try {
                // Determine endpoint
                let url = `https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`;
                let body = {};

                if (pet.image) {
                    url = `https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendPhoto`;
                    body = {
                        chat_id: TELEGRAM_CHAT_ID,
                        photo: pet.image,
                        caption: message,
                        parse_mode: 'Markdown'
                    };
                } else {
                    body = {
                        chat_id: TELEGRAM_CHAT_ID,
                        text: message,
                        parse_mode: 'Markdown'
                    };
                }

                // Call API using POST with JSON body (Simpler than FormData for URLs)
                await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                console.log('Telegram notification sent');

            } catch (error) {
                console.error('Telegram Notification Error:', error);
            }
        }


        // ==========================================
        // ‚úèÔ∏è Edit & Delete Logic
        // ==========================================

        function editPet(id) {
            const pet = pets.find(p => p.id === id);
            if (!pet) return;

            editingPetId = id;
            existingImageUrl = pet.image;
            
            document.getElementById('ownerName').value = pet.ownername;
            document.getElementById('houseNo').value = pet.houseno;
            document.getElementById('soi').value = pet.soi;
            document.getElementById('phone').value = pet.phone;
            document.getElementById('petType').value = pet.pettype;
            document.getElementById('petName').value = pet.petname;

            const preview = document.getElementById('preview');
            const placeholder = document.getElementById('uploadPlaceholder');
            const removeBtn = document.getElementById('removeImgBtn');

            if (pet.image) {
                preview.src = pet.image;
                preview.style.display = 'block';
                placeholder.classList.add('opacity-0');
                removeBtn.classList.remove('hidden');
            } else {
                removeImage(null);
            }

            document.getElementById('formTitle').innerText = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á';
            document.getElementById('formBadge').innerText = 'Editing Mode';
            document.getElementById('formBadge').className = 'bg-amber-100 text-amber-700 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider';
            document.getElementById('submitBtnText').innerText = '‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            document.getElementById('submitBtnIcon').className = 'fa-solid fa-save';
            document.getElementById('cancelEditBtn').classList.remove('hidden');

            switchView('register');
        }

        function cancelEdit() {
            editingPetId = null;
            existingImageUrl = null;
            resetForm();
            
            document.getElementById('formTitle').innerText = '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á';
            document.getElementById('formBadge').innerText = 'New Registration';
            document.getElementById('formBadge').className = 'bg-emerald-100 text-emerald-700 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider';
            document.getElementById('submitBtnText').innerText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            document.getElementById('submitBtnIcon').className = 'fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform';
            document.getElementById('cancelEditBtn').classList.add('hidden');
        }

        async function deletePet(id) {
            if(!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?')) return;
            setLoading(true);

            const { data: petData } = await supabaseClient
                .from('pets')
                .select('image')
                .eq('id', id)
                .single();

            if (petData && petData.image && petData.image.includes('/img/')) {
                try {
                    const urlParts = petData.image.split('/img/');
                    if (urlParts.length > 1) {
                        const filePath = urlParts[1];
                        await supabaseClient.storage.from('img').remove([filePath]);
                    }
                } catch (err) {
                    console.warn('Could not delete image file:', err);
                }
            }
            
            const { error } = await supabaseClient
                .from('pets')
                .delete()
                .eq('id', id);

            if (error) {
                showToast('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', true);
            } else {
                showToast('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
                fetchPets();
            }
            setLoading(false);
        }

        // ==========================================
        // üîÑ Data Operations
        // ==========================================

        async function fetchPets() {
            setLoading(true);
            const { data, error } = await supabaseClient
                .from('pets')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) {
                console.error('Error fetching pets:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', true);
            } else {
                pets = data;
                renderPets(pets);
            }
            setLoading(false);
        }

        function dataURLtoBlob(dataurl) {
            var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
                bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
            while(n--){
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], {type:mime});
        }

        async function handleRegister(e) {
            e.preventDefault();
            setLoading(true);

            let finalImageUrl = existingImageUrl; 

            if (currentImageBase64) {
                try {
                    const blob = dataURLtoBlob(currentImageBase64);
                    const fileName = `pet-${Date.now()}-${Math.floor(Math.random() * 1000)}.jpg`;
                    
                    const { data: uploadData, error: uploadError } = await supabaseClient
                        .storage
                        .from('img')
                        .upload(fileName, blob, { cacheControl: '3600', upsert: false });

                    if (uploadError) {
                        // FIX: Better Error Handling for RLS
                        if(uploadError.message.includes('Bucket not found')) {
                            alert('‡πÑ‡∏°‡πà‡∏û‡∏ö Bucket ‡∏ä‡∏∑‡πà‡∏≠ "img"\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á Bucket ‡πÉ‡∏ô Supabase Storage ‡∏ä‡∏∑‡πà‡∏≠ "img" ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô Public');
                            setLoading(false);
                            return; 
                        } else if (uploadError.message.includes('security policy') || uploadError.message.includes('new row violates')) {
                            alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏¥‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (RLS Policy)\n‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà\n\n‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ: ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Supabase > Storage > Policies ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î New Policy ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£ Insert');
                            // Do not return; continue to save data without new image
                        } else {
                            throw uploadError;
                        }
                    } else {
                        // Only get public URL if upload was successful
                        const { data: { publicUrl } } = supabaseClient
                            .storage
                            .from('img')
                            .getPublicUrl(fileName);
                        
                        finalImageUrl = publicUrl;
                    }

                } catch (err) {
                    console.error('Upload Error Details:', err);
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ: ' + err.message + '\n\n‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà');
                    // Continue without new image
                }
            }

            const petData = {
                ownername: document.getElementById('ownerName').value,
                houseno: document.getElementById('houseNo').value,
                soi: document.getElementById('soi').value || '-',
                phone: document.getElementById('phone').value,
                pettype: document.getElementById('petType').value,
                petname: document.getElementById('petName').value,
                image: finalImageUrl
            };

            let error;

            if (editingPetId) {
                // UPDATE
                const response = await supabaseClient
                    .from('pets')
                    .update(petData)
                    .eq('id', editingPetId);
                error = response.error;
            } else {
                // INSERT
                const response = await supabaseClient
                    .from('pets')
                    .insert([petData]);
                error = response.error;
                
                // üîî Notify Telegram only on NEW registration
                if (!error) {
                    notifyTelegram(petData);
                }
            }

            if (error) {
                console.error('Error saving:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, true);
            } else {
                showToast(editingPetId ? '‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢' : '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
                cancelEdit(); 
                await fetchPets();
            }
            setLoading(false);
        }

        // ==========================================
        // üñºÔ∏è Image & Render
        // ==========================================
        function previewImage(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                if (file.size > 10 * 1024 * 1024) {
                    showToast('‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10MB)', true);
                    input.value = '';
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const MAX_WIDTH = 800;
                        const MAX_HEIGHT = 800;
                        let width = img.width;
                        let height = img.height;

                        if (width > height) {
                            if (width > MAX_WIDTH) {
                                height *= MAX_WIDTH / width;
                                width = MAX_WIDTH;
                            }
                        } else {
                            if (height > MAX_HEIGHT) {
                                width *= MAX_HEIGHT / height;
                                height = MAX_HEIGHT;
                            }
                        }
                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        const compressedDataUrl = canvas.toDataURL('image/jpeg', 0.7);
                        currentImageBase64 = compressedDataUrl;

                        const preview = document.getElementById('preview');
                        const placeholder = document.getElementById('uploadPlaceholder');
                        const removeBtn = document.getElementById('removeImgBtn');
                        preview.src = compressedDataUrl;
                        preview.style.display = 'block';
                        placeholder.classList.add('opacity-0');
                        removeBtn.classList.remove('hidden');
                    };
                }
                reader.readAsDataURL(file);
            }
        }

        function removeImage(e) {
            if(e) e.stopPropagation();
            document.getElementById('petImage').value = '';
            currentImageBase64 = null;
            
            const preview = document.getElementById('preview');
            const placeholder = document.getElementById('uploadPlaceholder');
            const removeBtn = document.getElementById('removeImgBtn');
            preview.style.display = 'none';
            preview.src = '';
            placeholder.classList.remove('opacity-0');
            removeBtn.classList.add('hidden');
        }

        function resetForm() {
            document.getElementById('petForm').reset();
            removeImage(null);
            currentImageBase64 = null;
        }

        function renderPets(data) {
            const grid = document.getElementById('petGrid');
            const empty = document.getElementById('emptyState');
            const count = document.getElementById('count');
            
            grid.innerHTML = '';
            count.innerText = data.length;

            if (data.length === 0) {
                empty.classList.remove('hidden');
                return;
            } else {
                empty.classList.add('hidden');
            }

            data.forEach((pet, index) => {
                let typeColor = 'bg-slate-100 text-slate-600';
                if(pet.pettype === '‡∏™‡∏∏‡∏ô‡∏±‡∏Ç') typeColor = 'bg-orange-100 text-orange-600';
                else if(pet.pettype === '‡πÅ‡∏°‡∏ß') typeColor = 'bg-blue-100 text-blue-600';
                else if(pet.pettype === '‡∏ô‡∏Å') typeColor = 'bg-sky-100 text-sky-600';

                const displayImage = pet.image || 'https://images.unsplash.com/photo-1583337130417-3346a1be7dee?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=60';
                const dateObj = new Date(pet.created_at);
                const dateStr = dateObj.toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: '2-digit' });
                const delay = index < 8 ? `animation-delay: ${index * 50}ms` : '';

                // Admin Buttons
                const adminControls = isAdmin ? `
                    <div class="absolute top-3 right-3 flex gap-2 z-10">
                        <button onclick="editPet(${pet.id})" class="bg-white/80 hover:bg-white text-amber-500 hover:text-amber-600 w-8 h-8 rounded-full backdrop-blur-md flex items-center justify-center shadow-sm transition-all transform hover:scale-110">
                            <i class="fa-solid fa-pen text-xs"></i>
                        </button>
                        <button onclick="deletePet(${pet.id})" class="bg-white/80 hover:bg-white text-red-500 hover:text-red-600 w-8 h-8 rounded-full backdrop-blur-md flex items-center justify-center shadow-sm transition-all transform hover:scale-110">
                            <i class="fa-solid fa-trash text-xs"></i>
                        </button>
                    </div>
                ` : '';

                const card = `
                    <div class="bg-white rounded-3xl p-3 shadow-sm hover:shadow-xl transition-all duration-300 border border-slate-100 group fade-in flex flex-col relative" style="${delay}">
                        <div class="relative h-48 rounded-2xl overflow-hidden bg-slate-100 mb-3 shrink-0 cursor-zoom-in" onclick="openImageModal('${displayImage}')">
                            <img src="${displayImage}" alt="${pet.petname}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                            <div class="absolute top-3 left-3">
                                <span class="${typeColor} text-xs font-bold px-3 py-1.5 rounded-full shadow-sm backdrop-blur-md bg-opacity-90">
                                    ${pet.pettype}
                                </span>
                            </div>
                            <div class="absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity bg-black/30 text-white text-xs px-2 py-1 rounded-md backdrop-blur-sm pointer-events-none">
                                <i class="fa-solid fa-magnifying-glass-plus mr-1"></i> ‡∏î‡∏π‡∏£‡∏π‡∏õ
                            </div>
                            ${adminControls}
                        </div>
                        
                        <div class="px-2 pb-2 flex-1 flex flex-col">
                            <div class="flex justify-between items-end mb-3">
                                <h3 class="text-xl font-bold text-slate-800 leading-none truncate pr-2">${pet.petname}</h3>
                                <div class="text-right shrink-0">
                                    <span class="text-[10px] text-slate-400 block">${dateStr}</span>
                                    <span class="text-xs text-slate-500 font-medium">‡∏ö‡πâ‡∏≤‡∏ô ${pet.houseno}</span>
                                </div>
                            </div>
                            
                            <div class="space-y-2 bg-slate-50 rounded-xl p-3 mt-auto">
                                <div class="flex items-center gap-3 text-sm text-slate-600">
                                    <div class="w-5 flex justify-center"><i class="fa-solid fa-user text-secondary/70"></i></div>
                                    <span class="truncate font-medium text-xs">${pet.ownername}</span>
                                </div>
                                <div class="flex items-center gap-3 text-sm text-slate-600">
                                    <div class="w-5 flex justify-center"><i class="fa-solid fa-phone text-accent/70"></i></div>
                                    <a href="tel:${pet.phone}" class="hover:text-primary transition font-medium text-xs">${pet.phone}</a>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                grid.innerHTML += card;
            });
        }

        function filterPets() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = pets.filter(pet => {
                return (pet.ownername && pet.ownername.toLowerCase().includes(query)) || 
                       (pet.houseno && pet.houseno.toLowerCase().includes(query)) ||
                       (pet.petname && pet.petname.toLowerCase().includes(query));
            });
            renderPets(filtered);
        }

        function setLoading(isLoading) {
            const overlay = document.getElementById('loadingOverlay');
            if(isLoading) {
                overlay.classList.remove('hidden');
            } else {
                overlay.classList.add('hidden');
            }
        }

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            // Safe selection using new ID to prevent confusion with parent elements
            const msg = document.getElementById('toastMessage');
            const iconContainer = document.getElementById('toastIcon');
            
            // Check if elements exist to prevent errors
            if (!msg || !iconContainer) return;

            msg.innerText = message;
            
            if(isError) {
                iconContainer.className = 'bg-red-500 rounded-full p-1';
                iconContainer.innerHTML = '<i class="fa-solid fa-exclamation text-xs"></i>';
            } else {
                iconContainer.className = 'bg-emerald-500 rounded-full p-1';
                iconContainer.innerHTML = '<i class="fa-solid fa-check text-xs"></i>';
            }

            toast.classList.remove('translate-y-32', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-32', 'opacity-0');
            }, 3000);
        }
    </script>
</body>
</html>
