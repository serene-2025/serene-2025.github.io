<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>รับสมัครคณะกรรมการ - โกลเด้นแลนด์ ซีรีน</title>
    
    <!-- Google Fonts: Prompt -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Prompt', 'sans-serif'],
                        sarabun: ['Sarabun', 'sans-serif'], // Font for formal documents
                    },
                    colors: {
                        brand: {
                            50: '#fffbf0',
                            100: '#fde68a',
                            500: '#d97706',
                            600: '#b45309',
                            700: '#92400e',
                            800: '#78350f',
                            900: '#451a03',
                        },
                        accent: {
                            500: '#f59e0b',
                            600: '#d97706',
                        },
                        surface: '#fafaf9'
                    }
                }
            }
        }
    </script>

    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f5f5f4; }
        ::-webkit-scrollbar-thumb { background: #d6d3d1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a29e; }
        .modal-scroll::-webkit-scrollbar { width: 6px; }
        .modal-scroll::-webkit-scrollbar-thumb { background: #e7e5e4; border-radius: 3px; }

        /* Print Specific Styles */
        @media print {
            @page { 
                size: A4; 
                margin: 0;
            }
            body * {
                visibility: hidden;
            }
            #printArea, #printArea * {
                visibility: visible;
            }
            #printArea {
                position: fixed;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background: white;
                z-index: 9999;
                padding: 2cm; 
            }
            /* Hide URL/Page number headers/footers provided by browser if possible */
            html, body {
                height: 100vh; 
                overflow: hidden;
            }
        }
    </style>
</head>
<body class="bg-surface text-stone-800 font-sans min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-brand-900 text-white shadow-lg sticky top-0 z-50 border-b-2 border-accent-500 print:hidden">
        <div class="max-w-md mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-brand-100 to-accent-500 rounded-full flex items-center justify-center text-brand-900 shadow-md">
                    <i class="fa-solid fa-landmark text-lg"></i>
                </div>
                <div>
                    <h1 class="text-lg font-bold leading-tight text-brand-50">โกลเด้นแลนด์ ซีรีน</h1>
                    <p class="text-xs text-brand-100/80">นิติบุคคลหมู่บ้านจัดสรร</p>
                </div>
            </div>
            <button onclick="toggleAdminLogin()" class="text-white/50 hover:text-accent-500 transition">
                <i class="fa-solid fa-lock text-sm"></i>
            </button>
        </div>
    </header>

    <!-- Main Content (User View) -->
    <main id="userView" class="flex-grow print:hidden">
        <!-- Hero -->
        <div class="relative bg-gradient-to-b from-brand-800 to-brand-700 pb-20 pt-10 rounded-b-[3rem] overflow-hidden shadow-xl">
            <div class="absolute top-0 right-0 -mr-10 -mt-10 w-48 h-48 bg-accent-500 opacity-20 rounded-full blur-2xl"></div>
            <div class="absolute bottom-0 left-0 -ml-10 -mb-5 w-32 h-32 bg-white opacity-10 rounded-full blur-xl"></div>
            <div class="max-w-md mx-auto px-6 relative z-10 text-center">
                <span class="inline-block px-4 py-1 bg-white/10 backdrop-blur-md border border-white/20 text-brand-50 text-xs font-semibold rounded-full mb-4 shadow-sm">
                    <i class="fa-solid fa-star text-accent-500 mr-1"></i> เปิดรับสมัครกรรมการรุ่นใหม่
                </span>
                <h2 class="text-3xl font-bold text-white mb-3 drop-shadow-sm">สร้างสรรค์ชุมชน<br><span class="text-brand-100">ให้น่าอยู่ยิ่งขึ้น</span></h2>
                <p class="text-brand-100/90 mb-6 font-light text-sm">ขอเชิญท่านเจ้าของร่วมสมัครเป็นคณะกรรมการ<br>เพื่อพัฒนา "โกลเด้นแลนด์ ซีรีน" ของเรา</p>
                <div class="flex justify-center gap-4 text-white/90 text-sm font-medium">
                    <div class="px-3 py-1.5 bg-brand-900/30 rounded-lg backdrop-blur-sm border border-brand-500/30">
                        <i class="fa-regular fa-calendar-check text-accent-500 mr-1"></i> ม.ค. 2026
                    </div>
                    <div class="px-3 py-1.5 bg-brand-900/30 rounded-lg backdrop-blur-sm border border-brand-500/30">
                        <i class="fa-solid fa-user-group text-accent-500 mr-1"></i> รับ 9 ท่าน
                    </div>
                </div>
            </div>
        </div>

        <!-- Form -->
        <div class="max-w-md mx-auto px-4 -mt-12 relative z-20 pb-12">
            <form id="registrationForm" class="bg-white rounded-2xl shadow-xl p-6 space-y-5 border border-stone-100 relative overflow-hidden" onsubmit="handleSubmit(event)">
                <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-brand-600 via-accent-500 to-brand-600"></div>

                <div class="text-center border-b border-stone-100 pb-4 pt-2">
                    <h3 class="text-xl font-bold text-brand-900">แบบฟอร์มลงทะเบียน</h3>
                    <p class="text-sm text-stone-500">ประจำปี 2026</p>
                </div>

                <!-- Image Upload -->
                <div class="flex flex-col items-center justify-center mb-2">
                    <div class="relative group cursor-pointer transition-transform hover:scale-105" onclick="document.getElementById('photoUpload').click()">
                        <div id="imagePreview" class="w-28 h-28 rounded-full bg-stone-50 border-4 border-white shadow-lg flex items-center justify-center overflow-hidden object-cover ring-2 ring-brand-100">
                            <i class="fa-solid fa-camera text-stone-300 text-3xl group-hover:text-brand-500 transition"></i>
                            <img id="previewImg" class="w-full h-full object-cover hidden" alt="Preview">
                        </div>
                        <div class="absolute bottom-1 right-1 bg-gradient-to-r from-brand-600 to-accent-500 text-white p-2 rounded-full shadow-md border-2 border-white">
                            <i class="fa-solid fa-plus text-xs"></i>
                        </div>
                    </div>
                    <p class="text-xs text-stone-400 mt-3 font-medium">รูปถ่ายหน้าตรง (ถ้ามี)</p>
                    <input type="file" id="photoUpload" name="photo" class="hidden" accept="image/*" onchange="previewImage(this)">
                </div>

                <!-- Personal Info -->
                <div class="space-y-4">
                    <div class="flex items-center gap-2 text-brand-700 font-bold text-sm uppercase tracking-wide border-b border-stone-100 pb-2">
                        <i class="fa-solid fa-id-card text-accent-500"></i> ข้อมูลส่วนตัว
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-semibold text-stone-600 mb-1">ชื่อจริง</label>
                            <input type="text" name="firstName" required placeholder="สมชาย" class="w-full px-3 py-2.5 rounded-lg bg-stone-50 border border-stone-200 focus:outline-none focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500 text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-stone-600 mb-1">นามสกุล</label>
                            <input type="text" name="lastName" required placeholder="ใจดี" class="w-full px-3 py-2.5 rounded-lg bg-stone-50 border border-stone-200 focus:outline-none focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500 text-sm">
                        </div>
                    </div>
                    <div class="grid grid-cols-5 gap-3">
                        <div class="col-span-2">
                            <label class="block text-xs font-semibold text-stone-600 mb-1">อายุ (ปี)</label>
                            <input type="number" name="age" required placeholder="45" min="20" class="w-full px-3 py-2.5 rounded-lg bg-stone-50 border border-stone-200 focus:outline-none focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500 text-sm">
                        </div>
                        <div class="col-span-3">
                            <label class="block text-xs font-semibold text-stone-600 mb-1">อาชีพปัจจุบัน</label>
                            <input type="text" name="occupation" required placeholder="เช่น ธุรกิจส่วนตัว" class="w-full px-3 py-2.5 rounded-lg bg-stone-50 border border-stone-200 focus:outline-none focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500 text-sm">
                        </div>
                    </div>
                </div>

                <!-- Contact Info -->
                <div class="space-y-4 pt-2">
                    <div class="flex items-center gap-2 text-brand-700 font-bold text-sm uppercase tracking-wide border-b border-stone-100 pb-2">
                        <i class="fa-solid fa-map-location-dot text-accent-500"></i> ที่อยู่และการติดต่อ
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-semibold text-stone-600 mb-1">บ้านเลขที่</label>
                            <input type="text" name="houseNo" required placeholder="998/99" class="w-full px-3 py-2.5 rounded-lg bg-stone-50 border border-stone-200 focus:outline-none focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500 text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-stone-600 mb-1">ซอย</label>
                            <input type="text" name="soi" placeholder="5" class="w-full px-3 py-2.5 rounded-lg bg-stone-50 border border-stone-200 focus:outline-none focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500 text-sm">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-semibold text-stone-600 mb-1">เบอร์โทรศัพท์</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-stone-400 text-xs"><i class="fa-solid fa-phone"></i></span>
                                <input type="tel" name="phone" required placeholder="08x-xxx-xxxx" class="w-full pl-8 pr-3 py-2.5 rounded-lg bg-stone-50 border border-stone-200 focus:outline-none focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500 text-sm">
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-stone-600 mb-1">Line ID</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-[#06c755] text-xs"><i class="fa-brands fa-line"></i></span>
                                <input type="text" name="lineId" required placeholder="ไอดีไลน์" class="w-full pl-8 pr-3 py-2.5 rounded-lg bg-stone-50 border border-stone-200 focus:outline-none focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500 text-sm">
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-stone-600 mb-1">อีเมล (Email)</label>
                        <input type="email" name="email" required placeholder="email@example.com" class="w-full px-3 py-2.5 rounded-lg bg-stone-50 border border-stone-200 focus:outline-none focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500 text-sm">
                    </div>
                </div>

                <!-- Skills & Vision -->
                <div class="space-y-4 pt-2">
                    <div class="flex items-center gap-2 text-brand-700 font-bold text-sm uppercase tracking-wide border-b border-stone-100 pb-2">
                        <i class="fa-solid fa-lightbulb text-accent-500"></i> วิสัยทัศน์เพื่อหมู่บ้าน
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-stone-600 mb-1">ความเชี่ยวชาญพิเศษ</label>
                        <textarea name="skills" rows="2" required placeholder="เช่น บัญชี, กฎหมาย, วิศวกรรมโยธา, การตลาด..." class="w-full px-3 py-2.5 rounded-lg bg-stone-50 border border-stone-200 focus:outline-none focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500 text-sm resize-none"></textarea>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-stone-600 mb-1">สิ่งที่อยากพัฒนา / นโยบาย</label>
                        <textarea name="vision" rows="3" required placeholder="อธิบายแนวทางที่ท่านอยากพัฒนา โกลเด้นแลนด์ ซีรีน..." class="w-full px-3 py-2.5 rounded-lg bg-stone-50 border border-stone-200 focus:outline-none focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500 text-sm resize-none"></textarea>
                    </div>
                </div>

                <!-- Consent -->
                <div class="flex items-start gap-3 p-3 bg-brand-50 rounded-lg border border-brand-100/50">
                    <input type="checkbox" id="consent" required class="mt-0.5 w-4 h-4 text-brand-600 rounded border-gray-300 focus:ring-brand-500 accent-brand-600">
                    <label for="consent" class="text-xs text-stone-600 leading-relaxed">
                        ข้าพเจ้าขอรับรองว่าเป็นเจ้าของกรรมสิทธิ์ใน "โกลเด้นแลนด์ ซีรีน" และยินยอมให้เปิดเผยข้อมูลเพื่อการเลือกตั้ง
                    </label>
                </div>

                <!-- Submit Button -->
                <button type="submit" id="submitBtn" class="w-full bg-gradient-to-r from-brand-700 via-brand-600 to-brand-700 text-white font-bold py-3.5 px-6 rounded-xl shadow-lg hover:shadow-xl hover:translate-y-[-2px] hover:from-brand-600 hover:to-brand-600 transition-all duration-300 flex items-center justify-center gap-2 group">
                    <span>ยืนยันการสมัคร</span>
                    <i class="fa-solid fa-paper-plane group-hover:translate-x-1 transition-transform"></i>
                </button>
            </form>

            <div class="mt-8 text-center space-y-2">
                <p class="text-xs text-stone-400">ข้อมูลจะถูกบันทึกอย่างปลอดภัย</p>
                <div class="flex justify-center gap-2 text-stone-300 text-lg">
                    <i class="fa-brands fa-google-drive"></i>
                    <i class="fa-solid fa-shield-halved"></i>
                </div>
            </div>
        </div>
    </main>

    <!-- Admin View (Hidden by default) -->
    <main id="adminView" class="hidden flex-grow bg-slate-100 pb-12 print:hidden">
        <div class="bg-brand-900 text-white px-4 py-8 rounded-b-3xl shadow-lg mb-6">
            <div class="max-w-4xl mx-auto flex justify-between items-end">
                <div>
                    <h2 class="text-2xl font-bold">แผงควบคุมแอดมิน</h2>
                    <p class="text-brand-100 text-sm">รายชื่อผู้สมัครคณะกรรมการ</p>
                </div>
                <button onclick="logoutAdmin()" class="bg-white/10 px-4 py-2 rounded-lg hover:bg-white/20 text-sm backdrop-blur-sm">
                    <i class="fa-solid fa-sign-out-alt mr-1"></i> ออกจากระบบ
                </button>
            </div>
        </div>

        <div class="max-w-4xl mx-auto px-4">
            <div class="bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden">
                <div class="p-4 border-b border-stone-100 flex justify-between items-center bg-stone-50">
                    <h3 class="font-bold text-stone-700"><i class="fa-solid fa-users mr-2"></i>ผู้สมัครทั้งหมด</h3>
                    <button onclick="fetchApplicants()" class="text-brand-600 hover:text-brand-700 text-sm font-medium">
                        <i class="fa-solid fa-arrows-rotate mr-1"></i> รีเฟรช
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-stone-600">
                        <thead class="text-xs text-stone-500 uppercase bg-stone-50 border-b border-stone-100">
                            <tr>
                                <th class="px-6 py-3">รูปภาพ</th>
                                <th class="px-6 py-3">ชื่อ-นามสกุล</th>
                                <th class="px-6 py-3">ข้อมูลส่วนตัว</th>
                                <th class="px-6 py-3">ติดต่อ</th>
                                <th class="px-6 py-3">วิสัยทัศน์</th>
                                <th class="px-6 py-3 text-center">จัดการ</th>
                            </tr>
                        </thead>
                        <tbody id="applicantTableBody">
                            <tr>
                                <td colspan="6" class="px-6 py-8 text-center text-stone-400">
                                    <i class="fa-solid fa-spinner fa-spin mr-2"></i> กำลังโหลดข้อมูล...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="fixed inset-0 z-[70] flex items-center justify-center hidden print:hidden">
        <div class="absolute inset-0 bg-stone-900/80 backdrop-blur-sm transition-opacity" onclick="toggleAdminLogin()"></div>
        <div class="bg-white rounded-2xl p-8 max-w-sm w-full mx-4 relative z-10 shadow-2xl">
            <h3 class="text-xl font-bold text-center mb-4 text-brand-900">เข้าสู่ระบบแอดมิน</h3>
            <input type="password" id="adminPassword" placeholder="รหัสผ่าน" class="w-full px-4 py-3 rounded-xl bg-stone-50 border border-stone-200 mb-4 focus:ring-2 focus:ring-brand-500 focus:outline-none">
            <button onclick="checkAdminPassword()" class="w-full bg-brand-600 text-white font-bold py-3 rounded-xl hover:bg-brand-700 transition">
                เข้าใช้งาน
            </button>
        </div>
    </div>

    <!-- Qualifications Modal -->
    <div id="qualificationsModal" class="fixed inset-0 z-[60] flex items-center justify-center hidden print:hidden">
        <div class="absolute inset-0 bg-stone-900/80 backdrop-blur-sm transition-opacity"></div>
        <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 relative z-10 shadow-2xl border-t-4 border-brand-600 max-h-[90vh] flex flex-col animate-[fadeIn_0.3s_ease-out]">
            <div class="text-center mb-4 flex-shrink-0">
                 <div class="w-14 h-14 bg-brand-50 rounded-full flex items-center justify-center mx-auto mb-3 text-brand-600 ring-4 ring-brand-100/50">
                    <i class="fa-solid fa-scale-balanced text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-brand-900">คุณสมบัติผู้สมัคร</h3>
                <p class="text-xs text-stone-500">ตาม พ.ร.บ. การจัดสรรที่ดิน และระเบียบปฏิบัติ</p>
            </div>
            
            <div class="overflow-y-auto flex-grow mb-5 pr-2 space-y-3 text-sm text-stone-700 modal-scroll">
                <div class="bg-brand-50/40 p-3 rounded-lg border border-brand-100/60">
                    <p class="font-semibold text-brand-800 mb-2 text-sm">1. คุณสมบัติตามกฎหมาย:</p>
                    <ul class="list-disc pl-5 space-y-2 text-stone-600 text-xs leading-relaxed">
                        <li>เป็น<b class="text-brand-700">เจ้าของกรรมสิทธิ์</b>ในที่ดินแปลงย่อยในหมู่บ้าน</li>
                        <li>กรณีเจ้าของเป็นนิติบุคคล ต้องเป็นผู้มีอำนาจกระทำการแทน</li>
                        <li>ไม่เป็นคู่สมรสของผู้สมัครรายอื่นในการเลือกตั้งคราวเดียวกัน</li>
                        <li>บรรลุนิติภาวะ (อายุ 20 ปีบริบูรณ์ขึ้นไป)</li>
                        <li><span class="text-red-600 font-bold underline decoration-red-300">ไม่ค้างชำระ</span> ค่าใช้จ่ายส่วนกลาง</li>
                        <li>ไม่เป็นบุคคลล้มละลาย หรือไร้ความสามารถ</li>
                        <li>ไม่เคยได้รับโทษจำคุกโดยคำพิพากษาถึงที่สุด (เว้นแต่ลหุโทษ)</li>
                    </ul>
                </div>
                <div class="bg-orange-50/50 p-3 rounded-lg border border-orange-100/60 mt-2">
                    <p class="font-semibold text-orange-800 mb-2 text-sm flex items-center">
                        <i class="fa-solid fa-heart text-orange-500 mr-2"></i>2. จิตวิญญาณและทัศนคติ:
                    </p>
                    <ul class="list-disc pl-5 space-y-2 text-stone-600 text-xs leading-relaxed">
                        <li>ต้องมี<b>ใจรักในงานจิตอาสา</b> (เนื่องจากเป็นตำแหน่งที่ไม่มีเงินเดือน)</li>
                        <li>สามารถ<b>ทำงานร่วมกับทีม</b>ได้เป็นอย่างดี</li>
                        <li>เปิดกว้างและ<b>ยอมรับความคิดเห็นที่แตกต่าง</b>ได้</li>
                        <li>มีวุฒิภาวะทางอารมณ์และ<b>รับแรงกดดัน</b>ในการทำงานได้</li>
                    </ul>
                </div>
                <p class="text-[10px] text-stone-400 text-center mt-2 italic">* กรุณาตรวจสอบคุณสมบัติก่อนการลงทะเบียน เพื่อรักษาสิทธิ์ของท่าน</p>
            </div>

            <button onclick="closeQualificationsModal()" class="flex-shrink-0 w-full bg-gradient-to-r from-brand-700 via-brand-600 to-brand-700 text-white font-bold py-3 rounded-xl shadow-lg hover:shadow-xl hover:translate-y-[-1px] transition-all active:scale-[0.98] text-sm flex items-center justify-center gap-2">
                <span>รับทราบและยอมรับเงื่อนไข</span>
                <i class="fa-solid fa-check"></i>
            </button>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 z-50 flex items-center justify-center hidden print:hidden">
        <div class="absolute inset-0 bg-stone-900/70 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
        <div class="bg-white rounded-2xl p-8 max-w-sm w-full mx-4 relative z-10 text-center shadow-2xl transform scale-100 transition-transform border-t-4 border-accent-500">
            <div class="w-20 h-20 bg-green-50 rounded-full flex items-center justify-center mx-auto mb-4 text-green-500 ring-4 ring-green-100">
                <i class="fa-solid fa-check-circle text-4xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-brand-900 mb-2">ลงทะเบียนสำเร็จ!</h3>
            <p class="text-stone-500 mb-6 text-sm">ขอบคุณที่ร่วมเป็นส่วนหนึ่งของ<br>ครอบครัวโกลเด้นแลนด์ ซีรีน</p>
            <button onclick="closeModal()" class="w-full bg-stone-800 text-white font-medium py-3 rounded-xl hover:bg-stone-700 transition">
                ปิดหน้าต่าง
            </button>
        </div>
    </div>

    <!-- Print Template (Hidden by default, shown in print mode) -->
    <div id="printArea" class="hidden font-sarabun text-black p-8">
        <!-- Header -->
        <div class="flex justify-between items-start border-b-2 border-black pb-4 mb-6">
            <div class="flex items-center gap-4">
                <div class="w-16 h-16 bg-stone-200 rounded-full flex items-center justify-center text-stone-600 border-2 border-stone-400">
                    <i class="fa-solid fa-landmark text-3xl"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold">นิติบุคคลหมู่บ้านจัดสรร โกลเด้นแลนด์ ซีรีน</h1>
                    <p class="text-sm text-gray-600">Goldenland Serene Village Juristic Person</p>
                </div>
            </div>
            <div class="text-right">
                <div class="text-xl font-bold mb-1">ใบสมัครคณะกรรมการ</div>
                <div class="text-sm">ประจำปี 2026</div>
            </div>
        </div>

        <div class="flex gap-8 mb-6">
            <!-- Photo Area -->
            <div class="w-32 h-40 bg-gray-100 border border-gray-300 flex items-center justify-center flex-shrink-0" id="printPhotoContainer">
                <span class="text-gray-400 text-sm">รูปถ่าย 1 นิ้ว</span>
                <img id="printPhoto" class="w-full h-full object-cover hidden" />
            </div>

            <!-- Main Info -->
            <div class="flex-grow space-y-4">
                <div class="flex justify-between">
                    <div class="w-1/2">
                        <span class="font-bold">วันที่สมัคร:</span> <span id="printDate" class="ml-2 border-b border-dotted border-gray-400 px-2"></span>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <span class="font-bold">ชื่อ-นามสกุล:</span> <span id="printName" class="ml-2 border-b border-dotted border-gray-400 px-2 block"></span>
                    </div>
                    <div>
                        <span class="font-bold">อายุ:</span> <span id="printAge" class="ml-2 border-b border-dotted border-gray-400 px-2"></span> ปี
                    </div>
                </div>
                <div>
                    <span class="font-bold">อาชีพปัจจุบัน:</span> <span id="printOccupation" class="ml-2 border-b border-dotted border-gray-400 px-2 w-full"></span>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <span class="font-bold">บ้านเลขที่:</span> <span id="printHouseNo" class="ml-2 border-b border-dotted border-gray-400 px-2"></span>
                    </div>
                    <div>
                        <span class="font-bold">ซอย:</span> <span id="printSoi" class="ml-2 border-b border-dotted border-gray-400 px-2"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Section -->
        <div class="mb-6">
            <h3 class="font-bold text-lg border-b border-gray-300 mb-3 pb-1">ข้อมูลการติดต่อ</h3>
            <div class="grid grid-cols-3 gap-4">
                <div>
                    <span class="font-bold">โทรศัพท์:</span> <span id="printPhone" class="ml-2"></span>
                </div>
                <div>
                    <span class="font-bold">Line ID:</span> <span id="printLine" class="ml-2"></span>
                </div>
                <div>
                    <span class="font-bold">Email:</span> <span id="printEmail" class="ml-2"></span>
                </div>
            </div>
        </div>

        <!-- Vision Section -->
        <div class="mb-8">
            <h3 class="font-bold text-lg border-b border-gray-300 mb-3 pb-1">คุณสมบัติและวิสัยทัศน์</h3>
            <div class="mb-4">
                <span class="font-bold block mb-1">ความเชี่ยวชาญพิเศษ:</span>
                <div id="printSkills" class="p-3 bg-gray-50 border border-gray-200 rounded min-h-[60px]"></div>
            </div>
            <div>
                <span class="font-bold block mb-1">วิสัยทัศน์ / นโยบายการพัฒนา:</span>
                <div id="printVision" class="p-3 bg-gray-50 border border-gray-200 rounded min-h-[100px]"></div>
            </div>
        </div>

        <!-- Signatures -->
        <div class="flex justify-between mt-12 pt-8">
            <div class="text-center w-5/12">
                <div class="border-b border-black w-full h-1 mb-2"></div>
                <p>ลงชื่อผู้สมัคร</p>
                <p class="text-sm text-gray-500">( <span id="printSignName"></span> )</p>
            </div>
            <div class="text-center w-5/12">
                <div class="border-b border-black w-full h-1 mb-2"></div>
                <p>ลงชื่อเจ้าหน้าที่รับสมัคร</p>
                <p class="text-sm text-gray-500">( ........................................................... )</p>
            </div>
        </div>
        
        <div class="text-center text-xs text-gray-400 mt-12">
            เอกสารฉบับนี้พิมพ์จากระบบรับสมัครออนไลน์ โกลเด้นแลนด์ ซีรีน
        </div>
    </div>

    <script>
        // --- 1. CONFIGURATION ---
        // !!! สำคัญ: นำ URL ที่ได้จากการ Deploy Google Apps Script รอบใหม่มาใส่ที่นี่ !!!
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxoW7IFqQR6GRNv45YnWGCmLNEgwL8XE_F8s3X94j20Rs9DvyZzrYlJSAB8zuNUFblstA/exec"; 
        let allApplicants = []; // Store fetched data

        // --- 2. SHOW MODAL ON LOAD ---
        window.addEventListener('DOMContentLoaded', () => {
            document.getElementById('qualificationsModal').classList.remove('hidden');
        });

        function closeQualificationsModal() {
            document.getElementById('qualificationsModal').classList.add('hidden');
        }

        // --- 3. IMAGE PREVIEW ---
        function previewImage(input) {
            if (input.files && input.files[0]) {
                if (input.files[0].size > 4 * 1024 * 1024) {
                    alert("ขนาดไฟล์รูปใหญ่เกินไป กรุณาใช้รูปขนาดไม่เกิน 4MB");
                    input.value = "";
                    return;
                }
                var reader = new FileReader();
                reader.onload = function(e) {
                    const previewImg = document.getElementById('previewImg');
                    const icon = document.querySelector('#imagePreview i');
                    previewImg.src = e.target.result;
                    previewImg.classList.remove('hidden');
                    icon.classList.add('hidden');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // --- 4. HELPER: RESIZE, COMPRESS & CONVERT TO BASE64 ---
        // ฟังก์ชันนี้จะแปลงรูปเป็น Base64 โดยอัตโนมัติ พร้อมย่อขนาดเพื่อให้ส่งผ่าน Google Apps Script ได้
        function resizeAndCompressImage(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX_WIDTH = 800; // กำหนดความกว้าง 800px เพื่อให้ไฟล์ไม่ใหญ่เกินไป
                        
                        let width = img.width;
                        let height = img.height;

                        if (width > MAX_WIDTH) {
                            height *= MAX_WIDTH / width;
                            width = MAX_WIDTH;
                        }

                        canvas.width = width;
                        canvas.height = height;
                        
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // แปลงเป็น JPG และ Base64 string (ลดคุณภาพเหลือ 0.7)
                        const dataUrl = canvas.toDataURL('image/jpeg', 0.7);
                        
                        resolve({
                            data: dataUrl.split(',')[1], // ตัด header 'data:image/jpeg;base64,' ออก เพื่อให้ Apps Script นำไปใช้ได้เลย
                            type: 'image/jpeg',
                            name: file.name.replace(/\.[^/.]+$/, "") + ".jpg"
                        });
                    }
                }
            });
        }

        // --- 5. FORM SUBMISSION ---
        async function handleSubmit(event) {
            event.preventDefault();
            
            const btn = document.getElementById('submitBtn');
            const form = document.getElementById('registrationForm');
            const originalBtnContent = btn.innerHTML;
            
            // UI Loading State
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> กำลังอัปโหลดข้อมูล...';
            btn.classList.add('opacity-75', 'cursor-not-allowed', 'bg-stone-500');

            try {
                // Collect Data
                const formData = new FormData(form);
                const data = {};
                formData.forEach((value, key) => {
                    if (key !== 'photo') data[key] = value;
                });
                
                data.timestamp = new Date().toLocaleString('th-TH');

                // Handle Image File
                const fileInput = document.getElementById('photoUpload');
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    console.log("Processing image...", file.name);
                    
                    // เรียกใช้ฟังก์ชันแปลง Base64 ที่นี่
                    const compressedImage = await resizeAndCompressImage(file);
                    
                    data.imageFile = {
                        name: compressedImage.name,
                        type: compressedImage.type,
                        data: compressedImage.data
                    };
                }

                console.log("Sending data payload...");

                if (GOOGLE_SCRIPT_URL) {
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        body: JSON.stringify(data)
                    });
                    showSuccess();
                } else {
                    console.warn("Simulation mode: Success");
                    setTimeout(showSuccess, 2000);
                }

            } catch (error) {
                console.error('Error:', error);
                alert('เกิดข้อผิดพลาด: ' + error.message);
                
                // Reset Button
                btn.disabled = false;
                btn.innerHTML = originalBtnContent;
                btn.classList.remove('opacity-75', 'cursor-not-allowed', 'bg-stone-500');
            }
        }

        function showSuccess() {
            const btn = document.getElementById('submitBtn');
            btn.innerHTML = 'เรียบร้อย';
            document.getElementById('successModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('successModal').classList.add('hidden');
            window.location.reload(); 
        }

        // --- 6. ADMIN DASHBOARD LOGIC ---
        function toggleAdminLogin() {
            const modal = document.getElementById('adminLoginModal');
            modal.classList.toggle('hidden');
        }

        function checkAdminPassword() {
            const pw = document.getElementById('adminPassword').value;
            if(pw === 'admin1234') { // Simple client-side check for demo
                toggleAdminLogin();
                document.getElementById('userView').classList.add('hidden');
                document.getElementById('adminView').classList.remove('hidden');
                fetchApplicants();
            } else {
                alert('รหัสผ่านไม่ถูกต้อง');
            }
        }

        function logoutAdmin() {
            document.getElementById('adminView').classList.add('hidden');
            document.getElementById('userView').classList.remove('hidden');
            document.getElementById('adminPassword').value = '';
        }

        async function fetchApplicants() {
            const tbody = document.getElementById('applicantTableBody');
            tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-8 text-center text-stone-400"><i class="fa-solid fa-spinner fa-spin mr-2"></i> กำลังโหลดข้อมูล...</td></tr>';
            
            try {
                // Fetch from GAS doGet
                const response = await fetch(GOOGLE_SCRIPT_URL);
                
                // ตรวจสอบสถานะการตอบกลับ
                if (!response.ok) {
                    throw new Error(`Server returned ${response.status} ${response.statusText}`);
                }

                allApplicants = await response.json(); // Store global
                
                tbody.innerHTML = '';
                
                if(allApplicants.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-8 text-center text-stone-400">ยังไม่มีผู้สมัคร หรือไม่พบข้อมูลในระบบ</td></tr>';
                    return;
                }

                allApplicants.forEach((app, index) => {
                    const row = document.createElement('tr');
                    row.className = 'bg-white border-b hover:bg-stone-50 transition';
                    
                    // Photo logic
                    let photoHtml = '<div class="w-12 h-12 bg-stone-100 rounded-full flex items-center justify-center text-stone-300"><i class="fa-solid fa-user"></i></div>';
                    if(app.photo && app.photo.startsWith('http')) {
                        photoHtml = `<img src="${app.photo}" class="w-12 h-12 rounded-full object-cover border border-stone-200 cursor-pointer hover:scale-150 transition-transform" onclick="window.open('${app.photo}', '_blank')">`;
                    }

                    row.innerHTML = `
                        <td class="px-6 py-4">${photoHtml}</td>
                        <td class="px-6 py-4 font-medium text-stone-800">${app.name}</td>
                        <td class="px-6 py-4">
                            <div class="text-xs text-stone-500">อายุ: ${app.age} ปี</div>
                            <div class="text-xs text-stone-500">อาชีพ: ${app.occupation}</div>
                        </td>
                        <td class="px-6 py-4 text-xs text-stone-500">
                            ${app.contact}
                        </td>
                        <td class="px-6 py-4 text-xs text-stone-500 max-w-xs truncate" title="${app.vision}">
                            ${app.vision}
                        </td>
                        <td class="px-6 py-4 text-center">
                            <button onclick="printApplicant(${index})" class="text-white bg-brand-600 hover:bg-brand-700 w-8 h-8 rounded-lg shadow-sm transition-colors" title="พิมพ์ใบสมัคร">
                                <i class="fa-solid fa-print text-xs"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });

            } catch(e) {
                console.error("Fetch Error:", e);
                let msg = "เกิดข้อผิดพลาดในการโหลดข้อมูล";
                if(e.message.includes("Unexpected token")) {
                    msg += " (กรุณาตรวจสอบว่าได้ Deploy เป็น Web App ใหม่หรือยัง)";
                } else {
                    msg += ": " + e.message;
                }
                tbody.innerHTML = `<tr><td colspan="6" class="px-6 py-8 text-center text-red-400">${msg}</td></tr>`;
            }
        }

        // --- 7. PRINT FUNCTION ---
        function printApplicant(index) {
            const app = allApplicants[index];
            if (!app) return;

            // Map data to print template
            document.getElementById('printDate').innerText = app.timestamp;
            document.getElementById('printName').innerText = app.name;
            document.getElementById('printSignName').innerText = app.name;
            document.getElementById('printAge').innerText = app.age;
            document.getElementById('printOccupation').innerText = app.occupation;
            
            // Extract contact info manually since it's combined in the table view
            // Note: Ideally, fetch returns raw fields. Assuming raw fields are not available in current 'app' object structure from doGet
            // We need to parse 'contact' string or modify GAS doGet to return all fields separately.
            // Let's rely on what we have, parsing the contact string
            const contactParts = app.contact.split('|');
            document.getElementById('printPhone').innerText = contactParts[0] ? contactParts[0].replace('โทร:', '').trim() : '-';
            document.getElementById('printLine').innerText = contactParts[1] ? contactParts[1].replace('Line:', '').trim() : '-';
            
            // Email is likely in the array but maybe not fully exposed in 'contact' string in previous doGet.
            // Let's check doGet again. It returns: { timestamp, name, age, occupation, contact, vision, photo }
            // To do this properly, I should update the GAS doGet to return full object. 
            // For now, I will map what I can. Email might be missing in this view.
            
            // *Wait*, checking the previous GAS doGet...
            // It mapped: name = row[1]+" "+row[2], contact = "โทร: "+row[7]+" | Line: "+row[8]"
            // It didn't return HouseNo, Soi, Email, Skills explicitly in the JSON object keys.
            // **Correction**: The print view will be incomplete without modifying GAS. 
            // BUT, since I cannot modify GAS in this turn (unless I output it), I will try to use what I have.
            // Actually, the user asked to "Add function to print". 
            // The best way is to print what we have in the dashboard + vision.
            // I will fill missing fields with "-" for now.
            
            // NOTE: To get full data, you should update your Google Apps Script 'doGet' function 
            // to return all fields (houseNo, soi, email, skills) as separate keys.
            
            document.getElementById('printVision').innerText = app.vision;
            
            // Image
            const img = document.getElementById('printPhoto');
            const placeholder = document.querySelector('#printPhotoContainer span');
            if (app.photo && app.photo.startsWith('http')) {
                img.src = app.photo;
                img.classList.remove('hidden');
                placeholder.classList.add('hidden');
            } else {
                img.classList.add('hidden');
                placeholder.classList.remove('hidden');
            }

            // Print command
            window.print();
        }
    </script>
</body>
</html>
