<html lang="en">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ระบบลงทะเบียนสมาชิก</title>
    <!-- ใช้ฟอนต์ Kanit และ Bai Jamjuree -->
    <link href='https://fonts.googleapis.com/css?family=Kanit:400,500|Bai+Jamjuree:400,500' rel='stylesheet'>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <!-- SweetAlert2 -->
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- LIFF SDK -->
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        :root {
            --primary-color: #6c5ce7;
            --secondary-color: #a29bfe;
            --success-color: #00b894;
            --danger-color: #d63031;
            --light-color: #f5f6fa;
            --dark-color: #2d3436;
        }

        body {
            background-color: #f8f9fa;
            font-family: 'Kanit', sans-serif;
            color: var(--dark-color);
        }

        .card-form {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin: 2rem auto;
            max-width: 600px;
            animation: fadeIn 0.8s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .form-label {
            font-weight: 500;
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }

        .form-control, .form-select {
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 0.75rem;
            margin-bottom: 1rem;
            font-family: 'Bai Jamjuree', sans-serif;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(108, 92, 231, 0.25);
        }

        .btn-primary {
            background-color: var(--primary-color);
            border: none;
            border-radius: 8px;
            padding: 0.75rem;
            font-weight: 500;
            width: 100%;
            transition: background-color 0.3s;
        }

        .btn-primary:hover {
            background-color: #5649c0;
        }

        .avatar {
            border-radius: 50%;
            border: 3px solid var(--primary-color);
            margin-bottom: 1rem;
        }

        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .form-check-label {
            font-weight: 500;
            color: var(--dark-color);
        }

        .required:after {
            content: " *";
            color: var(--danger-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card-form">
            <div class="text-center mb-4">
                <img id="picURL" class="avatar" alt="Profile Picture" width="100" height="100">
                <h1>ลงทะเบียนสมาชิก</h1>
            </div>

            <form id="loginForm" class="was-validated" autocomplete="off" name="google-sheet">
                <!-- ชื่อ-สกุล -->
                <div class="mb-3">
                    <label for="name0" class="form-label required"><i class="fas fa-user me-2"></i>ชื่อ-สกุล</label>
                    <input type="text" class="form-control" placeholder="ชื่อ-สกุล" id="name0" name="name0" required>
                </div>

                <!-- เบอร์โทร -->
                <div class="mb-3">
                    <label for="phone" class="form-label required"><i class="fas fa-phone me-2"></i>เบอร์โทรติดต่อ</label>
                    <input type="tel" class="form-control" placeholder="ระบุเบอร์โทรติดต่อกลับ" id="phone" name="phone" required>
                </div>

                <!-- บ้านเลขที่ -->
                <div class="mb-3">
                    <label for="name1" class="form-label required"><i class="fas fa-home me-2"></i>บ้านเลขที่</label>
                    <input type="text" class="form-control" placeholder="บ้านเลขที่ เช่น 998/88" id="name1" name="name1" required>
                </div>

                <!-- ซอย -->
                <div class="mb-3">
                    <label for="room" class="form-label required"><i class="fas fa-road me-2"></i>ซอย</label>
                    <select id="room" name="room" class="form-select" required>
                        <option value="" disabled selected>เลือกซอย</option>
                        <option value="ซอย 1">ซอย 1</option>
                        <option value="ซอย 2">ซอย 2</option>
                        <option value="ซอย 3">ซอย 3</option>
                        <option value="ซอย 4">ซอย 4</option>
                        <option value="ซอย 5">ซอย 5</option>
                        <option value="ซอย 6">ซอย 6</option>
                        <option value="ซอย 7">ซอย 7</option>
                        <option value="ซอย 8">ซอย 8</option>
                        <option value="ซอย 9">ซอย 9</option>
                        <option value="ซอย 10">ซอย 10</option>
                        <option value="ซอย 11">ซอย 11</option>
                        <option value="ซอย 12">ซอย 12</option>
                    </select>
                </div>

                <!-- การอยู่อาศัย -->
                <div class="mb-3">
                    <label for="name2" class="form-label required"><i class="fas fa-users me-2"></i>การอยู่อาศัย</label>
                    <select id="name2" name="name2" class="form-select" required>
                        <option value="" disabled selected>เลือกประเภทการอยู่อาศัย</option>
                        <option value="เจ้าของบ้าน">เจ้าของบ้าน</option>
                        <option value="เจ้าของร่วม">เจ้าของร่วม</option>
                        <option value="ผู้อาศัย">ผู้อาศัย</option>
                        <option value="ผู้เช่า">ผู้เช่า</option>
                        <option value="ยังไม่มีคนอยู่">ยังไม่มีคนอยู่</option>
                        <option value="บ้านร้าง">บ้านร้าง</option>
                        <option value="อื่นๆ">อื่นๆ</option>
                    </select>
                </div>

                <!-- จำนวนสมาชิก -->
                <div class="mb-3">
                    <label for="name3" class="form-label required"><i class="fas fa-user-friends me-2"></i>จำนวนสมาชิกในบ้าน</label>
                    <select id="name3" name="name3" class="form-select" required>
                        <option value="" disabled selected>เลือกจำนวนสมาชิกในบ้าน</option>
                        <option value="1">1 คน</option>
                        <option value="2">2 คน</option>
                        <option value="3">3 คน</option>
                        <option value="4">4 คน</option>
                        <option value="5">5 คน</option>
                        <option value="6">6 คน</option>
                        <option value="7">7 คน</option>
                        <option value="8">8 คน</option>
                        <option value="9">9 คน</option>
                        <option value="10">10 คน</option>
                    </select>
                </div>

                <!-- E-mail -->
                <div class="mb-3">
                    <label for="name4" class="form-label"><i class="fas fa-envelope me-2"></i>E-mail (ใช้ในการออกบิลส่วนกลาง)</label>
                    <input type="email" class="form-control" placeholder="E-mail" id="name4" name="name4">
                </div>

                <!-- Line ID -->
                <div class="mb-3">
                    <label for="name5" class="form-label"><i class="fab fa-line me-2"></i>Line ID</label>
                    <input type="text" class="form-control" placeholder="Line ID" id="name5" name="name5">
                </div>

                <!-- Hidden Fields -->
                <input type="hidden" id="picture" name="picture" value="">
                <input type="hidden" id="RichMenuID" name="RichMenuID" value="richmenu-0bd347b4edc64174ace50549713b0a3b">
                <input type="hidden" id="userId" name="userId">
                <input type="hidden" id="profileImageUrl" name="profileImageUrl">
                <input type="hidden" id="lineDisplayName" name="lineDisplayName">
                <input type="hidden" id="uid" name="Uid">
                <input type="hidden" id="uname" name="UName">
                <input type="hidden" id="upic" name="Upic">

                <!-- Checkbox ยืนยัน -->
                <div class="form-check mb-4">
                    <input type="checkbox" class="form-check-input" name="visto" id="visto" required>
                    <label class="form-check-label" for="visto">ยืนยันส่งข้อมูลการสมัครสมาชิก</label>
                    <div class="invalid-feedback">หากไม่ยืนยันจะไม่สามารถลงทะเบียนได้</div>
                </div>

                <!-- ปุ่มลงทะเบียน -->
                <button type="submit" name="submit" id="submit" class="btn btn-primary" disabled>
                    <i class="fas fa-paper-plane me-2"></i>ลงทะเบียน
                </button>
            </form>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        window.onload = function() {
            initializeLiff("2000143615-Y8AQVAaq");
        };

        function initializeLiff(myLiffId) {
            liff.init({
                liffId: myLiffId
            })
            .then(() => {
                getid();
            })
            .then(() => {
                testclick();
            })
            .catch(err => {});
        }

        function getid() {
            liff.getProfile().then(function(profile) {
                const uid = profile.userId;
                const uname = profile.displayName;
                const upic = profile.pictureUrl;
                document.getElementById("picURL").src = upic;
                document.getElementsByName("Uid")[0].value = uid;
                document.getElementsByName("UName")[0].value = uname;
                document.getElementsByName("Upic")[0].value = upic;
            });
        }

        function testclick() {
            document.getElementById("submit").addEventListener("click", function() {
                liff.getProfile().then(profile => {
                    var name = profile.displayName;
                    var picURL = profile.pictureUrl;
                    var uid = profile.userId;
                    var phone = document.getElementById("phone");
                    var name0 = document.getElementById("name0");
                    var name1 = document.getElementById("name1");
                    var room = document.getElementById("room");
                    var name2 = document.getElementById("name2");
                    var name3 = document.getElementById("name3");

                    liff.sendMessages([{
                        type: "flex",
                        altText: "ลงทะเบียนสำเร็จ",
                        contents: {
                            "type": "bubble",
                            "hero": {
                                "type": "image",
                                "url": picURL,
                                "size": "full",
                                "aspectRatio": "20:13",
                                "aspectMode": "cover",
                                "action": {
                                    "type": "uri",
                                    "uri": "https://lin.ee/vybrauo"
                                }
                            },
                            "body": {
                                "type": "box",
                                "layout": "vertical",
                                "spacing": "md",
                                "action": {
                                    "type": "uri",
                                    "uri": "https://lin.ee/vybrauo"
                                },
                                "contents": [
                                    {
                                        "type": "text",
                                        "text": "✅ลงทะเบียนเรียบร้อยแล้ว!",
                                        "size": "md",
                                        "weight": "bold",
                                        "color": "#1DB446"
                                    },
                                    {
                                        "type": "box",
                                        "layout": "vertical",
                                        "spacing": "sm",
                                        "contents": [
                                            {
                                                "type": "box",
                                                "layout": "baseline",
                                                "contents": [
                                                    {
                                                        "type": "icon",
                                                        "url": "https://cdn-icons-png.flaticon.com/512/18109/18109387.png"
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": "ชื่อ-สกุล :",
                                                        "weight": "bold",
                                                        "margin": "sm",
                                                        "flex": 0
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": name0.value,
                                                        "size": "md",
                                                        "align": "end",
                                                        "weight": "bold"
                                                    }
                                                ]
                                            },
                                            {
                                                "type": "box",
                                                "layout": "baseline",
                                                "contents": [
                                                    {
                                                        "type": "icon",
                                                        "url": "https://cdn-icons-png.flaticon.com/512/17482/17482384.png"
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": "บ้านเลขที่ :",
                                                        "weight": "bold",
                                                        "margin": "sm",
                                                        "flex": 0
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": name1.value,
                                                        "size": "md",
                                                        "align": "end",
                                                        "weight": "bold"
                                                    }
                                                ]
                                            },
                                            {
                                                "type": "box",
                                                "layout": "baseline",
                                                "contents": [
                                                    {
                                                        "type": "icon",
                                                        "url": "https://cdn-icons-png.flaticon.com/512/18109/18109380.png"
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": "ซอย :",
                                                        "weight": "bold",
                                                        "margin": "sm",
                                                        "flex": 0
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": room.value,
                                                        "size": "md",
                                                        "align": "end",
                                                        "weight": "bold"
                                                    }
                                                ]
                                            },
                                            {
                                                "type": "box",
                                                "layout": "baseline",
                                                "contents": [
                                                    {
                                                        "type": "icon",
                                                        "url": "https://cdn-icons-png.flaticon.com/512/18109/18109346.png"
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": "การอยู่อาศัย :",
                                                        "weight": "bold",
                                                        "margin": "sm",
                                                        "flex": 0
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": name2.value,
                                                        "size": "md",
                                                        "align": "end",
                                                        "weight": "bold"
                                                    }
                                                ]
                                            },
                                            {
                                                "type": "box",
                                                "layout": "baseline",
                                                "contents": [
                                                    {
                                                        "type": "icon",
                                                        "url": "https://cdn-icons-png.flaticon.com/512/17481/17481972.png"
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": "จำนวนสมาชิก :",
                                                        "weight": "bold",
                                                        "margin": "sm",
                                                        "flex": 0
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": name3.value,
                                                        "size": "md",
                                                        "align": "end",
                                                        "weight": "bold"
                                                    }
                                                ],
                                                "spacing": "md"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "separator"
                                    },
                                    {
                                        "type": "text",
                                        "text": "Uid : " + uid,
                                        "wrap": true,
                                        "size": "sm",
                                        "align": "start",
                                        "margin": "sm",
                                        "weight": "bold"
                                    },
                                    {
                                        "type": "separator"
                                    },
                                    {
                                        "type": "text",
                                        "text": "ชื่อไลน์ : " + name,
                                        "wrap": true,
                                        "size": "sm",
                                        "align": "start",
                                        "margin": "sm",
                                        "weight": "bold"
                                    },
                                    {
                                        "type": "separator"
                                    },
                                    {
                                        "type": "text",
                                        "text": "หมายเลขโทรศัพท์ :" + phone.value,
                                        "wrap": true,
                                        "size": "sm",
                                        "align": "start",
                                        "flex": 0,
                                        "weight": "bold"
                                    },
                                    {
                                        "type": "separator"
                                    },
                                    {
                                        "type": "text",
                                        "text": "คลิกปุ่มด้านล่างเพื่อเข้าระบบ",
                                        "size": "sm",
                                        "align": "center",
                                        "color": "#ff3333"
                                    }
                                ]
                            },
                            "footer": {
                                "type": "box",
                                "layout": "horizontal",
                                "contents": [
                                    {
                                        "type": "button",
                                        "action": {
                                            "type": "uri",
                                            "label": "คลิกเข้าระบบ",
                                            "uri": "https://liff.line.me/2000143615-Mp3la3EK"
                                        },
                                        "style": "primary"
                                    }
                                ]
                            }
                        }
                    }]);

                    Swal.fire({
                        icon: 'success',
                        title: 'ลงทะเบียนเรียบร้อย !!',
                        showConfirmButton: false,
                        text: 'ท่านได้ส่งข้อมูลเรียบร้อยแล้วค่ะ',
                        timer: 6500
                    })
                    .then(function() {
                        liff.closeWindow();
                    });
                });
            });
        }

        const scriptURL = 'https://script.google.com/macros/s/AKfycbzDBa9nJZ-qFyNn-qoM8f59pjp5JDbxizK8DIWdj0zBkOG7bTUu5JBOwGj1EpycGFvt/exec';
        const form = document.forms['google-sheet'];
        form.addEventListener('submit', e => {
            e.preventDefault();
            fetch(scriptURL, { method: 'POST', body: new FormData(form) })
                .catch(error => console.error('Error!', error.message));
        });

        $(document).ready(function() {
            $('#submit').prop('disabled', true);
            $('#visto').click(function() {
                if ($(this).is(':checked')) {
                    $('#submit').prop('disabled', false);
                } else {
                    $('#submit').prop('disabled', true);
                }
            });
        });
    </script>
</body>
</html>
