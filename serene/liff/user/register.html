<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        .gradient-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.05)"/><circle cx="10" cy="60" r="0.5" fill="rgba(255,255,255,0.05)"/><circle cx="90" cy="40" r="0.5" fill="rgba(255,255,255,0.05)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            pointer-events: none;
        }
        .form-container {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        .input-focus:focus {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }
        .input-focus {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid #e5e7eb;
        }
        .input-focus:hover {
            border-color: #c7d2fe;
        }
        .success-animation {
            animation: successPulse 0.6s ease-in-out;
        }
        @keyframes successPulse {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .floating-elements {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }
        .floating-elements::before,
        .floating-elements::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 6s ease-in-out infinite;
        }
        .floating-elements::before {
            width: 200px;
            height: 200px;
            top: 10%;
            left: -100px;
            animation-delay: 0s;
        }
        .floating-elements::after {
            width: 150px;
            height: 150px;
            bottom: 10%;
            right: -75px;
            animation-delay: 3s;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        .header-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .form-label {
            font-weight: 600;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .required-star {
            color: #ef4444;
            font-weight: bold;
        }
        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 200% 200%;
            animation: gradientShift 3s ease infinite;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .copyright {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">
    <!-- Floating Elements -->
    <div class="floating-elements"></div>
    
    <div class="form-container max-w-2xl w-full rounded-2xl shadow-2xl p-8 relative z-10">
        <!-- Header -->
        <div class="text-center mb-10">
            <div class="w-24 h-24 header-icon rounded-full mx-auto mb-6 flex items-center justify-center text-4xl">
                üè†
            </div>
            <h1 class="text-4xl font-bold bg-gradient-to-r from-purple-600 via-blue-600 to-pink-600 bg-clip-text text-transparent mb-3">
                ‚ú® ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‚ú®
            </h1>
            <p class="text-gray-600 text-lg">üåü ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å üåü</p>
            <div class="flex justify-center gap-2 mt-4 text-2xl">
                <span class="animate-bounce">üéâ</span>
                <span class="animate-bounce" style="animation-delay: 0.1s;">üéä</span>
                <span class="animate-bounce" style="animation-delay: 0.2s;">üéà</span>
            </div>
        </div>



        <!-- Registration Form -->
        <form id="registrationForm" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- UID -->
                <div class="md:col-span-2">
                    <label for="uid" class="form-label text-sm mb-2">
                        üÜî ‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ <span class="required-star">*</span>
                    </label>
                    <input type="text" id="uid" name="uid" required 
                           class="input-focus w-full px-4 py-3 rounded-lg transition-all duration-300"
                           placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
                </div>

                <!-- Line Name -->
                <div>
                    <label for="line_name" class="form-label text-sm mb-2">
                        üí¨ ‡∏ä‡∏∑‡πà‡∏≠ Line
                    </label>
                    <input type="text" id="line_name" name="line_name" 
                           class="input-focus w-full px-4 py-3 rounded-lg transition-all duration-300"
                           placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô Line">
                </div>

                <!-- Full Name -->
                <div>
                    <label for="fullname" class="form-label text-sm mb-2">
                        üë§ ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="required-star">*</span>
                    </label>
                    <input type="text" id="fullname" name="fullname" required
                           class="input-focus w-full px-4 py-3 rounded-lg transition-all duration-300"
                           placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                </div>

                <!-- House Number -->
                <div>
                    <label for="house_no" class="form-label text-sm mb-2">
                        üè† ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà <span class="required-star">*</span>
                    </label>
                    <input type="text" id="house_no" name="house_no" required
                           class="input-focus w-full px-4 py-3 rounded-lg transition-all duration-300"
                           placeholder="‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô">
                </div>

                <!-- Soi -->
                <div>
                    <label for="soi" class="form-label text-sm mb-2">
                        üõ£Ô∏è ‡∏ã‡∏≠‡∏¢ <span class="required-star">*</span>
                    </label>
                    <select id="soi" name="soi" required
                            class="input-focus w-full px-4 py-3 rounded-lg transition-all duration-300">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ã‡∏≠‡∏¢</option>
                        <option value="‡∏ã‡∏≠‡∏¢ 1">üèòÔ∏è ‡∏ã‡∏≠‡∏¢ 1</option>
                        <option value="‡∏ã‡∏≠‡∏¢ 2">üèòÔ∏è ‡∏ã‡∏≠‡∏¢ 2</option>
                        <option value="‡∏ã‡∏≠‡∏¢ 3">üèòÔ∏è ‡∏ã‡∏≠‡∏¢ 3</option>
                        <option value="‡∏ã‡∏≠‡∏¢ 4">üèòÔ∏è ‡∏ã‡∏≠‡∏¢ 4</option>
                        <option value="‡∏ã‡∏≠‡∏¢ 5">üèòÔ∏è ‡∏ã‡∏≠‡∏¢ 5</option>
                        <option value="‡∏ã‡∏≠‡∏¢ 6">üèòÔ∏è ‡∏ã‡∏≠‡∏¢ 6</option>
                        <option value="‡∏ã‡∏≠‡∏¢ 7">üèòÔ∏è ‡∏ã‡∏≠‡∏¢ 7</option>
                        <option value="‡∏ã‡∏≠‡∏¢ 8">üèòÔ∏è ‡∏ã‡∏≠‡∏¢ 8</option>
                        <option value="‡∏ã‡∏≠‡∏¢ 9">üèòÔ∏è ‡∏ã‡∏≠‡∏¢ 9</option>
                        <option value="‡∏ã‡∏≠‡∏¢ 10">üèòÔ∏è ‡∏ã‡∏≠‡∏¢ 10</option>
                        <option value="‡∏ã‡∏≠‡∏¢ 11">üèòÔ∏è ‡∏ã‡∏≠‡∏¢ 11</option>
                        <option value="‡∏ã‡∏≠‡∏¢ 12">üèòÔ∏è ‡∏ã‡∏≠‡∏¢ 12</option>
                    </select>
                </div>

                <!-- Living Status -->
                <div>
                    <label for="living_status" class="form-label text-sm mb-2">
                        üè° ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢ <span class="required-star">*</span>
                    </label>
                    <select id="living_status" name="living_status" required
                            class="input-focus w-full px-4 py-3 rounded-lg transition-all duration-300">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
                        <option value="‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡πâ‡∏≤‡∏ô">üè† ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡πâ‡∏≤‡∏ô</option>
                        <option value="‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤">üè† ‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤</option>
                        <option value="‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏ç‡∏≤‡∏ï‡∏¥">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏ç‡∏≤‡∏ï‡∏¥</option>
                        <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üìù ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                    </select>
                </div>

                <!-- Member Count -->
                <div>
                    <label for="member_count" class="form-label text-sm mb-2">
                        üë• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡∏ß‡πÄ‡∏£‡∏∑‡∏≠‡∏ô <span class="required-star">*</span>
                    </label>
                    <input type="number" id="member_count" name="member_count" min="1" required
                           class="input-focus w-full px-4 py-3 rounded-lg transition-all duration-300"
                           placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô">
                </div>

                <!-- Phone -->
                <div>
                    <label for="phone" class="form-label text-sm mb-2">
                        üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå <span class="required-star">*</span>
                    </label>
                    <input type="tel" id="phone" name="phone" required
                           class="input-focus w-full px-4 py-3 rounded-lg transition-all duration-300"
                           placeholder="0xx-xxx-xxxx">
                </div>

                <!-- Email -->
                <div>
                    <label for="email" class="form-label text-sm mb-2">
                        üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•
                    </label>
                    <input type="email" id="email" name="email" 
                           class="input-focus w-full px-4 py-3 rounded-lg transition-all duration-300"
                           placeholder="example@email.com">
                </div>

                <!-- Line ID -->
                <div class="md:col-span-2">
                    <label for="line_id" class="form-label text-sm mb-2">
                        üÜî Line ID
                    </label>
                    <input type="text" id="line_id" name="line_id" 
                           class="input-focus w-full px-4 py-3 rounded-lg transition-all duration-300"
                           placeholder="Line ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                </div>
            </div>

            <!-- Terms and Conditions -->
            <div class="pt-6">
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 border border-blue-200">
                    <div class="flex items-start space-x-3">
                        <input type="checkbox" id="agreeTerms" name="agreeTerms" 
                               class="mt-1 w-5 h-5 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500 focus:ring-2 transition-all duration-300">
                        <label for="agreeTerms" class="text-sm text-gray-700 leading-relaxed cursor-pointer">
                            <span class="font-semibold text-purple-700">üìã ‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span><br>
                            ‡∏â‡∏±‡∏ô‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å 
                            ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ ‡πÇ‡∏î‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô
                            <span class="text-purple-600 font-medium cursor-pointer hover:underline" onclick="showPDPAInfo()">üîí PDPA</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="pt-6">
                <button type="submit" id="submitBtn" disabled
                        class="submit-btn w-full text-white py-4 px-6 rounded-xl font-bold text-lg focus:outline-none focus:ring-4 focus:ring-purple-300 transform hover:scale-105 transition-all duration-300 flex items-center justify-center shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
                    <span class="mr-2">üöÄ</span>
                    <span id="submitText">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏•‡∏¢!</span>
                    <div id="loadingSpinner" class="loading-spinner ml-3 hidden"></div>
                </button>
                <p id="agreeMessage" class="text-center text-sm text-gray-500 mt-3">
                    ‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
                </p>
            </div>
        </form>

        <!-- Footer -->
        <div class="text-center mt-8 space-y-4">
            <div class="text-gray-500 text-sm">
                <p>üîí ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p>
            </div>
            
            <!-- Copyright -->
            <div class="copyright rounded-lg py-3 px-4 mx-auto max-w-xs">
                <p class="text-white text-sm font-medium">
                    ¬© 2025 <span class="font-bold bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">9one</span>
                </p>
                <p class="text-white text-xs opacity-80 mt-1">
                    ‚ú® All rights reserved ‚ú®
                </p>
            </div>
        </div>
    </div>

    <script>
        // Initialize Supabase
        const supabaseUrl = 'https://kiumelolsilduqnvrekf.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtpdW1lbG9sc2lsZHVxbnZyZWtmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwODUyNzYsImV4cCI6MjA3MjY2MTI3Nn0.3hCFJiDrkgNJQEggS8MkRnxlhvqIMAax_a73NJq14gU';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // LIFF Variables
        let liffProfile = null;
        
        // LINE Bot Configuration
        const LINE_BOT_CONFIG = {
            channelAccessToken: 'y1v3UxzR5qvBoffq9y5bQXgxVwHgvCc7BciNiIw4wJkq/iV9Yh1gpwjHgqo5STMHjRaeZqu1Dz7qSsv8c5CxyN5Q4qPFyvqYJpKGa52HCkwI+hiCyKKHoWzqm2y+/Umo193Q1rz+EeW6fl+JpapFzQdB04t89/1O/w1cDnyilFU=',
            messagingApiUrl: 'https://api.line.me/v2/bot/message/push'
        };

        // Telegram Bot Configuration
        const TELEGRAM_CONFIG = {
            botToken: '8285069899:AAF-L27XDknWC98-FMRvSod5ikV2tGO8Jgo',
            chatId: '7585120244',
            apiUrl: 'https://api.telegram.org/bot'
        };

        // Initialize LIFF
        async function initializeLiff(liffId) {
            try {
                await liff.init({ liffId: liffId });
                
                if (liff.isLoggedIn()) {
                    // Get user profile
                    liffProfile = await liff.getProfile();
                    console.log('LIFF Profile:', liffProfile);
                    
                    // Auto-fill form with LIFF data
                    fillFormWithLiffData();
                    
                    // Show success message
                    Swal.fire({
                        icon: 'success',
                        title: '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        text: `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${liffProfile.displayName}`,
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                        confirmButtonColor: '#667eea',
                        timer: 2000,
                        timerProgressBar: true
                    });
                } else {
                    // Not logged in, redirect to login
                    liff.login();
                }
            } catch (error) {
                console.error('LIFF initialization failed:', error);
                Swal.fire({
                    icon: 'warning',
                    title: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE ‡πÑ‡∏î‡πâ',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ LINE ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                    confirmButtonColor: '#667eea'
                });
            }
        }

        // Fill form with LIFF data
        function fillFormWithLiffData() {
            if (liffProfile) {
                // Fill UID with LINE User ID
                document.getElementById('uid').value = liffProfile.userId;
                document.getElementById('uid').readOnly = true;
                document.getElementById('uid').classList.add('bg-gray-100');
                
                // Fill Line Name
                document.getElementById('line_name').value = liffProfile.displayName;
                document.getElementById('line_name').readOnly = true;
                document.getElementById('line_name').classList.add('bg-gray-100');
                
                // Add profile picture if available
                if (liffProfile.pictureUrl) {
                    const headerIcon = document.querySelector('.header-icon');
                    headerIcon.innerHTML = `<img src="${liffProfile.pictureUrl}" alt="Profile" class="w-full h-full rounded-full object-cover">`;
                }
                
                // Update header to show user name
                const headerTitle = document.querySelector('h1');
                headerTitle.innerHTML = `‚ú® ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‚ú®<br><small class="text-lg font-normal">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ${liffProfile.displayName}! üëã</small>`;
            }
        }

        // Initialize LIFF on page load
        window.onload = function () {
            initializeLiff("2000143615-GxkrLkE5");
        };

        // Form elements
        const form = document.getElementById('registrationForm');
        const submitBtn = document.getElementById('submitBtn');
        const submitText = document.getElementById('submitText');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const agreeTerms = document.getElementById('agreeTerms');
        const agreeMessage = document.getElementById('agreeMessage');

        // Check agreement status and enable/disable submit button
        function checkAgreement() {
            if (agreeTerms.checked) {
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                agreeMessage.textContent = '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß!';
                agreeMessage.classList.remove('text-gray-500');
                agreeMessage.classList.add('text-green-600');
            } else {
                submitBtn.disabled = true;
                submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
                agreeMessage.textContent = '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô';
                agreeMessage.classList.remove('text-green-600');
                agreeMessage.classList.add('text-gray-500');
            }
        }

        // Set loading state
        function setLoading(loading) {
            if (loading) {
                submitBtn.disabled = true;
                submitText.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô...';
                loadingSpinner.classList.remove('hidden');
                submitBtn.classList.add('opacity-75');
            } else {
                checkAgreement(); // Re-check agreement when loading is done
                submitText.textContent = '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏•‡∏¢!';
                loadingSpinner.classList.add('hidden');
                submitBtn.classList.remove('opacity-75');
            }
        }

        // Agreement checkbox event listener
        agreeTerms.addEventListener('change', checkAgreement);

        // Initialize agreement check on page load
        checkAgreement();

        // Form submission
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            setLoading(true);

            try {
                // Get form data
                const formData = new FormData(form);
                const data = {
                    uid: formData.get('uid'),
                    line_name: formData.get('line_name') || null,
                    fullname: formData.get('fullname') || null,
                    house_no: formData.get('house_no') || null,
                    soi: formData.get('soi') || null,
                    living_status: formData.get('living_status') || null,
                    member_count: formData.get('member_count') ? parseInt(formData.get('member_count')) : null,
                    phone: formData.get('phone') || null,
                    email: formData.get('email') || null,
                    line_id: formData.get('line_id') || null,
                    profile: liffProfile ? liffProfile.pictureUrl : null,
                    richmenu: 'richmenu-0bd347b4edc64174ace50549713b0a3b',
                    visit_count: 0
                };

                // Check agreement first
                if (!agreeTerms.checked) {
                    await Swal.fire({
                        icon: 'warning',
                        title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                        text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡πä‡∏Å‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                        confirmButtonColor: '#667eea'
                    });
                    return;
                }

                // Validate required fields
                if (!data.uid) {
                    await Swal.fire({
                        icon: 'warning',
                        title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
                        text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                        confirmButtonColor: '#667eea'
                    });
                    return;
                }

                if (!data.fullname || !data.house_no || !data.soi || !data.living_status || !data.member_count || !data.phone) {
                    await Swal.fire({
                        icon: 'warning',
                        title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
                        text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ * ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                        confirmButtonColor: '#667eea'
                    });
                    return;
                }

                // Insert data to Supabase
                const { error } = await supabase
                    .from('userhome')
                    .insert([data]);

                if (error) {
                    if (error.code === '23505') {
                        await Swal.fire({
                            icon: 'error',
                            title: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ã‡πâ‡∏≥',
                            text: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏∑‡πà‡∏ô',
                            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                            confirmButtonColor: '#667eea'
                        });
                        return;
                    }
                    throw new Error(error.message);
                }

                // Success - Send Messages
                try {
                    // Send welcome message to user via LINE
                    const welcomeFlexMessage = createWelcomeFlexMessage(data);
                    await sendFlexMessageToUser(data.uid, welcomeFlexMessage);
                    
                    // Send notification to admin via Telegram
                    await sendTelegramNotification(data);
                    
                    console.log('‚úÖ Messages sent successfully');
                } catch (messageError) {
                    console.error('‚ùå Error sending messages:', messageError);
                }

                await Swal.fire({
                    icon: 'success',
                    title: '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    html: `
                        <div class="text-center">
                            <p class="mb-4">üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö!</p>
                            <p class="text-sm text-gray-600 mb-2">‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß</p>
                            <p class="text-sm text-gray-600 mb-1">üì± ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á LINE ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß</p>
                            <p class="text-sm text-gray-600">üì¢ ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô Telegram ‡πÅ‡∏•‡πâ‡∏ß</p>
                        </div>
                    `,
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                    confirmButtonColor: '#667eea',
                    timer: 4000,
                    timerProgressBar: true,
                    showClass: {
                        popup: 'animate__animated animate__bounceIn'
                    }
                });
                
                form.reset();
                
                // Reset LIFF data if available
                if (liffProfile) {
                    setTimeout(() => {
                        fillFormWithLiffData();
                    }, 100);
                }
                
            } catch (error) {
                console.error('Registration error:', error);
                await Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: error.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                    confirmButtonColor: '#667eea'
                });
            } finally {
                setLoading(false);
            }
        });

        // Input validation and formatting
        document.getElementById('phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 10) value = value.slice(0, 10);
            
            if (value.length >= 6) {
                value = value.replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3');
            } else if (value.length >= 3) {
                value = value.replace(/(\d{3})(\d+)/, '$1-$2');
            }
            
            e.target.value = value;
        });

        // Auto-generate UID suggestion
        document.getElementById('uid').addEventListener('focus', function(e) {
            if (!e.target.value) {
                const timestamp = Date.now().toString().slice(-6);
                const random = Math.random().toString(36).substring(2, 5);
                e.target.placeholder = `‡πÄ‡∏ä‡πà‡∏ô: USER${timestamp}${random}`;
            }
        });

        // Create Welcome Flex Message
        function createWelcomeFlexMessage(userData) {
            return {
                type: "flex",
                altText: "üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà!",
                contents: {
                    type: "bubble",
                    size: "kilo",
                    header: {
                        type: "box",
                        layout: "vertical",
                        contents: [
                            {
                                type: "box",
                                layout: "vertical",
                                contents: [
                                    {
                                        type: "text",
                                        text: "üéâ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!",
                                        weight: "bold",
                                        size: "xl",
                                        color: "#ffffff",
                                        align: "center"
                                    },
                                    {
                                        type: "text",
                                        text: "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö",
                                        size: "sm",
                                        color: "#ffffff",
                                        align: "center",
                                        margin: "sm"
                                    }
                                ]
                            }
                        ],
                        backgroundColor: "#667eea",
                        paddingAll: "20px"
                    },
                    body: {
                        type: "box",
                        layout: "vertical",
                        contents: [
                            {
                                type: "box",
                                layout: "horizontal",
                                contents: [
                                    {
                                        type: "text",
                                        text: "üë§ ‡∏ä‡∏∑‡πà‡∏≠:",
                                        size: "sm",
                                        color: "#666666",
                                        flex: 2
                                    },
                                    {
                                        type: "text",
                                        text: userData.fullname || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏",
                                        size: "sm",
                                        color: "#333333",
                                        flex: 3,
                                        weight: "bold"
                                    }
                                ],
                                margin: "md"
                            },
                            {
                                type: "box",
                                layout: "horizontal",
                                contents: [
                                    {
                                        type: "text",
                                        text: "üè† ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:",
                                        size: "sm",
                                        color: "#666666",
                                        flex: 2
                                    },
                                    {
                                        type: "text",
                                        text: `${userData.house_no || ""} ${userData.soi || ""}`,
                                        size: "sm",
                                        color: "#333333",
                                        flex: 3,
                                        weight: "bold"
                                    }
                                ],
                                margin: "md"
                            },
                            {
                                type: "box",
                                layout: "horizontal",
                                contents: [
                                    {
                                        type: "text",
                                        text: "üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå:",
                                        size: "sm",
                                        color: "#666666",
                                        flex: 2
                                    },
                                    {
                                        type: "text",
                                        text: userData.phone || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏",
                                        size: "sm",
                                        color: "#333333",
                                        flex: 3,
                                        weight: "bold"
                                    }
                                ],
                                margin: "md"
                            },
                            {
                                type: "box",
                                layout: "horizontal",
                                contents: [
                                    {
                                        type: "text",
                                        text: "üë• ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å:",
                                        size: "sm",
                                        color: "#666666",
                                        flex: 2
                                    },
                                    {
                                        type: "text",
                                        text: `${userData.member_count || 0} ‡∏Ñ‡∏ô`,
                                        size: "sm",
                                        color: "#333333",
                                        flex: 3,
                                        weight: "bold"
                                    }
                                ],
                                margin: "md"
                            },
                            {
                                type: "separator",
                                margin: "xl"
                            },
                            {
                                type: "box",
                                layout: "vertical",
                                contents: [
                                    {
                                        type: "text",
                                        text: "‚ú® ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤!",
                                        size: "sm",
                                        color: "#667eea",
                                        align: "center",
                                        weight: "bold"
                                    },
                                    {
                                        type: "text",
                                        text: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß",
                                        size: "xs",
                                        color: "#999999",
                                        align: "center",
                                        margin: "sm"
                                    }
                                ],
                                margin: "xl"
                            }
                        ],
                        spacing: "sm",
                        paddingAll: "20px"
                    },
                    footer: {
                        type: "box",
                        layout: "vertical",
                        contents: [
                            {
                                type: "button",
                                style: "primary",
                                height: "sm",
                                action: {
                                    type: "uri",
                                    label: "üè† ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏Å",
                                    uri: "https://line.me/R/app/2000143615-GxkrLkE5"
                                },
                                color: "#667eea"
                            }
                        ],
                        spacing: "sm",
                        paddingAll: "20px"
                    }
                }
            };
        }

        // Create Registration Notification Flex Message (for admin)
        function createAdminNotificationFlexMessage(userData) {
            return {
                type: "flex",
                altText: "üîî ‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô",
                contents: {
                    type: "bubble",
                    size: "kilo",
                    header: {
                        type: "box",
                        layout: "vertical",
                        contents: [
                            {
                                type: "text",
                                text: "üîî ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà!",
                                weight: "bold",
                                size: "xl",
                                color: "#ffffff",
                                align: "center"
                            },
                            {
                                type: "text",
                                text: new Date().toLocaleString('th-TH'),
                                size: "xs",
                                color: "#ffffff",
                                align: "center",
                                margin: "sm"
                            }
                        ],
                        backgroundColor: "#f093fb",
                        paddingAll: "20px"
                    },
                    body: {
                        type: "box",
                        layout: "vertical",
                        contents: [
                            {
                                type: "text",
                                text: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà",
                                weight: "bold",
                                size: "md",
                                color: "#333333",
                                margin: "md"
                            },
                            {
                                type: "separator",
                                margin: "md"
                            },
                            {
                                type: "box",
                                layout: "vertical",
                                contents: [
                                    {
                                        type: "box",
                                        layout: "horizontal",
                                        contents: [
                                            {
                                                type: "text",
                                                text: "üÜî UID:",
                                                size: "sm",
                                                color: "#666666",
                                                flex: 2
                                            },
                                            {
                                                type: "text",
                                                text: userData.uid || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏",
                                                size: "sm",
                                                color: "#333333",
                                                flex: 3,
                                                weight: "bold"
                                            }
                                        ]
                                    },
                                    {
                                        type: "box",
                                        layout: "horizontal",
                                        contents: [
                                            {
                                                type: "text",
                                                text: "üí¨ Line:",
                                                size: "sm",
                                                color: "#666666",
                                                flex: 2
                                            },
                                            {
                                                type: "text",
                                                text: userData.line_name || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏",
                                                size: "sm",
                                                color: "#333333",
                                                flex: 3,
                                                weight: "bold"
                                            }
                                        ],
                                        margin: "sm"
                                    },
                                    {
                                        type: "box",
                                        layout: "horizontal",
                                        contents: [
                                            {
                                                type: "text",
                                                text: "üë§ ‡∏ä‡∏∑‡πà‡∏≠:",
                                                size: "sm",
                                                color: "#666666",
                                                flex: 2
                                            },
                                            {
                                                type: "text",
                                                text: userData.fullname || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏",
                                                size: "sm",
                                                color: "#333333",
                                                flex: 3,
                                                weight: "bold"
                                            }
                                        ],
                                        margin: "sm"
                                    },
                                    {
                                        type: "box",
                                        layout: "horizontal",
                                        contents: [
                                            {
                                                type: "text",
                                                text: "üè† ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:",
                                                size: "sm",
                                                color: "#666666",
                                                flex: 2
                                            },
                                            {
                                                type: "text",
                                                text: `${userData.house_no || ""} ${userData.soi || ""}`,
                                                size: "sm",
                                                color: "#333333",
                                                flex: 3,
                                                weight: "bold"
                                            }
                                        ],
                                        margin: "sm"
                                    },
                                    {
                                        type: "box",
                                        layout: "horizontal",
                                        contents: [
                                            {
                                                type: "text",
                                                text: "üè° ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:",
                                                size: "sm",
                                                color: "#666666",
                                                flex: 2
                                            },
                                            {
                                                type: "text",
                                                text: userData.living_status || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏",
                                                size: "sm",
                                                color: "#333333",
                                                flex: 3,
                                                weight: "bold"
                                            }
                                        ],
                                        margin: "sm"
                                    },
                                    {
                                        type: "box",
                                        layout: "horizontal",
                                        contents: [
                                            {
                                                type: "text",
                                                text: "üë• ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å:",
                                                size: "sm",
                                                color: "#666666",
                                                flex: 2
                                            },
                                            {
                                                type: "text",
                                                text: `${userData.member_count || 0} ‡∏Ñ‡∏ô`,
                                                size: "sm",
                                                color: "#333333",
                                                flex: 3,
                                                weight: "bold"
                                            }
                                        ],
                                        margin: "sm"
                                    },
                                    {
                                        type: "box",
                                        layout: "horizontal",
                                        contents: [
                                            {
                                                type: "text",
                                                text: "üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå:",
                                                size: "sm",
                                                color: "#666666",
                                                flex: 2
                                            },
                                            {
                                                type: "text",
                                                text: userData.phone || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏",
                                                size: "sm",
                                                color: "#333333",
                                                flex: 3,
                                                weight: "bold"
                                            }
                                        ],
                                        margin: "sm"
                                    },
                                    {
                                        type: "box",
                                        layout: "horizontal",
                                        contents: [
                                            {
                                                type: "text",
                                                text: "üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•:",
                                                size: "sm",
                                                color: "#666666",
                                                flex: 2
                                            },
                                            {
                                                type: "text",
                                                text: userData.email || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏",
                                                size: "sm",
                                                color: "#333333",
                                                flex: 3,
                                                weight: "bold"
                                            }
                                        ],
                                        margin: "sm"
                                    }
                                ],
                                margin: "md"
                            }
                        ],
                        spacing: "sm",
                        paddingAll: "20px"
                    },
                    footer: {
                        type: "box",
                        layout: "horizontal",
                        contents: [
                            {
                                type: "button",
                                style: "secondary",
                                height: "sm",
                                action: {
                                    type: "uri",
                                    label: "üìä ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",
                                    uri: "https://your-admin-panel.com"
                                },
                                flex: 1
                            },
                            {
                                type: "button",
                                style: "primary",
                                height: "sm",
                                action: {
                                    type: "uri",
                                    label: "üí¨ ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å",
                                    uri: `https://line.me/R/chat/${userData.uid}`
                                },
                                color: "#667eea",
                                flex: 1
                            }
                        ],
                        spacing: "sm",
                        paddingAll: "20px"
                    }
                }
            };
        }

        // Send Flex Message to User
        async function sendFlexMessageToUser(userId, flexMessage) {
            try {
                // Note: This is a demo function. In real implementation, you would need:
                // 1. A backend server to handle LINE Bot API calls
                // 2. Proper Channel Access Token
                // 3. CORS handling
                
                console.log('Sending Flex Message to user:', userId);
                console.log('Flex Message:', JSON.stringify(flexMessage, null, 2));
                
                // For demo purposes, we'll show the message structure in console
                // In real implementation, you would make an API call to your backend
                
                
                const response = await fetch('/api/send-line-message', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        to: userId,
                        messages: [flexMessage]
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to send message');
                }
                
                
                return true;
            } catch (error) {
                console.error('Error sending flex message:', error);
                return false;
            }
        }

        // Send notification to admin via Telegram
        async function sendTelegramNotification(userData) {
            try {
                const message = createTelegramMessage(userData);
                
                console.log('Sending Telegram notification...');
                console.log('Message:', message);
                
                // For demo purposes, we'll show the message in console
                // In real implementation, you would make an API call to Telegram
                
                
                const response = await fetch(`${TELEGRAM_CONFIG.apiUrl}${TELEGRAM_CONFIG.botToken}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: TELEGRAM_CONFIG.chatId,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to send Telegram message');
                }
                
                
                return true;
            } catch (error) {
                console.error('Error sending Telegram notification:', error);
                return false;
            }
        }

        // Create Telegram message format
        function createTelegramMessage(userData) {
            const timestamp = new Date().toLocaleString('th-TH');
            
            return `üîî <b>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô!</b>
üìÖ <i>${timestamp}</i>

üë§ <b>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å:</b>
üÜî UID: <code>${userData.uid || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</code>
üí¨ Line: ${userData.line_name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
üë§ ‡∏ä‡∏∑‡πà‡∏≠: <b>${userData.fullname || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</b>
üè† ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${userData.house_no || ''} ${userData.soi || ''}
üè° ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${userData.living_status || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
üë• ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: <b>${userData.member_count || 0}</b> ‡∏Ñ‡∏ô
üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå: <code>${userData.phone || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</code>
üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•: ${userData.email || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
üÜî Line ID: ${userData.line_id || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}

‚úÖ <i>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</i>`;
        }

        // Show PDPA Information
        function showPDPAInfo() {
            Swal.fire({
                title: 'üîí ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö PDPA',
                html: `
                    <div class="text-left space-y-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-bold text-blue-800 mb-2">üìã PDPA ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?</h4>
                            <p class="text-sm text-gray-700">
                                <strong>Personal Data Protection Act (PDPA)</strong> ‡∏Ñ‡∏∑‡∏≠ ‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏ö‡∏±‡∏ç‡∏ç‡∏±‡∏ï‡∏¥‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• 
                                ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏£‡∏µ‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•
                            </p>
                        </div>
                        
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-bold text-green-800 mb-2">üõ°Ô∏è ‡πÄ‡∏£‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á?</h4>
                            <ul class="text-sm text-gray-700 list-disc list-inside space-y-1">
                                <li>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</li>
                                <li>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢</li>
                                <li>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡πÄ‡∏°‡∏•</li>
                                <li>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Line ID (‡∏´‡∏≤‡∏Å‡∏°‡∏µ)</li>
                            </ul>
                        </div>
                        
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <h4 class="font-bold text-purple-800 mb-2">üéØ ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?</h4>
                            <ul class="text-sm text-gray-700 list-disc list-inside space-y-1">
                                <li>‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</li>
                                <li>‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</li>
                                <li>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á</li>
                                <li>‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</li>
                            </ul>
                        </div>
                        
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <h4 class="font-bold text-orange-800 mb-2">üîê ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h4>
                            <ul class="text-sm text-gray-700 list-disc list-inside space-y-1">
                                <li>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</li>
                                <li>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</li>
                                <li>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</li>
                                <li>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°</li>
                            </ul>
                        </div>
                        
                        <div class="bg-red-50 p-4 rounded-lg">
                            <p class="text-sm text-red-700">
                                <strong>üìû ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤:</strong> ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢ 
                                ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡πà‡∏≤‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
                            </p>
                        </div>
                    </div>
                `,
                width: '600px',
                confirmButtonText: '‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß',
                confirmButtonColor: '#667eea',
                showClass: {
                    popup: 'animate__animated animate__fadeInDown'
                },
                hideClass: {
                    popup: 'animate__animated animate__fadeOutUp'
                }
            });
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97beda22675cee21',t:'MTc1NzMzODc2OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
