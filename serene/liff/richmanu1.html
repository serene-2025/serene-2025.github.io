<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rich Menu API - LINE OA Admin</title>
  <meta name="description" content="Rich Menu API Admin for LIFF" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #1e3c72, #2a5298, #6a11cb, #2575fc); background-size: 300% 300%; animation: gradientMove 15s ease infinite; color: #F0F0F0; }
    @keyframes gradientMove { 0% {background-position:0% 50%;} 50% {background-position:100% 50%;} 100% {background-position:0% 50%;} }
    .btn-primary { background: linear-gradient(135deg,#00c6ff,#0072ff); transition:0.3s; box-shadow:0 4px 15px rgba(0,114,255,0.4); border-radius: 0.5rem;}
    .btn-primary:hover { transform:translateY(-2px) scale(1.02); box-shadow:0 6px 20px rgba(0,114,255,0.6);}
    .btn-danger { background: linear-gradient(135deg,#ff416c,#ff4b2b); transition:0.3s; box-shadow:0 4px 15px rgba(255,75,43,0.4); border-radius: 0.5rem;}
    .btn-danger:hover { transform:translateY(-2px) scale(1.02); box-shadow:0 6px 20px rgba(255,75,43,0.6);}
    .card-modern { background: rgba(255,255,255,0.1); backdrop-filter: blur(12px); border-radius:1rem; border:1px solid rgba(255,255,255,0.2); box-shadow:0 8px 20px rgba(0,0,0,0.3); transition:0.3s;}
    .swal2-popup { background: rgba(30,40,60,0.9)!important; color:#f0f0f0!important; border:1px solid #555!important; border-radius:1rem!important; backdrop-filter: blur(8px);}
    .swal2-title { color:#73B305 !important;}
    .swal2-input { background: rgba(255,255,255,0.05)!important; border:1px solid #666!important; color:#fff!important; border-radius:0.5rem!important; padding: 0.5rem 1rem!important;}
    #loading-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(6px); display:none; justify-content:center; align-items:center; z-index:9999; flex-direction:column; gap:1rem; }
    .img-container img { width: 100%; height: auto; border-radius: 0.75rem; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
    .user-result:checked + img { border: 3px solid #00c6ff; }
  </style>
</head>
<body class="gradient-bg min-h-screen">

  <div id="loading-overlay">
    <img src="https://developers.line.biz/media/line-mini-app/LINE_spinner_light.svg" alt="Loading..." class="w-16 h-16">
    <p id="loading-text" class="text-lg text-[#989fce]">กำลังโหลด...</p>
  </div>

  <div class="container mx-auto p-4 md:p-8">
    <header class="text-center mb-8">
      <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-[#989fce] to-[#347fc4]">
        Rich Menu API
      </h1>
      <p class="text-lg text-gray-300">จัดการ Rich Menu API ของ LINE OA</p>
      <div class="mt-4 flex flex-wrap justify-center gap-3">
        <button id="cancel-default-btn" class="btn-danger font-bold py-2 px-6 rounded-lg">ยกเลิก Rich Menu เริ่มต้นทั้งหมด</button>
        <button id="upload-menu-btn" class="btn-primary font-bold py-2 px-6 rounded-lg">อัพโหลด Rich Menu ใหม่</button>
      </div>
    </header>

    <main id="richmenu-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      <!-- Rich Menu Cards จะถูกสร้างตรงนี้ -->
    </main>
  </div>
  <script type="module">
        // กำหนดค่าคงที่ (ควรกำหนดใน Environment Variables จริง)
        const LIFF_ID = "2000143615-RQWZXWKA";
        const SUPABASE_URL = "https://kiumelolsilduqnvrekf.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtpdW1lbG9sc2lsZHVxbnZyZWtmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwODUyNzYsImV4cCI6MjA3MjY2MTI3Nn0.3hCFJiDrkgNJQEggS8MkRnxlhvqIMAax_a73NJq14gU";

        // การเตรียมใช้งาน Supabase และ DOM elements
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

        const loadingOverlay = document.getElementById('loading-overlay');
        const loadingText = document.getElementById('loading-text');
        const richMenuGrid = document.getElementById('richmenu-grid');
        const cancelDefaultBtn = document.getElementById('cancel-default-btn');
        const uploadMenuBtn = document.getElementById('upload-menu-btn');
        
        let richMenuDataCache = new Map(); // ใช้สำหรับเก็บข้อมูล Rich Menu เพื่อแสดงใน User Search Modal

        // --- Utilities for UI/UX ---
        const showLoading = (text = 'กำลังโหลด...') => {
            loadingText.textContent = text;
            loadingOverlay.style.display = 'flex';
        };
        const hideLoading = () => {
            loadingOverlay.style.display = 'none';
        };
        const showToast = (icon, title) => {
            Swal.fire({
                icon: icon, title: title, toast: true, position: 'top-end',
                showConfirmButton: false, timer: 3000, timerProgressBar: true,
                customClass: { popup: '!bg-[#3c3a4a] !text-white', title: '!text-[#fff]' }
            });
        };

        // --- Supabase Function Invoker (Backend API Gateway) ---
        async function invokeFunction(payload) {
            // ฟังก์ชันนี้จะเรียก Serverless Function ชื่อ 'manage-rich-menu'
            const { data, error } = await supabaseClient.functions.invoke('manage-rich-menu', { body: payload });
            if (error) throw new Error(error.message || 'การเรียกใช้ฟังก์ชันล้มเหลว');
            if (data && data.error) throw new Error(data.error); // ตรวจสอบ error ที่ส่งมาจากฝั่ง Server Function
            return data;
        }

        // --- User Search Modal (รองรับฟีเจอร์ค้นหาเร็วและเลือกหลายคน) ---
        async function showUserSearchModal(title) {
            // ฟังก์ชันนี้จะช่วยให้แอดมินสามารถค้นหาผู้ใช้ได้อย่างรวดเร็ว
            return new Promise((resolve) => {
                let selectedUsers = new Set();
                Swal.fire({
                    title: title,
                    width: 'clamp(300px, 100%, 1000px)',
                    html: `
                        <div class="p-2 text-left">
                            <div class="space-y-2 sm:space-y-0 sm:flex sm:gap-2 sm:items-center">
                                <input 
                                    id="swal-user-search" 
                                    class="flex-1 min-w-0 px-3 py-2 rounded-lg border border-[#5d536b] bg-[#1c1c28] text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                    placeholder="userId หรือชื่อ..."
                                >
                                <button id="swal-user-search-btn" class="btn-primary py-2 px-5 rounded-lg font-semibold w-full sm:w-auto">ค้นหา</button>
                                <button id="swal-user-all-btn" class="btn-primary py-2 px-5 rounded-lg font-semibold w-full sm:w-auto">ทั้งหมด</button>
                            </div>
                            <div id="swal-user-results" class="mt-4 max-h-60 overflow-y-auto border border-[#5d536b] rounded-lg">
                                <p class="text-center text-gray-400 p-4">พิมพ์เพื่อค้นหาผู้ใช้ หรือกด "ทั้งหมด"</p>
                            </div>
                        </div>
                    `,
                    showCancelButton: true,
                    cancelButtonText: 'ยกเลิก',
                    showConfirmButton: true,
                    confirmButtonText: 'ยืนยัน',
                    preConfirm: () => Array.from(selectedUsers),
                    didOpen: () => {
                        const searchInput = document.getElementById('swal-user-search');
                        const searchBtn = document.getElementById('swal-user-search-btn');
                        const allBtn = document.getElementById('swal-user-all-btn');
                        const resultsContainer = document.getElementById('swal-user-results');
                        const confirmBtn = Swal.getConfirmButton();
                        confirmBtn.disabled = true;

                        // อัปเดตจำนวนผู้ใช้ที่ถูกเลือก
                        const updateSelectedCount = () => {
                            const count = selectedUsers.size;
                            confirmBtn.textContent = `ยืนยัน (${count})`;
                            confirmBtn.disabled = count === 0;
                        };

                        // แสดงผลผู้ใช้ที่ค้นหา
                        const renderUsers = (users) => {
                            if (!users || users.length === 0) {
                                resultsContainer.innerHTML = '<p class="text-center text-gray-400 p-4">ไม่พบผู้ใช้</p>';
                                return;
                            }
                            resultsContainer.innerHTML = '';
                            users.forEach(user => {
                                const userEl = document.createElement('label');
                                userEl.className = 'flex items-start gap-3 p-2 rounded-lg hover:bg-[#7d6b91] cursor-pointer transition-colors m-1 border border-transparent';

                                // ฟีเจอร์: รู้ได้ว่า user คนนั้นกำลังใช้ Rich Menu API หน้าไหนอยู่
                                const linkedMenuInfo = richMenuDataCache.get(user.linkedRichMenuId);
                                let linkedMenuInfoHTML = `<p class="text-xs mt-1 text-gray-400">ใช้ Rich Menu เริ่มต้น</p>`;
                                if (linkedMenuInfo) {
                                    linkedMenuInfoHTML = `
                                        <div class="mt-1 p-1 bg-black/20 rounded-md">
                                            <p class="text-xs text-green-400 truncate mb-1" title="${linkedMenuInfo.name}">เมนู: ${linkedMenuInfo.name}</p>
                                            <img src="data:image/png;base64,${linkedMenuInfo.imageBase64}" class="w-24 h-auto rounded-sm">
                                        </div>`;
                                }

                                userEl.innerHTML = `
                                    <input type="checkbox" class="user-result sr-only" data-userid="${user.userId}">
                                    <img src="${user.pictureUrl || 'https://placehold.co/80x80/1c1c28/989fce?text=No+Pic'}" onerror="this.onerror=null;this.src='https://placehold.co/80x80/1c1c28/989fce?text=No+Pic'" alt="Profile" class="w-10 h-10 rounded-full object-cover flex-shrink-0 mt-1">
                                    <div class="overflow-hidden flex-grow">
                                        <p class="font-semibold truncate">${user.displayName} (${user.status})</p>
                                        <p class="text-xs text-gray-300 font-mono break-all truncate">${user.userId}</p>
                                        ${linkedMenuInfoHTML}
                                    </div>`;
                                
                                const checkbox = userEl.querySelector('input[type="checkbox"]');
                                // ใช้ event listener ที่ตัว label เพื่อให้คลิกง่าย
                                userEl.addEventListener('click', (e) => {
                                    // ป้องกันไม่ให้คลิกซ้ำเมื่อคลิกที่ checkbox โดยตรง (แต่ตอนนี้เป็น sr-only)
                                    if (e.target.type === 'checkbox') return;

                                    checkbox.checked = !checkbox.checked;
                                    userEl.classList.toggle('border-blue-500', checkbox.checked);

                                    if (checkbox.checked) selectedUsers.add(user.userId);
                                    else selectedUsers.delete(user.userId);
                                    updateSelectedCount();
                                });
                                
                                // ตั้งค่าสถานะเริ่มต้น
                                if (selectedUsers.has(user.userId)) {
                                    checkbox.checked = true;
                                    userEl.classList.add('border-blue-500');
                                }

                                resultsContainer.appendChild(userEl);
                            });
                        };

                        // ฟีเจอร์: ค้นหา user ในฐานข้อมูลเราได้แบบรวดเร็ว
                        const performSearch = async (allUsers = false) => {
                            const searchTerm = searchInput.value.trim();
                            if (!allUsers && searchTerm.length < 2) {
                                resultsContainer.innerHTML = '<p class="text-center text-gray-400 p-4">กรุณาพิมพ์อย่างน้อย 2 ตัวอักษร</p>';
                                return;
                            }
                            resultsContainer.innerHTML = `<p class="text-center text-gray-400 p-4">กำลังค้นหา${allUsers ? 'ผู้ใช้ทั้งหมด...' : '...'}</p>`;
                            try {
                                // getUsersWithRichMenu คือ API ที่ดึงข้อมูล user จาก DB พร้อม Rich Menu ที่ใช้อยู่
                                const { users } = await invokeFunction({ 
                                    action: 'getUsersWithRichMenu', 
                                    searchTerm: allUsers ? null : searchTerm,
                                    allUsers 
                                });
                                renderUsers(users);
                            } catch (err) {
                                console.error("Search error:", err);
                                resultsContainer.innerHTML = `<p class="text-center text-red-400 p-4">เกิดข้อผิดพลาดในการค้นหา: ${err.message}</p>`;
                            }
                        };

                        searchBtn.addEventListener('click', () => performSearch(false));
                        allBtn.addEventListener('click', () => performSearch(true));
                        searchInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); performSearch(false); }});
                        searchInput.focus();
                        updateSelectedCount();
                    }
                }).then((result) => resolve(result.isConfirmed ? result.value : null));
            });
        }

        // --- Rich Menu Card Renderer (รองรับฟีเจอร์แสดงรูป Rich Menu ทั้งหมด) ---
        function renderRichMenuCard(menu) {
            const card = document.createElement('div');
            card.id = `menu-${menu.richMenuId}`;
            card.className =
                'card-modern p-4 flex flex-col gap-4';

            const aspectRatio =
                menu.size && menu.size.width && menu.size.height
                    ? `${menu.size.width} / ${menu.size.height}`
                    : '2500 / 843'; // Default to tall size

            // แสดง Placeholder ก่อนโหลดรูปจริง
            card.innerHTML = `
                <div class="img-container bg-gray-700 animate-pulse rounded-lg" style="aspect-ratio:${aspectRatio};">
                    <div class="w-full h-full flex items-center justify-center text-gray-400">Loading Image...</div>
                </div>
                <div>
                    <h3 class="font-bold text-xl text-[#989fce] truncate">${menu.name}</h3>
                    <p class="text-xs text-gray-400 font-mono break-all mt-1">ID: ${menu.richMenuId}</p>
                </div>
                <div class="mt-auto grid grid-cols-2 gap-2 text-sm">
                    <button class="link-user-btn btn-primary p-2">เซ็ตรายบุคคล</button>
                    <button class="unlink-user-btn btn-danger p-2">ยกเลิกรายบุคคล</button>
                    <button class="set-default-btn btn-primary p-2 col-span-2">Set ทั้งหมด (Rich Menu เริ่มต้น)</button>
                    <button class="delete-menu-btn btn-danger p-2 col-span-2">ลบ Menu จาก LINE</button>
                </div>`;

            // Event Listeners
            card.querySelector('.link-user-btn').addEventListener('click', () => handleLinkUser(menu.richMenuId));
            card.querySelector('.unlink-user-btn').addEventListener('click', () => handleUnlinkUser(menu.richMenuId));
            card.querySelector('.set-default-btn').addEventListener('click', () => handleSetDefault(menu.richMenuId));
            card.querySelector('.delete-menu-btn').addEventListener('click', () => handleDeleteMenu(menu.richMenuId, menu.name));

            return card;
        }


        // --- Main Rich Menu Loading Logic ---
        async function loadRichMenus() {
            showLoading('กำลังโหลด Rich Menu และรูปภาพ (ใช้การแคชจาก Server)...');
            richMenuGrid.innerHTML = '';
            richMenuDataCache.clear();

            try {
                // 1. ดึง Rich Menu List
                const { richmenus } = await invokeFunction({ action: 'getList' });
                if (!richmenus || richmenus.length === 0) {
                    richMenuGrid.innerHTML = '<p class="text-center col-span-full text-gray-300 p-8">ไม่พบ Rich Menu กรุณาอัพโหลดก่อน</p>';
                    return;
                }

                richmenus.forEach(menu => {
                    richMenuGrid.appendChild(renderRichMenuCard(menu));
                    richMenuDataCache.set(menu.richMenuId, menu);
                });

                // 2. ดึงรูปภาพแยก (ป้องกัน Rate Limit ที่ฝั่ง Client)
                const imageFetchPromises = richmenus.map(async (menu) => {
                    // Server Function จะจัดการแคชรูปภาพ ไม่ให้เรียก LINE API ซ้ำซาก
                    const { imageBase64 } = await invokeFunction({ action: 'getRichMenuImage', richMenuId: menu.richMenuId });
                    const cardElement = document.getElementById(`menu-${menu.richMenuId}`);
                    if (cardElement && imageBase64) {
                        const imgContainer = cardElement.querySelector('.img-container');
                        imgContainer.classList.remove('animate-pulse', 'bg-gray-700');
                        const aspectRatio = (menu.size && menu.size.width && menu.size.height) ? `${menu.size.width} / ${menu.size.height}` : '2500 / 843';
                        imgContainer.innerHTML = `<img src="data:image/png;base64,${imageBase64}" alt="${menu.name}" class="w-full object-cover" style="aspect-ratio: ${aspectRatio};">`;
                          
                        // อัพเดท Cache สำหรับ User Search Modal
                        const cachedMenu = richMenuDataCache.get(menu.richMenuId);
                        if (cachedMenu) cachedMenu.imageBase64 = imageBase64;
                    }
                });

                await Promise.all(imageFetchPromises);

            } catch (err) {
                console.error(err);
                showToast('error', `โหลดข้อมูลไม่สำเร็จ: ${err.message}`);
            } finally {
                hideLoading();
            }
        }
        
        // --- Rich Menu Actions (การเซ็ตรายบุคคล / ยกเลิกรายบุคคล / เซ็ตทั้งหมด) ---

        async function handleLinkUser(richMenuId) {
            // ฟีเจอร์: เซ็ตรายบุคคล, เลือกหลายคนพร้อมกันได้
            const userIds = await showUserSearchModal('เลือก User ที่จะ Link Rich Menu นี้');
            if (userIds && userIds.length > 0) {
                showLoading(`กำลังลิงก์ Rich Menu ให้ ${userIds.length} คน...`);
                try {
                    // bulkLink จะเรียก LINE API หลายครั้ง แต่ Server Function จะจัดการคิวและ Error
                    await invokeFunction({ action: 'bulkLink', userIds, richMenuId });
                    showToast('success', `ลิงก์ Rich Menu สำเร็จสำหรับ ${userIds.length} คน`);
                } catch (err) {
                    console.error(err);
                    showToast('error', `ลิงก์ Rich Menu ไม่สำเร็จ: ${err.message}`);
                } finally {
                    hideLoading();
                }
            }
        }
        
        async function handleUnlinkUser() {
            // ฟีเจอร์: ยกเลิกรายบุคคลได้
            const userIds = await showUserSearchModal('เลือก User ที่จะยกเลิก Rich Menu');
            if (userIds && userIds.length > 0) {
                showLoading(`กำลังยกเลิก Rich Menu ของ ${userIds.length} คน...`);
                try {
                    // bulkUnlink จะทำให้ Rich Menu กลับไปเป็น Default หรือหายไป
                    const data = await invokeFunction({ action: 'bulkUnlink', userIds });
                    showToast('success', data.message || `ยกเลิกการลิงก์สำเร็จสำหรับ ${userIds.length} คน`);
                } catch (err) {
                    console.error(err);
                    showToast('error', `ยกเลิกการลิงก์ไม่สำเร็จ: ${err.message}`);
                } finally {
                    hideLoading();
                }
            }
        }

        async function handleSetDefault(richMenuId) {
            // ฟีเจอร์: สามารถเซ็ตทั้งหมดได้
            Swal.fire({
                title: 'ตั้งเป็น Rich Menu เริ่มต้น?', text: 'Rich Menu นี้จะแสดงให้ผู้ใช้ทุกคนที่ยังไม่มี Rich Menu เฉพาะของตัวเอง', icon: 'warning',
                showCancelButton: true, confirmButtonText: 'ยืนยัน', cancelButtonText: 'ยกเลิก', customClass: { popup: 'swal2-popup' }
            }).then(async (result) => {
                if (result.isConfirmed) {
                    showLoading('กำลังตั้งค่า Rich Menu เริ่มต้น...');
                    try {
                        // setDefault คือการเรียก LINE API เพื่อตั้งเป็น Rich Menu หลัก
                        await invokeFunction({ action: 'setDefault', richMenuId });
                        showToast('success', 'ตั้งเป็น Rich Menu เริ่มต้นสำเร็จ');
                    } catch (err) {
                        console.error(err);
                        showToast('error', `ตั้งค่าไม่สำเร็จ: ${err.message}`);
                    } finally {
                        hideLoading();
                    }
                }
            });
        }
        
        cancelDefaultBtn.addEventListener('click', () => {
            // ฟีเจอร์: ยกเลิกทั้งหมดได้
            Swal.fire({
                title: 'ยกเลิก Rich Menu เริ่มต้นทั้งหมด?', text: 'จะไม่มี Rich Menu เริ่มต้นสำหรับผู้ใช้ใหม่', icon: 'warning',
                showCancelButton: true, confirmButtonText: 'ยืนยัน', cancelButtonText: 'ยกเลิก', customClass: { popup: 'swal2-popup' }
            }).then(async (result) => {
                if (result.isConfirmed) {
                    showLoading('กำลังยกเลิก...');
                    try {
                        await invokeFunction({ action: 'cancelDefault' });
                        showToast('success', 'ยกเลิก Rich Menu เริ่มต้นสำเร็จ');
                    } catch (err) {
                        console.error(err);
                        showToast('error', `ยกเลิกไม่สำเร็จ: ${err.message}`);
                    } finally {
                        hideLoading();
                    }
                }
            });
        });

        async function handleDeleteMenu(richMenuId, menuName) {
            Swal.fire({
                title: `แน่ใจหรือไม่ที่จะลบ Rich Menu "${menuName}"?`, text: "การกระทำนี้จะลบออกจาก LINE OA และไม่สามารถย้อนกลับได้!", icon: 'error',
                showCancelButton: true, confirmButtonText: 'ลบ', cancelButtonText: 'ยกเลิก',
                confirmButtonClass: 'btn-danger', customClass: { popup: 'swal2-popup' }
            }).then(async (result) => {
                if (result.isConfirmed) {
                    showLoading('กำลังลบ Rich Menu...');
                    try {
                        await invokeFunction({ action: 'deleteMenu', richMenuId });
                        showToast('success', 'ลบ Rich Menu สำเร็จ');
                        await loadRichMenus(); // โหลดใหม่เพื่ออัพเดท UI
                    } catch (err) {
                        console.error(err);
                        showToast('error', `ลบ Rich Menu ไม่สำเร็จ: ${err.message}`);
                    } finally {
                        hideLoading();
                    }
                }
            });
        }

        // Mock Function: การอัพโหลด Rich Menu ใหม่ควรทำผ่าน Server (Supabase/AWS)
        uploadMenuBtn.addEventListener('click', () => {
            Swal.fire({
                title: 'ฟีเจอร์อัพโหลด',
                text: 'การอัพโหลด Rich Menu ต้องมีการส่งไฟล์รูปภาพและ JSON Payload ไปยัง Server-side API (Supabase Function) เพื่อเรียก LINE Messaging API: create Rich Menu, upload Rich Menu image.',
                icon: 'info',
                confirmButtonText: 'รับทราบ',
                customClass: { popup: 'swal2-popup' }
            });
        });


        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', async () => {
            showLoading('กำลังเริ่มต้น LIFF...');
            try {
                await liff.init({ liffId: LIFF_ID, withLoginOnExternalBrowser: true });
                if (!liff.isLoggedIn()) {
                    // บังคับ Login เพื่อดึงสิทธิ์แอดมินหรือข้อมูล
                    liff.login({ redirectUri: window.location.href });
                    return;
                }
                await loadRichMenus();
            } catch (err) {
                console.error('Critical Error:', err);
                showToast('error', 'ไม่สามารถโหลดแอปได้ กรุณาลองใหม่');
                richMenuGrid.innerHTML = `<p class="text-center col-span-full text-red-400 p-8">เกิดข้อผิดพลาดในการเริ่มต้นแอปพลิเคชัน</p>`;
                hideLoading();
            }
        });
  </script>
</body>
</html>
