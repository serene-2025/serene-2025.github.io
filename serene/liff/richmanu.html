<body class="gradient-bg min-h-screen">

  <div id="loading-overlay">
    <img src="https://developers.line.biz/media/line-mini-app/LINE_spinner_light.svg" alt="Loading..." class="w-16 h-16">
        <p id="loading-text" class="text-lg loading-text-color">กำลังโหลด...</p>
  </div>

  <div class="container mx-auto p-4 md:p-8">
    <header class="text-center mb-8 fade-in">
            <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-[#48D1CC] to-[#20B2AA]">
        Rich Menu API
      </h1>
      <p class="text-lg text-gray-300">จัดการ Rich Menu API ของ LINE OA</p>
    </header>

    <div class="mb-8 flex justify-center gap-4 fade-in" style="animation-delay: 0.2s;">
      <button id="cancel-default-btn" class="btn-danger font-bold py-2 px-6 rounded-lg">ยกเลิก Rich Menu เริ่มต้น</button>
    </div>

    <main id="richmenu-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          </main>
  </div>
  <script type="module">
        // ... (โค้ด JavaScript เดิม)
        
        async function showUserSearchModal(title) {
            return new Promise((resolve) => {
                let selectedUsers = new Set();
                Swal.fire({
                    title: title,
                    width: 'clamp(300px, 90%, 600px)',
                    html: `
                        <div class="p-2 text-left">
                            <div class="space-y-2 sm:space-y-0 sm:flex sm:gap-2 sm:items-center">
                               <input 
                                id="swal-user-search" 
                                                                class="flex-1 min-w-0 px-3 py-2 rounded-lg border modal-border-color modal-input-bg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#48D1CC]" 
                                placeholder="พิมพ์ userId หรือชื่อ..."
                                >

                                <button id="swal-user-search-btn" class="btn-primary py-2 px-5 rounded-lg w-full sm:w-auto flex-shrink-0 font-semibold">ค้นหา</button>
                            </div>
                                                        <div id="swal-user-results" class="mt-4 max-h-60 overflow-y-auto border modal-border-color rounded-lg modal-bg-color">
                               <p class="text-center text-gray-400 p-4">กรุณาพิมพ์เพื่อค้นหาผู้ใช้</p>
                            </div>
                        </div>
                    `,
                    showCancelButton: true,
                    cancelButtonText: 'ยกเลิก',
                    showConfirmButton: true,
                    confirmButtonText: 'ยืนยัน',
                    preConfirm: () => Array.from(selectedUsers),
                    didOpen: () => {
                        // ... (โค้ด JavaScript เดิม)
                        data.forEach(user => {
                                    const userEl = document.createElement('label');
                                    // เพิ่มคลาส hover:bg ที่กำหนดใหม่
                                    userEl.className = 'flex items-start gap-3 p-2 rounded-lg user-result-hover cursor-pointer transition-colors m-1';
                                    
                                    const linkedMenuInfo = richMenuDataCache.get(user.linkedRichMenuId);
                                    let linkedMenuInfoHTML = `<p class="text-xs mt-1 text-gray-400">ใช้ Rich Menu เริ่มต้น</p>`;
                                    if (linkedMenuInfo) {
                                        linkedMenuInfoHTML = `
                                            <div class="mt-1 p-1 bg-black/20 rounded-md">
                                                                                                <p class="text-xs text-[#48D1CC] truncate mb-1" title="${linkedMenuInfo.name}">เมนู: ${linkedMenuInfo.name}</p>
                                                <img src="${linkedMenuInfo.imageBase64}" class="w-24 h-auto rounded-sm">
                                            </div>`;
                                    }

                                    userEl.innerHTML = `
                                                                                <input type="checkbox" class="form-checkbox h-5 w-5 mt-2 bg-transparent rounded border-[#48D1CC] text-[#48D1CC] focus:ring-0" data-userid="${user.userId}">
                                        <img src="${user.pictureUrl || ''}" onerror="this.onerror=null;this.src='https://img.icons8.com/?size=80&id=492ILERveW8G&format=png'" alt="Profile" class="w-10 h-10 rounded-full object-cover flex-shrink-0 mt-1">
                                        <div class="overflow-hidden flex-grow">
                                            <p class="font-semibold truncate">${user.displayName}</p>
                                            <p class="text-xs text-gray-300 font-mono break-all truncate">${user.userId}</p>
                                            ${linkedMenuInfoHTML}
                                        </div>`;
                                    // ... (โค้ด JavaScript เดิม)
                                });
                            } catch (err) {
                                // ... (โค้ด JavaScript เดิม)
                            }
                        };
                        // ... (โค้ด JavaScript เดิม)
                    }
                }).then((result) => resolve(result.isConfirmed ? result.value : null));
            });
        }

        function renderRichMenuCard(menu) {
            const card = document.createElement('div');
            card.id = `menu-${menu.richMenuId}`;
            // เปลี่ยนคลาสพื้นหลังการ์ด
            card.className =
                'richmenu-card rounded-2xl p-4 flex flex-col gap-4 fade-in transition-all';

            // ... (โค้ด JavaScript เดิม)
            
            card.innerHTML = `
                <div class="img-container">
                    <img src="data:image/png;base64,${menu.imageBase64 || ''}" 
                         alt="${menu.name}" 
                         style="aspect-ratio:${aspectRatio};" />
                </div>
                <div>
                                        <h3 class="font-bold text-lg text-[#48D1CC] truncate">${menu.name}</h3>
                    <p class="text-xs text-gray-400 font-mono break-all">${menu.richMenuId}</p>
                </div>
                <div class="mt-auto grid grid-cols-2 gap-2 text-sm">
                    <button class="link-user-btn btn-primary p-2 rounded-lg">เซ็ต Users</button>
                    <button class="unlink-user-btn btn-primary p-2 rounded-lg">ยกเลิก Users</button>
                    <button class="set-default-btn btn-primary p-2 rounded-lg col-span-2">Set ทั้งหมด</button>
                    <button class="delete-menu-btn btn-danger p-2 rounded-lg col-span-2">ลบ Menu</button>
                </div>`;

            // ... (โค้ด JavaScript เดิม)
            return card;
        }
        // ... (โค้ด JavaScript เดิม)
  </script>
</body>
</html>
