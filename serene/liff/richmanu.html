<!DOCTYPE html>
<html lang="th">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Rich Menu API-LINE OA</title>
Â  <meta name="description" content="Rich Menu API Admin for LIFF" />
Â  <meta name="author" content="9one" />
Â  <meta property="og:title" content="Rich Menu API Admin-9one" />
Â  <meta property="og:description" content="Rich Menu API for LIFF" />
Â  <meta property="og:type" content="website" />
Â  <meta property="og:image" content="https://lh3.googleusercontent.com/d/1diz2KXxiOna6_ltL_GKxvfT3JkJCZtvG" />
Â  <script src="https://cdn.tailwindcss.com"></script>
Â  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
Â  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
Â  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
Â 
Â  <style>
Â  Â  @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@400;500;600;700&display=swap');
Â  Â  /* Color Palette & Base Theme */
Â  Â  :root {
Â  Â  Â  --color-bg-primary: #1F2937; /* Dark Slate */
Â  Â  Â  --color-bg-secondary: #374151; /* Medium Slate */
Â  Â  Â  --color-text-light: #F9FAFB;
Â  Â  Â  --color-text-muted: #9CA3AF;
Â  Â  Â  --color-accent-blue: #3B82F6; /* LINE/Primary Action Blue */
Â  Â  Â  --color-accent-red: #EF4444; /* Danger Red */
Â  Â  Â  --color-border: #4B5563;
Â  Â  }

Â  Â  body { font-family: 'Prompt', sans-serif; background-color: var(--color-bg-primary); color: var(--color-text-light); }
Â  Â  .gradient-bg { background: var(--color-bg-primary); } /* Simplifies for modern dark mode, keeps original name */

Â  Â  /* Button Styling */
Â  Â  .btn {
Â  Â  Â  font-weight: 600;
Â  Â  Â  padding: 0.75rem 1.5rem;
Â  Â  Â  border-radius: 0.75rem; /* More rounded corners */
Â  Â  Â  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
Â  Â  Â  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
Â  Â  Â  border: none;
Â  Â  }

Â  Â  .btn-primary {
Â  Â  Â  background: linear-gradient(135deg, var(--color-accent-blue) 0%, #60A5FA 100%);
Â  Â  Â  color: white;
Â  Â  }
Â  Â  .btn-primary:hover {
Â  Â  Â  transform: translateY(-1px);
Â  Â  Â  box-shadow: 0 6px 10px rgba(59, 130, 246, 0.3);
Â  Â  Â  opacity: 0.9;
Â  Â  }

Â  Â  .btn-danger {
Â  Â  Â  background: linear-gradient(135deg, var(--color-accent-red) 0%, #F87171 100%);
Â  Â  Â  color: white;
Â  Â  }
Â  Â  .btn-danger:hover {
Â  Â  Â  transform: translateY(-1px);
Â  Â  Â  box-shadow: 0 6px 10px rgba(239, 68, 68, 0.3);
Â  Â  Â  opacity: 0.9;
Â  Â  }

Â  Â  /* Rich Menu Card Styling */
Â  Â  .richmenu-card {
Â  Â  Â  background-color: var(--color-bg-secondary);
Â  Â  Â  border: 1px solid var(--color-border);
Â  Â  Â  border-radius: 1rem;
Â  Â  Â  transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
Â  Â  Â  overflow: hidden;
Â  Â  Â  box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
Â  Â  }

Â  Â  .richmenu-card:hover {
Â  Â  Â  transform: translateY(-5px);
Â  Â  Â  border-color: var(--color-accent-blue);
Â  Â  Â  box-shadow: 0 15px 25px rgba(59, 130, 246, 0.2);
Â  Â  }

Â  Â  /* Image Container */
Â  Â  .img-container {
Â  Â  Â  position: relative;
Â  Â  Â  width: 100%;
Â  Â  Â  border-radius: 0.5rem;
Â  Â  Â  overflow: hidden;
Â  Â  Â  background: #374151; /* Darker placeholder */
Â  Â  Â  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
Â  Â  }

Â  Â  .img-container img {
Â  Â  Â  width: 100%;
Â  Â  Â  height: auto;
Â  Â  Â  aspect-ratio: 2500 / 843;
Â  Â  Â  object-fit: contain;
Â  Â  Â  display: block;
Â  Â  Â  pointer-events: none;
Â  Â  Â  user-select: none;
Â  Â  }

Â  Â  /* SweetAlert2 Customization */
Â  Â  .swal2-popup {
Â  Â  Â  background-color: var(--color-bg-secondary) !important;
Â  Â  Â  color: var(--color-text-light) !important;
Â  Â  Â  border: 1px solid var(--color-border);
Â  Â  Â  border-radius: 1rem !important;
Â  Â  Â  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3) !important;
Â  Â  }
Â  Â  .swal2-title { color: var(--color-text-light) !important; }
Â  Â  .swal2-html-container { color: var(--color-text-muted) !important; }
Â  Â  .swal2-input {
Â  Â  Â  background-color: var(--color-bg-primary) !important;
Â  Â  Â  border: 1px solid var(--color-border) !important;
Â  Â  Â  color: var(--color-text-light) !important;
Â  Â  Â  border-radius: 0.5rem !important;
Â  Â  }
Â  Â  .swal2-input:focus {
Â  Â  Â  border-color: var(--color-accent-blue) !important;
Â  Â  Â  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5) !important;
Â  Â  }
Â  Â  .swal2-confirm { background-color: var(--color-accent-blue) !important; }
Â  Â  .swal2-cancel { background-color: var(--color-border) !important; }

Â  Â  /* Utility for Tailwind Overrides */
Â  Â  button, a, label, [role=button], input[type=checkbox] {
Â  Â  Â  -webkit-tap-highlight-color: transparent;
Â  Â  }

Â  Â  #swal-user-results {
Â  Â  Â  -webkit-overflow-scrolling: touch;
Â  Â  Â  overscroll-behavior: contain;
Â  Â  }
Â  Â  .fade-in {
Â  Â  Â  animation: fadeIn 0.5s ease-out both;
Â  Â  }
Â  Â  @keyframes fadeIn {
Â  Â  Â  from { opacity: 0; transform: translateY(10px); }
Â  Â  Â  to { opacity: 1; transform: translateY(0); }
Â  Â  }
Â  Â  #loading-overlay {
Â  Â  Â  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  background-color: rgba(31, 41, 55, 0.9); backdrop-filter: blur(8px); /* Deeper dark blur */
Â  Â  Â  display: none; justify-content: center; align-items: center;
Â  Â  Â  z-index: 9999; flex-direction: column; gap: 1rem;
Â  Â  }

Â  </style>
</head>
<body class="gradient-bg min-h-screen">

Â  <div id="loading-overlay">
Â  Â  Â  Â  <svg class="animate-spin h-10 w-10 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
Â  Â  Â  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
Â  Â  Â  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
Â  Â  </svg>
Â  Â  <p id="loading-text" class="text-lg text-gray-300">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”...</p>
Â  </div>

Â  <div class="container mx-auto p-4 md:p-8">
Â  Â  <header class="text-center mb-10 fade-in">
Â  Â  Â  <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-400">
Â  Â  Â  Â  Rich Menu API ğŸ§‘â€ğŸ’»
Â  Â  Â  </h1>
Â  Â  Â  <p class="text-xl text-gray-400 mt-2">à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸¡à¸·à¸­à¸ˆà¸±à¸”à¸à¸²à¸£ Rich Menu à¸ªà¸³à¸«à¸£à¸±à¸š LINE OA</p>
Â  Â  </header>

Â  Â  <div class="mb-10 flex justify-center gap-4 fade-in" style="animation-delay: 0.2s;">
Â  Â  Â  <button id="cancel-default-btn" class="btn btn-danger font-bold py-3 px-8 rounded-xl shadow-lg">âŒ à¸¢à¸à¹€à¸¥à¸´à¸ Rich Menu à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™</button>
Â  Â  </div>

Â  Â  <main id="richmenu-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
Â  Â  Â  Â  Â  </main>
Â  </div>

Â  Â  <script type="module">
Â  Â  Â  Â  const LIFF_ID = "2000143615-RQWZXWKA";
Â  Â  Â  Â  const SUPABASE_URL = "https://kiumelolsilduqnvrekf.supabase.co";
Â  Â  Â  Â  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtpdW1lbG9sc2lsZHVxbnZyZWtmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwODUyNzYsImV4cCI6MjA3MjY2MTI3Nn0.3hCFJiDrkgNJQEggS8MkRnxlhvqIMAax_a73NJQ14gU";

Â  Â  Â  Â  const { createClient } = supabase;
Â  Â  Â  Â  const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

Â  Â  Â  Â  const loadingOverlay = document.getElementById('loading-overlay');
Â  Â  Â  Â  const loadingText = document.getElementById('loading-text');
Â  Â  Â  Â  const richMenuGrid = document.getElementById('richmenu-grid');
Â  Â  Â  Â  const cancelDefaultBtn = document.getElementById('cancel-default-btn');
Â  Â  Â  Â Â 
Â  Â  Â  Â  let richMenuDataCache = new Map();

Â  Â  Â  Â  const showLoading = (text = 'à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”...') => {
Â  Â  Â  Â  Â  Â  loadingText.textContent = text;
Â  Â  Â  Â  Â  Â  loadingOverlay.style.display = 'flex';
Â  Â  Â  Â  };
Â  Â  Â  Â  const hideLoading = () => {
Â  Â  Â  Â  Â  Â  loadingOverlay.style.display = 'none';
Â  Â  Â  Â  };
Â  Â  Â  Â  const showToast = (icon, title) => {
Â  Â  Â  Â  Â  Â  Swal.fire({
Â  Â  Â  Â  Â  Â  Â  Â  icon: icon, title: title, toast: true, position: 'top-end',
Â  Â  Â  Â  Â  Â  Â  Â  showConfirmButton: false, timer: 3000, timerProgressBar: true,
Â  Â  Â  Â  Â  Â  Â  Â  customClass: { popup: '!bg-gray-700 !text-white' } /* Adjusted toast class for better contrast */
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };

Â  Â  Â  Â  async function invokeFunction(payload) {
Â  Â  Â  Â  Â  Â  const { data, error } = await supabaseClient.functions.invoke('manage-rich-menu', { body: payload });
Â  Â  Â  Â  Â  Â  if (error) throw error;
Â  Â  Â  Â  Â  Â  return data;
Â  Â  Â  Â  }

Â  Â  Â  Â  async function showUserSearchModal(title) {
Â  Â  Â  Â  Â  Â  return new Promise((resolve) => {
Â  Â  Â  Â  Â  Â  Â  Â  let selectedUsers = new Set();
Â  Â  Â  Â  Â  Â  Â  Â  Swal.fire({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: title,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 'clamp(300px, 90%, 600px)',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html: `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-2 text-left">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-2 sm:space-y-0 sm:flex sm:gap-2 sm:items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <inputÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id="swal-user-search"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="flex-1 min-w-0 px-4 py-2 rounded-lg border border-gray-600 bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 swal2-input"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="à¸à¸´à¸¡à¸à¹Œ userId à¸«à¸£à¸·à¸­à¸Šà¸·à¹ˆà¸­..."
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="swal-user-search-btn" class="btn btn-primary py-2 px-5 rounded-lg w-full sm:w-auto flex-shrink-0 font-semibold">à¸„à¹‰à¸™à¸«à¸²</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="swal-user-results" class="mt-4 max-h-60 overflow-y-auto border border-gray-600 rounded-lg bg-gray-700/50">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-center text-gray-400 p-4">à¸à¸£à¸¸à¸“à¸²à¸à¸´à¸¡à¸à¹Œà¹€à¸à¸·à¹ˆà¸­à¸„à¹‰à¸™à¸«à¸²à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showCancelButton: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cancelButtonText: 'à¸¢à¸à¹€à¸¥à¸´à¸',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showConfirmButton: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmButtonText: 'à¸¢à¸·à¸™à¸¢à¸±à¸™',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  customClass: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  popup: 'swal2-popup',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmButton: 'btn btn-primary',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cancelButton: 'btn !bg-gray-600 hover:!bg-gray-500 !text-white',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  preConfirm: () => Array.from(selectedUsers),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  didOpen: () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const searchInput = document.getElementById('swal-user-search');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const searchBtn = document.getElementById('swal-user-search-btn');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const resultsContainer = document.getElementById('swal-user-results');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const confirmBtn = Swal.getConfirmButton();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmBtn.disabled = true;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const updateSelectedCount = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const count = selectedUsers.size;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmBtn.textContent = `à¸¢à¸·à¸™à¸¢à¸±à¸™ (${count})`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmBtn.disabled = count === 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const performSearch = async () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const searchTerm = searchInput.value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (searchTerm.length < 2) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resultsContainer.innerHTML = '<p class="text-center text-gray-400 p-4">à¸à¸£à¸¸à¸“à¸²à¸à¸´à¸¡à¸à¹Œà¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 2 à¸•à¸±à¸§à¸­à¸±à¸à¸©à¸£</p>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resultsContainer.innerHTML = '<p class="text-center text-gray-400 p-4">à¸à¸³à¸¥à¸±à¸‡à¸„à¹‰à¸™à¸«à¸²...</p>';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { users: data } = await invokeFunction({Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  action: 'getUsersWithRichMenu',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  searchTerm: searchTermÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!data || data.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resultsContainer.innerHTML = '<p class="text-center text-gray-400 p-4">à¹„à¸¡à¹ˆà¸à¸šà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰</p>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resultsContainer.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data.forEach(user => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userEl = document.createElement('label');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Update hover color and margin for better look
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userEl.className = 'flex items-start gap-3 p-3 rounded-lg hover:bg-gray-600/70 cursor-pointer transition-colors m-0.5';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const linkedMenuInfo = richMenuDataCache.get(user.linkedRichMenuId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let linkedMenuInfoHTML = `<p class="text-xs mt-1 text-gray-500">à¹ƒà¸Šà¹‰ Rich Menu à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (linkedMenuInfo) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // New design for linked menu info
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  linkedMenuInfoHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-2 p-2 bg-gray-800 rounded-md flex items-center gap-2 border border-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="data:image/png;base64,${linkedMenuInfo.imageBase64}" class="w-12 h-auto rounded-sm flex-shrink-0" alt="Rich Menu Image">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-blue-400 truncate font-medium" title="${linkedMenuInfo.name}">à¹€à¸¡à¸™à¸¹à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸‡à¸²à¸™: ${linkedMenuInfo.name}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userEl.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" class="form-checkbox h-5 w-5 mt-1.5 bg-gray-700 rounded border-gray-500 text-blue-500 focus:ring-blue-500/50 focus:ring-offset-2 focus:ring-offset-gray-700" data-userid="${user.userId}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${user.pictureUrl || ''}" onerror="this.onerror=null;this.src='https://img.icons8.com/?size=80&id=492ILERveW8G&format=png'" alt="Profile" class="w-10 h-10 rounded-full object-cover flex-shrink-0 mt-1 border-2 border-gray-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="overflow-hidden flex-grow">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold truncate">${user.displayName}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-gray-400 font-mono break-all truncate">${user.userId}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${linkedMenuInfoHTML}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const checkbox = userEl.querySelector('input[type="checkbox"]');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  checkbox.checked = selectedUsers.has(user.userId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  checkbox.addEventListener('change', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (e.target.checked) selectedUsers.add(user.userId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else selectedUsers.delete(user.userId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateSelectedCount();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resultsContainer.appendChild(userEl);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Search error:", err);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resultsContainer.innerHTML = `<p class="text-center text-red-400 p-4">à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¸„à¹‰à¸™à¸«à¸²</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  searchBtn.addEventListener('click', performSearch);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  searchInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); performSearch(); }});
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  searchInput.focus();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateSelectedCount();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }).then((result) => resolve(result.isConfirmed ? result.value : null));
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â function renderRichMenuCard(menu) {
Â  Â  Â  Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  Â  Â  Â  card.id = `menu-${menu.richMenuId}`;
Â  Â  Â  Â  Â  Â  // Use the new richmenu-card class for improved look
Â  Â  Â  Â  Â  Â  card.className =
Â  Â  Â  Â  Â  Â  Â  Â  'richmenu-card p-4 flex flex-col gap-4 fade-in';

Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const aspectRatio =
Â  Â  Â  Â  Â  Â  Â  Â  menu.size && menu.size.width && menu.size.height
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? `${menu.size.width} / ${menu.size.height}`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : '2500 / 843';

Â  Â  Â  Â  Â  Â  card.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="img-container animate-pulse"> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="data:image/png;base64,${menu.imageBase64 || ''}"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â alt="${menu.name}"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â style="aspect-ratio:${aspectRatio};" />
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-xl text-white truncate">${menu.name}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-gray-400 font-mono break-all mt-1">${menu.richMenuId}</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-auto grid grid-cols-2 gap-3 text-base"> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="link-user-btn btn btn-primary py-2 px-3 rounded-lg text-sm">ğŸ”— à¹€à¸‹à¹‡à¸• Users</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="unlink-user-btn btn btn-primary py-2 px-3 rounded-lg text-sm !bg-indigo-500 hover:!bg-indigo-600">ğŸ§· à¸¢à¸à¹€à¸¥à¸´à¸ Users</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="set-default-btn btn btn-primary py-2 px-3 rounded-lg col-span-2 !bg-green-500 hover:!bg-green-600">â­ Set à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (Default)</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="delete-menu-btn btn btn-danger py-2 px-3 rounded-lg col-span-2">ğŸ—‘ï¸ à¸¥à¸š Menu</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>`;

Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  card.querySelector('.link-user-btn').addEventListener('click', () =>
Â  Â  Â  Â  Â  Â  Â  Â  handleLinkUser(menu.richMenuId)
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  card.querySelector('.unlink-user-btn').addEventListener('click', () =>
Â  Â  Â  Â  Â  Â  Â  Â  handleUnlinkUser(menu.richMenuId)
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  card.querySelector('.set-default-btn').addEventListener('click', () =>
Â  Â  Â  Â  Â  Â  Â  Â  handleSetDefault(menu.richMenuId)
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  card.querySelector('.delete-menu-btn').addEventListener('click', () =>
Â  Â  Â  Â  Â  Â  Â  Â  handleDeleteMenu(menu.richMenuId, menu.name)
Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  return card;
Â  Â  Â  Â  }




Â  Â  Â  Â  async function loadRichMenus() {
Â  Â  Â  Â  Â  Â  showLoading('à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ Rich Menu API...');
Â  Â  Â  Â  Â  Â  richMenuGrid.innerHTML = '';
Â  Â  Â  Â  Â  Â  richMenuDataCache.clear();

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const { richmenus } = await invokeFunction({ action: 'getList' });
Â  Â  Â  Â  Â  Â  Â  Â  if (!richmenus || richmenus.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  richMenuGrid.innerHTML = '<p class="text-center col-span-full text-gray-400 p-8">à¹„à¸¡à¹ˆà¸à¸š Rich Menu à¸—à¸µà¹ˆà¸ªà¸£à¹‰à¸²à¸‡à¹„à¸§à¹‰à¹ƒà¸™ LINE OA</p>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hideLoading();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  richmenus.forEach(menu => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  richMenuGrid.appendChild(renderRichMenuCard(menu));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  richMenuDataCache.set(menu.richMenuId, menu);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  const imageFetchPromises = richmenus.map(async (menu) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { imageBase64 } = await invokeFunction({ action: 'getRichMenuImage', richMenuId: menu.richMenuId });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cardElement = document.getElementById(`menu-${menu.richMenuId}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (cardElement && imageBase64) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const imgContainer = cardElement.querySelector('.img-container');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imgContainer.classList.remove('animate-pulse');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const aspectRatio = (menu.size && menu.size.width && menu.size.height) ? `${menu.size.width} / ${menu.size.height}` : '2500 / 843';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Using a data URI for the image
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imgContainer.innerHTML = `<img src="data:image/png;base64,${imageBase64}" alt="${menu.name}" style="aspect-ratio: ${aspectRatio};">`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cachedMenu = richMenuDataCache.get(menu.richMenuId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (cachedMenu) cachedMenu.imageBase64 = imageBase64;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (imgErr) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error(`Failed to load image for ${menu.richMenuId}`, imgErr);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  await Promise.all(imageFetchPromises);

Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error(err);
Â  Â  Â  Â  Â  Â  Â  Â  showToast('error', `à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ: ${err.message}`);
Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  hideLoading();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  async function handleLinkUser(richMenuId) {
Â  Â  Â  Â  Â  Â  const userIds = await showUserSearchModal('ğŸ”— à¸à¸³à¸«à¸™à¸” Rich Menu à¸™à¸µà¹‰à¹ƒà¸«à¹‰à¸à¸±à¸šà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰');
Â  Â  Â  Â  Â  Â  if (userIds && userIds.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  showLoading(`à¸à¸³à¸¥à¸±à¸‡à¸¥à¸´à¸‡à¸à¹Œ Rich Menu à¹ƒà¸«à¹‰ ${userIds.length} à¸„à¸™...`);
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await invokeFunction({ action: 'bulkLink', userIds, richMenuId });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('success', 'âœ… à¸¥à¸´à¸‡à¸à¹Œ Rich Menu à¸ªà¸³à¹€à¸£à¹‡à¸ˆ');
Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error(err);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('error', `âŒ à¸¥à¸´à¸‡à¸à¹Œ Rich Menu à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ: ${err.message}`);
Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hideLoading();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  async function handleUnlinkUser(richMenuId) {
Â  Â  Â  Â  Â  Â  const userIds = await showUserSearchModal('ğŸ§· à¸¢à¸à¹€à¸¥à¸´à¸ Rich Menu à¹€à¸‰à¸à¸²à¸°à¸‚à¸­à¸‡à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰');
Â  Â  Â  Â  Â  Â  if (userIds && userIds.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  showLoading(`à¸à¸³à¸¥à¸±à¸‡à¸¢à¸à¹€à¸¥à¸´à¸ Rich Menu à¸‚à¸­à¸‡ ${userIds.length} à¸„à¸™...`);
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = await invokeFunction({ action: 'bulkUnlink', userIds });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('success', data.message || 'ğŸ‘ à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸¥à¸´à¸‡à¸à¹Œà¸ªà¸³à¹€à¸£à¹‡à¸ˆ');
Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error(err);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('error', `âŒ à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸¥à¸´à¸‡à¸à¹Œà¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ: ${err.message}`);
Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hideLoading();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function handleSetDefault(richMenuId) {
Â  Â  Â  Â  Â  Â  Swal.fire({
Â  Â  Â  Â  Â  Â  Â  Â  title: 'à¸•à¸±à¹‰à¸‡à¹€à¸›à¹‡à¸™ Rich Menu à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™?', text: 'Rich Menu à¸™à¸µà¹‰à¸ˆà¸°à¹à¸ªà¸”à¸‡à¹ƒà¸«à¹‰à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸—à¸¸à¸à¸„à¸™à¸—à¸µà¹ˆà¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µ Rich Menu à¹€à¸‰à¸à¸²à¸°à¸‚à¸­à¸‡à¸•à¸±à¸§à¹€à¸­à¸‡', icon: 'question',
Â  Â  Â  Â  Â  Â  Â  Â  showCancelButton: true, confirmButtonText: 'âœ… à¸¢à¸·à¸™à¸¢à¸±à¸™', cancelButtonText: 'à¸¢à¸à¹€à¸¥à¸´à¸',
Â  Â  Â  Â  Â  Â  Â  Â  customClass: { popup: 'swal2-popup', confirmButton: 'btn btn-primary', cancelButton: 'btn !bg-gray-600 hover:!bg-gray-500 !text-white' }
Â  Â  Â  Â  Â  Â  }).then(async (result) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (result.isConfirmed) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showLoading('à¸à¸³à¸¥à¸±à¸‡à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹€à¸›à¹‡à¸™ Default...');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await invokeFunction({ action: 'setDefault', richMenuId });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('success', 'â­ à¸•à¸±à¹‰à¸‡à¹€à¸›à¹‡à¸™ Rich Menu à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¸ªà¸³à¹€à¸£à¹‡à¸ˆ');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error(err);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('error', `âŒ à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ: ${err.message}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hideLoading();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  cancelDefaultBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â Swal.fire({
Â  Â  Â  Â  Â  Â  Â  Â  title: 'à¸¢à¸à¹€à¸¥à¸´à¸ Rich Menu à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™?', text: 'à¸ˆà¸°à¹„à¸¡à¹ˆà¸¡à¸µ Rich Menu à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¸ªà¸³à¸«à¸£à¸±à¸šà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹ƒà¸«à¸¡à¹ˆà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” à¹à¸¥à¸°à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹€à¸”à¸´à¸¡à¸—à¸µà¹ˆà¸–à¸¹à¸à¸¢à¸à¹€à¸¥à¸´à¸ Rich Menu à¹€à¸‰à¸à¸²à¸°à¸ˆà¸°à¸à¸¥à¸±à¸šà¹„à¸›à¹ƒà¸Šà¹‰à¸„à¹ˆà¸² Default à¸‚à¸­à¸‡ LINE OA (à¸–à¹‰à¸²à¸¡à¸µ)', icon: 'warning',
Â  Â  Â  Â  Â  Â  Â  Â  showCancelButton: true, confirmButtonText: 'âŒ à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¸¢à¸à¹€à¸¥à¸´à¸', cancelButtonText: 'à¸¢à¸à¹€à¸¥à¸´à¸',
Â  Â  Â  Â  Â  Â  Â  Â  customClass: { popup: 'swal2-popup', confirmButton: 'btn btn-danger', cancelButton: 'btn !bg-gray-600 hover:!bg-gray-500 !text-white' }
Â  Â  Â  Â  Â  Â  }).then(async (result) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (result.isConfirmed) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showLoading('à¸à¸³à¸¥à¸±à¸‡à¸¢à¸à¹€à¸¥à¸´à¸ Rich Menu à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™...');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await invokeFunction({ action: 'cancelDefault' });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('success', 'ğŸ—‘ï¸ à¸¢à¸à¹€à¸¥à¸´à¸ Rich Menu à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¸ªà¸³à¹€à¸£à¹‡à¸ˆ');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error(err);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('error', `âŒ à¸¢à¸à¹€à¸¥à¸´à¸à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ: ${err.message}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hideLoading();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  async function handleDeleteMenu(richMenuId, menuName) {
Â  Â  Â  Â  Â  Â  Swal.fire({
Â  Â  Â  Â  Â  Â  Â  Â  title: `âš ï¸ à¸¥à¸š Rich Menu "${menuName}"?`, text: "à¸à¸²à¸£à¸à¸£à¸°à¸—à¸³à¸™à¸µà¹‰à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸¢à¹‰à¸­à¸™à¸à¸¥à¸±à¸šà¹„à¸”à¹‰!", icon: 'error',
Â  Â  Â  Â  Â  Â  Â  Â  showCancelButton: true, confirmButtonText: 'ğŸ”¥ à¸¥à¸šà¸­à¸¢à¹ˆà¸²à¸‡à¸–à¸²à¸§à¸£', cancelButtonText: 'à¸¢à¸à¹€à¸¥à¸´à¸',
Â  Â  Â  Â  Â  Â  Â  Â  customClass: { popup: 'swal2-popup', confirmButton: 'btn btn-danger', cancelButton: 'btn !bg-gray-600 hover:!bg-gray-500 !text-white' }
Â  Â  Â  Â  Â  Â  }).then(async (result) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (result.isConfirmed) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showLoading('à¸à¸³à¸¥à¸±à¸‡à¸¥à¸š Rich Menu...');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await invokeFunction({ action: 'deleteMenu', richMenuId });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('success', 'ğŸ—‘ï¸ à¸¥à¸š Rich Menu à¸ªà¸³à¹€à¸£à¹‡à¸ˆ');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await loadRichMenus(); // Reload data
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error(err);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('error', `âŒ à¸¥à¸š Rich Menu à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ: ${err.message}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hideLoading();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', async () => {
Â  Â  Â  Â  Â  Â  showLoading('à¸à¸³à¸¥à¸±à¸‡à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™ LIFF...');
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await liff.init({ liffId: LIFF_ID, withLoginOnExternalBrowser: true });
Â  Â  Â  Â  Â  Â  Â  Â  if (!liff.isLoggedIn()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  liff.login({ redirectUri: window.location.href });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  await loadRichMenus();
Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Critical Error:', err);
Â  Â  Â  Â  Â  Â  Â  Â  showToast('error', 'âŒ à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸” à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸«à¸¥à¸”à¹à¸­à¸›à¹„à¸”à¹‰');
Â  Â  Â  Â  Â  Â  Â  Â  richMenuGrid.innerHTML = `<p class="text-center col-span-full text-red-400 p-8">à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¹à¸­à¸›à¸à¸¥à¸´à¹€à¸„à¸Šà¸±à¸™ à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸š LIFF à¸«à¸£à¸·à¸­à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  hideLoading();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
