<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .loading {
            display: none;
        }
        .loading.show {
            display: inline-block;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .status-badge {
            transition: all 0.2s ease;
        }
        .status-badge:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 min-h-screen font-thai">
    <div class="container mx-auto px-2 py-4">
        <!-- Header -->
        <div class="bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 rounded-2xl shadow-2xl p-6 mb-6 relative overflow-hidden border border-white/10">
            <div class="absolute inset-0 bg-gradient-to-br from-blue-600/20 to-purple-600/20"></div>
            <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-white/5 to-transparent rounded-full -mr-16 -mt-16"></div>
            <div class="absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-white/5 to-transparent rounded-full -ml-12 -mb-12"></div>
            
            <div class="relative z-10 flex items-center">
                <div class="w-14 h-14 bg-gradient-to-br from-blue-400 to-indigo-500 rounded-2xl flex items-center justify-center mr-4 shadow-lg backdrop-blur-sm border border-white/20">
                    <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 2 0 01-2 2z"></path>
                    </svg>
                </div>
                <div>
                    <h1 class="text-xl sm:text-2xl font-bold text-white mb-1 tracking-tight">‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ</h1>
                    <p class="text-sm text-blue-100 font-medium">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</p>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-4 mb-6 border border-white/20">
            <div class="flex flex-col sm:flex-row gap-4 items-stretch sm:items-center">
                <button id="loadDataBtn" class="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white px-6 py-3 rounded-xl text-sm font-semibold transition-all duration-300 flex items-center justify-center gap-2 shadow-lg hover:shadow-xl transform hover:scale-105">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
                
                <div class="flex items-center gap-3 flex-1">
                    <div class="flex items-center gap-2 bg-gray-50 rounded-xl px-4 py-3 flex-1 border border-gray-200 focus-within:border-blue-400 focus-within:ring-4 focus-within:ring-blue-100 transition-all duration-200">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: ‡πÄ‡∏ä‡πà‡∏ô 998/27 " class="bg-transparent border-0 outline-none flex-1 text-sm text-gray-700 placeholder-gray-400">
                    </div>
                </div>

                <div class="loading flex justify-center" id="loadingSpinner">
                    <div class="animate-spin rounded-full h-7 w-7 border-2 border-blue-200 border-t-blue-600"></div>
                </div>
            </div>
        </div>

        <!-- Debug Info -->
        <div id="debugInfo" class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-8 hidden">
            <h3 class="text-lg font-bold text-yellow-800 mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏µ‡∏ö‡∏±‡∏Å</h3>
            <pre id="debugContent" class="text-sm text-yellow-700 whitespace-pre-wrap"></pre>
        </div>

        <!-- Data Table -->
        <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-2xl overflow-hidden border border-white/20">
            <div class="overflow-x-auto">
                <table class="w-full" id="dataTable">
                    <thead class="bg-gradient-to-r from-slate-800 via-blue-800 to-indigo-800">
                        <tr>
                            <th class="px-4 py-4 text-left text-sm font-bold text-white tracking-wide">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                            <th class="px-3 py-4 text-center text-xs font-bold text-white">‡∏°.‡∏Ñ.</th>
                            <th class="px-3 py-4 text-center text-xs font-bold text-white">‡∏Å.‡∏û.</th>
                            <th class="px-3 py-4 text-center text-xs font-bold text-white">‡∏°‡∏µ.‡∏Ñ.</th>
                            <th class="px-3 py-4 text-center text-xs font-bold text-white">‡πÄ‡∏°.‡∏¢.</th>
                            <th class="px-3 py-4 text-center text-xs font-bold text-white">‡∏û.‡∏Ñ.</th>
                            <th class="px-3 py-4 text-center text-xs font-bold text-white">‡∏°‡∏¥.‡∏¢.</th>
                            <th class="px-3 py-4 text-center text-xs font-bold text-white">‡∏Å.‡∏Ñ.</th>
                            <th class="px-3 py-4 text-center text-xs font-bold text-white">‡∏™.‡∏Ñ.</th>
                            <th class="px-3 py-4 text-center text-xs font-bold text-white">‡∏Å.‡∏¢.</th>
                            <th class="px-3 py-4 text-center text-xs font-bold text-white">‡∏ï.‡∏Ñ.</th>
                            <th class="px-3 py-4 text-center text-xs font-bold text-white">‡∏û.‡∏¢.</th>
                            <th class="px-3 py-4 text-center text-xs font-bold text-white">‡∏ò.‡∏Ñ.</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody" class="divide-y divide-gray-100">
                        <tr>
                            <td colspan="13" class="px-6 py-12 text-center text-gray-500">
                                <div class="flex flex-col items-center gap-3">
                                    <svg class="w-12 h-12 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 2 0 01-2 2z"></path>
                                    </svg>
                                    <p class="text-lg font-medium">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Card View Modal -->
        <div id="cardModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50 p-4">
            <div class="bg-gradient-to-br from-white via-blue-50 to-purple-50 rounded-2xl p-6 w-full max-w-md shadow-2xl max-h-90vh overflow-y-auto border border-white/20">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-gradient-to-br from-purple-500 via-pink-500 to-red-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg transform rotate-3 hover:rotate-0 transition-transform duration-300">
                        <span class="text-2xl">üè†</span>
                    </div>
                    <h3 class="text-xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2" id="cardTitle">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h3>
                    <p class="text-sm text-gray-600 font-medium" id="cardSubtitle"></p>
                </div>
                
                <div class="mb-6">
                    <div class="bg-gradient-to-br from-blue-100 via-purple-50 to-pink-100 rounded-2xl p-5 border border-purple-200 shadow-inner">
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div class="bg-white/70 rounded-xl p-3 backdrop-blur-sm">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-lg">üè°</span>
                                    <p class="text-gray-600 font-semibold text-xs">‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</p>
                                </div>
                                <p class="text-gray-900 font-bold text-lg" id="cardHouseNumber"></p>
                            </div>
                            <div class="bg-white/70 rounded-xl p-3 backdrop-blur-sm">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-lg">üõ£Ô∏è</span>
                                    <p class="text-gray-600 font-semibold text-xs">‡∏ã‡∏≠‡∏¢</p>
                                </div>
                                <p class="text-gray-900 font-bold" id="cardSoi"></p>
                            </div>
                            <div class="col-span-2 bg-white/70 rounded-xl p-3 backdrop-blur-sm">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-lg">üë§</span>
                                    <p class="text-gray-600 font-semibold text-xs">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</p>
                                </div>
                                <p class="text-gray-900 font-bold" id="cardName"></p>
                            </div>
                            <div class="col-span-2 bg-white/70 rounded-xl p-3 backdrop-blur-sm">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-lg">‚≠ê</span>
                                    <p class="text-gray-600 font-semibold text-xs">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>
                                </div>
                                <p class="text-gray-900 font-bold" id="cardStatus"></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <div class="flex items-center gap-2 mb-4">
                        <span class="text-xl">üí∞</span>
                        <h4 class="text-lg font-bold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h4>
                    </div>
                    <div class="grid grid-cols-3 gap-3" id="monthlyStatus">
                        <!-- Monthly status cards will be inserted here -->
                    </div>
                </div>

                <div class="flex justify-center">
                    <button id="closeCardBtn" class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-8 py-3 rounded-xl text-sm font-bold transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center gap-2">
                        <span>‚úñÔ∏è</span>
                        ‡∏õ‡∏¥‡∏î
                    </button>
                </div>
            </div>
        </div>

        <!-- Status Update Modal -->
        <div id="statusModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50 p-4">
            <div class="bg-white rounded-xl p-4 w-full max-w-sm shadow-2xl">
                <div class="text-center mb-4">
                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-3">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                    </div>
                    <h3 class="text-lg font-bold text-gray-800 mb-2">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</h3>
                </div>
                
                <div class="mb-4 space-y-2">
                    <div class="bg-gray-50 rounded-lg p-3">
                        <p class="text-gray-600 text-xs">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                        <p class="text-gray-800 font-semibold text-sm" id="modalRowInfo"></p>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-3">
                        <p class="text-gray-600 text-xs">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</p>
                        <p class="text-gray-800 font-semibold text-sm" id="modalMonthInfo"></p>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 font-semibold mb-2 text-sm">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà:</label>
                    <select id="statusSelect" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß">‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</option>
                        <option value="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢</option>
                        <option value="‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</option>
                        <option value="‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤">‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤</option>
                        <option value="‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö">‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö</option>
                    </select>
                </div>

                <div class="flex gap-3">
                    <button id="saveStatusBtn" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors duration-200">
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                    <button id="cancelStatusBtn" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors duration-200">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </div>
        </div>

        <!-- Messages -->
        <div id="successMessage" class="fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg hidden">
            <div class="flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span id="successText" class="font-medium text-sm">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</span>
            </div>
        </div>

        <div id="errorMessage" class="fixed top-4 right-4 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg hidden">
            <div class="flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
                <span id="errorText" class="font-medium text-sm">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!</span>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbxBtDb8KXZMbteNGZo73dBhEzGqtoLc5YtMY9LC2fP-lzsK4sUvfXkCrbeiYpwS9yAB/exec';
        let currentData = [];
        let currentEditCell = null;

        const months = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', 
                       '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];



        // Load data from Google Sheets
        async function loadData() {
            const loadingSpinner = document.getElementById('loadingSpinner');
            const loadDataBtn = document.getElementById('loadDataBtn');
            
            try {
                loadingSpinner.classList.add('show');
                loadDataBtn.disabled = true;
                
                const response = await fetch(`${API_URL}?action=getData`);
                const responseText = await response.text();
                
                console.log('Load data response:', responseText);
                
                const data = JSON.parse(responseText);
                
                if (data.success) {
                    currentData = data.data;
                    renderTable(currentData);
                    showMessage('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                } else {
                    throw new Error(data.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                }
            } catch (error) {
                console.error('Error loading data:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message, 'error');
            } finally {
                loadingSpinner.classList.remove('show');
                loadDataBtn.disabled = false;
            }
        }

        // Render table with data
        function renderTable(data) {
            const tableBody = document.getElementById('tableBody');
            
            if (!data || data.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="13" class="px-4 py-8 text-center text-gray-500">
                            ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </td>
                    </tr>
                `;
                return;
            }

            tableBody.innerHTML = data.map((row, index) => {
                const firstName = row['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•'] ? row['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•'].split(' ')[0] : '';
                const fullName = row['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•'] || '';
                
                const shortName = fullName.length > 15 ? fullName.substring(0, 15) + '...' : fullName;
                
                return `
                <tr class="hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 fade-in transition-all duration-300 border-b border-gray-100 cursor-pointer group" onclick="openCardModal(${index})">
                    <td class="px-4 py-4 text-sm">
                        <div class="space-y-3">
                            <div class="flex items-center justify-between gap-2">
                                <div class="flex items-center gap-2">
                                    <span class="text-lg">üè†</span>
                                    <div class="font-bold text-gray-900 text-lg tracking-tight">${row.‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà || ''}</div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-sm">üë§</span>
                                    <div class="font-semibold text-gray-800 text-sm" id="name-display-${index}" title="${fullName}">
                                        ${shortName}
                                    </div>
                                    ${fullName.length > 15 ? `<button onclick="event.stopPropagation(); toggleFullName(${index}, '${fullName.replace(/'/g, "\\'")}', '${shortName.replace(/'/g, "\\'")}', this)" class="text-blue-500 hover:text-blue-700 text-xs font-bold px-1 py-0.5 rounded hover:bg-blue-100 transition-colors" id="toggle-btn-${index}">...</button>` : ''}
                                </div>
                            </div>
                            <div class="flex items-center justify-between gap-2">
                                <div class="flex items-center gap-2">
                                    <span class="text-sm">üõ£Ô∏è</span>
                                    <div class="text-gray-600 text-sm font-medium">${row.‡∏ã‡∏≠‡∏¢ || ''}</div>
                                </div>
                                <div class="flex items-center gap-1">
                                    <span class="text-xs">‚≠ê</span>
                                    <div class="text-xs px-2 py-1 rounded-full ${getStatusColor(row.‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ || '‡∏õ‡∏Å‡∏ï‡∏¥')} font-semibold shadow-sm">
                                        ${row.‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ || '‡∏õ‡∏Å‡∏ï‡∏¥'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                    ${months.map(month => `
                        <td class="px-3 py-4 text-xs text-center">
                            <span class="status-badge inline-block px-3 py-2 rounded-xl text-xs font-bold cursor-pointer ${getStatusColor(row[month])} shadow-md hover:shadow-lg transition-all duration-300 transform hover:scale-110 group-hover:scale-105" 
                                  onclick="event.stopPropagation(); openStatusModal(${index}, '${month}', '${row[month] || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢'}')">
                                ${row[month] || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢'}
                            </span>
                        </td>
                    `).join('')}
                </tr>
            `;
            }).join('');
        }

        // Get status color classes
        function getStatusColor(status) {
            switch(status) {
                case '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß': return 'bg-gradient-to-br from-emerald-500 to-green-600 text-white hover:from-emerald-600 hover:to-green-700 border border-emerald-400';
                case '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢': return 'bg-gradient-to-br from-red-500 to-rose-600 text-white hover:from-red-600 hover:to-rose-700 border border-red-400';
                case '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': return 'bg-gradient-to-br from-amber-500 to-orange-600 text-white hover:from-amber-600 hover:to-orange-700 border border-amber-400';
                case '‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤': return 'bg-gradient-to-br from-blue-500 to-indigo-600 text-white hover:from-blue-600 hover:to-indigo-700 border border-blue-400';
                case '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö': return 'bg-gradient-to-br from-slate-500 to-gray-600 text-white hover:from-slate-600 hover:to-gray-700 border border-slate-400';
                case '‡∏õ‡∏Å‡∏ï‡∏¥': return 'bg-gradient-to-br from-blue-100 to-indigo-200 text-blue-900 border border-blue-300 hover:from-blue-200 hover:to-indigo-300';
                case '‡∏û‡∏¥‡πÄ‡∏®‡∏©': return 'bg-gradient-to-br from-purple-100 to-pink-200 text-purple-900 border border-purple-300 hover:from-purple-200 hover:to-pink-300';
                default: return 'bg-gradient-to-br from-gray-100 to-slate-200 text-gray-800 border border-gray-300 hover:from-gray-200 hover:to-slate-300';
            }
        }

        // Get status emoji
        function getStatusEmoji(status) {
            switch(status) {
                case '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß': return '‚úÖ';
                case '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢': return '‚ùå';
                case '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': return '‚è≥';
                case '‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤': return '‚¨ÜÔ∏è';
                case '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö': return 'üö´';
                default: return '‚ùå';
            }
        }

        // Get short status text for mobile
        function getStatusShort(status) {
            switch(status) {
                case '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß': return '‚úì';
                case '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢': return '‚úó';
                case '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': return '?';
                case '‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤': return '‚Üë';
                case '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö': return '-';
                default: return '‚úó';
            }
        }

        // Toggle full name display
        function toggleFullName(index, fullName, shortName, button) {
            const nameElement = document.getElementById(`name-display-${index}`);
            
            if (nameElement.textContent.includes('...')) {
                nameElement.textContent = fullName;
                button.textContent = '‚Üê';
                button.title = '‡∏¢‡πà‡∏≠‡∏ä‡∏∑‡πà‡∏≠';
            } else {
                nameElement.textContent = shortName;
                button.textContent = '...';
                button.title = '‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°';
            }
        }

        // Open card view modal
        function openCardModal(rowIndex) {
            const modal = document.getElementById('cardModal');
            const row = currentData[rowIndex];
            
            document.getElementById('cardTitle').textContent = `‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${row.‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà}`;
            document.getElementById('cardSubtitle').textContent = `${row['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•']}`;
            document.getElementById('cardHouseNumber').textContent = row.‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà || '-';
            document.getElementById('cardSoi').textContent = row.‡∏ã‡∏≠‡∏¢ || '-';
            document.getElementById('cardName').textContent = row['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•'] || '-';
            document.getElementById('cardStatus').textContent = row.‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ || '-';
            
            // Generate monthly status cards
            const monthlyStatusContainer = document.getElementById('monthlyStatus');
            const monthNames = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
            
            monthlyStatusContainer.innerHTML = months.map((month, index) => {
                const status = row[month] || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢';
                return `
                    <div class="bg-gradient-to-br from-white to-gray-50 rounded-xl p-3 text-center border-2 border-gray-200 hover:border-purple-300 hover:shadow-lg transition-all duration-300 cursor-pointer transform hover:scale-105" 
                         onclick="closeCardModal(); openStatusModal(${rowIndex}, '${month}', '${status}')">
                        <p class="text-xs font-bold text-gray-700 mb-2">${monthNames[index]}</p>
                        <div class="inline-block px-2 py-1 rounded-lg text-xs font-bold ${getStatusColor(status)} shadow-sm">
                            ${status}
                        </div>
                    </div>
                `;
            }).join('');
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        // Close card modal
        function closeCardModal() {
            const modal = document.getElementById('cardModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // Open status update modal
        function openStatusModal(rowIndex, month, currentStatus) {
            const modal = document.getElementById('statusModal');
            const row = currentData[rowIndex];
            
            document.getElementById('modalRowInfo').textContent = `${row.‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà} - ${row['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•']}`;
            document.getElementById('modalMonthInfo').textContent = month;
            document.getElementById('statusSelect').value = currentStatus;
            
            currentEditCell = { rowIndex, month, currentStatus };
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        // Close modal
        function closeModal() {
            const modal = document.getElementById('statusModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            currentEditCell = null;
        }

        // Save status update
        async function saveStatus() {
            if (!currentEditCell) return;
            
            const saveBtn = document.getElementById('saveStatusBtn');
            const originalText = saveBtn.textContent;
            
            try {
                // Show loading state
                saveBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
                saveBtn.disabled = true;
                
                const newStatus = document.getElementById('statusSelect').value;
                const { rowIndex, month } = currentEditCell;
                const row = currentData[rowIndex];
                
                // Try GET method first (Google Apps Script sometimes has issues with POST)
                const updateParams = new URLSearchParams({
                    action: 'updateStatus',
                    rowId: row.‡∏•‡∏≥‡∏î‡∏±‡∏ö,
                    month: month,
                    status: newStatus
                });

                console.log('Sending update data via GET:', updateParams.toString());

                let response;
                let result;
                
                try {
                    // Method 1: Try GET request
                    response = await fetch(`${API_URL}?${updateParams.toString()}`, {
                        method: 'GET',
                        mode: 'cors'
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const responseText = await response.text();
                    console.log('GET response:', responseText);
                    
                    result = JSON.parse(responseText);
                    
                } catch (getError) {
                    console.log('GET method failed, trying POST:', getError.message);
                    
                    // Method 2: Try POST with form data
                    const formData = new FormData();
                    formData.append('action', 'updateStatus');
                    formData.append('rowId', row.‡∏•‡∏≥‡∏î‡∏±‡∏ö);
                    formData.append('month', month);
                    formData.append('status', newStatus);
                    
                    try {
                        response = await fetch(API_URL, {
                            method: 'POST',
                            mode: 'cors',
                            body: formData
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        
                        const responseText = await response.text();
                        console.log('POST FormData response:', responseText);
                        
                        result = JSON.parse(responseText);
                        
                    } catch (postError) {
                        console.log('POST FormData failed, trying POST JSON:', postError.message);
                        
                        // Method 3: Try POST with JSON (original method)
                        const updateData = {
                            action: 'updateStatus',
                            rowId: row.‡∏•‡∏≥‡∏î‡∏±‡∏ö,
                            month: month,
                            status: newStatus
                        };
                        
                        response = await fetch(API_URL, {
                            method: 'POST',
                            mode: 'cors',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(updateData)
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        
                        const responseText = await response.text();
                        console.log('POST JSON response:', responseText);
                        
                        result = JSON.parse(responseText);
                    }
                }


                
                console.log('Final result:', result);
                
                if (result && result.success) {
                    // Update local data
                    currentData[rowIndex][month] = newStatus;
                    renderTable(currentData);
                    closeModal();
                    showMessage('‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                } else {
                    throw new Error(result?.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                }
            } catch (error) {
                console.error('Error updating status:', error);
                
                let errorMessage = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ';
                
                if (error.message.includes('Failed to fetch')) {
                    errorMessage += '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï';
                } else if (error.message.includes('CORS')) {
                    errorMessage += '‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≤‡∏°‡πÇ‡∏î‡πÄ‡∏°‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Apps Script';
                } else {
                    errorMessage += error.message;
                }
                
                showMessage(errorMessage, 'error');
            } finally {
                // Reset button state
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
            }
        }

        // Show message
        function showMessage(text, type = 'info') {
            if (type === 'success') {
                const message = document.getElementById('successMessage');
                document.getElementById('successText').textContent = text;
                message.classList.remove('hidden');
                setTimeout(() => message.classList.add('hidden'), 3000);
            } else if (type === 'error') {
                const message = document.getElementById('errorMessage');
                document.getElementById('errorText').textContent = text;
                message.classList.remove('hidden');
                setTimeout(() => message.classList.add('hidden'), 5000);
            }
        }

        // Search functionality
        function filterData() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            
            if (!searchTerm) {
                renderTable(currentData);
                return;
            }
            
            const filteredData = currentData.filter(row => {
                // If search term contains numbers or slash, do exact house number match
                if (/[\d\/]/.test(searchTerm)) {
                    return row.‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà && row.‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà.toLowerCase() === searchTerm.toLowerCase();
                }
                // Otherwise search in names and soi
                const lowerSearchTerm = searchTerm.toLowerCase();
                return (row.‡∏ã‡∏≠‡∏¢ && row.‡∏ã‡∏≠‡∏¢.toLowerCase().includes(lowerSearchTerm)) ||
                       (row['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•'] && row['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•'].toLowerCase().includes(lowerSearchTerm));
            });
            renderTable(filteredData);
        }

        // Event listeners
        document.getElementById('loadDataBtn').addEventListener('click', loadData);
        document.getElementById('saveStatusBtn').addEventListener('click', saveStatus);
        document.getElementById('cancelStatusBtn').addEventListener('click', closeModal);
        document.getElementById('closeCardBtn').addEventListener('click', closeCardModal);
        document.getElementById('searchInput').addEventListener('input', filterData);

        // Close modal when clicking outside
        document.getElementById('statusModal').addEventListener('click', (e) => {
            if (e.target.id === 'statusModal') {
                closeModal();
            }
        });

        document.getElementById('cardModal').addEventListener('click', (e) => {
            if (e.target.id === 'cardModal') {
                closeCardModal();
            }
        });

        // Load data on page load
        window.addEventListener('load', loadData);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'987d4c2313eb7b5a',t:'MTc1OTMzNTczMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
