<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .status-paid { background: linear-gradient(135deg, #10b981, #059669); }
        .status-advance { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .status-not-collect { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .status-overdue { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .status-pending { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .status-notice-sent { background: linear-gradient(135deg, #f97316, #ea580c); }
        .status-notice-pending { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .loading-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <div class="bg-white shadow-lg border-b-4 border-blue-500">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <h1 class="text-3xl font-bold text-gray-800 text-center">üè† ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ</h1>
            <p class="text-gray-600 text-center mt-2">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢‡∏î‡∏≤‡∏¢</p>
        </div>
    </div>

    <!-- Search Section -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <div class="bg-white rounded-2xl shadow-xl p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="lg:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">üè† ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</label>
                    <input type="text" id="searchInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ‡πÄ‡∏ä‡πà‡∏ô 99/1, 123/45..." 
                           class="w-full px-4 py-3 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-blue-50">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">üìÖ ‡∏õ‡∏µ</label>
                    <select id="yearFilter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</option>
                        <option value="2567">2567</option>
                        <option value="2568">2568</option>
                        <option value="2569">2569</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
                    <select id="statusFilter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        <option value="‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß">‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</option>
                        <option value="‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤">‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤</option>
                        <option value="‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö">‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö</option>
                        <option value="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢</option>
                        <option value="‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</option>
                        <option value="‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß">‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option>
                        <option value="‡∏£‡∏≠‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">‡∏£‡∏≠‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</option>
                    </select>
                </div>
            </div>
            <div class="mt-4">
                <button onclick="loadData()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-colors">
                    üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                </button>
            </div>
        </div>

        <!-- Loading -->
        <div id="loading" class="hidden text-center py-12">
            <div class="loading-spinner w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full mx-auto mb-4"></div>
            <p class="text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>

        <!-- Year Sections -->
        <div id="yearSections"></div>
        
        <!-- Results -->
        <div id="results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

        <!-- No Results -->
        <div id="noResults" class="hidden text-center py-12">
            <div class="text-6xl mb-4">üîç</div>
            <h3 class="text-xl font-semibold text-gray-700 mb-2">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h3>
            <p class="text-gray-500">‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</p>
        </div>
    </div>

    <script>
        let allData = [];
        const months = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', 
                       '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏õ‡∏¢‡∏±‡∏á Telegram
        async function sendSearchNotification(houseNumber) {
            try {
                const timestamp = new Date().toLocaleString('th-TH', {
                    timeZone: 'Asia/Bangkok',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });

                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Telegram Bot
                const telegramToken = '7708637309:AAHU2swP8U67XVWITdjsxjQoqiXIL9KbBJs';
                const chatId = '7585120244';

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                const message = `üîç ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ
                
üè† ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: ${houseNumber}
‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤: ${timestamp}
üì± ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: ${navigator.platform}
üåê ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå: ${navigator.userAgent.split(' ')[0]}

#‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• #‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ`;

                // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á Telegram
                const telegramUrl = `https://api.telegram.org/bot${telegramToken}/sendMessage`;
                
                fetch(telegramUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: message,
                        parse_mode: 'HTML'
                    })
                }).catch(error => {
                    // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á error ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡πá‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    console.log('Telegram notification sent silently');
                });

                // Log ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô localStorage ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
                const searchLog = JSON.parse(localStorage.getItem('searchLog') || '[]');
                searchLog.push({
                    houseNumber: houseNumber,
                    timestamp: timestamp
                });
                
                // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ 50 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                if (searchLog.length > 50) {
                    searchLog.splice(0, searchLog.length - 50);
                }
                
                localStorage.setItem('searchLog', JSON.stringify(searchLog));

            } catch (error) {
                // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á error ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡πá‡∏ô
                console.log('Search logged locally');
            }
        }

        // Load data from Google Sheets
        async function loadData() {
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const noResults = document.getElementById('noResults');
            const searchInput = document.getElementById('searchInput').value.trim();
            
            // ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô
            if (searchInput) {
                await sendSearchNotification(searchInput);
            }
            
            loading.classList.remove('hidden');
            results.innerHTML = '';
            noResults.classList.add('hidden');

            try {
                // Google Sheets CSV URL
                const sheetId = '1yklkO0OaVsZKpJc4EGcNDkpRsNd8DNWiJKlUnpBwBEE';
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv`;
                
                const response = await fetch(url);
                const csvText = await response.text();
                
                // Parse CSV data
                const rows = csvText.split('\n').map(row => {
                    const cols = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let i = 0; i < row.length; i++) {
                        const char = row[i];
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            cols.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    cols.push(current.trim());
                    return cols;
                });

                // Skip header row and process data
                allData = rows.slice(1).filter(row => row[0] && row[0].trim()).map(row => ({
                    id: row[0] || '',
                    houseNumber: row[1] || '',
                    soi: row[2] || '',
                    name: row[3] || '',
                    transferDate: row[4] || '',
                    status: row[5] || '',
                    dueMonth: row[6] || '',
                    year: row[7] || '',
                    months: months.reduce((acc, month, index) => {
                        acc[month] = row[8 + index] || '';
                        return acc;
                    }, {}),
                    noticeStatus: getNoticeStatus(row)
                }));

                displayResults(filterData());
            } catch (error) {
                console.error('Error loading data:', error);
                results.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                        <h3 class="text-xl font-semibold text-red-600 mb-2">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
                        <p class="text-gray-600">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                        <p class="text-sm text-gray-500 mt-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Google Sheets ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞</p>
                    </div>
                `;
            } finally {
                loading.classList.add('hidden');
            }
        }

        // Filter data based on search criteria
        function filterData() {
            const houseSearch = document.getElementById('searchInput').value.toLowerCase();
            const yearFilter = document.getElementById('yearFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            return allData.filter(item => {
                // Primary search by house number - exact match
                const matchesHouse = !houseSearch || 
                    item.houseNumber.toLowerCase() === houseSearch;

                // Filter by year
                const matchesYear = !yearFilter || item.year === yearFilter;

                // Filter by status
                const matchesStatus = !statusFilter || 
                    Object.values(item.months).some(status => status === statusFilter);

                return matchesHouse && matchesYear && matchesStatus;
            });
        }

        // Display results grouped by year
        function displayResults(data) {
            const yearSections = document.getElementById('yearSections');
            const results = document.getElementById('results');
            const noResults = document.getElementById('noResults');

            // Clear previous results
            yearSections.innerHTML = '';
            results.innerHTML = '';

            if (data.length === 0) {
                noResults.classList.remove('hidden');
                return;
            }

            noResults.classList.add('hidden');

            // Group data by year
            const groupedByYear = data.reduce((acc, item) => {
                const year = item.year || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏µ';
                if (!acc[year]) acc[year] = [];
                acc[year].push(item);
                return acc;
            }, {});

            // Sort years in descending order
            const sortedYears = Object.keys(groupedByYear).sort((a, b) => {
                if (a === '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏µ') return 1;
                if (b === '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏µ') return -1;
                return b.localeCompare(a);
            });

            // Display each year section
            sortedYears.forEach(year => {
                const yearData = groupedByYear[year];
                const yearColor = getYearColor(year);
                
                yearSections.innerHTML += `
                    <div class="mb-8">
                        <div class="flex items-center mb-6">
                            <div class="${yearColor} text-white px-6 py-3 rounded-full shadow-lg">
                                <h2 class="text-2xl font-bold">üìÖ ‡∏õ‡∏µ ${year}</h2>
                            </div>
                            <div class="ml-4 bg-white px-4 py-2 rounded-full shadow">
                                <span class="text-gray-600 font-medium">${yearData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${yearData.map(item => createCard(item)).join('')}
                        </div>
                    </div>
                `;
            });
        }

        // Create individual card
        function createCard(item) {
            const currentMonthStatus = getCurrentMonthStatus(item);
            const hasUnpaidMonth = checkForUnpaidMonths(item);
            const statusClass = hasUnpaidMonth ? 'status-overdue' : getStatusClass(currentMonthStatus);
            const statusIcon = getStatusIcon(currentMonthStatus);

            return `
                <div class="bg-white rounded-xl shadow-lg card-hover overflow-hidden border-l-4 border-blue-500">
                    <div class="${statusClass} text-white p-4">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-lg">${statusIcon} ${item.id}</h3>
                            <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm font-medium">
                                ${currentMonthStatus}
                            </span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm opacity-90">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</span>
                            <span class="bg-white bg-opacity-30 px-2 py-1 rounded text-xs font-medium">
                                ${getNoticeIcon(item.noticeStatus)} ${item.noticeStatus}
                            </span>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="space-y-3">
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">üè†</span>
                                <div>
                                    <p class="font-bold text-xl text-blue-600">${item.houseNumber}</p>
                                    <p class="text-sm text-gray-600">${item.soi}</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">üë§</span>
                                <div>
                                    <p class="font-semibold text-gray-800">${item.name}</p>
                                    <p class="text-sm text-gray-600">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">üìÖ</span>
                                <div>
                                    <p class="font-semibold text-gray-800">${item.transferDate}</p>
                                    <p class="text-sm text-gray-600">‡∏ß‡∏±‡∏ô‡πÇ‡∏≠‡∏ô</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">‚è∞</span>
                                <div>
                                    <p class="font-semibold text-gray-800">${item.dueMonth} ${item.year}</p>
                                    <p class="text-sm text-gray-600">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 pt-4 border-t border-gray-200">
                            <h4 class="font-semibold text-gray-800 mb-3">üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${item.year}</h4>
                            <div class="grid grid-cols-3 gap-2 text-xs">
                                ${months.map(month => {
                                    const status = item.months[month] || '-';
                                    const statusColor = getStatusColor(status);
                                    const shortMonth = getShortMonth(month);
                                    return `
                                        <div class="text-center p-2 rounded ${statusColor}">
                                            <div class="font-medium">${shortMonth}</div>
                                            <div class="text-xs mt-1">${status}</div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Helper functions
        function getNoticeStatus(row) {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß
            const monthStatuses = months.map((month, index) => row[8 + index] || '');
            const unpaidCount = monthStatuses.filter(status => 
                status === '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢' || status === '' || status === '-'
            ).length;
            
            if (unpaidCount >= 6) {
                return '‡πÅ‡∏à‡πâ‡∏á‡∏≠‡∏≤‡∏¢‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô';
            } else if (unpaidCount >= 4) {
                return '‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô - ‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
            } else if (unpaidCount >= 2) {
                return '‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô - ‡∏£‡∏≠‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô';
            } else if (unpaidCount >= 1) {
                return '‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞ 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô';
            }
            return '‡∏õ‡∏Å‡∏ï‡∏¥';
        }

        function getCurrentMonthStatus(item) {
            const currentMonth = new Date().getMonth();
            const currentMonthName = months[currentMonth];
            return item.months[currentMonthName] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
        }

        function checkForUnpaidMonths(item) {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÑ‡∏´‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            return Object.values(item.months).some(status => 
                status === '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢' || status === '' || status === '-'
            );
        }

        function getStatusClass(status) {
            switch (status) {
                case '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß': return 'status-paid';
                case '‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤': return 'status-advance';
                case '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö': return 'status-not-collect';
                case '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢': return 'status-overdue';
                case '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': return 'status-pending';
                case '‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß': return 'status-notice-sent';
                case '‡∏£‡∏≠‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô': return 'status-notice-pending';
                default: return 'status-overdue';
            }
        }

        function getStatusIcon(status) {
            switch (status) {
                case '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß': return '‚úÖ';
                case '‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤': return '‚≠ê';
                case '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö': return 'üö´';
                case '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢': return '‚ùå';
                case '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': return '‚è≥';
                case '‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß': return 'üìÆ';
                case '‡∏£‡∏≠‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô': return 'üìã';
                default: return '‚ùì';
            }
        }

        function getNoticeIcon(noticeStatus) {
            switch (noticeStatus) {
                case '‡πÅ‡∏à‡πâ‡∏á‡∏≠‡∏≤‡∏¢‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô': return 'üö®';
                case '‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô - ‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß': return 'üìÆ';
                case '‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô - ‡∏£‡∏≠‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô': return '‚è∞';
                case '‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞ 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô': return '‚ö†Ô∏è';
                case '‡∏õ‡∏Å‡∏ï‡∏¥': return '‚úÖ';
                default: return 'üìã';
            }
        }

        function getStatusColor(status) {
            switch (status) {
                case '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß': return 'bg-green-100 text-green-800';
                case '‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤': return 'bg-blue-100 text-blue-800';
                case '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö': return 'bg-purple-100 text-purple-800';
                case '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢': return 'bg-red-100 text-red-800';
                case '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': return 'bg-yellow-100 text-yellow-800';
                case '‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß': return 'bg-orange-100 text-orange-800';
                case '‡∏£‡∏≠‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô': return 'bg-cyan-100 text-cyan-800';
                default: return 'bg-gray-100 text-gray-600';
            }
        }

        function getYearColor(year) {
            switch (year) {
                case '2567': return 'bg-gradient-to-r from-blue-600 to-blue-700';
                case '2568': return 'bg-gradient-to-r from-green-600 to-green-700';
                case '2569': return 'bg-gradient-to-r from-purple-600 to-purple-700';
                default: return 'bg-gradient-to-r from-gray-600 to-gray-700';
            }
        }

        function getShortMonth(month) {
            const shortMonths = {
                '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°': '‡∏°.‡∏Ñ.',
                '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå': '‡∏Å.‡∏û.',
                '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°': '‡∏°‡∏µ.‡∏Ñ.',
                '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô': '‡πÄ‡∏°.‡∏¢.',
                '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°': '‡∏û.‡∏Ñ.',
                '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô': '‡∏°‡∏¥.‡∏¢.',
                '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°': '‡∏Å.‡∏Ñ.',
                '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°': '‡∏™.‡∏Ñ.',
                '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô': '‡∏Å.‡∏¢.',
                '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°': '‡∏ï.‡∏Ñ.',
                '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô': '‡∏û.‡∏¢.',
                '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°': '‡∏ò.‡∏Ñ.'
            };
            return shortMonths[month] || month.substring(0, 3);
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', () => {
            if (allData.length > 0) {
                displayResults(filterData());
            }
        });

        document.getElementById('yearFilter').addEventListener('change', () => {
            if (allData.length > 0) {
                displayResults(filterData());
            }
        });

        document.getElementById('statusFilter').addEventListener('change', () => {
            if (allData.length > 0) {
                displayResults(filterData());
            }
        });

        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                loadData();
            }
        });

        // Load data on page load
        window.addEventListener('load', loadData);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9714029b007fee52',t:'MTc1NTU0NzM2MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
