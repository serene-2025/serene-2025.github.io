
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .status-paid { background: linear-gradient(135deg, #10b981, #059669); }
        .status-advance { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .status-not-collect { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .status-overdue { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .status-pending { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .status-notice-sent { background: linear-gradient(135deg, #f97316, #ea580c); }
        .status-notice-pending { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .status-warning { background: linear-gradient(135deg, #fbbf24, #f59e0b); }
        .loading-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .chart-container { position: relative; height: 400px; }
        .tab-active { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; }
        .tab-inactive { background: #f3f4f6; color: #6b7280; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <div class="bg-white shadow-lg border-b-4 border-blue-500">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <h1 class="text-3xl font-bold text-gray-800 text-center">üè† ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ</h1>
            <p class="text-gray-600 text-center mt-2">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢‡∏î‡∏≤‡∏¢</p>
            
            <!-- Navigation Buttons -->
            <div class="flex justify-center mt-6 space-x-4">
                <button id="searchPageBtn" onclick="showSearchPage()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-colors shadow-lg">
                    üîç ‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                </button>
                <button id="summaryPageBtn" onclick="showSummaryPage()" class="bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-6 rounded-lg transition-colors shadow-lg">
                    üìä ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
        </div>
    </div>

    <!-- Search Page -->
    <div id="searchPage" class="max-w-7xl mx-auto px-4 py-8">
        <div class="bg-white rounded-2xl shadow-xl p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="lg:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">üè† ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</label>
                    <input type="text" id="searchInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ‡πÄ‡∏ä‡πà‡∏ô 998/5" 
                           class="w-full px-4 py-3 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-blue-50">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">üìÖ ‡∏õ‡∏µ</label>
                    <select id="yearFilter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</option>
                        <option value="2567">2567</option>
                        <option value="2568">2568</option>
                        <option value="2569">2569</option>
                        <option value="2570">2570</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
                    <select id="statusFilter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        <option value="‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß">‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</option>
                        <option value="‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤">‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤</option>
                        <option value="‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö">‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö</option>
                        <option value="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢</option>
                        <option value="‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</option>
                        <option value="‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß">‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option>
                        <option value="‡∏£‡∏≠‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">‡∏£‡∏≠‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</option>
                    </select>
                </div>
            </div>
            <div class="mt-4">
                <button onclick="loadData()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-colors">
                    üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                </button>
            </div>
        </div>

        <!-- Loading -->
        <div id="loading" class="hidden text-center py-12">
            <div class="loading-spinner w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full mx-auto mb-4"></div>
            <p class="text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>

        <!-- Year Sections -->
        <div id="yearSections"></div>
        
        <!-- Results -->
        <div id="results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

        <!-- No Results -->
        <div id="noResults" class="hidden text-center py-12">
            <div class="text-6xl mb-4">üîç</div>
            <h3 class="text-xl font-semibold text-gray-700 mb-2">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h3>
            <p class="text-gray-500">‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</p>
        </div>
    </div>

    <!-- Summary Page -->
    <div id="summaryPage" class="hidden max-w-7xl mx-auto px-4 py-8">
        <!-- Year Filter for Summary -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex items-center justify-between">
                <h3 class="text-xl font-bold text-gray-800">üìä ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ</h3>
                <select id="summaryYearFilter" onchange="generateSummary()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</option>
                    <option value="2567">‡∏õ‡∏µ 2567</option>
                    <option value="2568">‡∏õ‡∏µ 2568</option>
                    <option value="2569">‡∏õ‡∏µ 2569</option>
                    <option value="2570">‡∏õ‡∏µ 2570</option>
                </select>
            </div>
        </div>
        
        <!-- Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-gradient-to-br from-red-500 to-red-600 text-white rounded-xl p-6 shadow-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold mb-2">‚ùå ‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞</h3>
                        <p class="text-3xl font-bold" id="overdueCount">0</p>
                        <p class="text-sm opacity-90">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                    </div>
                    <div class="text-4xl opacity-80">üö®</div>
                </div>
                <div class="mt-4 pt-4 border-t border-red-400">
                    <p class="text-sm">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á: <span class="font-bold" id="overdueAmount">0</span> ‡∏ö‡∏≤‡∏ó</p>
                </div>
            </div>

            <div class="bg-gradient-to-br from-yellow-500 to-yellow-600 text-white rounded-xl p-6 shadow-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold mb-2">‚è≥ ‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                        <p class="text-3xl font-bold" id="warningCount">0</p>
                        <p class="text-sm opacity-90">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                    </div>
                    <div class="text-4xl opacity-80">üìã</div>
                </div>
                <div class="mt-4 pt-4 border-t border-yellow-400">
                    <p class="text-sm">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô: <span class="font-bold" id="warningAmount">0</span> ‡∏ö‡∏≤‡∏ó</p>
                </div>
            </div>

            <div class="bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl p-6 shadow-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold mb-2">‚úÖ ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</h3>
                        <p class="text-3xl font-bold" id="paidCount">0</p>
                        <p class="text-sm opacity-90">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                    </div>
                    <div class="text-4xl opacity-80">üí∞</div>
                </div>
                <div class="mt-4 pt-4 border-t border-green-400">
                    <p class="text-sm">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô: <span class="font-bold" id="paidAmount">0</span> ‡∏ö‡∏≤‡∏ó</p>
                </div>
            </div>

            <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl p-6 shadow-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold mb-2">üìä ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                        <p class="text-3xl font-bold" id="totalCount">0</p>
                        <p class="text-sm opacity-90">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                    </div>
                    <div class="text-4xl opacity-80">üè†</div>
                </div>
                <div class="mt-4 pt-4 border-t border-blue-400">
                    <p class="text-sm">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <span class="font-bold" id="totalAmount">0</span> ‡∏ö‡∏≤‡∏ó</p>
                </div>
            </div>
        </div>

        <!-- Collection Performance Chart -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">üìà ‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</h3>
                <div class="flex space-x-2">
                    <button id="monthlyViewBtn" onclick="switchChartView('monthly')" class="tab-active px-4 py-2 rounded-lg font-medium transition-all">
                        üìÖ ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                    </button>
                    <button id="yearlyViewBtn" onclick="switchChartView('yearly')" class="tab-inactive px-4 py-2 rounded-lg font-medium transition-all">
                        üìä ‡∏£‡∏≤‡∏¢‡∏õ‡∏µ
                    </button>
                </div>
            </div>
            
            <!-- Chart Container -->
            <div class="chart-container">
                <canvas id="collectionChart"></canvas>
            </div>
            
            <!-- Chart Legend -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-green-500 rounded mr-2"></div>
                    <span class="text-sm text-gray-700">‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ (‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß + ‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤)</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-red-500 rounded mr-2"></div>
                    <span class="text-sm text-gray-700">‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢)</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-purple-500 rounded mr-2"></div>
                    <span class="text-sm text-gray-700">‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-yellow-500 rounded mr-2"></div>
                    <span class="text-sm text-gray-700">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Status Chart -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-6">üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞</h3>
                <div id="statusChart" class="space-y-4"></div>
            </div>

            <!-- Monthly Chart -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-6">üìÖ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
                <div id="monthlyChart" class="space-y-3"></div>
            </div>
        </div>

        <!-- Performance Summary -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h3 class="text-xl font-bold text-gray-800 mb-6">üéØ ‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center p-4 bg-green-50 rounded-lg">
                    <div class="text-3xl font-bold text-green-600" id="collectionRate">0%</div>
                    <div class="text-sm text-gray-600 mt-1">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ</div>
                </div>
                <div class="text-center p-4 bg-red-50 rounded-lg">
                    <div class="text-3xl font-bold text-red-600" id="uncollectedRate">0%</div>
                    <div class="text-sm text-gray-600 mt-1">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</div>
                </div>
                <div class="text-center p-4 bg-blue-50 rounded-lg">
                    <div class="text-3xl font-bold text-blue-600" id="averageCollection">0</div>
                    <div class="text-sm text-gray-600 mt-1">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                </div>
            </div>
        </div>

        <!-- Overdue List -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">üö® ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞</h3>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <label class="text-sm text-gray-600">‡∏õ‡∏µ:</label>
                        <select id="overdueYearFilter" onchange="generateSummary()" class="px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</option>
                            <option value="2567">2567</option>
                            <option value="2568">2568</option>
                            <option value="2569">2569</option>
                            <option value="2570">2570</option>
                        </select>
                    </div>
                    <label class="flex items-center">
                        <input type="checkbox" id="showAllOverdue" onchange="generateSummary()" class="mr-2">
                        <span class="text-sm text-gray-600">‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                    </label>
                    <span id="overdueTotal" class="text-sm text-gray-500"></span>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="bg-gray-50 border-b">
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</th>
                        </tr>
                    </thead>
                    <tbody id="overdueTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <div class="flex items-center justify-center mb-2">
                <span class="text-2xl mr-2">¬©</span>
                <span class="font-medium">2025 9one. All rights reserved.</span>
            </div>
            <p class="text-gray-400 text-sm">‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ</p>
        </div>
    </footer>

    <script>
        let allData = [];
        let collectionChart = null;
        let currentChartView = 'monthly';
        const months = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', 
                       '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏õ‡∏¢‡∏±‡∏á Telegram
        async function sendSearchNotification(houseNumber) {
            try {
                const timestamp = new Date().toLocaleString('th-TH', {
                    timeZone: 'Asia/Bangkok',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });

                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Telegram Bot
                const telegramToken = '7708637309:AAHU2swP8U67XVWITdjsxjQoqiXIL9KbBJs';
                const chatId = '7585120244';

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                const message = `üîç ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ
                
üè† ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: ${houseNumber}
‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤: ${timestamp}
üì± ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: ${navigator.platform}
üåê ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå: ${navigator.userAgent.split(' ')[0]}

#‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• #‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ`;

                // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á Telegram
                const telegramUrl = `https://api.telegram.org/bot${telegramToken}/sendMessage`;
                
                fetch(telegramUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: message,
                        parse_mode: 'HTML'
                    })
                }).catch(error => {
                    // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á error ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡πá‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    console.log('Telegram notification sent silently');
                });

                // Log ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô localStorage ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
                const searchLog = JSON.parse(localStorage.getItem('searchLog') || '[]');
                searchLog.push({
                    houseNumber: houseNumber,
                    timestamp: timestamp
                });
                
                // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ 50 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                if (searchLog.length > 50) {
                    searchLog.splice(0, searchLog.length - 50);
                }
                
                localStorage.setItem('searchLog', JSON.stringify(searchLog));

            } catch (error) {
                // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á error ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡πá‡∏ô
                console.log('Search logged locally');
            }
        }

        // Load data from Google Sheets
        async function loadData(silentRefresh = false) {
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const noResults = document.getElementById('noResults');
            const searchInput = document.getElementById('searchInput').value.trim();
            
            // ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà silent refresh)
            if (searchInput && !silentRefresh) {
                await sendSearchNotification(searchInput);
            }
            
            if (!silentRefresh) {
                loading.classList.remove('hidden');
                results.innerHTML = '';
                noResults.classList.add('hidden');
            }

            try {
                // Google Sheets CSV URL
                const sheetId = '1yklkO0OaVsZKpJc4EGcNDkpRsNd8DNWiJKlUnpBwBEE';
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv`;
                
                const response = await fetch(url);
                const csvText = await response.text();
                
                // Parse CSV data
                const rows = csvText.split('\n').map(row => {
                    const cols = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let i = 0; i < row.length; i++) {
                        const char = row[i];
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            cols.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    cols.push(current.trim());
                    return cols;
                });

                // Skip header row and process data, filter out nodata entries
                allData = rows.slice(1)
                    .filter(row => row[0] && row[0].trim() && row[0].toLowerCase() !== 'nodata')
                    .map(row => ({
                    id: row[0] || '',
                    houseNumber: row[1] || '',
                    soi: row[2] || '',
                    name: row[3] || '',
                    transferDate: row[4] || '',
                    status: row[5] || '',
                    dueMonth: row[6] || '',
                    year: row[7] || '',
                    months: months.reduce((acc, month, index) => {
                        acc[month] = row[8 + index] || '';
                        return acc;
                    }, {}),
                    noticeStatus: getNoticeStatus(row)
                }));

                displayResults(filterData());
                
                // Update summary if on summary page
                if (!document.getElementById('summaryPage').classList.contains('hidden')) {
                    generateSummary();
                }
            } catch (error) {
                console.error('Error loading data:', error);
                if (!silentRefresh) {
                    results.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                            <h3 class="text-xl font-semibold text-red-600 mb-2">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
                            <p class="text-gray-600">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                            <p class="text-sm text-gray-500 mt-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Google Sheets ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞</p>
                        </div>
                    `;
                }
            } finally {
                if (!silentRefresh) {
                    loading.classList.add('hidden');
                }
            }
        }

        // Filter data based on search criteria
        function filterData() {
            const houseSearch = document.getElementById('searchInput').value.toLowerCase();
            const yearFilter = document.getElementById('yearFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            return allData.filter(item => {
                // Primary search by house number - exact match
                const matchesHouse = !houseSearch || 
                    item.houseNumber.toLowerCase() === houseSearch;

                // Filter by year
                const matchesYear = !yearFilter || item.year === yearFilter;

                // Filter by status
                const matchesStatus = !statusFilter || 
                    Object.values(item.months).some(status => status === statusFilter);

                return matchesHouse && matchesYear && matchesStatus;
            });
        }

        // Display results grouped by year
        function displayResults(data) {
            const yearSections = document.getElementById('yearSections');
            const results = document.getElementById('results');
            const noResults = document.getElementById('noResults');

            // Clear previous results
            yearSections.innerHTML = '';
            results.innerHTML = '';

            if (data.length === 0) {
                noResults.classList.remove('hidden');
                return;
            }

            noResults.classList.add('hidden');

            // Group data by year
            const groupedByYear = data.reduce((acc, item) => {
                const year = item.year || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏µ';
                if (!acc[year]) acc[year] = [];
                acc[year].push(item);
                return acc;
            }, {});

            // Sort years in descending order
            const sortedYears = Object.keys(groupedByYear).sort((a, b) => {
                if (a === '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏µ') return 1;
                if (b === '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏µ') return -1;
                return b.localeCompare(a);
            });

            // Display each year section
            sortedYears.forEach(year => {
                const yearData = groupedByYear[year];
                const yearColor = getYearColor(year);
                
                yearSections.innerHTML += `
                    <div class="mb-8">
                        <div class="flex items-center mb-6">
                            <div class="${yearColor} text-white px-6 py-3 rounded-full shadow-lg">
                                <h2 class="text-2xl font-bold">üìÖ ‡∏õ‡∏µ ${year}</h2>
                            </div>
                            <div class="ml-4 bg-white px-4 py-2 rounded-full shadow">
                                <span class="text-gray-600 font-medium">${yearData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${yearData.map(item => createCard(item)).join('')}
                        </div>
                    </div>
                `;
            });
        }

        // Create individual card
        function createCard(item) {
            const currentMonthStatus = getCurrentMonthStatus(item);
            const hasUnpaidMonth = checkForUnpaidMonths(item);
            const nearDue = isNearDueDate(item);
            
            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
            let statusClass;
            if (hasUnpaidMonth) {
                statusClass = 'status-overdue'; // ‡∏™‡∏µ‡πÅ‡∏î‡∏á - ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î
            } else if (nearDue) {
                statusClass = 'status-warning'; // ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á - ‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î
            } else {
                statusClass = getStatusClass(currentMonthStatus); // ‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏Å‡∏ï‡∏¥
            }
            
            const statusIcon = getStatusIcon(currentMonthStatus);
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢
            const unpaidMonths = calculateUnpaidMonths(item);
            const unpaidAmount = unpaidMonths * 300;

            return `
                <div class="bg-white rounded-xl shadow-lg card-hover overflow-hidden border-l-4 border-blue-500">
                    <div class="${statusClass} text-white p-4">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-lg">${statusIcon} ${item.id}</h3>
                            <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm font-medium">
                                ${unpaidAmount > 0 ? `${unpaidAmount.toLocaleString()} ‡∏ö‡∏≤‡∏ó` : '‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß'}
                            </span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm opacity-90">${unpaidAmount > 0 ? `‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞ ${unpaidMonths} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô` : '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô'}:</span>
                            <span class="bg-white bg-opacity-30 px-2 py-1 rounded text-xs font-medium">
                                ${getNoticeIcon(item.noticeStatus)} ${item.noticeStatus}
                            </span>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="space-y-3">
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">üè†</span>
                                <div>
                                    <p class="font-bold text-xl text-blue-600">${item.houseNumber}</p>
                                    <p class="text-sm text-gray-600">${item.soi}</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">üë§</span>
                                <div>
                                    <p class="font-semibold text-gray-800">${item.name}</p>
                                    <p class="text-sm text-gray-600">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">üìÖ</span>
                                <div>
                                    <p class="font-semibold text-gray-800">${item.transferDate}</p>
                                    <p class="text-sm text-gray-600">‡∏ß‡∏±‡∏ô‡πÇ‡∏≠‡∏ô</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">‚è∞</span>
                                <div>
                                    <p class="font-semibold text-gray-800">${item.dueMonth} ${item.year}</p>
                                    <p class="text-sm text-gray-600">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 pt-4 border-t border-gray-200">
                            <h4 class="font-semibold text-gray-800 mb-3">üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${item.year}</h4>
                            <div class="grid grid-cols-3 gap-2 text-xs">
                                ${months.map(month => {
                                    const status = item.months[month] || '-';
                                    const statusColor = getStatusColor(status);
                                    const shortMonth = getShortMonth(month);
                                    return `
                                        <div class="text-center p-2 rounded ${statusColor}">
                                            <div class="font-medium">${shortMonth}</div>
                                            <div class="text-xs mt-1">${status}</div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Switch chart view between monthly and yearly
        function switchChartView(view) {
            currentChartView = view;
            
            // Update button styles
            const monthlyBtn = document.getElementById('monthlyViewBtn');
            const yearlyBtn = document.getElementById('yearlyViewBtn');
            
            if (view === 'monthly') {
                monthlyBtn.className = 'tab-active px-4 py-2 rounded-lg font-medium transition-all';
                yearlyBtn.className = 'tab-inactive px-4 py-2 rounded-lg font-medium transition-all';
            } else {
                monthlyBtn.className = 'tab-inactive px-4 py-2 rounded-lg font-medium transition-all';
                yearlyBtn.className = 'tab-active px-4 py-2 rounded-lg font-medium transition-all';
            }
            
            // Regenerate chart
            generateCollectionChart();
        }

        // Generate collection performance chart
        function generateCollectionChart() {
            const ctx = document.getElementById('collectionChart').getContext('2d');
            
            // Destroy existing chart
            if (collectionChart) {
                collectionChart.destroy();
            }
            
            const selectedYear = document.getElementById('summaryYearFilter').value;
            const filteredData = selectedYear ? 
                allData.filter(item => item.year === selectedYear) : 
                allData;
            
            let chartData;
            
            if (currentChartView === 'monthly') {
                chartData = generateMonthlyChartData(filteredData);
            } else {
                chartData = generateYearlyChartData();
            }
            
            collectionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.labels,
                    datasets: [
                        {
                            label: '‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ',
                            data: chartData.collected,
                            backgroundColor: '#10b981',
                            borderColor: '#059669',
                            borderWidth: 1
                        },
                        {
                            label: '‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ',
                            data: chartData.uncollected,
                            backgroundColor: '#ef4444',
                            borderColor: '#dc2626',
                            borderWidth: 1
                        },
                        {
                            label: '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö',
                            data: chartData.noCollect,
                            backgroundColor: '#8b5cf6',
                            borderColor: '#7c3aed',
                            borderWidth: 1
                        },
                        {
                            label: '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                            data: chartData.pending,
                            backgroundColor: '#f59e0b',
                            borderColor: '#d97706',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false // Hide default legend, we have custom one
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.y;
                                    const total = chartData.totals[context.dataIndex];
                                    const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                    return `${context.dataset.label}: ${value} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (${percentage}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // Generate monthly chart data
        function generateMonthlyChartData(filteredData) {
            const monthlyStats = {};
            
            // Initialize monthly stats
            months.forEach(month => {
                monthlyStats[month] = {
                    collected: 0,
                    uncollected: 0,
                    noCollect: 0,
                    pending: 0,
                    total: 0
                };
            });
            
            // Count data for each month
            filteredData.forEach(item => {
                Object.entries(item.months).forEach(([month, status]) => {
                    if (monthlyStats[month]) {
                        monthlyStats[month].total++;
                        
                        switch (status) {
                            case '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß':
                            case '‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤':
                                monthlyStats[month].collected++;
                                break;
                            case '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢':
                            case '':
                            case '-':
                                monthlyStats[month].uncollected++;
                                break;
                            case '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö':
                                monthlyStats[month].noCollect++;
                                break;
                            case '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•':
                                monthlyStats[month].pending++;
                                break;
                        }
                    }
                });
            });
            
            return {
                labels: months.map(month => getShortMonth(month)),
                collected: months.map(month => monthlyStats[month].collected),
                uncollected: months.map(month => monthlyStats[month].uncollected),
                noCollect: months.map(month => monthlyStats[month].noCollect),
                pending: months.map(month => monthlyStats[month].pending),
                totals: months.map(month => monthlyStats[month].total)
            };
        }

        // Generate yearly chart data
        function generateYearlyChartData() {
            const years = ['2567', '2568', '2569', '2570'];
            const yearlyStats = {};
            
            // Initialize yearly stats
            years.forEach(year => {
                yearlyStats[year] = {
                    collected: 0,
                    uncollected: 0,
                    noCollect: 0,
                    pending: 0,
                    total: 0
                };
            });
            
            // Count data for each year
            allData.forEach(item => {
                const year = item.year;
                if (yearlyStats[year]) {
                    Object.values(item.months).forEach(status => {
                        yearlyStats[year].total++;
                        
                        switch (status) {
                            case '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß':
                            case '‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤':
                                yearlyStats[year].collected++;
                                break;
                            case '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢':
                            case '':
                            case '-':
                                yearlyStats[year].uncollected++;
                                break;
                            case '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö':
                                yearlyStats[year].noCollect++;
                                break;
                            case '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•':
                                yearlyStats[year].pending++;
                                break;
                        }
                    });
                }
            });
            
            return {
                labels: years,
                collected: years.map(year => yearlyStats[year].collected),
                uncollected: years.map(year => yearlyStats[year].uncollected),
                noCollect: years.map(year => yearlyStats[year].noCollect),
                pending: years.map(year => yearlyStats[year].pending),
                totals: years.map(year => yearlyStats[year].total)
            };
        }

        // Helper functions
        function getNoticeStatus(row) {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß
            const monthStatuses = months.map((month, index) => row[8 + index] || '');
            const unpaidCount = monthStatuses.filter(status => 
                status === '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢' || status === '' || status === '-'
            ).length;
            
            if (unpaidCount >= 6) {
                return '‡πÅ‡∏à‡πâ‡∏á‡∏≠‡∏≤‡∏¢‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô';
            } else if (unpaidCount >= 4) {
                return '‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô - ‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
            } else if (unpaidCount >= 2) {
                return '‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô - ‡∏£‡∏≠‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô';
            } else if (unpaidCount >= 1) {
                return '‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞ 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô';
            }
            return '‡∏õ‡∏Å‡∏ï‡∏¥';
        }

        function getCurrentMonthStatus(item) {
            const currentMonth = new Date().getMonth();
            const currentMonthName = months[currentMonth];
            return item.months[currentMonthName] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
        }

        function checkForUnpaidMonths(item) {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÑ‡∏´‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            return Object.values(item.months).some(status => 
                status === '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢' || status === '' || status === '-'
            );
        }

        function checkForPendingData(item) {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÑ‡∏´‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            return Object.values(item.months).some(status => 
                status === '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'
            );
        }

        function calculatePendingMonths(item) {
            // ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"
            return Object.values(item.months).filter(status => 
                status === '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'
            ).length;
        }

        function isNearDueDate(item) {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î)
            const currentDate = new Date();
            const currentMonth = currentDate.getMonth(); // 0-11
            const currentYear = currentDate.getFullYear();
            
            // ‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏µ ‡∏û.‡∏®. ‡πÄ‡∏õ‡πá‡∏ô ‡∏Ñ.‡∏®.
            const itemYear = parseInt(item.year) - 543;
            
            // ‡∏´‡∏≤‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î
            const dueMonthIndex = months.indexOf(item.dueMonth);
            
            if (dueMonthIndex === -1) return false;
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Date object ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î
            const dueDate = new Date(itemYear, dueMonthIndex, 1);
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Date object ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î
            const warningDate = new Date(itemYear, dueMonthIndex - 1, 1);
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î) ‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î
            return currentDate >= warningDate && currentDate < dueDate;
        }

        function calculateUnpaidMonths(item) {
            // ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢
            return Object.values(item.months).filter(status => 
                status === '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢' || status === '' || status === '-'
            ).length;
        }

        function getStatusClass(status) {
            switch (status) {
                case '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß': return 'status-paid';
                case '‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤': return 'status-advance';
                case '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö': return 'status-not-collect';
                case '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢': return 'status-overdue';
                case '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': return 'status-pending';
                case '‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß': return 'status-notice-sent';
                case '‡∏£‡∏≠‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô': return 'status-notice-pending';
                default: return 'status-overdue';
            }
        }

        function getStatusIcon(status) {
            switch (status) {
                case '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß': return '‚úÖ';
                case '‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤': return '‚≠ê';
                case '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö': return 'üö´';
                case '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢': return '‚ùå';
                case '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': return '‚è≥';
                case '‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß': return 'üìÆ';
                case '‡∏£‡∏≠‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô': return 'üìã';
                default: return '‚ùì';
            }
        }

        function getNoticeIcon(noticeStatus) {
            switch (noticeStatus) {
                case '‡πÅ‡∏à‡πâ‡∏á‡∏≠‡∏≤‡∏¢‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô': return 'üö®';
                case '‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô - ‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß': return 'üìÆ';
                case '‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô - ‡∏£‡∏≠‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô': return '‚è∞';
                case '‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞ 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô': return '‚ö†Ô∏è';
                case '‡∏õ‡∏Å‡∏ï‡∏¥': return '‚úÖ';
                default: return 'üìã';
            }
        }

        function getStatusColor(status) {
            switch (status) {
                case '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß': return 'bg-green-100 text-green-800';
                case '‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤': return 'bg-blue-100 text-blue-800';
                case '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö': return 'bg-purple-100 text-purple-800';
                case '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢': return 'bg-red-100 text-red-800';
                case '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': return 'bg-yellow-100 text-yellow-800';
                case '‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß': return 'bg-orange-100 text-orange-800';
                case '‡∏£‡∏≠‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô': return 'bg-cyan-100 text-cyan-800';
                default: return 'bg-gray-100 text-gray-600';
            }
        }

        function getYearColor(year) {
            switch (year) {
                case '2567': return 'bg-gradient-to-r from-blue-600 to-blue-700';
                case '2568': return 'bg-gradient-to-r from-green-600 to-green-700';
                case '2569': return 'bg-gradient-to-r from-purple-600 to-purple-700';
                case '2570': return 'bg-gradient-to-r from-orange-600 to-orange-700';
                default: return 'bg-gradient-to-r from-gray-600 to-gray-700';
            }
        }

        function getShortMonth(month) {
            const shortMonths = {
                '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°': '‡∏°.‡∏Ñ.',
                '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå': '‡∏Å.‡∏û.',
                '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°': '‡∏°‡∏µ.‡∏Ñ.',
                '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô': '‡πÄ‡∏°.‡∏¢.',
                '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°': '‡∏û.‡∏Ñ.',
                '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô': '‡∏°‡∏¥.‡∏¢.',
                '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°': '‡∏Å.‡∏Ñ.',
                '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°': '‡∏™.‡∏Ñ.',
                '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô': '‡∏Å.‡∏¢.',
                '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°': '‡∏ï.‡∏Ñ.',
                '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô': '‡∏û.‡∏¢.',
                '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°': '‡∏ò.‡∏Ñ.'
            };
            return shortMonths[month] || month.substring(0, 3);
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', () => {
            if (allData.length > 0) {
                displayResults(filterData());
            }
        });

        document.getElementById('yearFilter').addEventListener('change', () => {
            if (allData.length > 0) {
                displayResults(filterData());
            }
        });

        document.getElementById('statusFilter').addEventListener('change', () => {
            if (allData.length > 0) {
                displayResults(filterData());
            }
        });

        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                loadData();
            }
        });

        // Page navigation functions
        function showSearchPage() {
            document.getElementById('searchPage').classList.remove('hidden');
            document.getElementById('summaryPage').classList.add('hidden');
            document.getElementById('searchPageBtn').classList.remove('bg-gray-500');
            document.getElementById('searchPageBtn').classList.add('bg-blue-600', 'hover:bg-blue-700');
            document.getElementById('summaryPageBtn').classList.remove('bg-green-600', 'hover:bg-green-700');
            document.getElementById('summaryPageBtn').classList.add('bg-gray-500');
        }

        function showSummaryPage() {
            document.getElementById('searchPage').classList.add('hidden');
            document.getElementById('summaryPage').classList.remove('hidden');
            document.getElementById('summaryPageBtn').classList.remove('bg-gray-500');
            document.getElementById('summaryPageBtn').classList.add('bg-green-600', 'hover:bg-green-700');
            document.getElementById('searchPageBtn').classList.remove('bg-blue-600', 'hover:bg-blue-700');
            document.getElementById('searchPageBtn').classList.add('bg-gray-500');
            
            // Load summary data when showing summary page
            if (allData.length > 0) {
                generateSummary();
            }
        }

        // Generate summary statistics
        function generateSummary() {
            // Filter data by selected year
            const selectedYear = document.getElementById('summaryYearFilter').value;
            const filteredData = selectedYear ? 
                allData.filter(item => item.year === selectedYear) : 
                allData;
            
            const summary = {
                overdue: { count: 0, amount: 0, items: [] },
                warning: { count: 0, amount: 0 },
                paid: { count: 0, amount: 0 },
                total: { count: filteredData.length, amount: 0 },
                statusStats: {},
                monthlyStats: {}
            };

            // Initialize monthly stats
            months.forEach(month => {
                summary.monthlyStats[month] = {
                    paid: 0,
                    unpaid: 0,
                    advance: 0,
                    noCollect: 0
                };
            });

            let totalCollectable = 0;
            let totalCollected = 0;

            filteredData.forEach(item => {
                const hasUnpaidMonth = checkForUnpaidMonths(item);
                const hasPendingData = checkForPendingData(item);
                const unpaidMonths = calculateUnpaidMonths(item);
                const pendingMonths = calculatePendingMonths(item);
                const unpaidAmount = unpaidMonths * 300;
                const pendingAmount = pendingMonths * 300;

                // Count by category
                if (hasUnpaidMonth) {
                    summary.overdue.count++;
                    summary.overdue.amount += unpaidAmount;
                    summary.overdue.items.push({
                        ...item,
                        unpaidAmount: unpaidAmount,
                        unpaidMonths: unpaidMonths
                    });
                } else if (hasPendingData) {
                    summary.warning.count++;
                    summary.warning.amount += pendingAmount;
                } else {
                    summary.paid.count++;
                    summary.paid.amount += (12 - unpaidMonths - pendingMonths) * 300;
                }

                summary.total.amount += (12 - unpaidMonths) * 300;

                // Calculate collection performance
                Object.values(item.months).forEach(status => {
                    if (status !== '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö') {
                        totalCollectable++;
                        if (status === '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß' || status === '‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤') {
                            totalCollected++;
                        }
                    }
                });

                // Count status statistics
                Object.entries(item.months).forEach(([month, status]) => {
                    if (!summary.statusStats[status]) {
                        summary.statusStats[status] = 0;
                    }
                    summary.statusStats[status]++;

                    // Monthly statistics
                    if (summary.monthlyStats[month]) {
                        switch (status) {
                            case '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß':
                                summary.monthlyStats[month].paid++;
                                break;
                            case '‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤':
                                summary.monthlyStats[month].advance++;
                                break;
                            case '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö':
                                summary.monthlyStats[month].noCollect++;
                                break;
                            default:
                                summary.monthlyStats[month].unpaid++;
                        }
                    }
                });
            });

            // Calculate performance metrics
            const collectionRate = totalCollectable > 0 ? ((totalCollected / totalCollectable) * 100).toFixed(1) : 0;
            const uncollectedRate = totalCollectable > 0 ? (((totalCollectable - totalCollected) / totalCollectable) * 100).toFixed(1) : 0;
            const averageCollection = filteredData.length > 0 ? Math.round(totalCollected / 12) : 0;

            updateSummaryDisplay(summary, collectionRate, uncollectedRate, averageCollection);
            generateCollectionChart();
        }

        // Update summary display
        function updateSummaryDisplay(summary, collectionRate, uncollectedRate, averageCollection) {
            // Update summary cards
            document.getElementById('overdueCount').textContent = summary.overdue.count.toLocaleString();
            document.getElementById('overdueAmount').textContent = summary.overdue.amount.toLocaleString();
            document.getElementById('warningCount').textContent = summary.warning.count.toLocaleString();
            document.getElementById('warningAmount').textContent = summary.warning.amount.toLocaleString();
            document.getElementById('paidCount').textContent = summary.paid.count.toLocaleString();
            document.getElementById('paidAmount').textContent = summary.paid.amount.toLocaleString();
            document.getElementById('totalCount').textContent = summary.total.count.toLocaleString();
            document.getElementById('totalAmount').textContent = summary.total.amount.toLocaleString();

            // Update performance metrics
            document.getElementById('collectionRate').textContent = collectionRate + '%';
            document.getElementById('uncollectedRate').textContent = uncollectedRate + '%';
            document.getElementById('averageCollection').textContent = averageCollection.toLocaleString();

            // Update status chart
            const statusChart = document.getElementById('statusChart');
            statusChart.innerHTML = '';
            
            Object.entries(summary.statusStats).forEach(([status, count]) => {
                const percentage = ((count / (summary.total.count * 12)) * 100).toFixed(1);
                const color = getStatusChartColor(status);
                
                statusChart.innerHTML += `
                    <div class="flex items-center justify-between p-3 rounded-lg ${color}">
                        <div class="flex items-center">
                            <span class="text-lg mr-3">${getStatusIcon(status)}</span>
                            <span class="font-medium">${status || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
                        </div>
                        <div class="text-right">
                            <div class="font-bold">${count.toLocaleString()}</div>
                            <div class="text-sm opacity-75">${percentage}%</div>
                        </div>
                    </div>
                `;
            });

            // Update monthly chart
            const monthlyChart = document.getElementById('monthlyChart');
            monthlyChart.innerHTML = '';
            
            months.forEach(month => {
                const monthData = summary.monthlyStats[month];
                const total = monthData.paid + monthData.unpaid + monthData.advance + monthData.noCollect;
                
                if (total > 0) {
                    const paidPercentage = ((monthData.paid / total) * 100).toFixed(1);
                    
                    monthlyChart.innerHTML += `
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium text-gray-800">${getShortMonth(month)}</span>
                                <span class="text-sm text-gray-600">${total} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                            </div>
                            <div class="flex space-x-1 h-2 bg-gray-200 rounded-full overflow-hidden">
                                <div class="bg-green-500" style="width: ${(monthData.paid / total) * 100}%"></div>
                                <div class="bg-blue-500" style="width: ${(monthData.advance / total) * 100}%"></div>
                                <div class="bg-purple-500" style="width: ${(monthData.noCollect / total) * 100}%"></div>
                                <div class="bg-red-500" style="width: ${(monthData.unpaid / total) * 100}%"></div>
                            </div>
                            <div class="text-xs text-gray-600 mt-1">
                                ‡∏à‡πà‡∏≤‡∏¢: ${monthData.paid} | ‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤: ${monthData.advance} | ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö: ${monthData.noCollect} | ‡∏Ñ‡πâ‡∏≤‡∏á: ${monthData.unpaid}
                            </div>
                        </div>
                    `;
                }
            });

            // Update overdue table
            const overdueTableBody = document.getElementById('overdueTableBody');
            const overdueTotal = document.getElementById('overdueTotal');
            const showAllOverdue = document.getElementById('showAllOverdue').checked;
            const overdueYearFilter = document.getElementById('overdueYearFilter').value;
            
            // Filter overdue items by selected year
            let filteredOverdueItems = summary.overdue.items;
            if (overdueYearFilter) {
                filteredOverdueItems = summary.overdue.items.filter(item => item.year === overdueYearFilter);
            }
            
            overdueTableBody.innerHTML = '';
            
            if (filteredOverdueItems.length === 0) {
                overdueTableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-8 text-gray-500">
                            <div class="text-4xl mb-2">üéâ</div>
                            <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞</p>
                        </td>
                    </tr>
                `;
                overdueTotal.textContent = '';
            } else {
                // Sort by amount descending
                filteredOverdueItems.sort((a, b) => b.unpaidAmount - a.unpaidAmount);
                
                const itemsToShow = showAllOverdue ? filteredOverdueItems : filteredOverdueItems.slice(0, 20);
                
                itemsToShow.forEach((item, index) => {
                    const rowClass = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                    overdueTableBody.innerHTML += `
                        <tr class="${rowClass} hover:bg-red-50 transition-colors">
                            <td class="py-3 px-4 text-center font-medium">${index + 1}</td>
                            <td class="py-3 px-4">
                                <div class="flex items-center">
                                    <span class="text-lg mr-2">üè†</span>
                                    <span class="font-semibold text-blue-600">${item.houseNumber}</span>
                                </div>
                            </td>
                            <td class="py-3 px-4">
                                <div class="font-medium text-gray-800">${item.name}</div>
                                <div class="text-sm text-gray-500">${item.soi}</div>
                            </td>
                            <td class="py-3 px-4">
                                <span class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-sm font-medium">
                                    ${item.unpaidMonths} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                                </span>
                            </td>
                            <td class="py-3 px-4">
                                <span class="font-bold text-red-600 text-lg">
                                    ${item.unpaidAmount.toLocaleString()} ‡∏ö‡∏≤‡∏ó
                                </span>
                            </td>
                            <td class="py-3 px-4">
                                <span class="text-sm ${getNoticeStatusColor(item.noticeStatus)}">
                                    ${getNoticeIcon(item.noticeStatus)} ${item.noticeStatus}
                                </span>
                            </td>
                        </tr>
                    `;
                });
                
                // Update total display
                const totalShown = itemsToShow.length;
                const totalAll = filteredOverdueItems.length;
                const yearText = overdueYearFilter ? ` (‡∏õ‡∏µ ${overdueYearFilter})` : '';
                overdueTotal.textContent = showAllOverdue ? 
                    `‡πÅ‡∏™‡∏î‡∏á ${totalAll} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î${yearText}` : 
                    `‡πÅ‡∏™‡∏î‡∏á ${totalShown} ‡∏à‡∏≤‡∏Å ${totalAll} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£${yearText}`;
            }
        }

        function getStatusChartColor(status) {
            switch (status) {
                case '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß': return 'bg-green-100 text-green-800';
                case '‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤': return 'bg-blue-100 text-blue-800';
                case '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö': return 'bg-purple-100 text-purple-800';
                case '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢': return 'bg-red-100 text-red-800';
                case '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': return 'bg-yellow-100 text-yellow-800';
                case '‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß': return 'bg-orange-100 text-orange-800';
                case '‡∏£‡∏≠‡∏™‡πà‡∏á‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô': return 'bg-cyan-100 text-cyan-800';
                default: return 'bg-gray-100 text-gray-600';
            }
        }

        function getNoticeStatusColor(noticeStatus) {
            switch (noticeStatus) {
                case '‡πÅ‡∏à‡πâ‡∏á‡∏≠‡∏≤‡∏¢‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô': return 'bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium';
                case '‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô - ‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß': return 'bg-orange-100 text-orange-800 px-2 py-1 rounded-full font-medium';
                case '‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô - ‡∏£‡∏≠‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô': return 'bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full font-medium';
                case '‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞ 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô': return 'bg-amber-100 text-amber-800 px-2 py-1 rounded-full font-medium';
                case '‡∏õ‡∏Å‡∏ï‡∏¥': return 'bg-green-100 text-green-800 px-2 py-1 rounded-full font-medium';
                default: return 'bg-gray-100 text-gray-600 px-2 py-1 rounded-full font-medium';
            }
        }

        // Auto-refresh data every 30 seconds for real-time updates
        let autoRefreshInterval;
        
        function startAutoRefresh() {
            // Clear existing interval if any
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            
            // Set up auto-refresh every 30 seconds
            autoRefreshInterval = setInterval(() => {
                loadData(true); // Silent refresh
            }, 30000);
        }
        
        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
        }

        // Load data on page load
        window.addEventListener('load', () => {
            loadData();
            showSearchPage(); // Show search page by default
            startAutoRefresh(); // Start auto-refresh
        });
        
        // Stop auto-refresh when page is hidden to save resources
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                stopAutoRefresh();
            } else {
                startAutoRefresh();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'971cb456551cee46',t:'MTc1NTYzODUyNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
