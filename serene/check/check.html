<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        
        .slide-up {
            animation: slideUp 0.8s ease-out forwards;
        }
        
        .bounce-in {
            animation: bounceIn 1s ease-out forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .hover-lift {
            transition: all 0.3s ease;
        }
        
        .hover-lift:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .pulse-glow {
            animation: pulseGlow 2s infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8), 0 0 30px rgba(59, 130, 246, 0.6); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="glass-effect rounded-2xl p-8 mb-8 fade-in">
            <div class="text-center">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-white bg-opacity-20 rounded-full mb-4 bounce-in">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                    </svg>
                </div>
                <h1 class="text-4xl font-bold text-white mb-3">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á</h1>
                <p class="text-white text-opacity-90 text-lg">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á: 300 ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</p>
                <div class="mt-4 inline-flex items-center px-4 py-2 bg-white bg-opacity-20 rounded-full">
                    <div class="w-2 h-2 bg-green-400 rounded-full mr-2 pulse-glow"></div>
                    <span class="text-white text-sm">‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
                </div>
            </div>
        </div>



        <!-- Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-2xl shadow-xl p-6 hover-lift slide-up" style="animation-delay: 0.1s">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600 mb-1">‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
                        <p class="text-3xl font-bold text-green-600" id="paidCount">0</p>
                        <p class="text-xs text-green-500 mt-1">‚úì ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</p>
                    </div>
                    <div class="bg-gradient-to-br from-green-400 to-green-600 p-4 rounded-2xl">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-2xl shadow-xl p-6 hover-lift slide-up" style="animation-delay: 0.2s">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600 mb-1">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢</p>
                        <p class="text-3xl font-bold text-red-600" id="unpaidCount">0</p>
                        <p class="text-xs text-red-500 mt-1">‚ö† ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞</p>
                    </div>
                    <div class="bg-gradient-to-br from-red-400 to-red-600 p-4 rounded-2xl">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-2xl shadow-xl p-6 hover-lift slide-up" style="animation-delay: 0.3s">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600 mb-1">‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞</p>
                        <p class="text-3xl font-bold text-blue-600" id="totalUnpaid">0 ‡∏ö‡∏≤‡∏ó</p>
                        <p class="text-xs text-blue-500 mt-1">üí∞ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    </div>
                    <div class="bg-gradient-to-br from-blue-400 to-blue-600 p-4 rounded-2xl">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-2xl shadow-xl p-6 hover-lift slide-up" style="animation-delay: 0.4s">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600 mb-1">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢</p>
                        <p class="text-3xl font-bold text-purple-600" id="paymentRate">0%</p>
                        <p class="text-xs text-purple-500 mt-1">üìä ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå</p>
                    </div>
                    <div class="bg-gradient-to-br from-purple-400 to-purple-600 p-4 rounded-2xl">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Financial Summary Section -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-8 slide-up" style="animation-delay: 0.5s">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <svg class="w-7 h-7 text-blue-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-6 border border-blue-200">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-sm font-medium text-blue-700">üí∞ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
                        <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                        </div>
                    </div>
                    <p class="text-2xl font-bold text-blue-800" id="totalRevenue">0 ‡∏ö‡∏≤‡∏ó</p>
                    <p class="text-xs text-blue-600 mt-1">‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                </div>
                
                <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-6 border border-green-200">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-sm font-medium text-green-700">‚úÖ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</h4>
                        <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                    <p class="text-2xl font-bold text-green-800" id="collectedRevenue">0 ‡∏ö‡∏≤‡∏ó</p>
                    <p class="text-xs text-green-600 mt-1">‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
                </div>
                
                <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-xl p-6 border border-red-200">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-sm font-medium text-red-700">‚ö†Ô∏è ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö</h4>
                        <div class="w-8 h-8 bg-red-500 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                    <p class="text-2xl font-bold text-red-800" id="pendingRevenue">0 ‡∏ö‡∏≤‡∏ó</p>
                    <p class="text-xs text-red-600 mt-1">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞</p>
                </div>
                
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-6 border border-purple-200">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-sm font-medium text-purple-700">üìä ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á</h4>
                        <div class="w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
                            </svg>
                        </div>
                    </div>
                    <p class="text-2xl font-bold text-purple-800" id="averagePerRoom">0 ‡∏ö‡∏≤‡∏ó</p>
                    <p class="text-xs text-purple-600 mt-1">‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞</p>
                </div>
            </div>
            
            <!-- Monthly/Yearly Summary Tables -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-gray-50 rounded-xl p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 text-orange-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                    </h3>
                    <div class="space-y-3 max-h-64 overflow-y-auto" id="monthlySummary">
                        <!-- Monthly data will be populated here -->
                    </div>
                </div>
                
                <div class="bg-gray-50 rounded-xl p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 text-indigo-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏õ‡∏µ
                    </h3>
                    <div class="space-y-3" id="yearlySummary">
                        <!-- Yearly data will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <div class="bg-white rounded-2xl shadow-xl p-6 hover-lift slide-up" style="animation-delay: 0.6s">
                <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <div class="w-3 h-3 bg-blue-500 rounded-full mr-3"></div>
                    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞
                </h3>
                <div class="relative h-64">
                    <canvas id="paymentStatusChart"></canvas>
                </div>
            </div>
            
            <div class="bg-white rounded-2xl shadow-xl p-6 hover-lift slide-up" style="animation-delay: 0.7s">
                <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                    ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                </h3>
                <div class="relative h-64">
                    <canvas id="monthlyAmountChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Filter -->
        <div class="bg-white rounded-2xl shadow-xl p-6 mb-8 slide-up" style="animation-delay: 0.7s">
            <div class="flex flex-col lg:flex-row gap-4 items-center">
                <div class="flex flex-wrap items-center gap-4">
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                        </svg>
                        <select id="statusFilter" class="px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="unpaid">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢</option>
                            <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            <option value="paid">‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</option>
                            <option value="advance">‡∏à‡πà‡∏≤‡∏¢‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤</option>
                            <option value="pending">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <select id="yearFilter" class="px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="all">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</option>
                            <option value="2567">‡∏õ‡∏µ 2567</option>
                            <option value="2568">‡∏õ‡∏µ 2568</option>
                            <option value="2569">‡∏õ‡∏µ 2569</option>
                            <option value="2570">‡∏õ‡∏µ 2570</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                        </svg>
                        <select id="viewMode" class="px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="monthly">‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
                            <option value="yearly">‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                        </svg>
                        <select id="rowsPerPage" class="px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="10">10 ‡πÅ‡∏ñ‡∏ß</option>
                            <option value="20">20 ‡πÅ‡∏ñ‡∏ß</option>
                            <option value="50">50 ‡πÅ‡∏ñ‡∏ß</option>
                            <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex items-center gap-4 flex-1">
                    <input type="text" id="searchInput" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á..." 
                           class="flex-1 px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50 focus:bg-white transition-colors">
                    
                    <div class="flex items-center">
                        <button id="refreshBtn" class="px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            <span class="hidden sm:inline">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</span>
                        </button>
                        
                        <div class="ml-3 flex items-center">
                            <div class="w-2 h-2 bg-green-400 rounded-full mr-2 pulse-glow" id="autoRefreshIndicator"></div>
                            <span class="text-xs text-gray-500">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden slide-up" style="animation-delay: 0.8s">
            <div class="px-6 py-6 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                            <svg class="w-6 h-6 text-red-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞
                        </h2>
                        <p class="text-gray-600 mt-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-gray-500">‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>
                        <p class="text-lg font-semibold text-red-600" id="displayedRows">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                    </div>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gradient-to-r from-gray-100 to-gray-50">
                        <tr>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">üè† ‡∏´‡πâ‡∏≠‡∏á</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">üë§ ‡∏ä‡∏∑‡πà‡∏≠</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">üìÖ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">üí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">‚ö†Ô∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        </tr>
                    </thead>
                    <tbody id="dataTable" class="bg-white divide-y divide-gray-100">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            <div class="px-6 py-4 bg-gray-50 border-t border-gray-100">
                <div class="flex items-center justify-between">
                    <div class="text-sm text-gray-600">
                        ‡πÅ‡∏™‡∏î‡∏á <span id="startRow">1</span>-<span id="endRow">10</span> ‡∏à‡∏≤‡∏Å <span id="totalRows">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                    </div>
                    <div class="flex space-x-2">
                        <button id="prevPage" class="px-3 py-1 text-sm bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                            ‚Üê ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                        </button>
                        <button id="nextPage" class="px-3 py-1 text-sm bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                            ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="hidden bg-white rounded-xl shadow-lg p-8 text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>

        <!-- Error State -->
        <div id="errorState" class="hidden bg-red-50 border border-red-200 rounded-xl p-6">
            <div class="flex items-center">
                <svg class="w-6 h-6 text-red-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                    <h3 class="text-red-800 font-medium">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</h3>
                    <p class="text-red-600 text-sm mt-1">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Google Sheets</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allData = [];
        let filteredData = [];
        let currentPage = 1;
        let rowsPerPage = 10;
        const MONTHLY_FEE = 300;
        const SHEETS_ID = "1yklkO0OaVsZKpJc4EGcNDkpRsNd8DNWiJKlUnpBwBEE";
        const SHEETS_URL = `https://docs.google.com/spreadsheets/d/${SHEETS_ID}/gviz/tq?tqx=out:csv&sheet=Sheet1`;

        // Month mapping for Thai months
        const monthMapping = {
            '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°': 1, '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå': 2, '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°': 3, '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô': 4, '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°': 5, '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô': 6,
            '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°': 7, '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°': 8, '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô': 9, '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°': 10, '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô': 11, '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°': 12
        };

        const monthNames = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];

        async function fetchGoogleSheetsData() {
            try {
                const response = await fetch(SHEETS_URL);
                const csvText = await response.text();
                return parseCSVData(csvText);
            } catch (error) {
                console.error('Error fetching Google Sheets data:', error);
                // Fallback to sample data if fetch fails
                return getSampleData();
            }
        }

        function parseCSVData(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
            const data = [];

            // Find column indices
            const houseNumIndex = headers.findIndex(h => h.includes('‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà'));
            const nameIndex = headers.findIndex(h => h.includes('‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•'));
            const yearIndex = headers.findIndex(h => h.includes('‡∏õ‡∏µ'));
            const monthStartIndex = headers.findIndex(h => h.includes('‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°'));

            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;
                
                const row = lines[i].split(',').map(cell => cell.replace(/"/g, '').trim());
                if (row.length < headers.length) continue;

                const houseNum = row[houseNumIndex] || '';
                const name = row[nameIndex] || '';
                const year = parseInt(row[yearIndex]) || 2567;

                if (!houseNum || !name) continue;

                // Process monthly payment data
                const monthlyPayments = [];
                for (let monthIndex = 0; monthIndex < 12; monthIndex++) {
                    const cellValue = row[monthStartIndex + monthIndex] || '';
                    monthlyPayments.push(cellValue);
                }

                // Calculate payment periods and status
                const paymentPeriods = calculatePaymentPeriods(monthlyPayments, year);
                
                paymentPeriods.forEach(period => {
                    data.push({
                        room: houseNum,
                        name: name,
                        months: period.months,
                        status: period.status,
                        period: period.periodText,
                        year: year,
                        monthStart: period.startMonth,
                        monthEnd: period.endMonth
                    });
                });
            }

            return data;
        }

        function calculatePaymentPeriods(monthlyPayments, year) {
            const periods = [];
            let currentPeriod = null;

            monthlyPayments.forEach((payment, index) => {
                const monthNum = index + 1;
                
                // Define payment status based on database values
                let status = null;
                let shouldTrack = true;
                
                switch (payment.trim()) {
                    case '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß':
                        status = 'paid';
                        break;
                    case '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢':
                        status = 'unpaid';
                        break;
                    case '‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤':
                        status = 'advance';
                        break;
                    case '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•':
                        status = 'pending';
                        break;
                    case '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö':
                        shouldTrack = false;
                        break;
                    case '':
                        status = 'unpaid'; // Empty cells treated as unpaid
                        break;
                    default:
                        status = 'unpaid'; // Unknown values treated as unpaid
                        break;
                }

                if (!shouldTrack) {
                    // End current period for '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö'
                    if (currentPeriod && currentPeriod.months > 0) {
                        currentPeriod.periodText = formatPeriod(currentPeriod.startMonth, currentPeriod.endMonth, year);
                        periods.push({...currentPeriod});
                        currentPeriod = null;
                    }
                    return;
                }

                if (!currentPeriod) {
                    currentPeriod = {
                        startMonth: monthNum,
                        endMonth: monthNum,
                        months: 1,
                        status: status
                    };
                } else if (currentPeriod.status === status) {
                    // Continue current period
                    currentPeriod.endMonth = monthNum;
                    currentPeriod.months++;
                } else {
                    // End current period and start new period
                    if (currentPeriod.months > 0) {
                        currentPeriod.periodText = formatPeriod(currentPeriod.startMonth, currentPeriod.endMonth, year);
                        periods.push({...currentPeriod});
                    }
                    currentPeriod = {
                        startMonth: monthNum,
                        endMonth: monthNum,
                        months: 1,
                        status: status
                    };
                }
            });

            // Add final period if exists
            if (currentPeriod && currentPeriod.months > 0) {
                currentPeriod.periodText = formatPeriod(currentPeriod.startMonth, currentPeriod.endMonth, year);
                periods.push(currentPeriod);
            }

            return periods.filter(p => p.months > 0);
        }

        function formatPeriod(startMonth, endMonth, year) {
            if (startMonth === endMonth) {
                return `${monthNames[startMonth - 1]} ${year}`;
            } else {
                return `${monthNames[startMonth - 1]}-${monthNames[endMonth - 1]} ${year}`;
            }
        }

        function getSampleData() {
            // Fallback sample data based on your sheet structure with all status types
            return [
                { room: "998/1", name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏∏‡∏ô‡∏±‡∏ô‡∏ó‡∏≤ ‡∏™‡∏∏‡∏Ç‡πÅ‡∏Å‡πâ‡∏ß/‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ä‡∏∏‡∏ï‡∏¥‡∏°‡∏≤ ‡∏®‡∏¥‡∏£‡∏¥‡∏™‡∏≠‡∏ô", months: 7, status: "unpaid", period: "‡∏°.‡∏Ñ.-‡∏Å.‡∏Ñ. 2567", year: 2567, monthStart: 1, monthEnd: 7 },
                { room: "998/1", name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏∏‡∏ô‡∏±‡∏ô‡∏ó‡∏≤ ‡∏™‡∏∏‡∏Ç‡πÅ‡∏Å‡πâ‡∏ß/‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ä‡∏∏‡∏ï‡∏¥‡∏°‡∏≤ ‡∏®‡∏¥‡∏£‡∏¥‡∏™‡∏≠‡∏ô", months: 5, status: "paid", period: "‡∏™.‡∏Ñ.-‡∏ò.‡∏Ñ. 2567", year: 2567, monthStart: 8, monthEnd: 12 },
                { room: "998/2", name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏®‡∏¥‡∏£‡∏¥‡∏£‡∏±‡∏ï‡∏ô‡πå ‡∏†‡∏≤‡∏≠‡∏∏‡∏†‡∏±‡∏¢", months: 3, status: "advance", period: "‡∏°.‡∏Ñ.-‡∏°‡∏µ.‡∏Ñ. 2568", year: 2568, monthStart: 1, monthEnd: 3 },
                { room: "998/2", name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏®‡∏¥‡∏£‡∏¥‡∏£‡∏±‡∏ï‡∏ô‡πå ‡∏†‡∏≤‡∏≠‡∏∏‡∏†‡∏±‡∏¢", months: 5, status: "paid", period: "‡∏™.‡∏Ñ.-‡∏ò.‡∏Ñ. 2567", year: 2567, monthStart: 8, monthEnd: 12 },
                { room: "998/3", name: "‡∏ô‡∏≤‡∏¢‡∏ò‡∏ß‡∏±‡∏ä ‡∏õ‡∏á‡∏£‡∏±‡∏á‡∏©‡∏µ", months: 1, status: "unpaid", period: "‡∏Å.‡∏û. 2567", year: 2567, monthStart: 2, monthEnd: 2 },
                { room: "998/3", name: "‡∏ô‡∏≤‡∏¢‡∏ò‡∏ß‡∏±‡∏ä ‡∏õ‡∏á‡∏£‡∏±‡∏á‡∏©‡∏µ", months: 2, status: "pending", period: "‡∏û.‡∏¢.-‡∏ò.‡∏Ñ. 2567", year: 2567, monthStart: 11, monthEnd: 12 },
                { room: "998/4", name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏∏‡∏à‡∏¥‡∏ï‡∏£‡∏≤ ‡∏°‡∏π‡∏•‡∏•‡∏µ", months: 1, status: "unpaid", period: "‡∏Å.‡∏û. 2567", year: 2567, monthStart: 2, monthEnd: 2 },
                { room: "998/4", name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏∏‡∏à‡∏¥‡∏ï‡∏£‡∏≤ ‡∏°‡∏π‡∏•‡∏•‡∏µ", months: 5, status: "paid", period: "‡∏™.‡∏Ñ.-‡∏ò.‡∏Ñ. 2567", year: 2567, monthStart: 8, monthEnd: 12 },
                { room: "998/5", name: "‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏≤ ‡πÄ‡∏´‡∏•‡πà‡∏≤‡πÇ‡∏ô‡∏ô‡∏Ç‡∏ß‡∏≤", months: 4, status: "unpaid", period: "‡∏°.‡∏Ñ.-‡πÄ‡∏°.‡∏¢. 2567", year: 2567, monthStart: 1, monthEnd: 4 },
                { room: "998/5", name: "‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏≤ ‡πÄ‡∏´‡∏•‡πà‡∏≤‡πÇ‡∏ô‡∏ô‡∏Ç‡∏ß‡∏≤", months: 2, status: "advance", period: "‡∏û.‡∏Ñ.-‡∏°‡∏¥.‡∏¢. 2567", year: 2567, monthStart: 5, monthEnd: 6 },
                { room: "998/6", name: "‡∏ô‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏ó‡∏ò‡πå ‡πÉ‡∏à‡∏î‡∏µ", months: 3, status: "pending", period: "‡∏ï.‡∏Ñ.-‡∏ò.‡∏Ñ. 2567", year: 2567, monthStart: 10, monthEnd: 12 }
            ];
        }

        let paymentChart, monthlyChart;

        function createPaymentStatusChart() {
            const ctx = document.getElementById('paymentStatusChart').getContext('2d');
            
            // Count months for each status
            const paidCount = allData.filter(item => item.status === 'paid').reduce((sum, item) => sum + item.months, 0);
            const unpaidCount = allData.filter(item => item.status === 'unpaid').reduce((sum, item) => sum + item.months, 0);
            const advanceCount = allData.filter(item => item.status === 'advance').reduce((sum, item) => sum + item.months, 0);
            const pendingCount = allData.filter(item => item.status === 'pending').reduce((sum, item) => sum + item.months, 0);

            if (paymentChart) paymentChart.destroy();

            const chartData = [];
            const chartLabels = [];
            const chartColors = [];
            const chartBorderColors = [];

            if (paidCount > 0) {
                chartData.push(paidCount);
                chartLabels.push('‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                chartColors.push('rgba(34, 197, 94, 0.8)');
                chartBorderColors.push('rgba(34, 197, 94, 1)');
            }
            if (unpaidCount > 0) {
                chartData.push(unpaidCount);
                chartLabels.push('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢');
                chartColors.push('rgba(239, 68, 68, 0.8)');
                chartBorderColors.push('rgba(239, 68, 68, 1)');
            }
            if (advanceCount > 0) {
                chartData.push(advanceCount);
                chartLabels.push('‡∏à‡πà‡∏≤‡∏¢‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤');
                chartColors.push('rgba(59, 130, 246, 0.8)');
                chartBorderColors.push('rgba(59, 130, 246, 1)');
            }
            if (pendingCount > 0) {
                chartData.push(pendingCount);
                chartLabels.push('‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
                chartColors.push('rgba(245, 158, 11, 0.8)');
                chartBorderColors.push('rgba(245, 158, 11, 1)');
            }

            paymentChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        data: chartData,
                        backgroundColor: chartColors,
                        borderColor: chartBorderColors,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    family: 'Sarabun',
                                    size: 14
                                }
                            }
                        }
                    }
                }
            });
        }

        function createMonthlyAmountChart() {
            const ctx = document.getElementById('monthlyAmountChart').getContext('2d');
            
            // Group data by months owed
            const monthsData = {};
            allData.forEach(item => {
                if (item.status === 'unpaid') {
                    monthsData[item.months] = (monthsData[item.months] || 0) + 1;
                }
            });

            const labels = Object.keys(monthsData).sort((a, b) => a - b).map(m => `${m} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`);
            const data = Object.keys(monthsData).sort((a, b) => a - b).map(m => monthsData[m] * m * MONTHLY_FEE);

            if (monthlyChart) monthlyChart.destroy();

            monthlyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)',
                        data: data,
                        backgroundColor: 'rgba(59, 130, 246, 0.8)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
                                },
                                font: {
                                    family: 'Sarabun'
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    family: 'Sarabun'
                                }
                            }
                        }
                    }
                }
            });
        }

        async function loadData() {
            try {
                document.getElementById('loadingState').classList.remove('hidden');
                document.getElementById('errorState').classList.add('hidden');
                
                // Fetch data from Google Sheets
                allData = await fetchGoogleSheetsData();
                
                if (allData.length === 0) {
                    throw new Error('No data found');
                }
                
                filterData();
                updateSummary();
                createPaymentStatusChart();
                createMonthlyAmountChart();
                
                document.getElementById('loadingState').classList.add('hidden');
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('errorState').classList.remove('hidden');
                
                // Use fallback sample data
                allData = getSampleData();
                filterData();
                updateSummary();
                createPaymentStatusChart();
                createMonthlyAmountChart();
            }
        }

        function displayData(data) {
            const tbody = document.getElementById('dataTable');
            tbody.innerHTML = '';
            
            const viewMode = document.getElementById('viewMode').value;

            // Calculate pagination
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = rowsPerPage === 'all' ? data.length : startIndex + parseInt(rowsPerPage);
            const paginatedData = rowsPerPage === 'all' ? data : data.slice(startIndex, endIndex);

            if (viewMode === 'yearly') {
                displayYearlyData(paginatedData, data.length, startIndex, Math.min(endIndex, data.length));
            } else {
                displayMonthlyData(paginatedData, data.length, startIndex, Math.min(endIndex, data.length));
            }
        }

        function displayMonthlyData(paginatedData, totalLength, startIndex, endIndex) {
            const tbody = document.getElementById('dataTable');
            
            paginatedData.forEach((item, index) => {
                const total = item.months * MONTHLY_FEE;
                
                // Define status display based on all possible statuses
                let statusClass, statusText;
                switch (item.status) {
                    case 'paid':
                        statusClass = 'bg-green-100 text-green-800 border-green-200';
                        statusText = '‚úÖ ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß';
                        break;
                    case 'unpaid':
                        statusClass = 'bg-red-100 text-red-800 border-red-200';
                        statusText = '‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢';
                        break;
                    case 'advance':
                        statusClass = 'bg-blue-100 text-blue-800 border-blue-200';
                        statusText = 'üí∞ ‡∏à‡πà‡∏≤‡∏¢‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤';
                        break;
                    case 'pending':
                        statusClass = 'bg-yellow-100 text-yellow-800 border-yellow-200';
                        statusText = '‚è≥ ‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                        break;
                    default:
                        statusClass = 'bg-gray-100 text-gray-800 border-gray-200';
                        statusText = '‚ùì ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                        break;
                }

                const row = document.createElement('tr');
                row.className = 'hover:bg-blue-50 transition-colors duration-200';
                row.style.animationDelay = `${index * 0.05}s`;
                row.classList.add('fade-in');
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                <span class="text-blue-600 font-bold text-sm">${item.room}</span>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${item.name}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${item.period}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            ${item.months} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-bold text-gray-900">${total.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                        <div class="text-xs text-gray-500">${MONTHLY_FEE} √ó ${item.months}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold border ${statusClass}">
                            ${statusText}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });

            updatePaginationInfo(totalLength, startIndex, endIndex);
        }

        function displayYearlyData(paginatedData, totalLength, startIndex, endIndex) {
            const tbody = document.getElementById('dataTable');
            
            // Group data by room and year
            const yearlyGrouped = {};
            paginatedData.forEach(item => {
                const key = `${item.room}-${item.year}`;
                if (!yearlyGrouped[key]) {
                    yearlyGrouped[key] = {
                        room: item.room,
                        name: item.name,
                        year: item.year,
                        totalMonths: 0,
                        paidMonths: 0,
                        unpaidMonths: 0,
                        advanceMonths: 0,
                        pendingMonths: 0,
                        totalAmount: 0,
                        paidAmount: 0,
                        unpaidAmount: 0,
                        advanceAmount: 0,
                        pendingAmount: 0,
                        periods: []
                    };
                }
                
                const group = yearlyGrouped[key];
                group.totalMonths += item.months;
                group.totalAmount += item.months * MONTHLY_FEE;
                group.periods.push(item.period);
                
                switch (item.status) {
                    case 'paid':
                        group.paidMonths += item.months;
                        group.paidAmount += item.months * MONTHLY_FEE;
                        break;
                    case 'unpaid':
                        group.unpaidMonths += item.months;
                        group.unpaidAmount += item.months * MONTHLY_FEE;
                        break;
                    case 'advance':
                        group.advanceMonths += item.months;
                        group.advanceAmount += item.months * MONTHLY_FEE;
                        break;
                    case 'pending':
                        group.pendingMonths += item.months;
                        group.pendingAmount += item.months * MONTHLY_FEE;
                        break;
                }
            });

            Object.values(yearlyGrouped).forEach((group, index) => {
                const paymentRate = group.totalMonths > 0 ? Math.round((group.paidMonths / group.totalMonths) * 100) : 0;
                const statusClass = paymentRate === 100 ? 'bg-green-100 text-green-800' : paymentRate >= 50 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800';
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-blue-50 transition-colors duration-200';
                row.style.animationDelay = `${index * 0.05}s`;
                row.classList.add('fade-in');
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                <span class="text-blue-600 font-bold text-sm">${group.room}</span>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${group.name}</div>
                        <div class="text-xs text-gray-500">‡∏õ‡∏µ ${group.year}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                        <div class="space-y-1">
                            <div class="text-green-600">‡∏à‡πà‡∏≤‡∏¢: ${group.paidMonths} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                            <div class="text-red-600">‡∏Ñ‡πâ‡∏≤‡∏á: ${group.unpaidMonths} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                            ${group.advanceMonths > 0 ? `<div class="text-blue-600">‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤: ${group.advanceMonths} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>` : ''}
                            ${group.pendingMonths > 0 ? `<div class="text-yellow-600">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${group.pendingMonths} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>` : ''}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            ${group.totalMonths} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-bold text-gray-900">${group.totalAmount.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                        <div class="text-xs text-green-600">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ${group.paidAmount.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                        <div class="text-xs text-red-600">‡∏Ñ‡πâ‡∏≤‡∏á: ${group.unpaidAmount.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                        ${group.advanceAmount > 0 ? `<div class="text-xs text-blue-600">‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤: ${group.advanceAmount.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>` : ''}
                        ${group.pendingAmount > 0 ? `<div class="text-xs text-yellow-600">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${group.pendingAmount.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>` : ''}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold ${statusClass}">
                            ${paymentRate}% ‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });

            updatePaginationInfo(totalLength, startIndex, endIndex);
        }

        function updatePaginationInfo(total, start, end) {
            document.getElementById('totalRows').textContent = total;
            document.getElementById('startRow').textContent = total > 0 ? start + 1 : 0;
            document.getElementById('endRow').textContent = end;
            document.getElementById('displayedRows').textContent = `${total} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;

            const totalPages = Math.ceil(total / (rowsPerPage === 'all' ? total : parseInt(rowsPerPage)));
            document.getElementById('prevPage').disabled = currentPage <= 1;
            document.getElementById('nextPage').disabled = currentPage >= totalPages || rowsPerPage === 'all';
        }

        function updateSummary() {
            // Calculate months for all statuses
            const paidMonths = allData
                .filter(item => item.status === 'paid')
                .reduce((sum, item) => sum + item.months, 0);
            const unpaidMonths = allData
                .filter(item => item.status === 'unpaid')
                .reduce((sum, item) => sum + item.months, 0);
            const advanceMonths = allData
                .filter(item => item.status === 'advance')
                .reduce((sum, item) => sum + item.months, 0);
            const pendingMonths = allData
                .filter(item => item.status === 'pending')
                .reduce((sum, item) => sum + item.months, 0);
            
            // Total months that require payment (excluding '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö')
            const totalMonths = paidMonths + unpaidMonths + advanceMonths + pendingMonths;
            
            // Calculate amounts
            const totalUnpaid = allData
                .filter(item => item.status === 'unpaid')
                .reduce((sum, item) => sum + (item.months * MONTHLY_FEE), 0);
            const paymentRate = totalMonths > 0 ? Math.round((paidMonths / totalMonths) * 100) : 0;

            // Calculate comprehensive financial data
            const totalRevenue = allData.reduce((sum, item) => sum + (item.months * MONTHLY_FEE), 0);
            const collectedRevenue = allData
                .filter(item => item.status === 'paid' || item.status === 'advance')
                .reduce((sum, item) => sum + (item.months * MONTHLY_FEE), 0);
            const pendingRevenue = totalUnpaid + allData
                .filter(item => item.status === 'pending')
                .reduce((sum, item) => sum + (item.months * MONTHLY_FEE), 0);
            const uniqueRooms = [...new Set(allData.filter(item => item.status === 'unpaid').map(item => item.room))];
            const averagePerRoom = uniqueRooms.length > 0 ? Math.round(totalUnpaid / uniqueRooms.length) : 0;

            // Animate numbers - show months with suffix
            animateNumber('paidCount', paidMonths, ' ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô');
            animateNumber('unpaidCount', unpaidMonths, ' ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô');
            animateNumber('paymentRate', paymentRate, '%');
            animateNumber('totalRevenue', totalRevenue);
            animateNumber('collectedRevenue', collectedRevenue);
            animateNumber('pendingRevenue', pendingRevenue);
            animateNumber('averagePerRoom', averagePerRoom);
            
            document.getElementById('totalUnpaid').textContent = totalUnpaid.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
            
            // Generate monthly and yearly summaries
            generateMonthlySummary();
            generateYearlySummary();
        }

        function generateMonthlySummary() {
            const monthNames = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
            const monthlyData = {};

            // Process data for monthly summary
            allData.forEach(item => {
                const year = item.year;
                if (!monthlyData[year]) monthlyData[year] = {};
                
                // Handle cross-year periods
                if (item.monthStart > item.monthEnd) {
                    // Previous year months
                    for (let m = item.monthStart; m <= 12; m++) {
                        const key = `${year-1}-${m}`;
                        if (!monthlyData[year-1]) monthlyData[year-1] = {};
                        if (!monthlyData[year-1][m]) monthlyData[year-1][m] = { paid: 0, unpaid: 0, advance: 0, pending: 0, total: 0 };
                        monthlyData[year-1][m].total += MONTHLY_FEE;
                        monthlyData[year-1][m][item.status] += MONTHLY_FEE;
                    }
                    // Current year months
                    for (let m = 1; m <= item.monthEnd; m++) {
                        if (!monthlyData[year][m]) monthlyData[year][m] = { paid: 0, unpaid: 0, advance: 0, pending: 0, total: 0 };
                        monthlyData[year][m].total += MONTHLY_FEE;
                        monthlyData[year][m][item.status] += MONTHLY_FEE;
                    }
                } else {
                    // Same year period
                    for (let m = item.monthStart; m <= item.monthEnd; m++) {
                        if (!monthlyData[year][m]) monthlyData[year][m] = { paid: 0, unpaid: 0, advance: 0, pending: 0, total: 0 };
                        monthlyData[year][m].total += MONTHLY_FEE;
                        monthlyData[year][m][item.status] += MONTHLY_FEE;
                    }
                }
            });

            const container = document.getElementById('monthlySummary');
            container.innerHTML = '';

            // Sort years and months
            const sortedYears = Object.keys(monthlyData).sort((a, b) => b - a);
            
            sortedYears.forEach(year => {
                const yearData = monthlyData[year];
                const sortedMonths = Object.keys(yearData).sort((a, b) => b - a);
                
                sortedMonths.forEach(month => {
                    const data = yearData[month];
                    const monthName = monthNames[month - 1];
                    const paymentRate = data.total > 0 ? Math.round((data.paid / data.total) * 100) : 0;
                    
                    const monthDiv = document.createElement('div');
                    monthDiv.className = 'bg-white rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow';
                    monthDiv.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-semibold text-gray-800">${monthName} ${year}</h4>
                            <span class="text-xs px-2 py-1 rounded-full ${paymentRate === 100 ? 'bg-green-100 text-green-800' : 'bg-orange-100 text-orange-800'}">${paymentRate}%</span>
                        </div>
                        <div class="space-y-1 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">‡∏£‡∏ß‡∏°:</span>
                                <span class="font-medium">${data.total.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-green-600">‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß:</span>
                                <span class="text-green-600 font-medium">${data.paid.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-red-600">‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞:</span>
                                <span class="text-red-600 font-medium">${data.unpaid.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                        </div>
                    `;
                    container.appendChild(monthDiv);
                });
            });
        }

        function generateYearlySummary() {
            const yearlyData = {};

            // Process data for yearly summary
            allData.forEach(item => {
                const year = item.year;
                if (!yearlyData[year]) yearlyData[year] = { paid: 0, unpaid: 0, total: 0, rooms: new Set() };
                
                const amount = item.months * MONTHLY_FEE;
                yearlyData[year].total += amount;
                yearlyData[year].rooms.add(item.room);
                
                if (item.status === 'paid') {
                    yearlyData[year].paid += amount;
                } else {
                    yearlyData[year].unpaid += amount;
                }
            });

            const container = document.getElementById('yearlySummary');
            container.innerHTML = '';

            // Sort years (newest first)
            const sortedYears = Object.keys(yearlyData).sort((a, b) => b - a);
            
            sortedYears.forEach(year => {
                const data = yearlyData[year];
                const paymentRate = data.total > 0 ? Math.round((data.paid / data.total) * 100) : 0;
                const roomCount = data.rooms.size;
                
                const yearDiv = document.createElement('div');
                yearDiv.className = 'bg-white rounded-lg p-6 border border-gray-200 hover:shadow-md transition-shadow';
                yearDiv.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-lg font-bold text-gray-800">‡∏õ‡∏µ ${year}</h4>
                        <div class="text-right">
                            <div class="text-xs px-3 py-1 rounded-full ${paymentRate >= 80 ? 'bg-green-100 text-green-800' : paymentRate >= 60 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">${paymentRate}% ‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</div>
                            <div class="text-xs text-gray-500 mt-1">${roomCount} ‡∏´‡πâ‡∏≠‡∏á</div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div class="bg-blue-50 rounded-lg p-3">
                            <div class="text-blue-600 text-xs font-medium">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°</div>
                            <div class="text-blue-800 font-bold text-lg">${data.total.toLocaleString()}</div>
                            <div class="text-blue-600 text-xs">‡∏ö‡∏≤‡∏ó</div>
                        </div>
                        <div class="bg-green-50 rounded-lg p-3">
                            <div class="text-green-600 text-xs font-medium">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</div>
                            <div class="text-green-800 font-bold text-lg">${data.paid.toLocaleString()}</div>
                            <div class="text-green-600 text-xs">‡∏ö‡∏≤‡∏ó</div>
                        </div>
                        <div class="bg-red-50 rounded-lg p-3">
                            <div class="text-red-600 text-xs font-medium">‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö</div>
                            <div class="text-red-800 font-bold text-lg">${data.unpaid.toLocaleString()}</div>
                            <div class="text-red-600 text-xs">‡∏ö‡∏≤‡∏ó</div>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-3">
                            <div class="text-purple-600 text-xs font-medium">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏´‡πâ‡∏≠‡∏á</div>
                            <div class="text-purple-800 font-bold text-lg">${Math.round(data.total / roomCount).toLocaleString()}</div>
                            <div class="text-purple-600 text-xs">‡∏ö‡∏≤‡∏ó</div>
                        </div>
                    </div>
                `;
                container.appendChild(yearDiv);
            });
        }

        function animateNumber(elementId, targetValue, suffix = '') {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const startValue = 0;
            const duration = 1500;
            const startTime = performance.now();

            function updateNumber(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const currentValue = Math.floor(startValue + (targetValue - startValue) * progress);
                
                if (suffix === '%') {
                    element.textContent = currentValue + suffix;
                } else if (suffix === ' ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô') {
                    element.textContent = currentValue.toLocaleString() + suffix;
                } else if (suffix === '') {
                    element.textContent = currentValue.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
                } else {
                    element.textContent = currentValue.toLocaleString() + suffix;
                }
                
                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            }
            
            requestAnimationFrame(updateNumber);
        }

        function filterData() {
            const statusFilter = document.getElementById('statusFilter').value;
            const yearFilter = document.getElementById('yearFilter').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            rowsPerPage = document.getElementById('rowsPerPage').value;
            currentPage = 1; // Reset to first page when filtering

            filteredData = allData;

            // Filter by status
            if (statusFilter !== 'all') {
                filteredData = filteredData.filter(item => item.status === statusFilter);
            }

            // Filter by year
            if (yearFilter !== 'all') {
                filteredData = filteredData.filter(item => item.year == yearFilter);
            }

            // Filter by search term
            if (searchTerm) {
                filteredData = filteredData.filter(item => 
                    item.name.toLowerCase().includes(searchTerm) || 
                    item.room.toLowerCase().includes(searchTerm)
                );
            }

            displayData(filteredData);
        }

        // Auto-refresh functionality
        let autoRefreshInterval;
        let lastRefreshTime = Date.now();

        function startAutoRefresh() {
            // Refresh every 5 minutes
            autoRefreshInterval = setInterval(async () => {
                try {
                    const indicator = document.getElementById('autoRefreshIndicator');
                    indicator.classList.add('animate-pulse');
                    
                    await loadData();
                    lastRefreshTime = Date.now();
                    
                    // Show success feedback
                    indicator.classList.remove('animate-pulse');
                    indicator.classList.add('bg-green-400');
                    
                    setTimeout(() => {
                        indicator.classList.remove('bg-green-400');
                    }, 1000);
                } catch (error) {
                    console.error('Auto-refresh failed:', error);
                    const indicator = document.getElementById('autoRefreshIndicator');
                    indicator.classList.remove('animate-pulse', 'bg-green-400');
                    indicator.classList.add('bg-red-400');
                    
                    setTimeout(() => {
                        indicator.classList.remove('bg-red-400');
                    }, 2000);
                }
            }, 5 * 60 * 1000); // 5 minutes
        }

        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
        }

        async function manualRefresh() {
            const refreshBtn = document.getElementById('refreshBtn');
            const originalText = refreshBtn.innerHTML;
            
            refreshBtn.innerHTML = `
                <svg class="w-4 h-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                <span class="hidden sm:inline">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
            `;
            refreshBtn.disabled = true;
            
            try {
                await loadData();
                lastRefreshTime = Date.now();
            } catch (error) {
                console.error('Manual refresh failed:', error);
            } finally {
                refreshBtn.innerHTML = originalText;
                refreshBtn.disabled = false;
            }
        }

        // Pagination functions
        function nextPage() {
            const totalPages = Math.ceil(filteredData.length / (rowsPerPage === 'all' ? filteredData.length : parseInt(rowsPerPage)));
            if (currentPage < totalPages && rowsPerPage !== 'all') {
                currentPage++;
                displayData(filteredData);
            }
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                displayData(filteredData);
            }
        }

        // Event listeners
        document.getElementById('statusFilter').addEventListener('change', filterData);
        document.getElementById('yearFilter').addEventListener('change', filterData);
        document.getElementById('viewMode').addEventListener('change', filterData);
        document.getElementById('searchInput').addEventListener('input', filterData);
        document.getElementById('rowsPerPage').addEventListener('change', filterData);
        document.getElementById('nextPage').addEventListener('click', nextPage);
        document.getElementById('prevPage').addEventListener('click', prevPage);
        document.getElementById('refreshBtn').addEventListener('click', manualRefresh);

        // Load data on page load
        window.addEventListener('load', async () => {
            // Add loading animation
            setTimeout(async () => {
                await loadData();
                startAutoRefresh(); // Start auto-refresh after initial load
            }, 500);
        });

        // Stop auto-refresh when page is hidden/closed
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                stopAutoRefresh();
            } else {
                startAutoRefresh();
            }
        });

        // Stop auto-refresh before page unload
        window.addEventListener('beforeunload', stopAutoRefresh);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'980a92c0747b7b3c',t:'MTc1ODEzMjc2Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
