<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        
        .slide-up {
            animation: slideUp 0.8s ease-out forwards;
        }
        
        .bounce-in {
            animation: bounceIn 1s ease-out forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .hover-lift {
            transition: all 0.3s ease;
        }
        
        .hover-lift:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .pulse-glow {
            animation: pulseGlow 2s infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8), 0 0 30px rgba(59, 130, 246, 0.6); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="glass-effect rounded-2xl p-8 mb-8 fade-in">
            <div class="text-center">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-white bg-opacity-20 rounded-full mb-4 bounce-in">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                    </svg>
                </div>
                <h1 class="text-4xl font-bold text-white mb-3">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á</h1>
                <p class="text-white text-opacity-90 text-lg">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á: 300 ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</p>
                <div class="mt-4 inline-flex items-center px-4 py-2 bg-white bg-opacity-20 rounded-full">
                    <div class="w-2 h-2 bg-green-400 rounded-full mr-2 pulse-glow"></div>
                    <span class="text-white text-sm">‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
                </div>
            </div>
        </div>



        <!-- Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-2xl shadow-xl p-6 hover-lift slide-up" style="animation-delay: 0.1s">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600 mb-1">‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
                        <p class="text-3xl font-bold text-green-600" id="paidCount">0</p>
                        <p class="text-xs text-green-500 mt-1">‚úì ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</p>
                    </div>
                    <div class="bg-gradient-to-br from-green-400 to-green-600 p-4 rounded-2xl">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-2xl shadow-xl p-6 hover-lift slide-up" style="animation-delay: 0.2s">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600 mb-1">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢</p>
                        <p class="text-3xl font-bold text-red-600" id="unpaidCount">0</p>
                        <p class="text-xs text-red-500 mt-1">‚ö† ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞</p>
                    </div>
                    <div class="bg-gradient-to-br from-red-400 to-red-600 p-4 rounded-2xl">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-2xl shadow-xl p-6 hover-lift slide-up" style="animation-delay: 0.3s">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600 mb-1">‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞</p>
                        <p class="text-3xl font-bold text-blue-600" id="totalUnpaid">0 ‡∏ö‡∏≤‡∏ó</p>
                        <p class="text-xs text-blue-500 mt-1">üí∞ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    </div>
                    <div class="bg-gradient-to-br from-blue-400 to-blue-600 p-4 rounded-2xl">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-2xl shadow-xl p-6 hover-lift slide-up" style="animation-delay: 0.4s">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600 mb-1">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢</p>
                        <p class="text-3xl font-bold text-purple-600" id="paymentRate">0%</p>
                        <p class="text-xs text-purple-500 mt-1">üìä ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå</p>
                    </div>
                    <div class="bg-gradient-to-br from-purple-400 to-purple-600 p-4 rounded-2xl">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Financial Summary Section -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-8 slide-up" style="animation-delay: 0.5s">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <svg class="w-7 h-7 text-blue-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-6 border border-blue-200">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-sm font-medium text-blue-700">üí∞ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
                        <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                        </div>
                    </div>
                    <p class="text-2xl font-bold text-blue-800" id="totalRevenue">0 ‡∏ö‡∏≤‡∏ó</p>
                    <p class="text-xs text-blue-600 mt-1">‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                </div>
                
                <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-6 border border-green-200">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-sm font-medium text-green-700">‚úÖ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</h4>
                        <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                    <p class="text-2xl font-bold text-green-800" id="collectedRevenue">0 ‡∏ö‡∏≤‡∏ó</p>
                    <p class="text-xs text-green-600 mt-1">‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
                </div>
                
                <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-xl p-6 border border-red-200">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-sm font-medium text-red-700">‚ö†Ô∏è ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö</h4>
                        <div class="w-8 h-8 bg-red-500 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                    <p class="text-2xl font-bold text-red-800" id="pendingRevenue">0 ‡∏ö‡∏≤‡∏ó</p>
                    <p class="text-xs text-red-600 mt-1">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞</p>
                </div>
                
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-6 border border-purple-200">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-sm font-medium text-purple-700">üìä ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á</h4>
                        <div class="w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
                            </svg>
                        </div>
                    </div>
                    <p class="text-2xl font-bold text-purple-800" id="averagePerRoom">0 ‡∏ö‡∏≤‡∏ó</p>
                    <p class="text-xs text-purple-600 mt-1">‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞</p>
                </div>
            </div>
            
            <!-- Monthly/Yearly Summary Tables -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-gray-50 rounded-xl p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 text-orange-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                    </h3>
                    <div class="space-y-3 max-h-64 overflow-y-auto" id="monthlySummary">
                        <!-- Monthly data will be populated here -->
                    </div>
                </div>
                
                <div class="bg-gray-50 rounded-xl p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 text-indigo-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏õ‡∏µ
                    </h3>
                    <div class="space-y-3" id="yearlySummary">
                        <!-- Yearly data will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <div class="bg-white rounded-2xl shadow-xl p-6 hover-lift slide-up" style="animation-delay: 0.6s">
                <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <div class="w-3 h-3 bg-blue-500 rounded-full mr-3"></div>
                    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞
                </h3>
                <div class="relative h-64">
                    <canvas id="paymentStatusChart"></canvas>
                </div>
            </div>
            
            <div class="bg-white rounded-2xl shadow-xl p-6 hover-lift slide-up" style="animation-delay: 0.7s">
                <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                    ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                </h3>
                <div class="relative h-64">
                    <canvas id="monthlyAmountChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Filter -->
        <div class="bg-white rounded-2xl shadow-xl p-6 mb-8 slide-up" style="animation-delay: 0.7s">
            <div class="flex flex-col lg:flex-row gap-4 items-center">
                <div class="flex flex-wrap items-center gap-4">
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                        </svg>
                        <select id="statusFilter" class="px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="unpaid">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢</option>
                            <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            <option value="paid">‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</option>
                            <option value="advance">‡∏à‡πà‡∏≤‡∏¢‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤</option>
                            <option value="pending">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <select id="yearFilter" class="px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="all">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</option>
                            <option value="2567">‡∏õ‡∏µ 2567</option>
                            <option value="2568">‡∏õ‡∏µ 2568</option>
                            <option value="2569">‡∏õ‡∏µ 2569</option>
                            <option value="2570">‡∏õ‡∏µ 2570</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                        </svg>
                        <select id="viewMode" class="px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="monthly">‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
                            <option value="yearly">‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                        </svg>
                        <select id="rowsPerPage" class="px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="10">10 ‡πÅ‡∏ñ‡∏ß</option>
                            <option value="20">20 ‡πÅ‡∏ñ‡∏ß</option>
                            <option value="50">50 ‡πÅ‡∏ñ‡∏ß</option>
                            <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex items-center gap-4 flex-1">
                    <input type="text" id="searchInput" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á..." 
                           class="flex-1 px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50 focus:bg-white transition-colors">
                    
                    <div class="flex items-center">
                        <button id="refreshBtn" class="px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            <span class="hidden sm:inline">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</span>
                        </button>
                        
                        <div class="ml-3 flex items-center">
                            <div class="w-2 h-2 bg-green-400 rounded-full mr-2 pulse-glow" id="autoRefreshIndicator"></div>
                            <span class="text-xs text-gray-500">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden slide-up" style="animation-delay: 0.8s">
            <div class="px-6 py-6 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                            <svg class="w-6 h-6 text-red-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞
                        </h2>
                        <p class="text-gray-600 mt-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-gray-500">‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>
                        <p class="text-lg font-semibold text-red-600" id="displayedRows">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                    </div>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gradient-to-r from-gray-100 to-gray-50">
                        <tr>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">üè† ‡∏´‡πâ‡∏≠‡∏á</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">üë§ ‡∏ä‡∏∑‡πà‡∏≠</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">üìÖ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">üí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">‚ö†Ô∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        </tr>
                    </thead>
                    <tbody id="dataTable" class="bg-white divide-y divide-gray-100">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            <div class="px-6 py-4 bg-gray-50 border-t border-gray-100">
                <div class="flex items-center justify-between">
                    <div class="text-sm text-gray-600">
                        ‡πÅ‡∏™‡∏î‡∏á <span id="startRow">1</span>-<span id="endRow">10</span> ‡∏à‡∏≤‡∏Å <span id="totalRows">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                    </div>
                    <div class="flex space-x-2">
                        <button id="prevPage" class="px-3 py-1 text-sm bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                            ‚Üê ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                        </button>
                        <button id="nextPage" class="px-3 py-1 text-sm bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                            ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="hidden bg-white rounded-xl shadow-lg p-8 text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>

        <!-- Error State -->
        <div id="errorState" class="hidden bg-red-50 border border-red-200 rounded-xl p-6">
            <div class="flex items-center">
                <svg class="w-6 h-6 text-red-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                    <h3 class="text-red-800 font-medium">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</h3>
                    <p class="text-red-600 text-sm mt-1">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Google Sheets</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allData = [];
        let filteredData = [];
        let currentPage = 1;
        let rowsPerPage = 10;
        const MONTHLY_FEE = 300;
        const SHEETS_ID = "1yklkO0OaVsZKpJc4EGcNDkpRsNd8DNWiJKlUnpBwBEE";
        const SHEETS_URL = `https://docs.google.com/spreadsheets/d/${SHEETS_ID}/gviz/tq?tqx=out:csv&sheet=Sheet1`;

        // Month mapping for Thai months
        const monthMapping = {
            '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°': 1, '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå': 2, '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°': 3, '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô': 4, '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°': 5, '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô': 6,
            '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°': 7, '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°': 8, '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô': 9, '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°': 10, '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô': 11, '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°': 12
        };

        const monthNames = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];

        async function fetchGoogleSheetsData() {
            try {
                const response = await fetch(SHEETS_URL);
                const csvText = await response.text();
                return parseCSVData(csvText);
            } catch (error) {
                console.error('Error fetching Google Sheets data:', error);
                // Fallback to sample data if fetch fails
                return getSampleData();
            }
        }

        function parseCSVData(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
            const data = [];

            // Find column indices
            const houseNumIndex = headers.findIndex(h => h.includes('‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà'));
            const nameIndex = headers.findIndex(h => h.includes('‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•'));
            const yearIndex = headers.findIndex(h => h.includes('‡∏õ‡∏µ'));
            const monthStartIndex = headers.findIndex(h => h.includes('‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°'));

            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;
                
                const row = lines[i].split(',').map(cell => cell.replace(/"/g, '').trim());
                if (row.length < headers.length) continue;

                const houseNum = row[houseNumIndex] || '';
                const name = row[nameIndex] || '';
                const year = parseInt(row[yearIndex]) || 2567;

                if (!houseNum || !name) continue;

                // Process monthly payment data
                const monthlyPayments = [];
                for (let monthIndex = 0; monthIndex < 12; monthIndex++) {
                    const cellValue = row[monthStartIndex + monthIndex] || '';
                    monthlyPayments.push(cellValue);
                }

                // Calculate payment periods and status
                const paymentPeriods = calculatePaymentPeriods(monthlyPayments, year);
                
                paymentPeriods.forEach(period => {
                    data.push({
                        room: houseNum,
                        name: name,
                        months: period.months,
                        status: period.status,
                        period: period.periodText,
                        year: year,
                        monthStart: period.startMonth,
                        monthEnd: period.endMonth
                    });
                });
            }

            return data;
        }

        function calculatePaymentPeriods(monthlyPayments, year) {
            const periods = [];
            let currentPeriod = null;

            monthlyPayments.forEach((payment, index) => {
                const monthNum = index + 1;
                
                // Define payment status based on database values
                let status = null;
                let shouldTrack = true;
                
                switch (payment.trim()) {
                    case '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß':
                        status = 'paid';
                        break;
                    case '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢':
                        status = 'unpaid';
                        break;
                    case '‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤':
                        status = 'advance';
                        break;
                    case '‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•':
                        status = 'pending';
                        break;
                    case '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö':
                        shouldTrack = false;
                        break;
                    case '':
                        status = 'unpaid'; // Empty cells treated as unpaid
                        break;
                    default:
                        status = 'unpaid'; // Unknown values treated as unpaid
                        break;
                }

                if (!shouldTrack) {
                    // End current period for '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö'
                    if (currentPeriod && currentPeriod.months > 0) {
                        currentPeriod.periodText = formatPeriod(currentPeriod.startMonth, currentPeriod.endMonth, year);
                        periods.push({...currentPeriod});
                        currentPeriod = null;
                    }
                    return;
                }

                if (!currentPeriod) {
                    currentPeriod = {
                        startMonth: monthNum,
                        endMonth: monthNum,
                        months: 1,
                        status: status
                    };
                } else if (currentPeriod.status === status) {
                    // Continue current period
                    currentPeriod.endMonth = monthNum;
                    currentPeriod.months++;
                } else {
                    // End current period and start new period
                    if (currentPeriod.months > 0) {
                        currentPeriod.periodText = formatPeriod(currentPeriod.startMonth, currentPeriod.endMonth, year);
                        periods.push({...currentPeriod});
                    }
                    currentPeriod = {
                        startMonth: monthNum,
                        endMonth: monthNum,
                        months: 1,
                        status: status
                    };
                }
            });

            // Add final period if exists
            if (currentPeriod && currentPeriod.months > 0) {
                currentPeriod.periodText = formatPeriod(currentPeriod.startMonth, currentPeriod.endMonth, year);
                periods.push(currentPeriod);
            }

            return periods.filter(p => p.months > 0);
        }

        function formatPeriod(startMonth, endMonth, year) {
            if (startMonth === endMonth) {
                return `${monthNames[startMonth - 1]} ${year}`;
            } else {
                return `${monthNames[startMonth - 1]}-${monthNames[endMonth - 1]} ${year}`;
            }
        }

        function getSampleData() {
            // Fallback sample data based on your sheet structure with all status types
            return [
                { room: "998/1", name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏∏‡∏ô‡∏±‡∏ô‡∏ó‡∏≤ ‡∏™‡∏∏‡∏Ç‡πÅ‡∏Å‡πâ‡∏ß/‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ä‡∏∏‡∏ï‡∏¥‡∏°‡∏≤ ‡∏®‡∏¥‡∏£‡∏¥‡∏™‡∏≠‡∏ô", months: 7, status: "unpaid", period: "‡∏°.‡∏Ñ.-‡∏Å.‡∏Ñ. 2567", year: 2567, monthStart: 1, monthEnd: 7 },
                { room: "998/1", name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏∏‡∏ô‡∏±‡∏ô‡∏ó‡∏≤ ‡∏™‡∏∏‡∏Ç‡πÅ‡∏Å‡πâ‡∏ß/‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ä‡∏∏‡∏ï‡∏¥‡∏°‡∏≤ ‡∏®‡∏¥‡∏£‡∏¥‡∏™‡∏≠‡∏ô", months: 5, status: "paid", period: "‡∏™.‡∏Ñ.-‡∏ò.‡∏Ñ. 2567", year: 2567, monthStart: 8, monthEnd: 12 },
                { room: "998/2", name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏®‡∏¥‡∏£‡∏¥‡∏£‡∏±‡∏ï‡∏ô‡πå ‡∏†‡∏≤‡∏≠‡∏∏‡∏†‡∏±‡∏¢", months: 3, status: "advance", period: "‡∏°.‡∏Ñ.-‡∏°‡∏µ.‡∏Ñ. 2568", year: 2568, monthStart: 1, monthEnd: 3 },
                { room: "998/2", name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏®‡∏¥‡∏£‡∏¥‡∏£‡∏±‡∏ï‡∏ô‡πå ‡∏†‡∏≤‡∏≠‡∏∏‡∏†‡∏±‡∏¢", months: 5, status: "paid", period: "‡∏™.‡∏Ñ.-‡∏ò.‡∏Ñ. 2567", year: 2567, monthStart: 8, monthEnd: 12 },
                { room: "998/3", name: "‡∏ô‡∏≤‡∏¢‡∏ò‡∏ß‡∏±‡∏ä ‡∏õ‡∏á‡∏£‡∏±‡∏á‡∏©‡∏µ", months: 1, status: "unpaid", period: "‡∏Å.‡∏û. 2567", year: 2567, monthStart: 2, monthEnd: 2 },
                { room: "998/3", name: "‡∏ô‡∏≤‡∏¢‡∏ò‡∏ß‡∏±‡∏ä ‡∏õ‡∏á‡∏£‡∏±‡∏á‡∏©‡∏µ", months: 2, status: "pending", period: "‡∏û.‡∏¢.-‡∏ò.‡∏Ñ. 2567", year: 2567, monthStart: 11, monthEnd: 12 },
                { room: "998/4", name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏∏‡∏à‡∏¥‡∏ï‡∏£‡∏≤ ‡∏°‡∏π‡∏•‡∏•‡∏µ", months: 1, status: "unpaid", period: "‡∏Å.‡∏û. 2567", year: 2567, monthStart: 2, monthEnd: 2 },
                { room: "998/4", name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏∏‡∏à‡∏¥‡∏ï‡∏£‡∏≤ ‡∏°‡∏π‡∏•‡∏•‡∏µ", months: 5, status: "paid", period: "‡∏™.‡∏Ñ.-‡∏ò.‡∏Ñ. 2567", year: 2567, monthStart: 8, monthEnd: 12 },
                { room: "998/5", name: "‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏≤ ‡πÄ‡∏´‡∏•‡πà‡∏≤‡πÇ‡∏ô‡∏ô‡∏Ç‡∏ß‡∏≤", months: 4, status: "unpaid", period: "‡∏°.‡∏Ñ.-‡πÄ‡∏°.‡∏¢. 2567", year: 2567, monthStart: 1, monthEnd: 4 },
                { room: "998/5", name: "‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏≤ ‡πÄ‡∏´‡∏•‡πà‡∏≤‡πÇ‡∏ô‡∏ô‡∏Ç‡∏ß‡∏≤", months: 2, status: "advance", period: "‡∏û.‡∏Ñ.-‡∏°‡∏¥.‡∏¢. 2567", year: 2567, monthStart: 5, monthEnd: 6 },
                { room: "998/6", name: "‡∏ô‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏ó‡∏ò‡πå ‡πÉ‡∏à‡∏î‡∏µ", months: 3, status: "pending", period: "‡∏ï.‡∏Ñ.-‡∏ò.‡∏Ñ. 2567", year: 2567, monthStart: 10, monthEnd: 12 }
            ];
        }

        let paymentChart, monthlyChart;

        function createPaymentStatusChart() {
            const ctx = document.getElementById('paymentStatusChart').getContext('2d');
            
            // Count months for each status
            const paidCount = allData.filter(item => item.status === 'paid').reduce((sum, item) => sum + item.months, 0);
            const unpaidCount = allData.filter(item => item.status === 'unpaid').reduce((sum, item) => sum + item.months, 0);
            const advanceCount = allData.filter(item => item.status === 'advance').reduce((sum, item) => sum + item.months, 0);
            const pendingCount = allData.filter(item => item.status === 'pending').reduce((sum, item) => sum + item.months, 0);

            if (paymentChart) paymentChart.destroy();

            const chartData = [];
            const chartLabels = [];
            const chartColors = [];
            const chartBorderColors = [];

            if (paidCount > 0) {
                chartData.push(paidCount);
                chartLabels.push('‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                chartColors.push('rgba(34, 197, 94, 0.8)');
                chartBorderColors.push('rgba(34, 197, 94, 1)');
            }
            if (unpaidCount > 0) {
                chartData.push(unpaidCount);
                chartLabels.push('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢');
                chartColors.push('rgba(239, 68, 68, 0.8)');
                chartBorderColors.push('rgba(239, 68, 68, 1)');
            }
            if (advanceCount > 0) {
                chartData.push(advanceCount);
                chartLabels.push('‡∏à‡πà‡∏≤‡∏¢‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤');
                chartColors.push('rgba(59, 130, 246, 0.8)');
                chartBorderColors.push('rgba(59, 130, 246, 1)');
            }
            if (pendingCount > 0) {
                chartData.push(pendingCount);
                chartLabels.push('‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
                chartColors.push('rgba(245, 158, 11, 0.8)');
                chartBorderColors.push('rgba(245, 158, 11, 1)');
            }

            paymentChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        data: chartData,
                        backgroundColor: chartColors,
                        borderColor: chartBorderColors,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    family: 'Sarabun',
                                    size: 14
                                }
                            }
                        }
                    }
                }
            });
        }

        function createMonthlyAmountChart() {
            const ctx = document.getElementById('monthlyAmountChart').getContext('2d');
            
            // Group data by months owed
            const monthsData = {};
            allData.forEach(item => {
                if (item.status === 'unpaid') {
                    monthsData[item.months] = (monthsData[item.months] || 0) + 1;
                }
            });

            const labels = Object.keys(monthsData).sort((a, b) => a - b).map(m => `${m} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`);
            const data = Object.keys(monthsData).sort((a, b) => a - b).map(m => monthsData[m] * m * MONTHLY_FEE);

            if (monthlyChart) monthlyChart.destroy();

            monthlyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)',
                        data: data,
                        backgroundColor: 'rgba(59, 130, 246, 0.8)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
                                },
                                font: {
                                    family: 'Sarabun'
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    family: 'Sarabun'
                                }
                            }
                        }
                    }
                }
            });
        }

        async function loadData() {
            try {
                document.getElementById('loadingState').classList.remove('hidden');
                document.getElementById('errorState').classList.add('hidden');
                
                // Fetch data from Google Sheets
                allData = await fetchGoogleSheetsData();
                
                if (allData.length === 0) {
                    throw new Error('No data found');
                }
                
                filterData();
                updateSummary();
                createPaymentStatusChart();
                createMonthlyAmountChart();
                
                document.getElementById('loadingState').classList.add('hidden');
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('errorState').classList.remove('hidden');
                
                // Use fallback sample data
                allData = getSampleData();
                filterData();
                updateSummary();
                createPaymentStatusChart();
                createMonthlyAmountChart();
            }
        }

        function displayData(data) {
            const tbody = document.getElementById('dataTable');
            tbody.innerHTML = '';
            
            const viewMode = document.getElementById('viewMode').value;

            // Calculate pagination
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = rowsPerPage === 'all' ? data.length : startIndex + parseInt(rowsPerPage);
            const paginatedData = rowsPerPage === 'all' ? data : data.slice(startIndex, endIndex);

            if (viewMode === 'yearly') {
                displayYearlyData(paginatedData, data.length, startIndex, Math.min(endIndex, data.length));
            } else {
                displayMonthlyData(paginatedData, data.length, startIndex, Math.min(endIndex, data.length));
            }
        }

        function displayMonthlyData(paginatedData, totalLength, startIndex, endIndex) {
            const tbody = document.getElementById('dataTable');
            
            paginatedData.forEach((item, index) => {
                const total = item.months * MONTHLY_FEE;
                
                // Define status display based on all possible statuses
                let statusClass, statusText;
                switch (item.status) {
                    case 'paid':
                        statusClass = 'bg-green-100 text-green-800 border-green-200';
                        statusText = '‚úÖ ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß';
                        break;
                    case 'unpaid':
                        statusClass = 'bg-red-100 text-red-800 border-red-200';
                        statusText = '‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢';
                        break;
                    case 'advance':
                        statusClass = 'bg-blue-100 text-blue-800 border-blue-200';
                        statusText = 'üí∞ ‡∏à‡πà‡∏≤‡∏¢‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤';
                        break;
                    case 'pending':
                        statusClass = 'bg-yellow-100 text-yellow-800 border-yellow-200';
                        statusText = '‚è≥ ‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                        break;
                    default:
                        statusClass = 'bg-gray-100 text-gray-800 border-gray-200';
                        statusText = '‚ùì ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                        break;
                }

                const row = document.createElement('tr');
                row.className = 'hover:bg-blue-50 transition-colors duration-200';
                row.style.animationDelay = `${index * 0.05}s`;
                row.classList.add('fade-in');
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                <span class="text-blue-600 font-bold text-sm">${item.room}</span>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${item.name}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${item.period}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            ${item.months} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-bold text-gray-900">${total.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                        <div class="text-xs text-gray-500">${MONTHLY_FEE} √ó ${item.months}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold border ${statusClass}">
                            ${statusText}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });

            updatePaginationInfo(totalLength, startIndex, endIndex);
        }

        function displayYearlyData(paginatedData, totalLength, startIndex, endIndex) {
            const tbody = document.getElementById('dataTable');
            
            // Group data by room and year
            const yearlyGrouped = {};
            paginatedData.forEach(item => {
                const key = `${item.room}-${item.year}`;
                if (!yearlyGrouped[key]) {
                    yearlyGrouped[key] = {
                        room: item.room,
                        name: item.name,
                        year: item.year,
                        totalMonths: 0,
                        paidMonths: 0,
                        unpaidMonths: 0,
                        advanceMonths: 0,
                        pendingMonths: 0,
                        totalAmount: 0,
                        paidAmount: 0,
                        unpaidAmount: 0,
                        advanceAmount: 0,
                        pendingAmount: 0,
                        periods: []
                    };
                }
                
                const group = yearlyGrouped[key];
                group.totalMonths += item.months;
                group.totalAmount += item.months * MONTHLY_FEE;
                group.periods.push(item.period);
                
                switch (item.status) {
                    case 'paid':
                        group.paidMonths += item.months;
                        group.paidAmount += item.months * MONTHLY_FEE;
                        break;
                    case 'unpaid':
                        group.unpaidMonths += item.months;
                        group.unpaidAmount += item.months * MONTHLY_FEE;
                        break;
                    case 'advance':
                        group.advanceMonths += item.months;
                        group.advanceAmount += item.months * MONTHLY_FEE;
                        break;
                    case 'pending':
                        group.pendingMonths += item.months;
                        group.pendingAmount += item.months * MONTHLY_FEE;
                        break;
                }
            });

            Object.values(yearlyGrouped).forEach((group, index) => {
                const paymentRate = group.totalMonths > 0 ? Math.round((group.paidMonths / group.totalMonths) * 100) : 0;
                const statusClass = paymentRate === 100 ? 'bg-green-100 text-green-800' : paymentRate >= 50 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800';
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-blue-50 transition-colors duration-200';
                row.style.animationDelay = `${index * 0.05}s`;
                row.classList.add('fade-in');
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                <span class="text-blue-600 font-bold text-sm">${group.room}</span>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${group.name}</div>
                        <div class="text-xs text-gray-500">‡∏õ‡∏µ ${group.year}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                        <div class="space-y-1">
                            <div class="text-green-600">‡∏à‡πà‡∏≤‡∏¢: ${group.paidMonths} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                            <div class="text-red-600">‡∏Ñ‡πâ‡∏≤‡∏á: ${group.unpaidMonths} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                            ${group.advanceMonths > 0 ? `<div class="text-blue-600">‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤: ${group.advanceMonths} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>` : ''}
                            ${group.pendingMonths > 0 ? `<div class="text-yellow-600">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${group.pendingMonths} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>` : ''}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            ${group.totalMonths} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-bold text-gray-900">${group.totalAmount.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                        <div class="text-xs text-green-600">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ${group.paidAmount.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                        <div class="text-xs text-red-600">‡∏Ñ‡πâ‡∏≤‡∏á: ${group.unpaidAmount.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                        ${group.advanceAmount > 0 ? `<div class="text-xs text-blue-600">‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤: ${group.advanceAmount.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>` : ''}
                        ${group.pendingAmount > 0 ? `<div class="text-xs text-yellow-600">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${group.pendingAmount.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>` : ''}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold ${statusClass}">
                            ${paymentRate}% ‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });

            updatePaginationInfo(totalLength, startIndex, endIndex);
        }

        function updatePaginationInfo(total, start, end) {
            document.getElementById('totalRows').textContent = total;
            document.getElementById('startRow').textContent = total > 0 ? start + 1 : 0;
            document.getElementById('endRow').textContent = end;
            document.getElementById('displayedRows').textContent = `${total} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;

            const totalPages = Math.ceil(total / (rowsPerPage === 'all' ? total : parseInt(rowsPerPage)));
            document.getElementById('prevPage').disabled = currentPage <= 1;
            document.getElementById('nextPage').disabled = currentPage >= totalPages || rowsPerPage === 'all';
        }

        function updateSummary() {
            // Calculate months for all statuses
            const paidMonths = allData
                .filter(item => item.status === 'paid')
                .reduce((sum, item) => sum + item.months, 0);
            const unpaidMonths = allData
                .filter(item => item.status === 'unpaid')
                .reduce((sum, item) => sum + item.months, 0);
            const advanceMonths = allData
                .filter(item => item.status === 'advance')
                .reduce((sum, item) => sum + item.months, 0);
            const pendingMonths = allData
                .filter(item => item.status === 'pending')
                .reduce((sum, item) => sum + item.months, 0);
            
            // Total months that require payment (excluding '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö')
            const totalMonths = paidMonths + unpaidMonths + advanceMonths + pendingMonths;
            
            // Calculate amounts
            const totalUnpaid = allData
                .filter(item => item.status === 'unpaid')
                .reduce((sum, item) => sum + (item.months * MONTHLY_FEE), 0);
            const paymentRate = totalMonths > 0 ? Math.round((paidMonths / totalMonths) * 100) : 0;

            // Calculate comprehensive financial data
            const totalRevenue = allData.reduce((sum, item) => sum + (item.months * MONTHLY_FEE), 0);
            const collectedRevenue = allData
                .filter(item => item.status === 'paid' || item.status === 'advance')
                .reduce((sum, item) => sum + (item.months * MONTHLY_FEE), 0);
            const pendingRevenue = totalUnpaid + allData
                .filter(item => item.status === 'pending')
                .reduce((sum, item) => sum + (item.months * MONTHLY_FEE), 0);
            const uniqueRooms = [...new Set(allData.filter(item => item.status === 'unpaid').map(item => item.room))];
            const averagePerRoom = uniqueRooms.length > 0 ? Math.round(totalUnpaid / uniqueRooms.length) : 0;

            // Animate numbers - show months with suffix
            animateNumber('paidCount', paidMonths, ' ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô');
            animateNumber('unpaidCount', unpaidMonths, ' ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô');
            animateNumber('paymentRate', paymentRate, '%');
            animateNumber('totalRevenue', totalRevenue);
            animateNumber('collectedRevenue', collectedRevenue);
            animateNumber('pendingRevenue', pendingRevenue);
            animateNumber('averagePerRoom', averagePerRoom);
            
            document.getElementById('totalUnpaid').textContent = totalUnpaid.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
            
            // Generate monthly and yearly summaries
            generateMonthlySummary();
            generateYearlySummary();
        }

        function generateMonthlySummary() {
            const monthNames = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
            const monthlyData = {};

            // Process data for monthly summary
            allData.forEach(item => {
                const year = item.year;
                if (!monthlyData[year]) monthlyData[year] = {};
                
                // Handle cross-year periods
                if (item.monthStart > item.monthEnd) {
                    // Previous year months
                    for (let m = item.monthStart; m <= 12; m++) {
                        const key = `${year-1}-${m}`;
                        if (!monthlyData[year-1]) monthlyData[year-1] = {};
                        if (!monthlyData[year-1][m]) monthlyData[year-1][m] = { paid: 0, unpaid: 0, advance: 0, pending: 0, total: 0 };
                        monthlyData[year-1][m].total += MONTHLY_FEE;
                        monthlyData[year-1][m][item.status] += MONTHLY_FEE;
                    }
                    // Current year months
                    for (let m = 1; m <= item.monthEnd; m++) {
                        if (!monthlyData[year][m]) monthlyData[year][m] = { paid: 0, unpaid: 0, advance: 0, pending: 0, total: 0 };
                        monthlyData[year][m].total += MONTHLY_FEE;
                        monthlyData[year][m][item.status] += MONTHLY_FEE;
                    }
                } else {
                    // Same year period
                    for (let m = item.monthStart; m <= item.monthEnd; m++) {
                        if (!monthlyData[year][m]) monthlyData[year][m] = { paid: 0, unpaid: 0, advance: 0, pending: 0, total: 0 };
                        monthlyData[year][m].total += MONTHLY_FEE;
                        monthlyData[year][m][item.status] += MONTHLY_FEE;
                    }
                }
            });

            const container = document.getElementById('monthlySummary');
            container.innerHTML = '';

            // Sort years and months
            const sortedYears = Object.keys(monthlyData).sort((a, b) => b - a);
            
            sortedYears.forEach(year => {
                const yearData = monthlyData[year];
                const sortedMonths = Object.keys(yearData).sort((a, b) => b - a);
                
                sortedMonths.forEach(month => {
                    const data = yearData[month];
                    const monthName = monthNames[month - 1];
                    const paymentRate = data.total > 0 ? Math.round((data.paid / data.total) * 100) : 0;
                    
                    const monthDiv = document.createElement('div');
                    monthDiv.className = 'bg-white rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow';
                    monthDiv.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-semibold text-gray-800">${monthName} ${year}</h4>
                            <span class="text-xs px-2 py-1 rounded-full ${paymentRate === 100 ? 'bg-green-100 text-green-800' : 'bg-orange-100 text-orange-800'}">${paymentRate}%</span>
                        </div>
                        <div class="space-y-1 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">‡∏£‡∏ß‡∏°:</span>
                                <span class="font-medium">${data.total.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-green-600">‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß:</span>
                                <span class="text-green-600 font-medium">${data.paid.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-red-600">‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞:</span>
                                <span class="text-red-600 font-medium">${data.unpaid.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                        </div>
                    `;
                    container.appendChild(monthDiv);
                });
            });
        }

        function generateYearlySummary() {
            const yearlyData = {};

            // Process data for yearly summary
            allData.forEach(item => {
                const year = item.year;
                if (!yearlyData[year]) yearlyData[year] = { paid: 0, unpaid: 0, total: 0, rooms: new Set() };
                
                const amount = item.months * MONTHLY_FEE;
                yearlyData[year].total += amount;
                yearlyData[year].rooms.add(item.room);
                
                if (item.status === 'paid') {
                    yearlyData[year].paid += amount;
                } else {
                    yearlyData[year].unpaid += amount;
                }
            });

            const container = document.getElementById('yearlySummary');
            container.innerHTML = '';

            // Sort years (newest first)
            const sortedYears = Object.keys(yearlyData).sort((a, b) => b - a);
            
            sortedYears.forEach(year => {
                const data = yearlyData[year];
                const paymentRate = data.total > 0 ? Math.round((data.paid / data.total) * 100) : 0;
                const roomCount = data.rooms.size;
                
                const yearDiv = document.createElement('div');
                yearDiv.className = 'bg-white rounded-lg p-6 border border-gray-200 hover:shadow-md transition-shadow';
                yearDiv.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-lg font-bold text-gray-800">‡∏õ‡∏µ ${year}</h4>
                        <div class="text-right">
                            <div class="text-xs px-3 py-1 rounded-full ${paymentRate >= 80 ? 'bg-green-100 text-green-800' : paymentRate >= 60 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">${paymentRate}% ‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</div>
                            <div class="text-xs text-gray-500 mt-1">${roomCount} ‡∏´‡πâ‡∏≠‡∏á</div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div class="bg-blue-50 rounded-lg p-3">
                            <div class="text-blue-600 text-xs font-medium">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°</div>
                            <div class="text-blue-800 font-bold text-lg">${data.total.toLocaleString()}</div>
                            <div class="text-blue-600 text-xs">‡∏ö‡∏≤‡∏ó</div>
                        </div>
                        <div class="bg-green-50 rounded-lg p-3">
                            <div class="text-green-600 text-xs font-medium">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</div>
                            <div class="text-green-800 font-bold text-lg">${data.paid.toLocaleString()}</div>
                            <div class="text-green-600 text-xs">‡∏ö‡∏≤‡∏ó</div>
                        </div>
                        <div class="bg-red-50 rounded-lg p-3">
                            <div class="text-red-600 text-xs font-medium">‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö</div>
                            <div class="text-red-800 font-bold text-lg">${data.unpaid.toLocaleString()}</div>
                            <div class="text-red-600 text-xs">‡∏ö‡∏≤‡∏ó</div>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-3">
                            <div class="text-purple-600 text-xs font-medium">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏´‡πâ‡∏≠‡∏á</div>
                            <div class="text-purple-800 font-bold text-lg">${Math.round(data.total / roomCount).toLocaleString()}</div>
                            <div class="text-purple-600 text-xs">‡∏ö‡∏≤‡∏ó</div>
                        </div>
                    </div>
                `;
                container.appendChild(yearDiv);
            });
        }

        function animateNumber(elementId, targetValue, suffix = '') {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const startValue = 0;
            const duration = 1500;
            const startTime = performance.now();

            function updateNumber(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const currentValue = Math.floor(startValue + (targetValue - startValue) * progress);
                
                if (suffix === '%') {
                    element.textContent = currentValue + suffix;
                } else if (suffix === ' ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô') {
                    element.textContent = currentValue.toLocaleString() + suffix;
                } else if (suffix === '') {
                    element.textContent = currentValue.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
                } else {
                    element.textContent = currentValue.toLocaleString() + suffix;
                }
                
                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            }
            
            requestAnimationFrame(updateNumber);
        }

        function filterData() {
            const statusFilter = document.getElementById('statusFilter').value;
            const yearFilter = document.getElementById('yearFilter').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            rowsPerPage = document.getElementById('rowsPerPage').value;
            currentPage = 1; // Reset to first page when filtering

            filteredData = allData;

            // Filter by status
            if (statusFilter !== 'all') {
                filteredData = filteredData.filter(item => item.status === statusFilter);
            }

            // Filter by year
            if (yearFilter !== 'all') {
                filteredData = filteredData.filter(item => item.year == yearFilter);
            }

            // Filter by search term
            if (searchTerm) {
                filteredData = filteredData.filter(item => 
                    item.name.toLowerCase().includes(searchTerm) || 
                    item.room.toLowerCase().includes(searchTerm)
                );
            }

            displayData(filteredData);
        }

        // Auto-refresh functionality
        let autoRefreshInterval;
        let lastRefreshTime = Date.now();

        function startAutoRefresh() {
            // Refresh every 5 minutes
            autoRefreshInterval = setInterval(async () => {
                try {
                    const indicator = document.getElementById('autoRefreshIndicator');
                    indicator.classList.add('animate-pulse');
                    
                    await loadData();
                    lastRefreshTime = Date.now();
                    
                    // Show success feedback
                    indicator.classList.remove('animate-pulse');
                    indicator.classList.add('bg-green-400');
                    
                    setTimeout(() => {
                        indicator.classList.remove('bg-green-400');
                    }, 1000);
                } catch (error) {
                    console.error('Auto-refresh failed:', error);
                    const indicator = document.getElementById('autoRefreshIndicator');
                    indicator.classList.remove('animate-pulse', 'bg-green-400');
                    indicator.classList.add('bg-red-400');
                    
                    setTimeout(() => {
                        indicator.classList.remove('bg-red-400');
                    }, 2000);
                }
            }, 5 * 60 * 1000); // 5 minutes
        }

        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
        }

        async function manualRefresh() {
            const refreshBtn = document.getElementById('refreshBtn');
            const originalText = refreshBtn.innerHTML;
            
            refreshBtn.innerHTML = `
                <svg class="w-4 h-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                <span class="hidden sm:inline">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
            `;
            refreshBtn.disabled = true;
            
            try {
                await loadData();
                lastRefreshTime = Date.now();
            } catch (error) {
                console.error('Manual refresh failed:', error);
            } finally {
                refreshBtn.innerHTML = originalText;
                refreshBtn.disabled = false;
            }
        }

        // Pagination functions
        function nextPage() {
            const totalPages = Math.ceil(filteredData.length / (rowsPerPage === 'all' ? filteredData.length : parseInt(rowsPerPage)));
            if (currentPage < totalPages && rowsPerPage !== 'all') {
                currentPage++;
                displayData(filteredData);
            }
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                displayData(filteredData);
            }
        }

        // Event listeners
        document.getElementById('statusFilter').addEventListener('change', filterData);
        document.getElementById('yearFilter').addEventListener('change', filterData);
        document.getElementById('viewMode').addEventListener('change', filterData);
        document.getElementById('searchInput').addEventListener('input', filterData);
        document.getElementById('rowsPerPage').addEventListener('change', filterData);
        document.getElementById('nextPage').addEventListener('click', nextPage);
        document.getElementById('prevPage').addEventListener('click', prevPage);
        document.getElementById('refreshBtn').addEventListener('click', manualRefresh);

        // Load data on page load
        window.addEventListener('load', async () => {
            // Add loading animation
            setTimeout(async () => {
                await loadData();
                startAutoRefresh(); // Start auto-refresh after initial load
            }, 500);
        });

        // Stop auto-refresh when page is hidden/closed
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                stopAutoRefresh();
            } else {
                startAutoRefresh();
            }
        });

        // Stop auto-refresh before page unload
        window.addEventListener('beforeunload', stopAutoRefresh);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'980a92c0747b7b3c',t:'MTc1ODEzMjc2Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

        
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 768px) {
            .month-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 6px;
            }
            .month-card {
                padding: 8px 6px;
                font-size: 0.7rem;
                min-height: 50px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-purple-600/20 to-blue-600/20"></div>
        <div class="relative container mx-auto px-6 py-12 text-center">
            <div class="mb-8">
                <i class="fas fa-home text-6xl text-white mb-4 opacity-90"></i>
                <h1 class="text-4xl md:text-6xl font-bold text-white mb-4">
                    ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ
                </h1>
                <p class="text-xl text-white/80 max-w-2xl mx-auto">
                    ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢‡∏î‡∏≤‡∏¢
                </p>
            </div>
        </div>
    </div>

    <!-- Search Section -->
    <div class="container mx-auto px-6 py-8">
        <div class="max-w-2xl mx-auto">
            <div class="bg-white rounded-2xl p-6 shadow-xl">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <div class="relative">
                            <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500"></i>
                            <input 
                                type="text" 
                                id="searchInput" 
                                placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ‡πÄ‡∏ä‡πà‡∏ô 998/1"
                                class="w-full pl-12 pr-4 py-4 text-lg border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-purple-500/30 focus:border-purple-500 focus:outline-none transition-all duration-300"
                            >
                        </div>
                    </div>
                    <div class="flex gap-3">
                        <button 
                            onclick="searchData()" 
                            class="px-8 py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-semibold hover:from-purple-700 hover:to-blue-700 transform hover:scale-105 transition-all duration-300 shadow-lg"
                        >
                            <i class="fas fa-search mr-2"></i>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                        </button>
                        <button 
                            onclick="showAllData()" 
                            class="px-8 py-4 bg-gradient-to-r from-green-500 to-teal-600 text-white rounded-xl font-semibold hover:from-green-600 hover:to-teal-700 transform hover:scale-105 transition-all duration-300 shadow-lg"
                        >
                            <i class="fas fa-list mr-2"></i>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </button>
                    </div>
                </div>
                
                <div id="searchInfo" class="mt-4 text-center text-gray-600 hidden">
                    <span id="searchResult"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div id="loading" class="hidden container mx-auto px-6 py-12">
        <div class="text-center">
            <div class="glass-effect rounded-2xl p-12 max-w-md mx-auto">
                <i class="fas fa-spinner loading-spinner text-4xl text-purple-600 mb-4"></i>
                <p class="text-xl text-gray-700">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
            </div>
        </div>
    </div>

    <!-- Results -->
    <div class="container mx-auto px-6 py-8">
        <div id="results" class="grid gap-8 md:grid-cols-2 lg:grid-cols-3"></div>
    </div>

    <!-- Connection Warning -->
    <div id="apiWarning" class="hidden container mx-auto px-6 mb-8">
        <div class="glass-effect rounded-2xl p-6 border-l-4 border-red-500">
            <div class="flex items-start">
                <i class="fas fa-exclamation-triangle text-red-500 text-2xl mr-4 mt-1"></i>
                <div>
                    <h3 class="text-xl font-semibold text-red-700 mb-2">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡πÑ‡∏î‡πâ</h3>
                    <div class="text-red-600 space-y-2">
                        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:</p>
                        <ul class="list-disc list-inside space-y-1 ml-4">
                            <li>Google Sheets ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏õ‡πá‡∏ô "Anyone with the link can view"</li>
                            <li>Spreadsheet ID ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</li>
                            <li>‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏µ‡∏ï: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ" ‡∏™‡∏∞‡∏Å‡∏î‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</li>
                            <li>‡∏•‡∏≠‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- No Results -->
    <div id="noResults" class="hidden container mx-auto px-6 py-12">
        <div class="text-center">
            <div class="glass-effect rounded-2xl p-12 max-w-md mx-auto">
                <i class="fas fa-search text-6xl text-gray-400 mb-6"></i>
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                <p class="text-gray-500">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
            </div>
        </div>
    </div>

    <!-- Payment Details Modal -->
    <div id="paymentModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold mb-1">
                            <i class="fas fa-receipt mr-2"></i>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á
                        </h2>
                        <p id="modalHouseNo" class="text-blue-100"></p>
                    </div>
                    <button onclick="closePaymentModal()" class="text-white hover:text-gray-200 text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <!-- Modal Content -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                <div id="paymentDetailsContent">
                    <!-- Payment details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="hidden fixed inset-0 bg-black bg-opacity-90 z-[60] flex items-center justify-center p-4">
        <div class="relative max-w-6xl max-h-[95vh] w-full h-full flex items-center justify-center">
            <!-- Close button -->
            <button onclick="closeImageModal()" class="absolute top-4 right-4 z-10 bg-black bg-opacity-50 text-white rounded-full w-12 h-12 flex items-center justify-center hover:bg-opacity-70 transition-all duration-300">
                <i class="fas fa-times text-xl"></i>
            </button>
            
            <!-- Loading spinner -->
            <div id="imageLoading" class="absolute inset-0 flex items-center justify-center">
                <div class="bg-white bg-opacity-20 backdrop-blur-sm rounded-2xl p-8">
                    <i class="fas fa-spinner loading-spinner text-4xl text-white mb-4"></i>
                    <p class="text-white text-lg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...</p>
                </div>
            </div>
            
            <!-- Image container -->
            <div class="relative w-full h-full flex items-center justify-center">
                <img id="modalImage" class="max-w-full max-h-full object-contain rounded-lg shadow-2xl" style="display: none;" onload="hideImageLoading()" onerror="showImageError()">
                
                <!-- Error message -->
                <div id="imageError" class="hidden bg-red-500 bg-opacity-90 text-white rounded-2xl p-8 text-center">
                    <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
                    <h3 class="text-xl font-bold mb-2">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ</h3>
                    <p class="text-red-100">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                </div>
            </div>
            
            <!-- Image info -->
            <div class="absolute bottom-4 left-4 right-4 bg-black bg-opacity-50 backdrop-blur-sm text-white rounded-xl p-4">
                <div class="flex justify-between items-center">
                    <div>
                        <h4 id="imageTitle" class="font-semibold text-lg mb-1"></h4>
                        <p id="imageSubtitle" class="text-gray-300 text-sm"></p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="downloadImage()" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg transition-colors duration-300">
                            <i class="fas fa-download mr-2"></i>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
                        </button>
                        <button onclick="openImageInNewTab()" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg transition-colors duration-300">
                            <i class="fas fa-external-link-alt mr-2"></i>‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SHEET_ID = '1yklkO0OaVsZKpJc4EGcNDkpRsNd8DNWiJKlUnpBwBEE';
        const SHEET_NAME = '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ';
        
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á
        const PAYMENT_SHEET_ID = '1mRI_UrDLCy_4I6guONsscwJwWvLWyEgHB9VEEfCSZNA';
        const PAYMENT_SHEET_NAME = '‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á';
        
        // Telegram Configuration
        const TELEGRAM_TOKEN = '8285069899:AAF-L27XDknWC98-FMRvSod5ikV2tGO8Jgo';
        const TELEGRAM_CHAT_ID = '7585120244';
        
        const monthNames = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', 
                           '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
        
        let allData = [];
        let paymentData = [];

        async function loadPaymentData() {
            try {
                const csvUrl = `https://docs.google.com/spreadsheets/d/${PAYMENT_SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(PAYMENT_SHEET_NAME)}`;
                console.log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á...');
                
                const response = await fetch(csvUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const csvText = await response.text();
                const rows = parseCSV(csvText);
                
                if (rows && rows.length > 1) {
                    paymentData = rows.slice(1).filter(row => {
                        // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå E (index 4): ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà
                        // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå F (index 5): ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô  
                        // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå G (index 6): ‡∏õ‡∏µ
                        // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå N (index 13): ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                        const houseNo = row[4];
                        const month = row[5];
                        const year = row[6];
                        const status = row[13];
                        
                        return houseNo && month && year && status && 
                               houseNo.trim() !== '' && month.trim() !== '' && 
                               year.trim() !== '' && status.trim() !== '';
                    });
                    
                    console.log('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', paymentData.length, '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                    return Promise.resolve();
                } else {
                    console.log('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô Google Sheets');
                    paymentData = [];
                    return Promise.resolve();
                }
                
            } catch (error) {
                console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢:', error);
                paymentData = [];
                return Promise.resolve();
            }
        }

        async function loadData() {
            try {
                const csvUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}`;
                console.log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets...');
                
                const response = await fetch(csvUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const csvText = await response.text();
                const rows = parseCSV(csvText);
                
                if (rows && rows.length > 1) {
                    // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A-T (20 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏£‡∏Å)
                    allData = rows.slice(1).filter(row => {
                        const [invNo, houseNo, soi, name] = row;
                        return invNo && houseNo && soi && name && 
                               invNo !== 'undefined' && houseNo !== 'undefined' && 
                               soi !== 'undefined' && name !== 'undefined' &&
                               invNo.trim() !== '' && houseNo.trim() !== '' && 
                               soi.trim() !== '' && name.trim() !== '';
                    }).map(row => row.slice(0, 20)); // ‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A-T
                    
                    console.log('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', allData.length, '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                    hideApiKeyWarning();
                    return Promise.resolve();
                } else {
                    throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Google Sheets');
                }
                
            } catch (error) {
                console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', error);
                showApiKeyWarning();
                allData = [];
                return Promise.resolve();
            }
        }

        function parseCSV(csvText) {
            const rows = [];
            const lines = csvText.split('\n');
            
            for (let line of lines) {
                if (line.trim()) {
                    const row = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            row.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    
                    row.push(current.trim());
                    rows.push(row);
                }
            }
            
            return rows;
        }

        function getMonthStatusClass(status) {
            const statusLower = status.toLowerCase();
            if (statusLower.includes('‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß')) return 'status-paid';
            if (statusLower.includes('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢')) return 'status-unpaid';
            if (statusLower.includes('‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤')) return 'status-advance';
            if (statusLower.includes('‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö')) return 'status-exempt';
            if (statusLower.includes('‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•') || statusLower.includes('‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö')) return 'status-pending';
            if (statusLower.includes('‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô')) return 'status-contact-admin';
            return 'bg-gray-200 text-gray-800';
        }

        function calculateOverdueStatus(monthlyStatuses) {
            let overdueCount = 0;
            const currentMonth = new Date().getMonth();
            
            for (let i = 0; i <= currentMonth; i++) {
                const status = monthlyStatuses[i]?.toLowerCase() || '';
                if (status.includes('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢') || status.includes('‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•') || status.includes('‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö')) {
                    overdueCount++;
                }
            }

            if (overdueCount === 0) return { 
                text: '‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 
                icon: 'fas fa-check-circle', 
                color: 'text-white',
                headerBg: 'from-green-500 to-green-600'
            };
            if (overdueCount === 1) return { 
                text: '‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞ 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô', 
                icon: 'fas fa-exclamation-triangle', 
                color: 'text-white',
                headerBg: 'from-yellow-500 to-yellow-600'
            };
            if (overdueCount === 2) return { 
                text: '‡∏£‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', 
                icon: 'fas fa-bell', 
                color: 'text-white',
                headerBg: 'from-orange-400 to-orange-500'
            };
            if (overdueCount === 3) return { 
                text: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', 
                icon: 'fas fa-file-invoice', 
                color: 'text-white',
                headerBg: 'from-orange-500 to-red-400'
            };
            if (overdueCount >= 4 && overdueCount <= 5) return { 
                text: '‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡πå‡∏ï‡πà‡∏≤‡∏á‡πÜ', 
                icon: 'fas fa-ban', 
                color: 'text-white',
                headerBg: 'from-red-500 to-red-600'
            };
            if (overdueCount >= 6) return { 
                text: '‡πÅ‡∏à‡πâ‡∏á‡∏≠‡∏≤‡∏¢‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô', 
                icon: 'fas fa-gavel', 
                color: 'text-white',
                headerBg: 'from-red-700 to-red-800'
            };
            
            return { 
                text: `‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞ ${overdueCount} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`, 
                icon: 'fas fa-times-circle', 
                color: 'text-white',
                headerBg: 'from-red-500 to-red-600'
            };
        }

        function calculateTotalAmount(monthlyStatuses) {
            let totalPaid = 0;
            let totalUnpaid = 0;
            let totalAdvance = 0;

            monthlyStatuses.forEach(status => {
                const statusLower = status.toLowerCase();
                if (statusLower.includes('‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß')) {
                    totalPaid += 300;
                } else if (statusLower.includes('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢') || statusLower.includes('‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•') || statusLower.includes('‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö')) {
                    totalUnpaid += 300;
                } else if (statusLower.includes('‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤')) {
                    totalAdvance += 300;
                }
            });

            return { totalPaid, totalUnpaid, totalAdvance };
        }

        async function sendTelegramNotification(houseNo, searchResults) {
            try {
                if (!searchResults || searchResults.length === 0) {
                    return;
                }

                let message = `üè† *‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤*\n`;
                message += `üìç ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: *${houseNo}*\n`;
                message += `üìä ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: *${searchResults.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£*\n\n`;

                searchResults.forEach((rowData, index) => {
                    const [invNo, houseNo, soi, name, transferDate, status, dueMonth, year, ...monthlyStatuses] = rowData;
                    const updatedMonthlyStatuses = updateMonthlyStatusWithPayments(houseNo, year, monthlyStatuses);
                    const overdueStatus = calculateOverdueStatus(updatedMonthlyStatuses);
                    const amounts = calculateTotalAmount(updatedMonthlyStatuses);

                    message += `üìã *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${index + 1} (‡∏õ‡∏µ ${year})*\n`;
                    message += `üë§ ‡∏ä‡∏∑‡πà‡∏≠: ${name}\n`;
                    message += `üèòÔ∏è ‡∏ã‡∏≠‡∏¢: ${soi}\n`;
                    message += `üìÖ ‡∏ß‡∏±‡∏ô‡πÇ‡∏≠‡∏ô: ${transferDate}\n`;
                    message += `üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${status}\n`;
                    message += `‚ö†Ô∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: *${overdueStatus.text}*\n`;
                    
                    message += `üí∞ *‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô:*\n`;
                    message += `‚úÖ ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß: ${amounts.totalPaid.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n`;
                    message += `‚ùå ‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞: ${amounts.totalUnpaid.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n`;
                    message += `üîÑ ‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤: ${amounts.totalAdvance.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n`;

                    // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                    message += `üìÖ *‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:*\n`;
                    const monthlyStatus = updatedMonthlyStatuses.slice(0, 12).map((status, monthIndex) => {
                        const monthName = monthNames[monthIndex];
                        let emoji = '‚ùì';
                        if (status.toLowerCase().includes('‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß')) emoji = '‚úÖ';
                        else if (status.toLowerCase().includes('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢')) emoji = '‚ùå';
                        else if (status.toLowerCase().includes('‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤')) emoji = 'üîÑ';
                        else if (status.toLowerCase().includes('‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö')) emoji = '‚≠ï';
                        else if (status.toLowerCase().includes('‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•') || status.toLowerCase().includes('‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö')) emoji = '‚è≥';
                        
                        return `${emoji} ${monthName}`;
                    }).join(' ');
                    
                    message += monthlyStatus + '\n';
                    
                    if (index < searchResults.length - 1) {
                        message += '\n' + '‚îÄ'.repeat(30) + '\n\n';
                    }
                });

                message += `\nüïê ‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: ${new Date().toLocaleString('th-TH')}`;

                const telegramUrl = `https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`;
                
                const response = await fetch(telegramUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: TELEGRAM_CHAT_ID,
                        text: message,
                        parse_mode: 'Markdown'
                    })
                });

                if (response.ok) {
                    console.log('‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Telegram ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                } else {
                    console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á Telegram:', await response.text());
                }

            } catch (error) {
                console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Telegram:', error);
            }
        }

        function showApiKeyWarning() {
            document.getElementById('apiWarning').classList.remove('hidden');
        }

        function hideApiKeyWarning() {
            document.getElementById('apiWarning').classList.add('hidden');
        }

        function updateMonthlyStatusWithPayments(houseNo, year, monthlyStatuses) {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏Ç‡∏≠‡∏á monthlyStatuses ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö
            const updatedStatuses = [...monthlyStatuses];
            
            // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏õ‡∏µ
            const payments = paymentData.filter(payment => {
                // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå E (index 4): ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà
                // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå F (index 5): ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô  
                // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå G (index 6): ‡∏õ‡∏µ
                // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå N (index 13): ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                const paymentHouseNo = payment[4]; // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå E
                const paymentMonth = payment[5];   // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå F
                const paymentYear = payment[6];    // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå G
                const paymentStatus = payment[13]; // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå N
                
                return paymentHouseNo && paymentMonth && paymentYear && paymentStatus &&
                       paymentHouseNo.trim() === houseNo.trim() && 
                       paymentYear.trim() === year.trim();
            });
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢
            payments.forEach(payment => {
                const paymentMonth = payment[5];   // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå F: ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                const paymentStatus = payment[13]; // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå N: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                const monthIndex = parseInt(paymentMonth) - 1; // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô index (0-11)
                
                if (monthIndex >= 0 && monthIndex < 12 && paymentStatus) {
                    const statusLower = paymentStatus.toLowerCase().trim();
                    
                    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç
                    if (statusLower.includes('‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö')) {
                        updatedStatuses[monthIndex] = '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö';
                    } else if (statusLower.includes('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß')) {
                        updatedStatuses[monthIndex] = '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß';
                    } else if (statusLower.includes('‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô')) {
                        updatedStatuses[monthIndex] = '‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô';
                    }
                }
            });
            
            return updatedStatuses;
        }

        function createCard(rowData) {
            const [invNo, houseNo, soi, name, transferDate, status, dueMonth, year, ...monthlyStatuses] = rowData;
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢
            const updatedMonthlyStatuses = updateMonthlyStatusWithPayments(houseNo, year, monthlyStatuses);
            
            const overdueStatus = calculateOverdueStatus(updatedMonthlyStatuses);
            const amounts = calculateTotalAmount(updatedMonthlyStatuses);

            return `
                <div class="bg-white rounded-2xl shadow-xl card-hover overflow-hidden fade-in">
                    <!-- Header -->
                    <div class="bg-gradient-to-r ${overdueStatus.headerBg} text-white p-6">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-2xl font-bold mb-1">
                                    <i class="fas fa-home mr-2"></i>${houseNo}
                                </h3>
                                <p class="text-white/80">${soi}</p>
                            </div>
                            <div class="text-right">
                                <i class="${overdueStatus.icon} ${overdueStatus.color} text-2xl mb-1"></i>
                                <p class="text-sm font-medium">${overdueStatus.text}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Content -->
                    <div class="p-6">
                        <!-- Personal Info -->
                        <div class="mb-6">
                            <h4 class="text-lg font-semibold text-gray-800 mb-3">
                                <i class="fas fa-user mr-2 text-purple-600"></i>${name}
                            </h4>
                            <div class="grid grid-cols-1 gap-3 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-500">‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà :</span>
                                    <span class="font-semibold">${houseNo}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">‡∏ã‡∏≠‡∏¢ :</span>
                                    <span class="font-semibold">${soi}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">‡∏ß‡∏±‡∏ô‡πÇ‡∏≠‡∏ô :</span>
                                    <span class="font-semibold">${transferDate}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ :</span>
                                    <span class="font-semibold text-purple-600">${status}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Monthly Status Grid -->
                        <div class="mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <h5 class="font-semibold text-gray-700 flex items-center">
                                    <i class="fas fa-calendar-alt mr-2 text-purple-600"></i>
                                    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (${year})
                                </h5>
                                <button 
                                    onclick="showPaymentDetails('${houseNo}')" 
                                    class="px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg text-sm font-medium hover:from-blue-600 hover:to-blue-700 transform hover:scale-105 transition-all duration-300 shadow-md"
                                >
                                    <i class="fas fa-info-circle mr-1"></i>‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                                </button>
                            </div>
                            <div class="month-grid">
                                ${updatedMonthlyStatuses.slice(0, 12).map((monthStatus, index) => `
                                    <div class="month-card ${getMonthStatusClass(monthStatus)}" title="${monthNames[index]}: ${monthStatus}">
                                        <div class="font-bold">${monthNames[index]}</div>
                                        <div class="text-xs mt-1 leading-tight">${monthStatus}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Financial Summary -->
                        <div class="bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl p-4">
                            <h5 class="font-semibold text-gray-700 mb-4 flex items-center">
                                <i class="fas fa-chart-pie mr-2 text-purple-600"></i>
                                ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (300 ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)
                            </h5>
                            <div class="grid grid-cols-3 gap-4">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-green-600 mb-1">
                                        ${amounts.totalPaid.toLocaleString()}
                                    </div>
                                    <div class="text-xs text-gray-500">‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-red-600 mb-1">
                                        ${amounts.totalUnpaid.toLocaleString()}
                                    </div>
                                    <div class="text-xs text-gray-500">‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-blue-600 mb-1">
                                        ${amounts.totalAdvance.toLocaleString()}
                                    </div>
                                    <div class="text-xs text-gray-500">‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function searchData() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const noResults = document.getElementById('noResults');
            const searchInfo = document.getElementById('searchInfo');
            const searchResult = document.getElementById('searchResult');

            if (!searchTerm) {
                showAllData();
                return;
            }

            loading.classList.remove('hidden');
            results.innerHTML = '';
            noResults.classList.add('hidden');
            searchInfo.classList.add('hidden');

            setTimeout(async () => {
                const filteredData = allData.filter(row => {
                    const houseNo = row[1];
                    return houseNo && houseNo.toString().trim() === searchTerm;
                });

                loading.classList.add('hidden');

                if (filteredData.length > 0) {
                    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏õ‡∏µ (‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà 7) ‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢
                    const sortedFilteredData = filteredData.sort((a, b) => {
                        const yearA = parseInt(a[7]) || 0;
                        const yearB = parseInt(b[7]) || 0;
                        return yearB - yearA; // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢ (‡∏õ‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô)
                    });
                    
                    results.innerHTML = sortedFilteredData.map(createCard).join('');
                    searchResult.innerHTML = `<i class="fas fa-check-circle mr-2"></i>‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà "${searchTerm}" ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${filteredData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)`;
                    searchInfo.classList.remove('hidden');
                    
                    // ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Telegram
                    await sendTelegramNotification(searchTerm, sortedFilteredData);
                } else {
                    noResults.classList.remove('hidden');
                    searchResult.innerHTML = `<i class="fas fa-times-circle mr-2"></i>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà "${searchTerm}"`;
                    searchInfo.classList.remove('hidden');
                }
            }, 1000);
        }

        function showAllData() {
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const noResults = document.getElementById('noResults');
            const searchInfo = document.getElementById('searchInfo');
            const searchResult = document.getElementById('searchResult');

            loading.classList.remove('hidden');
            results.innerHTML = '';
            noResults.classList.add('hidden');
            searchInfo.classList.add('hidden');

            setTimeout(() => {
                loading.classList.add('hidden');

                if (allData.length > 0) {
                    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏õ‡∏µ (‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà 7) ‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢
                    const sortedData = [...allData].sort((a, b) => {
                        const yearA = parseInt(a[7]) || 0;
                        const yearB = parseInt(b[7]) || 0;
                        return yearB - yearA; // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢ (‡∏õ‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô)
                    });
                    
                    results.innerHTML = sortedData.map(createCard).join('');
                    searchResult.innerHTML = `<i class="fas fa-list mr-2"></i>‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${allData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)`;
                    searchInfo.classList.remove('hidden');
                } else {
                    noResults.classList.remove('hidden');
                    searchResult.innerHTML = `<i class="fas fa-exclamation-triangle mr-2"></i>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö`;
                    searchInfo.classList.remove('hidden');
                }
            }, 1000);
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchData();
            }
        });

        function showPaymentDetails(houseNo) {
            const modal = document.getElementById('paymentModal');
            const modalHouseNo = document.getElementById('modalHouseNo');
            const content = document.getElementById('paymentDetailsContent');
            
            modalHouseNo.textContent = `‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: ${houseNo}`;
            
            // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà
            const housePayments = paymentData.filter(payment => {
                const paymentHouseNo = payment[4]; // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå E: ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà
                return paymentHouseNo && paymentHouseNo.trim() === houseNo.trim();
            });
            
            if (housePayments.length === 0) {
                content.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-inbox text-6xl text-gray-300 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢</h3>
                        <p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ</p>
                    </div>
                `;
            } else {
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏õ‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏•‡∏á‡πÑ‡∏õ
                const sortedPayments = housePayments.sort((a, b) => {
                    const yearA = parseInt(a[6]) || 0; // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå G: ‡∏õ‡∏µ
                    const yearB = parseInt(b[6]) || 0;
                    const monthA = parseInt(a[5]) || 0; // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå F: ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                    const monthB = parseInt(b[5]) || 0;
                    
                    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏µ‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢ (‡∏õ‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô)
                    if (yearA !== yearB) return yearB - yearA;
                    // ‡∏ñ‡πâ‡∏≤‡∏õ‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢ (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏•‡∏á‡πÑ‡∏õ)
                    return monthB - monthA;
                });
                
                content.innerHTML = `
                    <div class="space-y-4">
                        ${sortedPayments.map(payment => createPaymentCard(payment)).join('')}
                    </div>
                `;
            }
            
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        function createPaymentCard(payment) {
            const [id, date, uid, name, houseNo, month, year, paymentType, note, amountText, amount, imageUrl, checker, status, checkDate, pdfUrl] = payment;
            
            const monthName = monthNames[parseInt(month) - 1] || month;
            const statusClass = getPaymentStatusClass(status);
            const statusIcon = getPaymentStatusIcon(status);
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠
            const nameColors = [
                'bg-gradient-to-r from-purple-500 to-purple-600', 
                'bg-gradient-to-r from-blue-500 to-blue-600', 
                'bg-gradient-to-r from-green-500 to-green-600', 
                'bg-gradient-to-r from-red-500 to-red-600', 
                'bg-gradient-to-r from-yellow-500 to-yellow-600', 
                'bg-gradient-to-r from-pink-500 to-pink-600', 
                'bg-gradient-to-r from-indigo-500 to-indigo-600', 
                'bg-gradient-to-r from-teal-500 to-teal-600'
            ];
            const nameColorIndex = name.length % nameColors.length;
            const nameGradient = nameColors[nameColorIndex];
            
            return `
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 hover:shadow-xl transition-all duration-300 overflow-hidden">
                    <!-- Header with gradient -->
                    <div class="${nameGradient} text-white p-6">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="text-xl font-bold mb-2 flex items-center">
                                    <i class="fas fa-calendar-alt mr-2"></i>
                                    ${monthName} ${year}
                                </h4>
                                <div class="bg-white/20 backdrop-blur-sm rounded-full px-4 py-2 inline-block">
                                    <span class="font-semibold text-white">${name}</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="inline-flex items-center px-4 py-2 bg-white/20 backdrop-blur-sm rounded-full text-sm font-medium text-white">
                                    <i class="${statusIcon} mr-2"></i>${status}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div class="p-6">
                        <!-- Amount highlight -->
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 mb-6 border border-green-100">
                            <div class="text-center">
                                <p class="text-sm text-green-600 font-medium mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</p>
                                <p class="text-3xl font-bold text-green-700">${parseInt(amount).toLocaleString()} <span class="text-lg">‡∏ö‡∏≤‡∏ó</span></p>
                                <p class="text-sm text-green-600 mt-1">${paymentType}</p>
                            </div>
                        </div>
                        
                        <!-- Details grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="space-y-4">
                                <h5 class="font-semibold text-gray-700 flex items-center border-b border-gray-200 pb-2">
                                    <i class="fas fa-info-circle mr-2 text-blue-500"></i>
                                    ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á
                                </h5>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-500 text-sm flex items-center">
                                            <i class="fas fa-calendar mr-2 text-gray-400"></i>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á
                                        </span>
                                        <span class="font-medium text-gray-800">${date}</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-500 text-sm flex items-center">
                                            <i class="fas fa-credit-card mr-2 text-gray-400"></i>‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢
                                        </span>
                                        <span class="font-medium text-gray-800">${paymentType}</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-500 text-sm flex items-center">
                                            <i class="fas fa-hashtag mr-2 text-gray-400"></i>‡∏£‡∏´‡∏±‡∏™‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
                                        </span>
                                        <span class="font-mono text-sm text-gray-600 bg-gray-100 px-2 py-1 rounded">${id}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <h5 class="font-semibold text-gray-700 flex items-center border-b border-gray-200 pb-2">
                                    <i class="fas fa-user-check mr-2 text-green-500"></i>
                                    ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                                </h5>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-500 text-sm flex items-center">
                                            <i class="fas fa-user mr-2 text-gray-400"></i>‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                                        </span>
                                        <span class="font-medium text-gray-800">${checker || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'}</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-500 text-sm flex items-center">
                                            <i class="fas fa-clock mr-2 text-gray-400"></i>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                                        </span>
                                        <span class="font-medium text-gray-800">${checkDate || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'}</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-500 text-sm flex items-center">
                                            <i class="fas fa-flag mr-2 text-gray-400"></i>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                                        </span>
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${statusClass}">
                                            <i class="${statusIcon} mr-1"></i>${status}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        ${note ? `
                            <div class="mb-6">
                                <h5 class="font-semibold text-gray-700 flex items-center mb-3">
                                    <i class="fas fa-sticky-note mr-2 text-yellow-500"></i>
                                    ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
                                </h5>
                                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-lg">
                                    <p class="text-gray-700">${note}</p>
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- Action buttons -->
                        <div class="flex gap-3 flex-wrap pt-4 border-t border-gray-100">
                            ${imageUrl ? `
                                <button onclick="showImageModal('${imageUrl}', '${monthName} ${year}', '${name} - ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${houseNo}')" class="flex-1 min-w-[140px] inline-flex items-center justify-center px-4 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-medium hover:from-blue-600 hover:to-blue-700 transform hover:scale-105 transition-all duration-300 shadow-lg">
                                    <i class="fas fa-receipt mr-2"></i>‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ
                                </button>
                            ` : ''}
                            ${pdfUrl ? `
                                <button onclick="showImageModal('${convertGoogleDrivePdfToImage(pdfUrl)}', '‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à ${monthName} ${year}', '${name} - ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${houseNo}')" class="flex-1 min-w-[140px] inline-flex items-center justify-center px-4 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl font-medium hover:from-red-600 hover:to-red-700 transform hover:scale-105 transition-all duration-300 shadow-lg">
                                    <i class="fas fa-file-invoice mr-2"></i>‡∏î‡∏π‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à
                                </button>
                            ` : ''}
                            ${!imageUrl && !pdfUrl ? `
                                <div class="w-full text-center py-4">
                                    <p class="text-gray-500 text-sm">
                                        <i class="fas fa-info-circle mr-1"></i>
                                        ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö
                                    </p>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getPaymentStatusClass(status) {
            const statusLower = status?.toLowerCase() || '';
            if (statusLower.includes('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß')) return 'bg-green-100 text-green-800';
            if (statusLower.includes('‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö')) return 'bg-yellow-100 text-yellow-800';
            if (statusLower.includes('‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô')) return 'bg-red-100 text-red-800';
            return 'bg-gray-100 text-gray-800';
        }
        
        function getPaymentStatusIcon(status) {
            const statusLower = status?.toLowerCase() || '';
            if (statusLower.includes('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß')) return 'fas fa-check-circle';
            if (statusLower.includes('‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö')) return 'fas fa-clock';
            if (statusLower.includes('‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô')) return 'fas fa-exclamation-triangle';
            return 'fas fa-question-circle';
        }
        
        function closePaymentModal() {
            const modal = document.getElementById('paymentModal');
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
        
        // Close modal when clicking outside
        document.getElementById('paymentModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePaymentModal();
            }
        });

        // PDF to Image Conversion Function
        function convertGoogleDrivePdfToImage(pdfUrl) {
            if (!pdfUrl) return '';
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Google Drive URL ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (pdfUrl.includes('drive.google.com')) {
                // ‡πÅ‡∏¢‡∏Å file ID ‡∏à‡∏≤‡∏Å Google Drive URL
                let fileId = '';
                
                // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: https://drive.google.com/file/d/FILE_ID/view
                if (pdfUrl.includes('/file/d/')) {
                    const match = pdfUrl.match(/\/file\/d\/([a-zA-Z0-9-_]+)/);
                    if (match) fileId = match[1];
                }
                // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: https://drive.google.com/open?id=FILE_ID
                else if (pdfUrl.includes('open?id=')) {
                    const match = pdfUrl.match(/open\?id=([a-zA-Z0-9-_]+)/);
                    if (match) fileId = match[1];
                }
                // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: https://docs.google.com/document/d/FILE_ID/
                else if (pdfUrl.includes('docs.google.com')) {
                    const match = pdfUrl.match(/\/d\/([a-zA-Z0-9-_]+)/);
                    if (match) fileId = match[1];
                }
                
                // ‡∏ñ‡πâ‡∏≤‡∏û‡∏ö file ID ‡πÉ‡∏´‡πâ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô direct image URL
                if (fileId) {
                    // ‡πÉ‡∏ä‡πâ Google Drive Viewer API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á PDF ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
                    return `https://drive.google.com/thumbnail?id=${fileId}&sz=w2000`;
                }
            }
            
            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Google Drive URL ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ URL ‡πÄ‡∏î‡∏¥‡∏°
            return pdfUrl;
        }

        // Image Modal Functions
        let currentImageUrl = '';

        function showImageModal(imageUrl, title, subtitle) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const imageTitle = document.getElementById('imageTitle');
            const imageSubtitle = document.getElementById('imageSubtitle');
            const imageLoading = document.getElementById('imageLoading');
            const imageError = document.getElementById('imageError');
            
            currentImageUrl = imageUrl;
            imageTitle.textContent = title;
            imageSubtitle.textContent = subtitle;
            
            // Reset states
            modalImage.style.display = 'none';
            imageLoading.classList.remove('hidden');
            imageError.classList.add('hidden');
            
            // Set image source
            modalImage.src = imageUrl;
            
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
            
            // Clear image source to stop loading
            const modalImage = document.getElementById('modalImage');
            modalImage.src = '';
        }

        function hideImageLoading() {
            const modalImage = document.getElementById('modalImage');
            const imageLoading = document.getElementById('imageLoading');
            
            modalImage.style.display = 'block';
            imageLoading.classList.add('hidden');
        }

        function showImageError() {
            const imageLoading = document.getElementById('imageLoading');
            const imageError = document.getElementById('imageError');
            
            imageLoading.classList.add('hidden');
            imageError.classList.remove('hidden');
        }

        function downloadImage() {
            if (currentImageUrl) {
                const link = document.createElement('a');
                link.href = currentImageUrl;
                link.download = `slip_${Date.now()}.jpg`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        function openImageInNewTab() {
            if (currentImageUrl) {
                window.open(currentImageUrl, '_blank');
            }
        }

        // Close image modal when clicking outside
        document.getElementById('imageModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeImageModal();
            }
        });

        // Close image modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const imageModal = document.getElementById('imageModal');
                const paymentModal = document.getElementById('paymentModal');
                
                if (!imageModal.classList.contains('hidden')) {
                    closeImageModal();
                } else if (!paymentModal.classList.contains('hidden')) {
                    closePaymentModal();
                }
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            Promise.all([loadData(), loadPaymentData()]).then(() => {
                if (allData.length > 0) {
                    showAllData();
                }
            });
        });
    </script>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-16">
        <div class="container mx-auto px-6 text-center">
            <div class="mb-4">
                <i class="fas fa-home text-3xl text-purple-400 mb-2"></i>
                <h3 class="text-xl font-semibold">‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ</h3>
            </div>
            <div class="border-t border-gray-700 pt-4">
                <p class="text-gray-400">
                    ¬© 2025 <span class="text-purple-400 font-semibold">9one</span> - All rights reserved
                </p>
            </div>
        </div>
    </footer>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97d069cf64017b48',t:'MTc1NzUyMjkxMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
