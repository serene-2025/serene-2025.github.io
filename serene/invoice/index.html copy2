<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link rel="stylesheet" href="style.css">
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
</head>
<body>
    <header>
        <!-- ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì -->
        <img src="https://cdn.glitch.global/4e71954f-9396-4d19-8fc1-d58002e06dda/thumbnails%2Flogo%20serene23.png?1736658072642" alt="Logo" class="logo">
    </header>

    <div class="container">
        <h1>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h1>

        <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå -->
        <div id="profile" style="display: none; text-align: center;">
            <img id="profileImage" src="" alt="Profile Image" style="border-radius: 50%; width: 100px; height: 100px;">
            <p id="displayName"></p>
        </div>

        <form id="tenantForm">

            <label for="name">ü§π‚Äç‚ôÇÔ∏è ‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label>
            <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•" id="name" name="name" required>

            <label for="phone">üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label>
            <input type="tel" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö" id="phone" name="phone" required>

          <label for="name1">üè° ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</label>
            <input type="text" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ‡πÄ‡∏ä‡πà‡∏ô 998/88" id="name1" name="name1" required>

          <label for="room">üöè ‡∏ã‡∏≠‡∏¢</label>
            <select id="room" name="room" required>
              <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ã‡∏≠‡∏¢</option>
               <option value="1">‡∏ã‡∏≠‡∏¢ 1</option>
               <option value="2">‡∏ã‡∏≠‡∏¢ 2</option>
              <option value="3">‡∏ã‡∏≠‡∏¢ 3</option>
               <option value="4">‡∏ã‡∏≠‡∏¢ 4</option>
              <option value="5">‡∏ã‡∏≠‡∏¢ 5</option>
              <option value="6">‡∏ã‡∏≠‡∏¢ 6</option>
               <option value="7">‡∏ã‡∏≠‡∏¢ 7</option>
               <option value="8">‡∏ã‡∏≠‡∏¢ 8</option>
                <option value="9">‡∏ã‡∏≠‡∏¢ 9</option>
                <option value="10">‡∏ã‡∏≠‡∏¢ 10</option>
                <option value="11">‡∏ã‡∏≠‡∏¢ 11</option>
                <option value="12">‡∏ã‡∏≠‡∏¢ 12</option>
            </select>

          <label for="name2">üè™ ‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢(‡πÄ‡∏à‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô/‡∏ú‡∏π‡πâ‡∏≠‡∏≤‡∏®‡∏±‡∏¢/‡πÄ‡∏ä‡πà‡∏≤)</label>
            <select id="name2" name="name2" required>
              <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢</option>
                                            <option value="‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡πâ‡∏≤‡∏ô">‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡πâ‡∏≤‡∏ô</option>
                                            <option value="‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡πà‡∏ß‡∏°">‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡πà‡∏ß‡∏°</option>
                                            <option value="‡∏ú‡∏π‡πâ‡∏≠‡∏≤‡∏®‡∏±‡∏¢">‡∏ú‡∏π‡πâ‡∏≠‡∏≤‡∏®‡∏±‡∏¢</option>
                                            <option value="‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤">‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤</option>
                                            <option value="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡∏≠‡∏¢‡∏π‡πà">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡∏≠‡∏¢‡∏π‡πà</option>
                                            <option value="‡∏ö‡πâ‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏á">‡∏ö‡πâ‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏á</option>
                                            <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
            </select>

          <label for="name3">üë©‚Äçüë©‚Äçüëß‚Äçüë¶ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô</label>
            <select id="name3" name="name3" required>
                                            <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô</option>
                                            <option value="1">1 ‡∏Ñ‡∏ô</option>
                                            <option value="2">2 ‡∏Ñ‡∏ô</option>
                                            <option value="3">3 ‡∏Ñ‡∏ô</option>
                                            <option value="4">4 ‡∏Ñ‡∏ô</option>
                                            <option value="5">5 ‡∏Ñ‡∏ô</option>
                                            <option value="6">6 ‡∏Ñ‡∏ô</option>
                                            <option value="7">7 ‡∏Ñ‡∏ô</option>
                                            <option value="8">8 ‡∏Ñ‡∏ô</option>
                                            <option value="9">9 ‡∏Ñ‡∏ô</option>
                                            <option value="10">10 ‡∏Ñ‡∏ô</option>
            </select>

   <label for="name4">üìß E-mail(‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏ö‡∏¥‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á)</label>
            <input type="text" class="form-control" placeholder="E-mail(‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏ö‡∏¥‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á)" id="name4" name="name4">

             <label for="name5">Line ID</label>
            <input type="text" placeholder="Line ID" id="name5" name="name5" >

            <input type="hidden" id="userId" name="userId">
            <input type="hidden" id="profileImageUrl" name="profileImageUrl">
            <input type="hidden" id="lineDisplayName" name="lineDisplayName">

            <button type="submit">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        async function initLiff() {
            // ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
            const liffId = "2000143615-D9GLpGqy";

            // Show loading SweetAlert
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...',
                text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            await liff.init({ liffId: liffId });
            if (liff.isLoggedIn()) {
                const profile = await liff.getProfile();
                const userId = profile.userId;
                const displayName = profile.displayName;
                document.getElementById('userId').value = userId;
                document.getElementById('profileImage').src = profile.pictureUrl;
                document.getElementById('displayName').textContent = profile.displayName;
                document.getElementById('profileImageUrl').value = profile.pictureUrl;
                document.getElementById('lineDisplayName').value = displayName; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ
                document.getElementById('profile').style.display = 'block';

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
                fetch('https://script.google.com/macros/s/AKfycbxJPZzU2epM28NpDuvqJqLGbmHBo-Ga5UlEwtLoB94_fx5sZ7ht2HhM70p8LXPmzzb0eA/exec?action=getTenantInfo&userId=' + userId)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ info.html
                        window.location.href = 'info.html';
                    } else {
                        Swal.close();
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    Swal.close();
                });
            } else {
                liff.login();
                Swal.close();
            }
        }

        initLiff();

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß
        function fetchRegisteredRooms() {
            fetch('https://script.google.com/macros/s/AKfycbxJPZzU2epM28NpDuvqJqLGbmHBo-Ga5UlEwtLoB94_fx5sZ7ht2HhM70p8LXPmzzb0eA/exec?action=getRegisteredRooms')
            .then(response => response.json())
            .then(registeredRooms => {
                const roomSelect = document.getElementById('userId');
                Array.from(roomSelect.options).forEach(option => {
                    option.disabled = false;
                });
                registeredRooms.forEach(userId => {
                    const option = roomSelect.querySelector(`option[value="${userId}"]`);
                    if (option) {
                        option.disabled = true;
                    }
                });
                Swal.close();
            })
            .catch(error => {
                console.error('Error:', error);
                Swal.close();
            });
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Flex Message
        async function sendMessages(userId) {
            const flexMessage = {
                type: "flex",
                altText: "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
                contents: {
                    type: "bubble",
                    body: {
                        type: "box",
                        layout: "vertical",
                        contents: [
                            {
                                type: "text",
                                text: "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
                                weight: "bold",
                                size: "xl"
                            },
                            {
                                type: "text",
                                text: "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô",
                                size: "md"
                            }
                        ]
                    }
                }
            };

            await liff.sendMessages([flexMessage]);
        }

        document.getElementById('tenantForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const formData = new FormData(this);
            const formObj = {};
            formData.forEach((value, key) => formObj[key] = value);

            fetch('https://script.google.com/macros/s/AKfycbxJPZzU2epM28NpDuvqJqLGbmHBo-Ga5UlEwtLoB94_fx5sZ7ht2HhM70p8LXPmzzb0eA/exec?action=registerTenant', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams(formObj)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        text: '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        icon: 'success',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                    }).then(() => {
                        document.getElementById('tenantForm').reset();
                        // fetchRegisteredRooms();
                        window.location.href = 'info.html';
                        sendMessages(document.getElementById('userId').value); // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Flex Message
                    });
                } else {
                    Swal.fire({
                        title: '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                        text: '‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß',
                        icon: 'error',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                    });
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });

        // ‡∏î‡∏∂‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏û‡∏à
        // fetchRegisteredRooms();
    </script>
</body>
</html>
